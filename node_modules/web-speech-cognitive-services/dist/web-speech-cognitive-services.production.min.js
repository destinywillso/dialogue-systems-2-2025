"use strict";(()=>{var fw=Object.create;var Xg=Object.defineProperty;var gw=Object.getOwnPropertyDescriptor;var mw=Object.getOwnPropertyNames;var yw=Object.getPrototypeOf,Sw=Object.prototype.hasOwnProperty;var u=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);var Cw=(r,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of mw(e))!Sw.call(r,n)&&n!==t&&Xg(r,n,{get:()=>e[n],enumerable:!(i=gw(e,n))||i.enumerable});return r};var yp=(r,e,t)=>(t=r!=null?fw(yw(r)):{},Cw(e||!r||!r.__esModule?Xg(t,"default",{value:r,enumerable:!0}):t,r));var Cp=u(Sp=>{"use strict";Object.defineProperty(Sp,"__esModule",{value:!0});Sp.default=Rw;var xs,Pw=new Uint8Array(16);function Rw(){if(!xs&&(xs=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!xs))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return xs(Pw)}});var Zg=u(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.default=void 0;var Ew=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;Ns.default=Ew});var Pn=u(js=>{"use strict";Object.defineProperty(js,"__esModule",{value:!0});js.default=void 0;var ww=Iw(Zg());function Iw(r){return r&&r.__esModule?r:{default:r}}function _w(r){return typeof r=="string"&&ww.default.test(r)}var bw=_w;js.default=bw});var En=u(Rn=>{"use strict";Object.defineProperty(Rn,"__esModule",{value:!0});Rn.default=void 0;Rn.unsafeStringify=Yg;var Aw=Tw(Pn());function Tw(r){return r&&r.__esModule?r:{default:r}}var de=[];for(let r=0;r<256;++r)de.push((r+256).toString(16).slice(1));function Yg(r,e=0){return de[r[e+0]]+de[r[e+1]]+de[r[e+2]]+de[r[e+3]]+"-"+de[r[e+4]]+de[r[e+5]]+"-"+de[r[e+6]]+de[r[e+7]]+"-"+de[r[e+8]]+de[r[e+9]]+"-"+de[r[e+10]]+de[r[e+11]]+de[r[e+12]]+de[r[e+13]]+de[r[e+14]]+de[r[e+15]]}function Ow(r,e=0){let t=Yg(r,e);if(!(0,Aw.default)(t))throw TypeError("Stringified UUID is invalid");return t}var kw=Ow;Rn.default=kw});var tm=u(qs=>{"use strict";Object.defineProperty(qs,"__esModule",{value:!0});qs.default=void 0;var Mw=xw(Cp()),Dw=En();function xw(r){return r&&r.__esModule?r:{default:r}}var em,Pp,Rp=0,Ep=0;function Nw(r,e,t){let i=e&&t||0,n=e||new Array(16);r=r||{};let s=r.node||em,o=r.clockseq!==void 0?r.clockseq:Pp;if(s==null||o==null){let v=r.random||(r.rng||Mw.default)();s==null&&(s=em=[v[0]|1,v[1],v[2],v[3],v[4],v[5]]),o==null&&(o=Pp=(v[6]<<8|v[7])&16383)}let a=r.msecs!==void 0?r.msecs:Date.now(),c=r.nsecs!==void 0?r.nsecs:Ep+1,p=a-Rp+(c-Ep)/1e4;if(p<0&&r.clockseq===void 0&&(o=o+1&16383),(p<0||a>Rp)&&r.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Rp=a,Ep=c,Pp=o,a+=122192928e5;let h=((a&268435455)*1e4+c)%4294967296;n[i++]=h>>>24&255,n[i++]=h>>>16&255,n[i++]=h>>>8&255,n[i++]=h&255;let d=a/4294967296*1e4&268435455;n[i++]=d>>>8&255,n[i++]=d&255,n[i++]=d>>>24&15|16,n[i++]=d>>>16&255,n[i++]=o>>>8|128,n[i++]=o&255;for(let v=0;v<6;++v)n[i+v]=s[v];return e||(0,Dw.unsafeStringify)(n)}var jw=Nw;qs.default=jw});var wp=u(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});zs.default=void 0;var qw=zw(Pn());function zw(r){return r&&r.__esModule?r:{default:r}}function Lw(r){if(!(0,qw.default)(r))throw TypeError("Invalid UUID");let e,t=new Uint8Array(16);return t[0]=(e=parseInt(r.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(r.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(r.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(r.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(r.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Bw=Lw;zs.default=Bw});var Ip=u(Hr=>{"use strict";Object.defineProperty(Hr,"__esModule",{value:!0});Hr.URL=Hr.DNS=void 0;Hr.default=Hw;var Fw=En(),Vw=Uw(wp());function Uw(r){return r&&r.__esModule?r:{default:r}}function Ww(r){r=unescape(encodeURIComponent(r));let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t));return e}var rm="6ba7b810-9dad-11d1-80b4-00c04fd430c8";Hr.DNS=rm;var im="6ba7b811-9dad-11d1-80b4-00c04fd430c8";Hr.URL=im;function Hw(r,e,t){function i(n,s,o,a){var c;if(typeof n=="string"&&(n=Ww(n)),typeof s=="string"&&(s=(0,Vw.default)(s)),((c=s)===null||c===void 0?void 0:c.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+n.length);if(p.set(s),p.set(n,s.length),p=t(p),p[6]=p[6]&15|e,p[8]=p[8]&63|128,o){a=a||0;for(let h=0;h<16;++h)o[a+h]=p[h];return o}return(0,Fw.unsafeStringify)(p)}try{i.name=r}catch{}return i.DNS=rm,i.URL=im,i}});var sm=u(Bs=>{"use strict";Object.defineProperty(Bs,"__esModule",{value:!0});Bs.default=void 0;function Kw(r){if(typeof r=="string"){let e=unescape(encodeURIComponent(r));r=new Uint8Array(e.length);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t)}return Jw($w(Gw(r),r.length*8))}function Jw(r){let e=[],t=r.length*32,i="0123456789abcdef";for(let n=0;n<t;n+=8){let s=r[n>>5]>>>n%32&255,o=parseInt(i.charAt(s>>>4&15)+i.charAt(s&15),16);e.push(o)}return e}function nm(r){return(r+64>>>9<<4)+14+1}function $w(r,e){r[e>>5]|=128<<e%32,r[nm(e)-1]=e;let t=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let o=0;o<r.length;o+=16){let a=t,c=i,p=n,h=s;t=Re(t,i,n,s,r[o],7,-680876936),s=Re(s,t,i,n,r[o+1],12,-389564586),n=Re(n,s,t,i,r[o+2],17,606105819),i=Re(i,n,s,t,r[o+3],22,-1044525330),t=Re(t,i,n,s,r[o+4],7,-176418897),s=Re(s,t,i,n,r[o+5],12,1200080426),n=Re(n,s,t,i,r[o+6],17,-1473231341),i=Re(i,n,s,t,r[o+7],22,-45705983),t=Re(t,i,n,s,r[o+8],7,1770035416),s=Re(s,t,i,n,r[o+9],12,-1958414417),n=Re(n,s,t,i,r[o+10],17,-42063),i=Re(i,n,s,t,r[o+11],22,-1990404162),t=Re(t,i,n,s,r[o+12],7,1804603682),s=Re(s,t,i,n,r[o+13],12,-40341101),n=Re(n,s,t,i,r[o+14],17,-1502002290),i=Re(i,n,s,t,r[o+15],22,1236535329),t=Ee(t,i,n,s,r[o+1],5,-165796510),s=Ee(s,t,i,n,r[o+6],9,-1069501632),n=Ee(n,s,t,i,r[o+11],14,643717713),i=Ee(i,n,s,t,r[o],20,-373897302),t=Ee(t,i,n,s,r[o+5],5,-701558691),s=Ee(s,t,i,n,r[o+10],9,38016083),n=Ee(n,s,t,i,r[o+15],14,-660478335),i=Ee(i,n,s,t,r[o+4],20,-405537848),t=Ee(t,i,n,s,r[o+9],5,568446438),s=Ee(s,t,i,n,r[o+14],9,-1019803690),n=Ee(n,s,t,i,r[o+3],14,-187363961),i=Ee(i,n,s,t,r[o+8],20,1163531501),t=Ee(t,i,n,s,r[o+13],5,-1444681467),s=Ee(s,t,i,n,r[o+2],9,-51403784),n=Ee(n,s,t,i,r[o+7],14,1735328473),i=Ee(i,n,s,t,r[o+12],20,-1926607734),t=we(t,i,n,s,r[o+5],4,-378558),s=we(s,t,i,n,r[o+8],11,-2022574463),n=we(n,s,t,i,r[o+11],16,1839030562),i=we(i,n,s,t,r[o+14],23,-35309556),t=we(t,i,n,s,r[o+1],4,-1530992060),s=we(s,t,i,n,r[o+4],11,1272893353),n=we(n,s,t,i,r[o+7],16,-155497632),i=we(i,n,s,t,r[o+10],23,-1094730640),t=we(t,i,n,s,r[o+13],4,681279174),s=we(s,t,i,n,r[o],11,-358537222),n=we(n,s,t,i,r[o+3],16,-722521979),i=we(i,n,s,t,r[o+6],23,76029189),t=we(t,i,n,s,r[o+9],4,-640364487),s=we(s,t,i,n,r[o+12],11,-421815835),n=we(n,s,t,i,r[o+15],16,530742520),i=we(i,n,s,t,r[o+2],23,-995338651),t=Ie(t,i,n,s,r[o],6,-198630844),s=Ie(s,t,i,n,r[o+7],10,1126891415),n=Ie(n,s,t,i,r[o+14],15,-1416354905),i=Ie(i,n,s,t,r[o+5],21,-57434055),t=Ie(t,i,n,s,r[o+12],6,1700485571),s=Ie(s,t,i,n,r[o+3],10,-1894986606),n=Ie(n,s,t,i,r[o+10],15,-1051523),i=Ie(i,n,s,t,r[o+1],21,-2054922799),t=Ie(t,i,n,s,r[o+8],6,1873313359),s=Ie(s,t,i,n,r[o+15],10,-30611744),n=Ie(n,s,t,i,r[o+6],15,-1560198380),i=Ie(i,n,s,t,r[o+13],21,1309151649),t=Ie(t,i,n,s,r[o+4],6,-145523070),s=Ie(s,t,i,n,r[o+11],10,-1120210379),n=Ie(n,s,t,i,r[o+2],15,718787259),i=Ie(i,n,s,t,r[o+9],21,-343485551),t=lr(t,a),i=lr(i,c),n=lr(n,p),s=lr(s,h)}return[t,i,n,s]}function Gw(r){if(r.length===0)return[];let e=r.length*8,t=new Uint32Array(nm(e));for(let i=0;i<e;i+=8)t[i>>5]|=(r[i/8]&255)<<i%32;return t}function lr(r,e){let t=(r&65535)+(e&65535);return(r>>16)+(e>>16)+(t>>16)<<16|t&65535}function Qw(r,e){return r<<e|r>>>32-e}function Ls(r,e,t,i,n,s){return lr(Qw(lr(lr(e,r),lr(i,s)),n),t)}function Re(r,e,t,i,n,s,o){return Ls(e&t|~e&i,r,e,n,s,o)}function Ee(r,e,t,i,n,s,o){return Ls(e&i|t&~i,r,e,n,s,o)}function we(r,e,t,i,n,s,o){return Ls(e^t^i,r,e,n,s,o)}function Ie(r,e,t,i,n,s,o){return Ls(t^(e|~i),r,e,n,s,o)}var Xw=Kw;Bs.default=Xw});var am=u(Fs=>{"use strict";Object.defineProperty(Fs,"__esModule",{value:!0});Fs.default=void 0;var Zw=om(Ip()),Yw=om(sm());function om(r){return r&&r.__esModule?r:{default:r}}var eI=(0,Zw.default)("v3",48,Yw.default),tI=eI;Fs.default=tI});var cm=u(Vs=>{"use strict";Object.defineProperty(Vs,"__esModule",{value:!0});Vs.default=void 0;var rI=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),iI={randomUUID:rI};Vs.default=iI});var lm=u(Us=>{"use strict";Object.defineProperty(Us,"__esModule",{value:!0});Us.default=void 0;var um=pm(cm()),nI=pm(Cp()),sI=En();function pm(r){return r&&r.__esModule?r:{default:r}}function oI(r,e,t){if(um.default.randomUUID&&!e&&!r)return um.default.randomUUID();r=r||{};let i=r.random||(r.rng||nI.default)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){t=t||0;for(let n=0;n<16;++n)e[t+n]=i[n];return e}return(0,sI.unsafeStringify)(i)}var aI=oI;Us.default=aI});var hm=u(Ws=>{"use strict";Object.defineProperty(Ws,"__esModule",{value:!0});Ws.default=void 0;function cI(r,e,t,i){switch(r){case 0:return e&t^~e&i;case 1:return e^t^i;case 2:return e&t^e&i^t&i;case 3:return e^t^i}}function _p(r,e){return r<<e|r>>>32-e}function uI(r){let e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof r=="string"){let o=unescape(encodeURIComponent(r));r=[];for(let a=0;a<o.length;++a)r.push(o.charCodeAt(a))}else Array.isArray(r)||(r=Array.prototype.slice.call(r));r.push(128);let i=r.length/4+2,n=Math.ceil(i/16),s=new Array(n);for(let o=0;o<n;++o){let a=new Uint32Array(16);for(let c=0;c<16;++c)a[c]=r[o*64+c*4]<<24|r[o*64+c*4+1]<<16|r[o*64+c*4+2]<<8|r[o*64+c*4+3];s[o]=a}s[n-1][14]=(r.length-1)*8/Math.pow(2,32),s[n-1][14]=Math.floor(s[n-1][14]),s[n-1][15]=(r.length-1)*8&4294967295;for(let o=0;o<n;++o){let a=new Uint32Array(80);for(let g=0;g<16;++g)a[g]=s[o][g];for(let g=16;g<80;++g)a[g]=_p(a[g-3]^a[g-8]^a[g-14]^a[g-16],1);let c=t[0],p=t[1],h=t[2],d=t[3],v=t[4];for(let g=0;g<80;++g){let M=Math.floor(g/20),A=_p(c,5)+cI(M,p,h,d)+v+e[M]+a[g]>>>0;v=d,d=h,h=_p(p,30)>>>0,p=c,c=A}t[0]=t[0]+c>>>0,t[1]=t[1]+p>>>0,t[2]=t[2]+h>>>0,t[3]=t[3]+d>>>0,t[4]=t[4]+v>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var pI=uI;Ws.default=pI});var vm=u(Hs=>{"use strict";Object.defineProperty(Hs,"__esModule",{value:!0});Hs.default=void 0;var lI=dm(Ip()),hI=dm(hm());function dm(r){return r&&r.__esModule?r:{default:r}}var dI=(0,lI.default)("v5",80,hI.default),vI=dI;Hs.default=vI});var fm=u(Ks=>{"use strict";Object.defineProperty(Ks,"__esModule",{value:!0});Ks.default=void 0;var fI="00000000-0000-0000-0000-000000000000";Ks.default=fI});var gm=u(Js=>{"use strict";Object.defineProperty(Js,"__esModule",{value:!0});Js.default=void 0;var gI=mI(Pn());function mI(r){return r&&r.__esModule?r:{default:r}}function yI(r){if(!(0,gI.default)(r))throw TypeError("Invalid UUID");return parseInt(r.slice(14,15),16)}var SI=yI;Js.default=SI});var mm=u(ht=>{"use strict";Object.defineProperty(ht,"__esModule",{value:!0});Object.defineProperty(ht,"NIL",{enumerable:!0,get:function(){return wI.default}});Object.defineProperty(ht,"parse",{enumerable:!0,get:function(){return AI.default}});Object.defineProperty(ht,"stringify",{enumerable:!0,get:function(){return bI.default}});Object.defineProperty(ht,"v1",{enumerable:!0,get:function(){return CI.default}});Object.defineProperty(ht,"v3",{enumerable:!0,get:function(){return PI.default}});Object.defineProperty(ht,"v4",{enumerable:!0,get:function(){return RI.default}});Object.defineProperty(ht,"v5",{enumerable:!0,get:function(){return EI.default}});Object.defineProperty(ht,"validate",{enumerable:!0,get:function(){return _I.default}});Object.defineProperty(ht,"version",{enumerable:!0,get:function(){return II.default}});var CI=Kt(tm()),PI=Kt(am()),RI=Kt(lm()),EI=Kt(vm()),wI=Kt(fm()),II=Kt(gm()),_I=Kt(Pn()),bI=Kt(En()),AI=Kt(wp());function Kt(r){return r&&r.__esModule?r:{default:r}}});var hr=u(wi=>{"use strict";Object.defineProperty(wi,"__esModule",{value:!0});wi.createNoDashGuid=wi.createGuid=void 0;var TI=mm(),ym=()=>(0,TI.v4)();wi.createGuid=ym;var OI=()=>ym().replace(new RegExp("-","g"),"").toUpperCase();wi.createNoDashGuid=OI});var Ii=u(Kr=>{"use strict";Object.defineProperty(Kr,"__esModule",{value:!0});Kr.PlatformEvent=Kr.EventType=void 0;var kI=hr(),MI;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warning=2]="Warning",r[r.Error=3]="Error",r[r.None=4]="None"})(MI=Kr.EventType||(Kr.EventType={}));var bp=class{constructor(e,t){this.privName=e,this.privEventId=(0,kI.createNoDashGuid)(),this.privEventTime=new Date().toISOString(),this.privEventType=t,this.privMetadata={}}get name(){return this.privName}get eventId(){return this.privEventId}get eventTime(){return this.privEventTime}get eventType(){return this.privEventType}get metadata(){return this.privMetadata}};Kr.PlatformEvent=bp});var qp=u(Z=>{"use strict";Object.defineProperty(Z,"__esModule",{value:!0});Z.AudioStreamNodeErrorEvent=Z.AudioStreamNodeDetachedEvent=Z.AudioStreamNodeAttachedEvent=Z.AudioStreamNodeAttachingEvent=Z.AudioStreamNodeEvent=Z.AudioSourceErrorEvent=Z.AudioSourceOffEvent=Z.AudioSourceReadyEvent=Z.AudioSourceInitializingEvent=Z.AudioSourceEvent=void 0;var Ap=Ii(),dr=class extends Ap.PlatformEvent{constructor(e,t,i=Ap.EventType.Info){super(e,i),this.privAudioSourceId=t}get audioSourceId(){return this.privAudioSourceId}};Z.AudioSourceEvent=dr;var Tp=class extends dr{constructor(e){super("AudioSourceInitializingEvent",e)}};Z.AudioSourceInitializingEvent=Tp;var Op=class extends dr{constructor(e){super("AudioSourceReadyEvent",e)}};Z.AudioSourceReadyEvent=Op;var kp=class extends dr{constructor(e){super("AudioSourceOffEvent",e)}};Z.AudioSourceOffEvent=kp;var Mp=class extends dr{constructor(e,t){super("AudioSourceErrorEvent",e,Ap.EventType.Error),this.privError=t}get error(){return this.privError}};Z.AudioSourceErrorEvent=Mp;var Jr=class extends dr{constructor(e,t,i){super(e,t),this.privAudioNodeId=i}get audioNodeId(){return this.privAudioNodeId}};Z.AudioStreamNodeEvent=Jr;var Dp=class extends Jr{constructor(e,t){super("AudioStreamNodeAttachingEvent",e,t)}};Z.AudioStreamNodeAttachingEvent=Dp;var xp=class extends Jr{constructor(e,t){super("AudioStreamNodeAttachedEvent",e,t)}};Z.AudioStreamNodeAttachedEvent=xp;var Np=class extends Jr{constructor(e,t){super("AudioStreamNodeDetachedEvent",e,t)}};Z.AudioStreamNodeDetachedEvent=Np;var jp=class extends Jr{constructor(e,t,i){super("AudioStreamNodeErrorEvent",e,t),this.privError=i}get error(){return this.privError}};Z.AudioStreamNodeErrorEvent=jp});var Sm=u(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.ConnectionRedirectEvent=Y.ConnectionMessageSentEvent=Y.ConnectionMessageReceivedEvent=Y.ConnectionEstablishErrorEvent=Y.ConnectionErrorEvent=Y.ConnectionClosedEvent=Y.ConnectionEstablishedEvent=Y.ConnectionStartEvent=Y.ConnectionEvent=Y.ServiceEvent=void 0;var vr=Ii(),zp=class extends vr.PlatformEvent{constructor(e,t,i=vr.EventType.Info){super(e,i),this.privJsonResult=t}get jsonString(){return this.privJsonResult}};Y.ServiceEvent=zp;var dt=class extends vr.PlatformEvent{constructor(e,t,i=vr.EventType.Info){super(e,i),this.privConnectionId=t}get connectionId(){return this.privConnectionId}};Y.ConnectionEvent=dt;var Lp=class extends dt{constructor(e,t,i){super("ConnectionStartEvent",e),this.privUri=t,this.privHeaders=i}get uri(){return this.privUri}get headers(){return this.privHeaders}};Y.ConnectionStartEvent=Lp;var Bp=class extends dt{constructor(e){super("ConnectionEstablishedEvent",e)}};Y.ConnectionEstablishedEvent=Bp;var Fp=class extends dt{constructor(e,t,i){super("ConnectionClosedEvent",e,vr.EventType.Debug),this.privReason=i,this.privStatusCode=t}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}};Y.ConnectionClosedEvent=Fp;var Vp=class extends dt{constructor(e,t,i){super("ConnectionErrorEvent",e,vr.EventType.Debug),this.privMessage=t,this.privType=i}get message(){return this.privMessage}get type(){return this.privType}};Y.ConnectionErrorEvent=Vp;var Up=class extends dt{constructor(e,t,i){super("ConnectionEstablishErrorEvent",e,vr.EventType.Error),this.privStatusCode=t,this.privReason=i}get reason(){return this.privReason}get statusCode(){return this.privStatusCode}};Y.ConnectionEstablishErrorEvent=Up;var Wp=class extends dt{constructor(e,t,i){super("ConnectionMessageReceivedEvent",e),this.privNetworkReceivedTime=t,this.privMessage=i}get networkReceivedTime(){return this.privNetworkReceivedTime}get message(){return this.privMessage}};Y.ConnectionMessageReceivedEvent=Wp;var Hp=class extends dt{constructor(e,t,i){super("ConnectionMessageSentEvent",e),this.privNetworkSentTime=t,this.privMessage=i}get networkSentTime(){return this.privNetworkSentTime}get message(){return this.privMessage}};Y.ConnectionMessageSentEvent=Hp;var Kp=class extends dt{constructor(e,t,i,n){super("ConnectionRedirectEvent",e,vr.EventType.Info),this.privRedirectUrl=t,this.privOriginalUrl=i,this.privContext=n}get redirectUrl(){return this.privRedirectUrl}get originalUrl(){return this.privOriginalUrl}get context(){return this.privContext}};Y.ConnectionRedirectEvent=Kp});var vt=u(fr=>{"use strict";Object.defineProperty(fr,"__esModule",{value:!0});fr.ObjectDisposedError=fr.InvalidOperationError=fr.ArgumentNullError=void 0;var Jp=class extends Error{constructor(e){super(e),this.name="ArgumentNull",this.message=e}};fr.ArgumentNullError=Jp;var $p=class extends Error{constructor(e){super(e),this.name="InvalidOperation",this.message=e}};fr.InvalidOperationError=$p;var Gp=class extends Error{constructor(e,t){super(t),this.name=e+"ObjectDisposed",this.message=t}};fr.ObjectDisposedError=Gp});var Xp=u(Gr=>{"use strict";Object.defineProperty(Gr,"__esModule",{value:!0});Gr.ConnectionMessage=Gr.MessageType=void 0;var $s=vt(),DI=hr(),$r;(function(r){r[r.Text=0]="Text",r[r.Binary=1]="Binary"})($r=Gr.MessageType||(Gr.MessageType={}));var Qp=class{constructor(e,t,i,n){if(this.privBody=null,e===$r.Text&&t&&typeof t!="string")throw new $s.InvalidOperationError("Payload must be a string");if(e===$r.Binary&&t&&!(t instanceof ArrayBuffer))throw new $s.InvalidOperationError("Payload must be ArrayBuffer");switch(this.privMessageType=e,this.privBody=t,this.privHeaders=i||{},this.privId=n||(0,DI.createNoDashGuid)(),this.messageType){case $r.Binary:this.privSize=this.binaryBody!==null?this.binaryBody.byteLength:0;break;case $r.Text:this.privSize=this.textBody.length}}get messageType(){return this.privMessageType}get headers(){return this.privHeaders}get body(){return this.privBody}get textBody(){if(this.privMessageType===$r.Binary)throw new $s.InvalidOperationError("Not supported for binary message");return this.privBody}get binaryBody(){if(this.privMessageType===$r.Text)throw new $s.InvalidOperationError("Not supported for text message");return this.privBody}get id(){return this.privId}};Gr.ConnectionMessage=Qp});var Cm=u(Gs=>{"use strict";Object.defineProperty(Gs,"__esModule",{value:!0});Gs.ConnectionOpenResponse=void 0;var Zp=class{constructor(e,t){this.privStatusCode=e,this.privReason=t}get statusCode(){return this.privStatusCode}get reason(){return this.privReason}};Gs.ConnectionOpenResponse=Zp});var Pm=u(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.DeferralMap=void 0;var Yp=class{constructor(){this.privMap={}}add(e,t){this.privMap[e]=t}getId(e){return this.privMap[e]}complete(e,t){try{this.privMap[e].resolve(t)}catch(i){this.privMap[e].reject(i)}finally{this.privMap[e]=void 0}}};Qs.DeferralMap=Yp});var tl=u(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.SendingAgentContextMessageEvent=_i.DialogEvent=void 0;var Rm=Ii(),Xs=class extends Rm.PlatformEvent{constructor(e,t=Rm.EventType.Info){super(e,t)}};_i.DialogEvent=Xs;var el=class extends Xs{constructor(e){super("SendingAgentContextMessageEvent"),this.privAgentConfig=e}get agentConfig(){return this.privAgentConfig}};_i.SendingAgentContextMessageEvent=el});var il=u(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.EventSource=void 0;var xI=vt(),NI=hr(),rl=class{constructor(e){this.privEventListeners={},this.privIsDisposed=!1,this.privConsoleListener=void 0,this.privMetadata=e}onEvent(e){if(this.isDisposed())throw new xI.ObjectDisposedError("EventSource");if(this.metadata)for(let t in this.metadata)t&&e.metadata&&(e.metadata[t]||(e.metadata[t]=this.metadata[t]));for(let t in this.privEventListeners)t&&this.privEventListeners[t]&&this.privEventListeners[t](e)}attach(e){let t=(0,NI.createNoDashGuid)();return this.privEventListeners[t]=e,{detach:()=>(delete this.privEventListeners[t],Promise.resolve())}}attachListener(e){return this.attach(t=>e.onEvent(t))}attachConsoleListener(e){return this.privConsoleListener&&this.privConsoleListener.detach(),this.privConsoleListener=this.attach(t=>e.onEvent(t)),this.privConsoleListener}isDisposed(){return this.privIsDisposed}dispose(){this.privEventListeners=null,this.privIsDisposed=!0}get metadata(){return this.privMetadata}};Zs.EventSource=rl});var Em=u(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});eo.Events=void 0;var jI=vt(),qI=il(),Ys=class r{static setEventSource(e){if(!e)throw new jI.ArgumentNullError("eventSource");r.privInstance=e}static get instance(){return r.privInstance}};eo.Events=Ys;Ys.privInstance=new qI.EventSource});var Im=u(wm=>{"use strict";Object.defineProperty(wm,"__esModule",{value:!0})});var _m=u(wn=>{"use strict";Object.defineProperty(wn,"__esModule",{value:!0});wn.ConnectionState=void 0;var zI;(function(r){r[r.None=0]="None",r[r.Connected=1]="Connected",r[r.Connecting=2]="Connecting",r[r.Disconnected=3]="Disconnected"})(zI=wn.ConnectionState||(wn.ConnectionState={}))});var Am=u(bm=>{"use strict";Object.defineProperty(bm,"__esModule",{value:!0})});var Om=u(Tm=>{"use strict";Object.defineProperty(Tm,"__esModule",{value:!0})});var Mm=u(km=>{"use strict";Object.defineProperty(km,"__esModule",{value:!0})});var xm=u(Dm=>{"use strict";Object.defineProperty(Dm,"__esModule",{value:!0})});var jm=u(Nm=>{"use strict";Object.defineProperty(Nm,"__esModule",{value:!0})});var zm=u(qm=>{"use strict";Object.defineProperty(qm,"__esModule",{value:!0})});var Bm=u(Lm=>{"use strict";Object.defineProperty(Lm,"__esModule",{value:!0})});var Vm=u(Fm=>{"use strict";Object.defineProperty(Fm,"__esModule",{value:!0})});var sl=u(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.List=void 0;var LI=vt(),nl=class r{constructor(e){if(this.privSubscriptionIdCounter=0,this.privAddSubscriptions={},this.privRemoveSubscriptions={},this.privDisposedSubscriptions={},this.privDisposeReason=null,this.privList=[],e)for(let t of e)this.privList.push(t)}get(e){return this.throwIfDisposed(),this.privList[e]}first(){return this.get(0)}last(){return this.get(this.length()-1)}add(e){this.throwIfDisposed(),this.insertAt(this.privList.length,e)}insertAt(e,t){this.throwIfDisposed(),e===0?this.privList.unshift(t):e===this.privList.length?this.privList.push(t):this.privList.splice(e,0,t),this.triggerSubscriptions(this.privAddSubscriptions)}removeFirst(){return this.throwIfDisposed(),this.removeAt(0)}removeLast(){return this.throwIfDisposed(),this.removeAt(this.length()-1)}removeAt(e){return this.throwIfDisposed(),this.remove(e,1)[0]}remove(e,t){this.throwIfDisposed();let i=this.privList.splice(e,t);return this.triggerSubscriptions(this.privRemoveSubscriptions),i}clear(){this.throwIfDisposed(),this.remove(0,this.length())}length(){return this.throwIfDisposed(),this.privList.length}onAdded(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privAddSubscriptions[t]=e,{detach:()=>(delete this.privAddSubscriptions[t],Promise.resolve())}}onRemoved(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privRemoveSubscriptions[t]=e,{detach:()=>(delete this.privRemoveSubscriptions[t],Promise.resolve())}}onDisposed(e){this.throwIfDisposed();let t=this.privSubscriptionIdCounter++;return this.privDisposedSubscriptions[t]=e,{detach:()=>(delete this.privDisposedSubscriptions[t],Promise.resolve())}}join(e){return this.throwIfDisposed(),this.privList.join(e)}toArray(){let e=Array();return this.privList.forEach(t=>{e.push(t)}),e}any(e){return this.throwIfDisposed(),e?this.where(e).length()>0:this.length()>0}all(e){return this.throwIfDisposed(),this.where(e).length()===this.length()}forEach(e){this.throwIfDisposed();for(let t=0;t<this.length();t++)e(this.privList[t],t)}select(e){this.throwIfDisposed();let t=[];for(let i=0;i<this.privList.length;i++)t.push(e(this.privList[i],i));return new r(t)}where(e){this.throwIfDisposed();let t=new r;for(let i=0;i<this.privList.length;i++)e(this.privList[i],i)&&t.add(this.privList[i]);return t}orderBy(e){this.throwIfDisposed();let i=this.toArray().sort(e);return new r(i)}orderByDesc(e){return this.throwIfDisposed(),this.orderBy((t,i)=>e(i,t))}clone(){return this.throwIfDisposed(),new r(this.toArray())}concat(e){return this.throwIfDisposed(),new r(this.privList.concat(e.toArray()))}concatArray(e){return this.throwIfDisposed(),new r(this.privList.concat(e))}isDisposed(){return this.privList==null}dispose(e){this.isDisposed()||(this.privDisposeReason=e,this.privList=null,this.privAddSubscriptions=null,this.privRemoveSubscriptions=null,this.triggerSubscriptions(this.privDisposedSubscriptions))}throwIfDisposed(){if(this.isDisposed())throw new LI.ObjectDisposedError("List",this.privDisposeReason)}triggerSubscriptions(e){if(e)for(let t in e)t&&e[t]()}};to.List=nl});var cl=u(Me=>{"use strict";Object.defineProperty(Me,"__esModule",{value:!0});Me.marshalPromiseToCallbacks=Me.Sink=Me.Deferred=Me.PromiseResultEventSource=Me.PromiseResult=Me.PromiseState=void 0;var Jt;(function(r){r[r.None=0]="None",r[r.Resolved=1]="Resolved",r[r.Rejected=2]="Rejected"})(Jt=Me.PromiseState||(Me.PromiseState={}));var ro=class{constructor(e){this.throwIfError=()=>{if(this.isError)throw this.error},e.on(t=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!1,this.privResult=t)},t=>{this.privIsCompleted||(this.privIsCompleted=!0,this.privIsError=!0,this.privError=t)})}get isCompleted(){return this.privIsCompleted}get isError(){return this.privIsError}get error(){return this.privError}get result(){return this.privResult}};Me.PromiseResult=ro;var io=class{constructor(){this.setResult=e=>{this.privOnSetResult(e)},this.setError=e=>{this.privOnSetError(e)},this.on=(e,t)=>{this.privOnSetResult=e,this.privOnSetError=t}}};Me.PromiseResultEventSource=io;var ol=class{constructor(){this.resolve=e=>(this.privResolve(e),this),this.reject=e=>(this.privReject(e),this),this.privPromise=new Promise((e,t)=>{this.privResolve=e,this.privReject=t})}get promise(){return this.privPromise}};Me.Deferred=ol;var al=class{constructor(){this.privState=Jt.None,this.privPromiseResult=null,this.privPromiseResultEvents=null,this.privSuccessHandlers=[],this.privErrorHandlers=[],this.privPromiseResultEvents=new io,this.privPromiseResult=new ro(this.privPromiseResultEvents)}get state(){return this.privState}get result(){return this.privPromiseResult}resolve(e){if(this.privState!==Jt.None)throw new Error("'Cannot resolve a completed promise'");this.privState=Jt.Resolved,this.privPromiseResultEvents.setResult(e);for(let t=0;t<this.privSuccessHandlers.length;t++)this.executeSuccessCallback(e,this.privSuccessHandlers[t],this.privErrorHandlers[t]);this.detachHandlers()}reject(e){if(this.privState!==Jt.None)throw new Error("'Cannot reject a completed promise'");this.privState=Jt.Rejected,this.privPromiseResultEvents.setError(e);for(let t of this.privErrorHandlers)this.executeErrorCallback(e,t);this.detachHandlers()}on(e,t){e==null&&(e=()=>{}),this.privState===Jt.None?(this.privSuccessHandlers.push(e),this.privErrorHandlers.push(t)):(this.privState===Jt.Resolved?this.executeSuccessCallback(this.privPromiseResult.result,e,t):this.privState===Jt.Rejected&&this.executeErrorCallback(this.privPromiseResult.error,t),this.detachHandlers())}executeSuccessCallback(e,t,i){try{t(e)}catch(n){this.executeErrorCallback(`'Unhandled callback error: ${n}'`,i)}}executeErrorCallback(e,t){if(t)try{t(e)}catch(i){throw new Error(`'Unhandled callback error: ${i}. InnerError: ${e}'`)}else throw new Error(`'Unhandled error: ${e}'`)}detachHandlers(){this.privErrorHandlers=[],this.privSuccessHandlers=[]}};Me.Sink=al;function BI(r,e,t){r.then(i=>{try{e&&e(i)}catch(n){if(t)try{if(n instanceof Error){let s=n;t(s.name+": "+s.message)}else t(n)}catch{}}},i=>{if(t)try{if(i instanceof Error){let n=i;t(n.name+": "+n.message)}else t(i)}catch{}})}Me.marshalPromiseToCallbacks=BI});var hl=u(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.Queue=void 0;var ul=vt(),pl=sl(),Um=cl(),In;(function(r){r[r.Dequeue=0]="Dequeue",r[r.Peek=1]="Peek"})(In||(In={}));var ll=class{constructor(e){this.privPromiseStore=new pl.List,this.privIsDrainInProgress=!1,this.privIsDisposing=!1,this.privDisposeReason=null,this.privList=e||new pl.List,this.privDetachables=[],this.privSubscribers=new pl.List,this.privDetachables.push(this.privList.onAdded(()=>this.drain()))}enqueue(e){this.throwIfDispose(),this.enqueueFromPromise(new Promise(t=>t(e)))}enqueueFromPromise(e){this.throwIfDispose(),e.then(t=>{this.privList.add(t)},()=>{})}dequeue(){this.throwIfDispose();let e=new Um.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:In.Dequeue}),this.drain()),e.promise}peek(){this.throwIfDispose();let e=new Um.Deferred;return this.privSubscribers&&(this.privSubscribers.add({deferral:e,type:In.Peek}),this.drain()),e.promise}length(){return this.throwIfDispose(),this.privList.length()}isDisposed(){return this.privSubscribers==null}async drainAndDispose(e,t){if(!this.isDisposed()&&!this.privIsDisposing){this.privDisposeReason=t,this.privIsDisposing=!0;let i=this.privSubscribers;if(i){for(;i.length()>0;)i.removeFirst().deferral.resolve(void 0);this.privSubscribers===i&&(this.privSubscribers=i)}for(let n of this.privDetachables)await n.detach();if(this.privPromiseStore.length()>0&&e){let n=[];return this.privPromiseStore.toArray().forEach(s=>{n.push(s)}),Promise.all(n).finally(()=>{this.privSubscribers=null,this.privList.forEach(s=>{e(s)}),this.privList=null}).then()}else this.privSubscribers=null,this.privList=null}}async dispose(e){await this.drainAndDispose(null,e)}drain(){if(!this.privIsDrainInProgress&&!this.privIsDisposing){this.privIsDrainInProgress=!0;let e=this.privSubscribers,t=this.privList;if(e&&t){for(;t.length()>0&&e.length()>0&&!this.privIsDisposing;){let i=e.removeFirst();if(i.type===In.Peek)i.deferral.resolve(t.first());else{let n=t.removeFirst();i.deferral.resolve(n)}}this.privSubscribers===e&&(this.privSubscribers=e),this.privList===t&&(this.privList=t)}this.privIsDrainInProgress=!1}}throwIfDispose(){if(this.isDisposed())throw this.privDisposeReason?new ul.InvalidOperationError(this.privDisposeReason):new ul.ObjectDisposedError("Queue");if(this.privIsDisposing)throw new ul.InvalidOperationError("Queue disposing")}};no.Queue=ll});var Wm=u(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.RawWebsocketMessage=void 0;var so=Xp(),_n=vt(),FI=hr(),dl=class{constructor(e,t,i){if(this.privPayload=null,!t)throw new _n.ArgumentNullError("payload");if(e===so.MessageType.Binary&&Object.getPrototypeOf(t).constructor.name!=="ArrayBuffer")throw new _n.InvalidOperationError("Payload must be ArrayBuffer");if(e===so.MessageType.Text&&typeof t!="string")throw new _n.InvalidOperationError("Payload must be a string");this.privMessageType=e,this.privPayload=t,this.privId=i||(0,FI.createNoDashGuid)()}get messageType(){return this.privMessageType}get payload(){return this.privPayload}get textContent(){if(this.privMessageType===so.MessageType.Binary)throw new _n.InvalidOperationError("Not supported for binary message");return this.privPayload}get binaryContent(){if(this.privMessageType===so.MessageType.Text)throw new _n.InvalidOperationError("Not supported for text message");return this.privPayload}get id(){return this.privId}};oo.RawWebsocketMessage=dl});var Hm=u(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.RiffPcmEncoder=void 0;var vl=class{constructor(e,t){this.privActualSampleRate=e,this.privDesiredSampleRate=t}encode(e){let t=this.downSampleAudioFrame(e,this.privActualSampleRate,this.privDesiredSampleRate);if(!t)return null;let i=t.length*2,n=new ArrayBuffer(i),s=new DataView(n);return this.floatTo16BitPCM(s,0,t),n}setString(e,t,i){for(let n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))}floatTo16BitPCM(e,t,i){for(let n=0;n<i.length;n++,t+=2){let s=Math.max(-1,Math.min(1,i[n]));e.setInt16(t,s<0?s*32768:s*32767,!0)}}downSampleAudioFrame(e,t,i){if(!e)return null;if(i===t||i>t)return e;let n=t/i,s=Math.round(e.length/n),o=new Float32Array(s),a=0,c=0;for(;c<s;){let p=Math.round((c+1)*n),h=0,d=0;for(;a<p&&a<e.length;)h+=e[a++],d++;o[c++]=h/d}return o}};ao.RiffPcmEncoder=vl});var $m=u(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.Stream=void 0;var Km=vt(),VI=hr(),Jm=hl(),fl=class{constructor(e){this.privIsWriteEnded=!1,this.privIsReadEnded=!1,this.privId=e||(0,VI.createNoDashGuid)(),this.privReaderQueue=new Jm.Queue}get isClosed(){return this.privIsWriteEnded}get isReadEnded(){return this.privIsReadEnded}get id(){return this.privId}close(){this.privIsWriteEnded||(this.writeStreamChunk({buffer:null,isEnd:!0,timeReceived:Date.now()}),this.privIsWriteEnded=!0)}writeStreamChunk(e){if(this.throwIfClosed(),!this.privReaderQueue.isDisposed())try{this.privReaderQueue.enqueue(e)}catch{}}read(){if(this.privIsReadEnded)throw new Km.InvalidOperationError("Stream read has already finished");return this.privReaderQueue.dequeue().then(async e=>((e===void 0||e.isEnd)&&await this.privReaderQueue.dispose("End of stream reached"),e))}readEnded(){this.privIsReadEnded||(this.privIsReadEnded=!0,this.privReaderQueue=new Jm.Queue)}throwIfClosed(){if(this.privIsWriteEnded)throw new Km.InvalidOperationError("Stream closed")}};co.Stream=fl});var uo=u(bn=>{"use strict";Object.defineProperty(bn,"__esModule",{value:!0});bn.TranslationStatus=void 0;var UI;(function(r){r[r.Success=0]="Success",r[r.Error=1]="Error"})(UI=bn.TranslationStatus||(bn.TranslationStatus={}))});var Gm=u(po=>{"use strict";Object.defineProperty(po,"__esModule",{value:!0});po.ChunkedArrayBufferStream=void 0;var WI=P(),gl=class extends WI.Stream{constructor(e,t){super(t),this.privTargetChunkSize=Math.round(e),this.privNextBufferReadyBytes=0}writeStreamChunk(e){if(e.isEnd||this.privNextBufferReadyBytes===0&&e.buffer.byteLength===this.privTargetChunkSize){super.writeStreamChunk(e);return}let t=0;for(;t<e.buffer.byteLength;){this.privNextBufferToWrite===void 0&&(this.privNextBufferToWrite=new ArrayBuffer(this.privTargetChunkSize),this.privNextBufferStartTime=e.timeReceived);let i=Math.min(e.buffer.byteLength-t,this.privTargetChunkSize-this.privNextBufferReadyBytes),n=new Uint8Array(this.privNextBufferToWrite),s=new Uint8Array(e.buffer.slice(t,i+t));n.set(s,this.privNextBufferReadyBytes),this.privNextBufferReadyBytes+=i,t+=i,this.privNextBufferReadyBytes===this.privTargetChunkSize&&(super.writeStreamChunk({buffer:this.privNextBufferToWrite,isEnd:!1,timeReceived:this.privNextBufferStartTime}),this.privNextBufferReadyBytes=0,this.privNextBufferToWrite=void 0)}}close(){this.privNextBufferReadyBytes!==0&&!this.isClosed&&super.writeStreamChunk({buffer:this.privNextBufferToWrite.slice(0,this.privNextBufferReadyBytes),isEnd:!1,timeReceived:this.privNextBufferStartTime}),super.close()}};po.ChunkedArrayBufferStream=gl});var Xm=u(Qm=>{"use strict";Object.defineProperty(Qm,"__esModule",{value:!0})});var Zm=u(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.Timeout=void 0;var bt=class r{static load(){let e=new Map([[0,()=>{}]]),t=new Map,n="data:text/javascript;base64,"+btoa(`!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return d}));const r=new Map,o=new Map,i=e=>{const t=r.get(e);if(void 0===t)throw new Error('There is no interval scheduled with the given id "'.concat(e,'".'));clearTimeout(t),r.delete(e)},u=e=>{const t=o.get(e);if(void 0===t)throw new Error('There is no timeout scheduled with the given id "'.concat(e,'".'));clearTimeout(t),o.delete(e)},f=(e,t)=>{let n,r;if("performance"in self){const o=performance.now();n=o,r=e-Math.max(0,o-t)}else n=Date.now(),r=e;return{expected:n+r,remainingDelay:r}},c=(e,t,n,r)=>{const o="performance"in self?performance.now():Date.now();o>n?postMessage({id:null,method:"call",params:{timerId:t}}):e.set(t,setTimeout(c,n-o,e,t,n))},a=(e,t,n)=>{const{expected:o,remainingDelay:i}=f(e,n);r.set(t,setTimeout(c,i,r,t,o))},d=(e,t,n)=>{const{expected:r,remainingDelay:i}=f(e,n);o.set(t,setTimeout(c,i,o,t,r))}},function(e,t,n){"use strict";n.r(t);var r=n(2);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(3);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(4);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o);var f=n(5);for(var o in f)"default"!==o&&function(e){n.d(t,e,(function(){return f[e]}))}(o);var c=n(6);for(var o in c)"default"!==o&&function(e){n.d(t,e,(function(){return c[e]}))}(o);var a=n(7);for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);var d=n(8);for(var o in d)"default"!==o&&function(e){n.d(t,e,(function(){return d[e]}))}(o);var s=n(9);for(var o in s)"default"!==o&&function(e){n.d(t,e,(function(){return s[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(11);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);var i=n(12);for(var o in i)"default"!==o&&function(e){n.d(t,e,(function(){return i[e]}))}(o);var u=n(13);for(var o in u)"default"!==o&&function(e){n.d(t,e,(function(){return u[e]}))}(o)},function(e,t){},function(e,t){},function(e,t){},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(1);for(var i in o)"default"!==i&&function(e){n.d(t,e,(function(){return o[e]}))}(i);var u=n(10);for(var i in u)"default"!==i&&function(e){n.d(t,e,(function(){return u[e]}))}(i);addEventListener("message",({data:e})=>{try{if("clear"===e.method){const{id:t,params:{timerId:n}}=e;Object(r.b)(n),postMessage({error:null,id:t})}else{if("set"!==e.method)throw new Error('The given method "'.concat(e.method,'" is not supported'));{const{params:{delay:t,now:n,timerId:o}}=e;Object(r.d)(t,o,n)}}}catch(t){postMessage({error:{message:t.message},id:e.id,result:null})}})}]);`),s=new Worker(n);return s.addEventListener("message",({data:c})=>{if(r.isCallNotification(c)){let{params:{timerId:p}}=c,h=e.get(p);if(typeof h=="number"){let d=t.get(h);if(d===void 0||d!==p)throw new Error("The timer is in an undefined state.")}else if(typeof h<"u")h(),e.delete(p);else throw new Error("The timer is in an undefined state.")}else if(r.isClearResponse(c)){let{id:p}=c,h=t.get(p);if(h===void 0)throw new Error("The timer is in an undefined state.");t.delete(p),e.delete(h)}else{let{error:{message:p}}=c;throw new Error(p)}}),{clearTimeout:c=>{let p=Math.random();t.set(p,c),e.set(c,p),s.postMessage({id:p,method:"clear",params:{timerId:c}})},setTimeout:(c,p)=>{let h=Math.random();return e.set(h,c),s.postMessage({id:null,method:"set",params:{delay:p,now:performance.now(),timerId:h}}),h}}}static loadWorkerTimers(){return()=>(r.workerTimers!==null||(r.workerTimers=r.load()),r.workerTimers)}static isCallNotification(e){return e.method!==void 0&&e.method==="call"}static isClearResponse(e){return e.error===null&&typeof e.id=="number"}};lo.Timeout=bt;bt.workerTimers=null;bt.clearTimeout=r=>bt.timers().clearTimeout(r);bt.setTimeout=(r,e)=>bt.timers().setTimeout(r,e);bt.timers=bt.loadWorkerTimers()});var Ym=u(D=>{"use strict";Object.defineProperty(D,"__esModule",{value:!0});D.OCSPCacheUpdateErrorEvent=D.OCSPResponseRetrievedEvent=D.OCSPCacheFetchErrorEvent=D.OCSPVerificationFailedEvent=D.OCSPCacheHitEvent=D.OCSPCacheEntryNeedsRefreshEvent=D.OCSPCacheEntryExpiredEvent=D.OCSPWSUpgradeStartedEvent=D.OCSPStapleReceivedEvent=D.OCSPCacheUpdateCompleteEvent=D.OCSPDiskCacheStoreEvent=D.OCSPMemoryCacheStoreEvent=D.OCSPCacheUpdateNeededEvent=D.OCSPDiskCacheHitEvent=D.OCSPCacheMissEvent=D.OCSPMemoryCacheHitEvent=D.OCSPEvent=void 0;var ve=Ii(),ce=class extends ve.PlatformEvent{constructor(e,t,i){super(e,t),this.privSignature=i}};D.OCSPEvent=ce;var ml=class extends ce{constructor(e){super("OCSPMemoryCacheHitEvent",ve.EventType.Debug,e)}};D.OCSPMemoryCacheHitEvent=ml;var yl=class extends ce{constructor(e){super("OCSPCacheMissEvent",ve.EventType.Debug,e)}};D.OCSPCacheMissEvent=yl;var Sl=class extends ce{constructor(e){super("OCSPDiskCacheHitEvent",ve.EventType.Debug,e)}};D.OCSPDiskCacheHitEvent=Sl;var Cl=class extends ce{constructor(e){super("OCSPCacheUpdateNeededEvent",ve.EventType.Debug,e)}};D.OCSPCacheUpdateNeededEvent=Cl;var Pl=class extends ce{constructor(e){super("OCSPMemoryCacheStoreEvent",ve.EventType.Debug,e)}};D.OCSPMemoryCacheStoreEvent=Pl;var Rl=class extends ce{constructor(e){super("OCSPDiskCacheStoreEvent",ve.EventType.Debug,e)}};D.OCSPDiskCacheStoreEvent=Rl;var El=class extends ce{constructor(e){super("OCSPCacheUpdateCompleteEvent",ve.EventType.Debug,e)}};D.OCSPCacheUpdateCompleteEvent=El;var wl=class extends ce{constructor(){super("OCSPStapleReceivedEvent",ve.EventType.Debug,"")}};D.OCSPStapleReceivedEvent=wl;var Il=class extends ce{constructor(e){super("OCSPWSUpgradeStartedEvent",ve.EventType.Debug,e)}};D.OCSPWSUpgradeStartedEvent=Il;var _l=class extends ce{constructor(e,t){super("OCSPCacheEntryExpiredEvent",ve.EventType.Debug,e),this.privExpireTime=t}};D.OCSPCacheEntryExpiredEvent=_l;var bl=class extends ce{constructor(e,t,i){super("OCSPCacheEntryNeedsRefreshEvent",ve.EventType.Debug,e),this.privExpireTime=i,this.privStartTime=t}};D.OCSPCacheEntryNeedsRefreshEvent=bl;var Al=class extends ce{constructor(e,t,i){super("OCSPCacheHitEvent",ve.EventType.Debug,e),this.privExpireTime=i,this.privExpireTimeString=new Date(i).toLocaleDateString(),this.privStartTime=t,this.privStartTimeString=new Date(t).toLocaleTimeString()}};D.OCSPCacheHitEvent=Al;var Tl=class extends ce{constructor(e,t){super("OCSPVerificationFailedEvent",ve.EventType.Debug,e),this.privError=t}};D.OCSPVerificationFailedEvent=Tl;var Ol=class extends ce{constructor(e,t){super("OCSPCacheFetchErrorEvent",ve.EventType.Debug,e),this.privError=t}};D.OCSPCacheFetchErrorEvent=Ol;var kl=class extends ce{constructor(e){super("OCSPResponseRetrievedEvent",ve.EventType.Debug,e)}};D.OCSPResponseRetrievedEvent=kl;var Ml=class extends ce{constructor(e,t){super("OCSPCacheUpdateErrorEvent",ve.EventType.Debug,e),this.privError=t}};D.OCSPCacheUpdateErrorEvent=Ml});var ty=u(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.BackgroundEvent=void 0;var ey=P(),Dl=class extends ey.PlatformEvent{constructor(e){super("BackgroundEvent",ey.EventType.Error),this.privError=e}get error(){return this.privError}};ho.BackgroundEvent=Dl});var P=u(T=>{"use strict";var HI=T&&T.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),j=T&&T.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&HI(e,r,t)};Object.defineProperty(T,"__esModule",{value:!0});T.TranslationStatus=void 0;j(qp(),T);j(Sm(),T);j(Xp(),T);j(Cm(),T);j(Pm(),T);j(tl(),T);j(vt(),T);j(Em(),T);j(il(),T);j(hr(),T);j(Im(),T);j(_m(),T);j(Am(),T);j(Om(),T);j(Mm(),T);j(xm(),T);j(jm(),T);j(zm(),T);j(Bm(),T);j(Vm(),T);j(sl(),T);j(Ii(),T);j(cl(),T);j(hl(),T);j(Wm(),T);j(Hm(),T);j($m(),T);var KI=uo();Object.defineProperty(T,"TranslationStatus",{enumerable:!0,get:function(){return KI.TranslationStatus}});j(Gm(),T);j(Xm(),T);j(Zm(),T);j(Ym(),T);j(ty(),T)});var _e=u(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.HeaderNames=void 0;var We=class{};vo.HeaderNames=We;We.AuthKey="Ocp-Apim-Subscription-Key";We.Authorization="Authorization";We.SpIDAuthKey="Apim-Subscription-Id";We.ConnectionId="X-ConnectionId";We.ContentType="Content-Type";We.CustomCommandsAppId="X-CommandsAppId";We.Path="Path";We.RequestId="X-RequestId";We.RequestStreamId="X-StreamId";We.RequestTimestamp="X-Timestamp"});var go=u(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.AuthInfo=void 0;var xl=class{constructor(e,t){this.privHeaderName=e,this.privToken=t}get headerName(){return this.privHeaderName}get token(){return this.privToken}};fo.AuthInfo=xl});var ry=u(mo=>{"use strict";Object.defineProperty(mo,"__esModule",{value:!0});mo.CognitiveSubscriptionKeyAuthentication=void 0;var JI=P(),$I=_e(),GI=go(),Nl=class{constructor(e){if(!e)throw new JI.ArgumentNullError("subscriptionKey");this.privAuthInfo=new GI.AuthInfo($I.HeaderNames.AuthKey,e)}fetch(e){return Promise.resolve(this.privAuthInfo)}fetchOnExpiry(e){return Promise.resolve(this.privAuthInfo)}};mo.CognitiveSubscriptionKeyAuthentication=Nl});var oy=u(So=>{"use strict";Object.defineProperty(So,"__esModule",{value:!0});So.CognitiveTokenAuthentication=void 0;var iy=P(),ny=go(),sy=_e(),yo=class r{constructor(e,t){if(!e)throw new iy.ArgumentNullError("fetchCallback");if(!t)throw new iy.ArgumentNullError("fetchOnExpiryCallback");this.privFetchCallback=e,this.privFetchOnExpiryCallback=t}fetch(e){return this.privFetchCallback(e).then(t=>new ny.AuthInfo(sy.HeaderNames.Authorization,t===void 0?void 0:r.privTokenPrefix+t))}fetchOnExpiry(e){return this.privFetchOnExpiryCallback(e).then(t=>new ny.AuthInfo(sy.HeaderNames.Authorization,t===void 0?void 0:r.privTokenPrefix+t))}};So.CognitiveTokenAuthentication=yo;yo.privTokenPrefix="Bearer "});var cy=u(ay=>{"use strict";Object.defineProperty(ay,"__esModule",{value:!0})});var py=u(uy=>{"use strict";Object.defineProperty(uy,"__esModule",{value:!0})});var jl=u(()=>{});var ql=u(Co=>{"use strict";Object.defineProperty(Co,"__esModule",{value:!0});Co.LogLevel=void 0;var QI=P();Object.defineProperty(Co,"LogLevel",{enumerable:!0,get:function(){return QI.EventType}})});var I=u(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.Contracts=void 0;var zl=class r{static throwIfNullOrUndefined(e,t){if(e==null)throw new Error("throwIfNullOrUndefined:"+t)}static throwIfNull(e,t){if(e===null)throw new Error("throwIfNull:"+t)}static throwIfNullOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),(""+e).trim().length<1)throw new Error("throwIfNullOrWhitespace:"+t)}static throwIfNullOrTooLong(e,t,i){if(r.throwIfNullOrUndefined(e,t),(""+e).length>i)throw new Error("throwIfNullOrTooLong:"+t+" (more than "+i.toString()+" characters)")}static throwIfNullOrTooShort(e,t,i){if(r.throwIfNullOrUndefined(e,t),(""+e).length<i)throw new Error("throwIfNullOrTooShort:"+t+" (less than "+i.toString()+" characters)")}static throwIfDisposed(e){if(e)throw new Error("the object is already disposed")}static throwIfArrayEmptyOrWhitespace(e,t){if(r.throwIfNullOrUndefined(e,t),e.length===0)throw new Error("throwIfArrayEmptyOrWhitespace:"+t);for(let i of e)r.throwIfNullOrWhitespace(i,t)}static throwIfFileDoesNotExist(e,t){r.throwIfNullOrWhitespace(e,t)}static throwIfNotUndefined(e,t){if(e!==void 0)throw new Error("throwIfNotUndefined:"+t)}static throwIfNumberOutOfRange(e,t,i,n){if(r.throwIfNullOrUndefined(e,t),e<i||e>n)throw new Error("throwIfNumberOutOfRange:"+t+" (must be between "+i.toString()+" and "+n.toString()+")")}};Po.Contracts=zl});var hy=u(At=>{"use strict";var XI=At&&At.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),ZI=At&&At.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),YI=At&&At.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&XI(e,r,t);return ZI(e,r),e};Object.defineProperty(At,"__esModule",{value:!0});At.ConsoleLoggingListener=void 0;var ly=YI(jl()),An=ql(),e_=I(),Ll=class{constructor(e=An.LogLevel.None){this.privLogPath=void 0,this.privEnableConsoleOutput=!0,this.privLogLevelFilter=e}set logPath(e){e_.Contracts.throwIfNullOrUndefined(ly.openSync,`
File System access not available`),this.privLogPath=e}set enableConsoleOutput(e){this.privEnableConsoleOutput=e}onEvent(e){if(e.eventType>=this.privLogLevelFilter){let t=this.toString(e);if(this.logCallback&&this.logCallback(t),this.privLogPath&&ly.writeFileSync(this.privLogPath,t+`
`,{flag:"a+"}),this.privEnableConsoleOutput)switch(e.eventType){case An.LogLevel.Debug:console.debug(t);break;case An.LogLevel.Info:console.info(t);break;case An.LogLevel.Warning:console.warn(t);break;case An.LogLevel.Error:console.error(t);break;default:console.log(t);break}}}toString(e){let t=[`${e.eventTime}`,`${e.name}`],i=e;for(let n in i)if(n&&e.hasOwnProperty(n)&&n!=="eventTime"&&n!=="eventType"&&n!=="eventId"&&n!=="name"&&n!=="constructor"){let s=i[n],o="<NULL>";s!=null&&(typeof s=="number"||typeof s=="string"?o=s.toString():o=JSON.stringify(s)),t.push(`${n}: ${o}`)}return t.join(" | ")}};At.ConsoleLoggingListener=Ll});var vy=u(dy=>{"use strict";Object.defineProperty(dy,"__esModule",{value:!0})});var gr=u($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.AudioStreamFormatImpl=$t.AudioStreamFormat=$t.AudioFormatTag=void 0;var Tn;(function(r){r[r.PCM=1]="PCM",r[r.MuLaw=2]="MuLaw",r[r.Siren=3]="Siren",r[r.MP3=4]="MP3",r[r.SILKSkype=5]="SILKSkype",r[r.OGG_OPUS=6]="OGG_OPUS",r[r.WEBM_OPUS=7]="WEBM_OPUS",r[r.ALaw=8]="ALaw",r[r.FLAC=9]="FLAC",r[r.OPUS=10]="OPUS",r[r.AMR_WB=11]="AMR_WB",r[r.G722=12]="G722"})(Tn=$t.AudioFormatTag||($t.AudioFormatTag={}));var Ro=class{static getDefaultInputFormat(){return bi.getDefaultInputFormat()}static getWaveFormat(e,t,i,n){return new bi(e,t,i,n)}static getWaveFormatPCM(e,t,i){return new bi(e,t,i)}};$t.AudioStreamFormat=Ro;var bi=class r extends Ro{constructor(e=16e3,t=16,i=1,n=Tn.PCM){super();let s=!0;switch(n){case Tn.PCM:this.formatTag=1;break;case Tn.ALaw:this.formatTag=6;break;case Tn.MuLaw:this.formatTag=7;break;default:s=!1}if(this.bitsPerSample=t,this.samplesPerSec=e,this.channels=i,this.avgBytesPerSec=this.samplesPerSec*this.channels*(this.bitsPerSample/8),this.blockAlign=this.channels*Math.max(this.bitsPerSample,8),s){this.privHeader=new ArrayBuffer(44);let o=new DataView(this.privHeader);this.setString(o,0,"RIFF"),o.setUint32(4,0,!0),this.setString(o,8,"WAVEfmt "),o.setUint32(16,16,!0),o.setUint16(20,this.formatTag,!0),o.setUint16(22,this.channels,!0),o.setUint32(24,this.samplesPerSec,!0),o.setUint32(28,this.avgBytesPerSec,!0),o.setUint16(32,this.channels*(this.bitsPerSample/8),!0),o.setUint16(34,this.bitsPerSample,!0),this.setString(o,36,"data"),o.setUint32(40,0,!0)}}static getDefaultInputFormat(){return new r}static getAudioContext(e){let t=window.AudioContext||window.webkitAudioContext||!1;if(t)return e!==void 0&&navigator.mediaDevices.getSupportedConstraints().sampleRate?new t({sampleRate:e}):new t;throw new Error("Browser does not support Web Audio API (AudioContext is not available).")}close(){}get header(){return this.privHeader}setString(e,t,i){for(let n=0;n<i.length;n++)e.setUint8(t+n,i.charCodeAt(n))}};$t.AudioStreamFormatImpl=bi});var my=u(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.MicAudioSource=Qr.AudioWorkletSourceURLPropertyName=void 0;var fy=C(),fe=P(),gy=gr();Qr.AudioWorkletSourceURLPropertyName="MICROPHONE-WorkletSourceUrl";var Eo=class r{constructor(e,t,i,n){this.privRecorder=e,this.deviceId=t,this.privStreams={},this.privOutputChunkSize=r.AUDIOFORMAT.avgBytesPerSec/10,this.privId=i||(0,fe.createNoDashGuid)(),this.privEvents=new fe.EventSource,this.privMediaStream=n||null,this.privIsClosing=!1}get format(){return Promise.resolve(r.AUDIOFORMAT)}turnOn(){if(this.privInitializeDeferral)return this.privInitializeDeferral.promise;this.privInitializeDeferral=new fe.Deferred;try{this.createAudioContext()}catch(i){if(i instanceof Error){let n=i;this.privInitializeDeferral.reject(n.name+": "+n.message)}else this.privInitializeDeferral.reject(i);return this.privInitializeDeferral.promise}let e=window.navigator,t=e.getUserMedia||e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia;if(e.mediaDevices&&(t=(i,n,s)=>{e.mediaDevices.getUserMedia(i).then(n).catch(s)}),t){let i=()=>{this.onEvent(new fe.AudioSourceInitializingEvent(this.privId)),this.privMediaStream&&this.privMediaStream.active?(this.onEvent(new fe.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()):t({audio:this.deviceId?{deviceId:this.deviceId}:!0,video:!1},n=>{this.privMediaStream=n,this.onEvent(new fe.AudioSourceReadyEvent(this.privId)),this.privInitializeDeferral.resolve()},n=>{let s=`Error occurred during microphone initialization: ${n}`;this.privInitializeDeferral.reject(s),this.onEvent(new fe.AudioSourceErrorEvent(this.privId,s))})};this.privContext.state==="suspended"?this.privContext.resume().then(i).catch(n=>{this.privInitializeDeferral.reject(`Failed to initialize audio context: ${n}`)}):i()}else{let i="Browser does not support getUserMedia.";this.privInitializeDeferral.reject(i),this.onEvent(new fe.AudioSourceErrorEvent(i,""))}return this.privInitializeDeferral.promise}id(){return this.privId}attach(e){return this.onEvent(new fe.AudioStreamNodeAttachingEvent(this.privId,e)),this.listen(e).then(t=>(this.onEvent(new fe.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:async()=>(t.readEnded(),delete this.privStreams[e],this.onEvent(new fe.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>t.read()}))}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new fe.AudioStreamNodeDetachedEvent(this.privId,e)))}async turnOff(){for(let e in this.privStreams)if(e){let t=this.privStreams[e];t&&t.close()}this.onEvent(new fe.AudioSourceOffEvent(this.privId)),this.privInitializeDeferral&&(await this.privInitializeDeferral,this.privInitializeDeferral=null),await this.destroyAudioContext()}get events(){return this.privEvents}get deviceInfo(){return this.getMicrophoneLabel().then(e=>({bitspersample:r.AUDIOFORMAT.bitsPerSample,channelcount:r.AUDIOFORMAT.channels,connectivity:fy.connectivity.Unknown,manufacturer:"Speech SDK",model:e,samplerate:r.AUDIOFORMAT.samplesPerSec,type:fy.type.Microphones}))}setProperty(e,t){if(e===Qr.AudioWorkletSourceURLPropertyName)this.privRecorder.setWorkletUrl(t);else throw new Error("Property '"+e+"' is not supported on Microphone.")}getMicrophoneLabel(){let e="microphone";if(this.privMicrophoneLabel!==void 0)return Promise.resolve(this.privMicrophoneLabel);if(this.privMediaStream===void 0||!this.privMediaStream.active)return Promise.resolve(e);this.privMicrophoneLabel=e;let t=this.privMediaStream.getTracks()[0].getSettings().deviceId;if(t===void 0)return Promise.resolve(this.privMicrophoneLabel);let i=new fe.Deferred;return navigator.mediaDevices.enumerateDevices().then(n=>{for(let s of n)if(s.deviceId===t){this.privMicrophoneLabel=s.label;break}i.resolve(this.privMicrophoneLabel)},()=>i.resolve(this.privMicrophoneLabel)),i.promise}async listen(e){await this.turnOn();let t=new fe.ChunkedArrayBufferStream(this.privOutputChunkSize,e);this.privStreams[e]=t;try{this.privRecorder.record(this.privContext,this.privMediaStream,t)}catch(n){throw this.onEvent(new fe.AudioStreamNodeErrorEvent(this.privId,e,n)),n}return t}onEvent(e){this.privEvents.onEvent(e),fe.Events.instance.onEvent(e)}createAudioContext(){this.privContext||(this.privContext=gy.AudioStreamFormatImpl.getAudioContext(r.AUDIOFORMAT.samplesPerSec))}async destroyAudioContext(){if(!this.privContext)return;this.privRecorder.releaseMediaResources(this.privContext);let e=!1;"close"in this.privContext&&(e=!0),e?this.privIsClosing||(this.privIsClosing=!0,await this.privContext.close(),this.privContext=null,this.privIsClosing=!1):this.privContext!==null&&this.privContext.state==="running"&&await this.privContext.suspend()}};Qr.MicAudioSource=Eo;Eo.AUDIOFORMAT=gy.AudioStreamFormat.getDefaultInputFormat()});var Sy=u(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.FileAudioSource=void 0;var yy=C(),Ne=P(),t_=gr(),Bl=class{constructor(e,t,i){this.privStreams={},this.privHeaderEnd=44,this.privId=i||(0,Ne.createNoDashGuid)(),this.privEvents=new Ne.EventSource,this.privSource=e,typeof window<"u"&&typeof Blob<"u"&&this.privSource instanceof Blob?this.privFilename=e.name:this.privFilename=t||"unknown.wav",this.privAudioFormatPromise=this.readHeader()}get format(){return this.privAudioFormatPromise}turnOn(){if(this.privFilename.lastIndexOf(".wav")!==this.privFilename.length-4){let e=this.privFilename+" is not supported. Only WAVE files are allowed at the moment.";return this.onEvent(new Ne.AudioSourceErrorEvent(e,"")),Promise.reject(e)}this.onEvent(new Ne.AudioSourceInitializingEvent(this.privId)),this.onEvent(new Ne.AudioSourceReadyEvent(this.privId))}id(){return this.privId}async attach(e){this.onEvent(new Ne.AudioStreamNodeAttachingEvent(this.privId,e));let t=await this.upload(e);return this.onEvent(new Ne.AudioStreamNodeAttachedEvent(this.privId,e)),Promise.resolve({detach:async()=>{t.readEnded(),delete this.privStreams[e],this.onEvent(new Ne.AudioStreamNodeDetachedEvent(this.privId,e)),await this.turnOff()},id:()=>e,read:()=>t.read()})}detach(e){e&&this.privStreams[e]&&(this.privStreams[e].close(),delete this.privStreams[e],this.onEvent(new Ne.AudioStreamNodeDetachedEvent(this.privId,e)))}turnOff(){for(let e in this.privStreams)if(e){let t=this.privStreams[e];t&&!t.isClosed&&t.close()}return this.onEvent(new Ne.AudioSourceOffEvent(this.privId)),Promise.resolve()}get events(){return this.privEvents}get deviceInfo(){return this.privAudioFormatPromise.then(e=>Promise.resolve({bitspersample:e.bitsPerSample,channelcount:e.channels,connectivity:yy.connectivity.Unknown,manufacturer:"Speech SDK",model:"File",samplerate:e.samplesPerSec,type:yy.type.File}))}readHeader(){let t=this.privSource.slice(0,4296),i=new Ne.Deferred,n=s=>{let o=new DataView(s),a=g=>String.fromCharCode(o.getUint8(g),o.getUint8(g+1),o.getUint8(g+2),o.getUint8(g+3));if(a(0)!=="RIFF"){i.reject("Invalid WAV header in file, RIFF was not found");return}if(a(8)!=="WAVE"||a(12)!=="fmt "){i.reject("Invalid WAV header in file, WAVEfmt was not found");return}let c=o.getInt32(16,!0),p=o.getUint16(22,!0),h=o.getUint32(24,!0),d=o.getUint16(34,!0),v=36+Math.max(c-16,0);for(;a(v)!=="data";v+=2)if(v>4288){i.reject("Invalid WAV header in file, data block was not found");return}this.privHeaderEnd=v+8,i.resolve(t_.AudioStreamFormat.getWaveFormatPCM(h,d,p))};if(typeof window<"u"&&typeof Blob<"u"&&t instanceof Blob){let s=new FileReader;s.onload=o=>{let a=o.target.result;n(a)},s.readAsArrayBuffer(t)}else{let s=t;n(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength))}return i.promise}async upload(e){let t=i=>{let n=`Error occurred while processing '${this.privFilename}'. ${i}`;throw this.onEvent(new Ne.AudioStreamNodeErrorEvent(this.privId,e,n)),new Error(n)};try{await this.turnOn();let i=await this.privAudioFormatPromise,n=new Ne.ChunkedArrayBufferStream(i.avgBytesPerSec/10,e);this.privStreams[e]=n;let s=this.privSource.slice(this.privHeaderEnd),o=a=>{n.isClosed||(n.writeStreamChunk({buffer:a,isEnd:!1,timeReceived:Date.now()}),n.close())};if(typeof window<"u"&&typeof Blob<"u"&&s instanceof Blob){let a=new FileReader;a.onerror=c=>t(c.toString()),a.onload=c=>{let p=c.target.result;o(p)},a.readAsArrayBuffer(s)}else{let a=s;o(a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength))}return n}catch(i){t(i)}}onEvent(e){this.privEvents.onEvent(e),Ne.Events.instance.onEvent(e)}};wo.FileAudioSource=Bl});var Cy=u(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.PcmRecorder=void 0;var r_=P(),Fl=class{constructor(e){this.privStopInputOnRelease=e}record(e,t,i){let s=new r_.RiffPcmEncoder(e.sampleRate,16e3),o=e.createMediaStreamSource(t),a=()=>{let p=(()=>{let h=0;try{return e.createScriptProcessor(h,1,1)}catch{h=2048;let v=e.sampleRate;for(;h<16384&&v>=32e3;)h<<=1,v>>=1;return e.createScriptProcessor(h,1,1)}})();p.onaudioprocess=h=>{let d=h.inputBuffer.getChannelData(0);if(i&&!i.isClosed){let v=s.encode(d);v&&i.writeStreamChunk({buffer:v,isEnd:!1,timeReceived:Date.now()})}},o.connect(p),p.connect(e.destination),this.privMediaResources={scriptProcessorNode:p,source:o,stream:t}},c=!!this.privSpeechProcessorScript&&this.privSpeechProcessorScript.toLowerCase()==="ignore";if(e.audioWorklet&&!c){if(!this.privSpeechProcessorScript){let p=`class SP extends AudioWorkletProcessor {
                    constructor(options) {
                      super(options);
                    }
                    process(inputs, outputs) {
                      const input = inputs[0];
                      const output = [];
                      for (let channel = 0; channel < input.length; channel += 1) {
                        output[channel] = input[channel];
                      }
                      this.port.postMessage(output[0]);
                      return true;
                    }
                  }
                  registerProcessor('speech-processor', SP);`,h=new Blob([p],{type:"application/javascript; charset=utf-8"});this.privSpeechProcessorScript=URL.createObjectURL(h)}e.audioWorklet.addModule(this.privSpeechProcessorScript).then(()=>{let p=new AudioWorkletNode(e,"speech-processor");p.port.onmessage=h=>{let d=h.data;if(i&&!i.isClosed){let v=s.encode(d);v&&i.writeStreamChunk({buffer:v,isEnd:!1,timeReceived:Date.now()})}},o.connect(p),p.connect(e.destination),this.privMediaResources={scriptProcessorNode:p,source:o,stream:t}}).catch(()=>{a()})}else try{a()}catch(p){throw new Error(`Unable to start audio worklet node for PCMRecorder: ${p}`)}}releaseMediaResources(e){this.privMediaResources&&(this.privMediaResources.scriptProcessorNode&&(this.privMediaResources.scriptProcessorNode.disconnect(e.destination),this.privMediaResources.scriptProcessorNode=null),this.privMediaResources.source&&(this.privMediaResources.source.disconnect(),this.privStopInputOnRelease&&this.privMediaResources.stream.getTracks().forEach(t=>t.stop()),this.privMediaResources.source=null))}setWorkletUrl(e){this.privSpeechProcessorScript=e}};Io.PcmRecorder=Fl});var Py=u(()=>{});var Ry=u(()=>{});var Ey=u(()=>{});var wy=u(()=>{});var Iy=u(()=>{});var Ul=u(Ze=>{"use strict";var i_=Ze&&Ze.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),n_=Ze&&Ze.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),_y=Ze&&Ze.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&i_(e,r,t);return n_(e,r),e},Vl=Ze&&Ze.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ze,"__esModule",{value:!0});Ze.WebsocketMessageAdapter=void 0;var s_=_y(Py()),o_=_y(Ry()),a_=Vl(Ey()),c_=Vl(wy()),u_=Vl(Iy()),p_=_e(),_=P(),_o=class r{constructor(e,t,i,n,s,o){if(!e)throw new _.ArgumentNullError("uri");if(!i)throw new _.ArgumentNullError("messageFormatter");this.proxyInfo=n,this.privConnectionEvents=new _.EventSource,this.privConnectionId=t,this.privMessageFormatter=i,this.privConnectionState=_.ConnectionState.None,this.privUri=e,this.privHeaders=s,this.privEnableCompression=o,this.privHeaders[p_.HeaderNames.ConnectionId]=this.privConnectionId,this.privHeaders.connectionId=this.privConnectionId,this.privLastErrorReceived=""}get state(){return this.privConnectionState}open(){if(this.privConnectionState===_.ConnectionState.Disconnected)return Promise.reject(`Cannot open a connection that is in ${this.privConnectionState} state`);if(this.privConnectionEstablishDeferral)return this.privConnectionEstablishDeferral.promise;this.privConnectionEstablishDeferral=new _.Deferred,this.privCertificateValidatedDeferral=new _.Deferred,this.privConnectionState=_.ConnectionState.Connecting;try{if(typeof WebSocket<"u"&&!r.forceNpmWebSocket)this.privCertificateValidatedDeferral.resolve(),this.privWebsocketClient=new WebSocket(this.privUri);else{let t=new URL(this.privUri).protocol;t?.toLocaleLowerCase()==="wss:"?t="https:":t?.toLocaleLowerCase()==="ws:"&&(t="http:");let i={headers:this.privHeaders,perMessageDeflate:this.privEnableCompression,followRedirects:t.toLocaleLowerCase()==="https:"};this.privCertificateValidatedDeferral.resolve(),i.agent=this.getAgent(),i.agent.protocol=t,this.privWebsocketClient=new u_.default(this.privUri,i),this.privWebsocketClient.on("redirect",n=>{let s=new _.ConnectionRedirectEvent(this.privConnectionId,n,this.privUri,`Getting redirect URL from endpoint ${this.privUri} with redirect URL '${n}'`);_.Events.instance.onEvent(s)})}this.privWebsocketClient.binaryType="arraybuffer",this.privReceivingMessageQueue=new _.Queue,this.privDisconnectDeferral=new _.Deferred,this.privSendMessageQueue=new _.Queue,this.processSendQueue().catch(e=>{_.Events.instance.onEvent(new _.BackgroundEvent(e))})}catch(e){return this.privConnectionEstablishDeferral.resolve(new _.ConnectionOpenResponse(500,e)),this.privConnectionEstablishDeferral.promise}return this.onEvent(new _.ConnectionStartEvent(this.privConnectionId,this.privUri)),this.privWebsocketClient.onopen=()=>{this.privCertificateValidatedDeferral.promise.then(()=>{this.privConnectionState=_.ConnectionState.Connected,this.onEvent(new _.ConnectionEstablishedEvent(this.privConnectionId)),this.privConnectionEstablishDeferral.resolve(new _.ConnectionOpenResponse(200,""))},e=>{this.privConnectionEstablishDeferral.reject(e)})},this.privWebsocketClient.onerror=e=>{this.onEvent(new _.ConnectionErrorEvent(this.privConnectionId,e.message,e.type)),this.privLastErrorReceived=e.message},this.privWebsocketClient.onclose=e=>{this.privConnectionState===_.ConnectionState.Connecting?(this.privConnectionState=_.ConnectionState.Disconnected,this.privConnectionEstablishDeferral.resolve(new _.ConnectionOpenResponse(e.code,e.reason+" "+this.privLastErrorReceived))):(this.privConnectionState=_.ConnectionState.Disconnected,this.privWebsocketClient=null,this.onEvent(new _.ConnectionClosedEvent(this.privConnectionId,e.code,e.reason))),this.onClose(e.code,e.reason).catch(t=>{_.Events.instance.onEvent(new _.BackgroundEvent(t))})},this.privWebsocketClient.onmessage=e=>{let t=new Date().toISOString();if(this.privConnectionState===_.ConnectionState.Connected){let i=new _.Deferred;if(this.privReceivingMessageQueue.enqueueFromPromise(i.promise),e.data instanceof ArrayBuffer){let n=new _.RawWebsocketMessage(_.MessageType.Binary,e.data);this.privMessageFormatter.toConnectionMessage(n).then(s=>{this.onEvent(new _.ConnectionMessageReceivedEvent(this.privConnectionId,t,s)),i.resolve(s)},s=>{i.reject(`Invalid binary message format. Error: ${s}`)})}else{let n=new _.RawWebsocketMessage(_.MessageType.Text,e.data);this.privMessageFormatter.toConnectionMessage(n).then(s=>{this.onEvent(new _.ConnectionMessageReceivedEvent(this.privConnectionId,t,s)),i.resolve(s)},s=>{i.reject(`Invalid text message format. Error: ${s}`)})}}},this.privConnectionEstablishDeferral.promise}send(e){if(this.privConnectionState!==_.ConnectionState.Connected)return Promise.reject(`Cannot send on connection that is in ${_.ConnectionState[this.privConnectionState]} state`);let t=new _.Deferred,i=new _.Deferred;return this.privSendMessageQueue.enqueueFromPromise(i.promise),this.privMessageFormatter.fromConnectionMessage(e).then(n=>{i.resolve({Message:e,RawWebsocketMessage:n,sendStatusDeferral:t})},n=>{i.reject(`Error formatting the message. ${n}`)}),t.promise}read(){return this.privConnectionState!==_.ConnectionState.Connected?Promise.reject(`Cannot read on connection that is in ${this.privConnectionState} state`):this.privReceivingMessageQueue.dequeue()}close(e){if(this.privWebsocketClient)this.privConnectionState!==_.ConnectionState.Disconnected&&this.privWebsocketClient.close(1e3,e||"Normal closure by client");else return Promise.resolve();return this.privDisconnectDeferral.promise}get events(){return this.privConnectionEvents}sendRawMessage(e){try{if(!e)return Promise.resolve();if(this.onEvent(new _.ConnectionMessageSentEvent(this.privConnectionId,new Date().toISOString(),e.Message)),this.isWebsocketOpen)this.privWebsocketClient.send(e.RawWebsocketMessage.payload);else return Promise.reject("websocket send error: Websocket not ready "+this.privConnectionId+" "+e.Message.id+" "+new Error().stack);return Promise.resolve()}catch(t){return Promise.reject(`websocket send error: ${t}`)}}async onClose(e,t){let i=`Connection closed. ${e}: ${t}`;this.privConnectionState=_.ConnectionState.Disconnected,this.privDisconnectDeferral.resolve(),await this.privReceivingMessageQueue.drainAndDispose(()=>{},i),await this.privSendMessageQueue.drainAndDispose(n=>{n.sendStatusDeferral.reject(i)},i)}async processSendQueue(){for(;;){let t=await this.privSendMessageQueue.dequeue();if(!t)return;try{await this.sendRawMessage(t),t.sendStatusDeferral.resolve()}catch(i){t.sendStatusDeferral.reject(i)}}}onEvent(e){this.privConnectionEvents.onEvent(e),_.Events.instance.onEvent(e)}getAgent(){let e=new a_.default.Agent(this.createConnection);return this.proxyInfo!==void 0&&this.proxyInfo.HostName!==void 0&&this.proxyInfo.Port>0&&(e.proxyInfo=this.proxyInfo),e}static GetProxyAgent(e){let t={host:e.HostName,port:e.Port};return e.UserName?t.headers={"Proxy-Authentication":"Basic "+Buffer.from(`${e.UserName}:${e.Password===void 0?"":e.Password}`).toString("base64")}:t.headers={},t.headers.requestOCSP="true",new c_.default(t)}createConnection(e,t){let i;if(t={...t,requestOCSP:!0,servername:t.host},this.proxyInfo){let s=r.GetProxyAgent(this.proxyInfo);i=new Promise((o,a)=>{s.callback(e,t,(c,p)=>{c?a(c):o(p)})})}else t.secureEndpoint?i=Promise.resolve(o_.connect(t)):i=Promise.resolve(s_.connect(t));return i}get isWebsocketOpen(){return this.privWebsocketClient&&this.privWebsocketClient.readyState===this.privWebsocketClient.OPEN}};Ze.WebsocketMessageAdapter=_o;_o.forceNpmWebSocket=!1});var by=u(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.WebsocketConnection=void 0;var Wl=P(),l_=Ul(),Hl=class{constructor(e,t,i,n,s,o=!1,a){if(this.privIsDisposed=!1,!e)throw new Wl.ArgumentNullError("uri");if(!n)throw new Wl.ArgumentNullError("messageFormatter");this.privMessageFormatter=n;let c="",p=0;if(t){for(let h in t)if(h){c+=p===0&&e.indexOf("?")===-1?"?":"&";let d=encodeURIComponent(h);c+=d;let v=t[h];v&&(v=encodeURIComponent(v),c+=`=${v}`),p++}}if(i){for(let h in i)if(h){c+=p===0&&e.indexOf("?")===-1?"?":"&";let d=encodeURIComponent(i[h]);c+=`${h}=${d}`,p++}}this.privUri=e+c,this.privId=a||(0,Wl.createNoDashGuid)(),this.privConnectionMessageAdapter=new l_.WebsocketMessageAdapter(this.privUri,this.id,this.privMessageFormatter,s,i,o)}async dispose(){this.privIsDisposed=!0,this.privConnectionMessageAdapter&&await this.privConnectionMessageAdapter.close()}isDisposed(){return this.privIsDisposed}get id(){return this.privId}get uri(){return this.privUri}state(){return this.privConnectionMessageAdapter.state}open(){return this.privConnectionMessageAdapter.open()}send(e){return this.privConnectionMessageAdapter.send(e)}read(){return this.privConnectionMessageAdapter.read()}get events(){return this.privConnectionMessageAdapter.events}};bo.WebsocketConnection=Hl});var Ay=u(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.ReplayableAudioNode=void 0;var Kl=class{constructor(e,t){this.privBuffers=[],this.privReplayOffset=0,this.privLastShrinkOffset=0,this.privBufferStartOffset=0,this.privBufferSerial=0,this.privBufferedBytes=0,this.privReplay=!1,this.privLastChunkAcquiredTime=0,this.privAudioNode=e,this.privBytesPerSecond=t}id(){return this.privAudioNode.id()}read(){if(this.privReplay&&this.privBuffers.length!==0){let e=this.privReplayOffset-this.privBufferStartOffset,t=Math.round(e*this.privBytesPerSecond*1e-7);t%2!==0&&t++;let i=0;for(;i<this.privBuffers.length&&t>=this.privBuffers[i].chunk.buffer.byteLength;)t-=this.privBuffers[i++].chunk.buffer.byteLength;if(i<this.privBuffers.length){let n=this.privBuffers[i].chunk.buffer.slice(t);return this.privReplayOffset+=n.byteLength/this.privBytesPerSecond*1e7,i===this.privBuffers.length-1&&(this.privReplay=!1),Promise.resolve({buffer:n,isEnd:!1,timeReceived:this.privBuffers[i].chunk.timeReceived})}}return this.privAudioNode.read().then(e=>(e&&e.buffer&&this.privBuffers&&(this.privBuffers.push(new Jl(e,this.privBufferSerial++,this.privBufferedBytes)),this.privBufferedBytes+=e.buffer.byteLength),e))}detach(){return this.privBuffers=void 0,this.privAudioNode.detach()}replay(){this.privBuffers&&this.privBuffers.length!==0&&(this.privReplay=!0,this.privReplayOffset=this.privLastShrinkOffset)}shrinkBuffers(e){if(this.privBuffers===void 0||this.privBuffers.length===0)return;this.privLastShrinkOffset=e;let t=e-this.privBufferStartOffset,i=Math.round(t*this.privBytesPerSecond*1e-7),n=0;for(;n<this.privBuffers.length&&i>=this.privBuffers[n].chunk.buffer.byteLength;)i-=this.privBuffers[n++].chunk.buffer.byteLength;this.privBufferStartOffset=Math.round(e-i/this.privBytesPerSecond*1e7),this.privBuffers=this.privBuffers.slice(n)}findTimeAtOffset(e){if(e<this.privBufferStartOffset||this.privBuffers===void 0)return 0;for(let t of this.privBuffers){let i=t.byteOffset/this.privBytesPerSecond*1e7,n=i+t.chunk.buffer.byteLength/this.privBytesPerSecond*1e7;if(e>=i&&e<=n)return t.chunk.timeReceived}return 0}};Ao.ReplayableAudioNode=Kl;var Jl=class{constructor(e,t,i){this.chunk=e,this.serial=t,this.byteOffset=i}}});var Ql=u(Tt=>{"use strict";var h_=Tt&&Tt.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),d_=Tt&&Tt.__setModuleDefault||(Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e}),v_=Tt&&Tt.__importStar||function(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)t!=="default"&&Object.prototype.hasOwnProperty.call(r,t)&&h_(e,r,t);return d_(e,r),e};Object.defineProperty(Tt,"__esModule",{value:!0});Tt.AudioFileWriter=void 0;var On=v_(jl()),$l=I(),Gl=class{constructor(e){$l.Contracts.throwIfNullOrUndefined(On.openSync,`
File System access not available, please use Push or PullAudioOutputStream`),this.privFd=On.openSync(e,"w")}set format(e){$l.Contracts.throwIfNotUndefined(this.privAudioFormat,"format is already set"),this.privAudioFormat=e;let t=0;this.privAudioFormat.hasHeader&&(t=this.privAudioFormat.header.byteLength),this.privFd!==void 0&&(this.privWriteStream=On.createWriteStream("",{fd:this.privFd,start:t,autoClose:!1}))}write(e){$l.Contracts.throwIfNullOrUndefined(this.privAudioFormat,"must set format before writing."),this.privWriteStream!==void 0&&this.privWriteStream.write(new Uint8Array(e.slice(0)))}close(){this.privFd!==void 0&&(this.privWriteStream.on("finish",()=>{this.privAudioFormat.hasHeader&&(this.privAudioFormat.updateHeader(this.privWriteStream.bytesWritten),On.writeSync(this.privFd,new Int8Array(this.privAudioFormat.header),0,this.privAudioFormat.header.byteLength,0)),On.closeSync(this.privFd),this.privFd=void 0}),this.privWriteStream.end())}id(){return this.privId}};Tt.AudioFileWriter=Gl});var Xl=u(Ye=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});Ye.PullAudioInputStreamImpl=Ye.PullAudioInputStream=Ye.PushAudioInputStreamImpl=Ye.PushAudioInputStream=Ye.AudioInputStream=void 0;var To=C(),ge=P(),Ty=hr(),f_=f(),g_=gr(),kn=class{constructor(){}static createPushStream(e){return Mn.create(e)}static createPullStream(e,t){return Dn.create(e,t)}};Ye.AudioInputStream=kn;var Mn=class extends kn{static create(e){return new Oo(e)}};Ye.PushAudioInputStream=Mn;var Oo=class extends Mn{constructor(e){super(),e===void 0?this.privFormat=g_.AudioStreamFormatImpl.getDefaultInputFormat():this.privFormat=e,this.privEvents=new ge.EventSource,this.privId=(0,Ty.createNoDashGuid)(),this.privStream=new ge.ChunkedArrayBufferStream(this.privFormat.avgBytesPerSec/10)}get format(){return Promise.resolve(this.privFormat)}write(e){this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}id(){return this.privId}turnOn(){this.onEvent(new ge.AudioSourceInitializingEvent(this.privId)),this.onEvent(new ge.AudioSourceReadyEvent(this.privId))}async attach(e){this.onEvent(new ge.AudioStreamNodeAttachingEvent(this.privId,e)),await this.turnOn();let t=this.privStream;return this.onEvent(new ge.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:async()=>(this.onEvent(new ge.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>t.read()}}detach(e){this.onEvent(new ge.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:To.connectivity.Unknown,manufacturer:"Speech SDK",model:"PushStream",samplerate:this.privFormat.samplesPerSec,type:To.type.Stream})}onEvent(e){this.privEvents.onEvent(e),ge.Events.instance.onEvent(e)}toBuffer(e){let t=Buffer.alloc(e.byteLength),i=new Uint8Array(e);for(let n=0;n<t.length;++n)t[n]=i[n];return t}};Ye.PushAudioInputStreamImpl=Oo;var Dn=class extends kn{constructor(){super()}static create(e,t){return new ko(e,t)}};Ye.PullAudioInputStream=Dn;var ko=class extends Dn{constructor(e,t){super(),t===void 0?this.privFormat=f_.AudioStreamFormat.getDefaultInputFormat():this.privFormat=t,this.privEvents=new ge.EventSource,this.privId=(0,Ty.createNoDashGuid)(),this.privCallback=e,this.privIsClosed=!1,this.privBufferSize=this.privFormat.avgBytesPerSec/10}get format(){return Promise.resolve(this.privFormat)}close(){this.privIsClosed=!0,this.privCallback.close()}id(){return this.privId}turnOn(){this.onEvent(new ge.AudioSourceInitializingEvent(this.privId)),this.onEvent(new ge.AudioSourceReadyEvent(this.privId))}async attach(e){return this.onEvent(new ge.AudioStreamNodeAttachingEvent(this.privId,e)),await this.turnOn(),this.onEvent(new ge.AudioStreamNodeAttachedEvent(this.privId,e)),{detach:()=>(this.privCallback.close(),this.onEvent(new ge.AudioStreamNodeDetachedEvent(this.privId,e)),this.turnOff()),id:()=>e,read:()=>{let t=0,i;for(;t<this.privBufferSize;){let n=new ArrayBuffer(this.privBufferSize-t),s=this.privCallback.read(n);if(i===void 0?i=n:new Int8Array(i).set(new Int8Array(n),t),s===0)break;t+=s}return Promise.resolve({buffer:i.slice(0,t),isEnd:this.privIsClosed||t===0,timeReceived:Date.now()})}}}detach(e){this.onEvent(new ge.AudioStreamNodeDetachedEvent(this.privId,e))}turnOff(){}get events(){return this.privEvents}get deviceInfo(){return Promise.resolve({bitspersample:this.privFormat.bitsPerSample,channelcount:this.privFormat.channels,connectivity:To.connectivity.Unknown,manufacturer:"Speech SDK",model:"PullStream",samplerate:this.privFormat.samplesPerSec,type:To.type.Stream})}onEvent(e){this.privEvents.onEvent(e),ge.Events.instance.onEvent(e)}};Ye.PullAudioInputStreamImpl=ko});var Zl=u(xn=>{"use strict";Object.defineProperty(xn,"__esModule",{value:!0});xn.SpeechSynthesisOutputFormat=void 0;var m_;(function(r){r[r.Raw8Khz8BitMonoMULaw=0]="Raw8Khz8BitMonoMULaw",r[r.Riff16Khz16KbpsMonoSiren=1]="Riff16Khz16KbpsMonoSiren",r[r.Audio16Khz16KbpsMonoSiren=2]="Audio16Khz16KbpsMonoSiren",r[r.Audio16Khz32KBitRateMonoMp3=3]="Audio16Khz32KBitRateMonoMp3",r[r.Audio16Khz128KBitRateMonoMp3=4]="Audio16Khz128KBitRateMonoMp3",r[r.Audio16Khz64KBitRateMonoMp3=5]="Audio16Khz64KBitRateMonoMp3",r[r.Audio24Khz48KBitRateMonoMp3=6]="Audio24Khz48KBitRateMonoMp3",r[r.Audio24Khz96KBitRateMonoMp3=7]="Audio24Khz96KBitRateMonoMp3",r[r.Audio24Khz160KBitRateMonoMp3=8]="Audio24Khz160KBitRateMonoMp3",r[r.Raw16Khz16BitMonoTrueSilk=9]="Raw16Khz16BitMonoTrueSilk",r[r.Riff16Khz16BitMonoPcm=10]="Riff16Khz16BitMonoPcm",r[r.Riff8Khz16BitMonoPcm=11]="Riff8Khz16BitMonoPcm",r[r.Riff24Khz16BitMonoPcm=12]="Riff24Khz16BitMonoPcm",r[r.Riff8Khz8BitMonoMULaw=13]="Riff8Khz8BitMonoMULaw",r[r.Raw16Khz16BitMonoPcm=14]="Raw16Khz16BitMonoPcm",r[r.Raw24Khz16BitMonoPcm=15]="Raw24Khz16BitMonoPcm",r[r.Raw8Khz16BitMonoPcm=16]="Raw8Khz16BitMonoPcm",r[r.Ogg16Khz16BitMonoOpus=17]="Ogg16Khz16BitMonoOpus",r[r.Ogg24Khz16BitMonoOpus=18]="Ogg24Khz16BitMonoOpus",r[r.Raw48Khz16BitMonoPcm=19]="Raw48Khz16BitMonoPcm",r[r.Riff48Khz16BitMonoPcm=20]="Riff48Khz16BitMonoPcm",r[r.Audio48Khz96KBitRateMonoMp3=21]="Audio48Khz96KBitRateMonoMp3",r[r.Audio48Khz192KBitRateMonoMp3=22]="Audio48Khz192KBitRateMonoMp3",r[r.Ogg48Khz16BitMonoOpus=23]="Ogg48Khz16BitMonoOpus",r[r.Webm16Khz16BitMonoOpus=24]="Webm16Khz16BitMonoOpus",r[r.Webm24Khz16BitMonoOpus=25]="Webm24Khz16BitMonoOpus",r[r.Raw24Khz16BitMonoTrueSilk=26]="Raw24Khz16BitMonoTrueSilk",r[r.Raw8Khz8BitMonoALaw=27]="Raw8Khz8BitMonoALaw",r[r.Riff8Khz8BitMonoALaw=28]="Riff8Khz8BitMonoALaw",r[r.Webm24Khz16Bit24KbpsMonoOpus=29]="Webm24Khz16Bit24KbpsMonoOpus",r[r.Audio16Khz16Bit32KbpsMonoOpus=30]="Audio16Khz16Bit32KbpsMonoOpus",r[r.Audio24Khz16Bit48KbpsMonoOpus=31]="Audio24Khz16Bit48KbpsMonoOpus",r[r.Audio24Khz16Bit24KbpsMonoOpus=32]="Audio24Khz16Bit24KbpsMonoOpus",r[r.Raw22050Hz16BitMonoPcm=33]="Raw22050Hz16BitMonoPcm",r[r.Riff22050Hz16BitMonoPcm=34]="Riff22050Hz16BitMonoPcm",r[r.Raw44100Hz16BitMonoPcm=35]="Raw44100Hz16BitMonoPcm",r[r.Riff44100Hz16BitMonoPcm=36]="Riff44100Hz16BitMonoPcm",r[r.AmrWb16000Hz=37]="AmrWb16000Hz",r[r.G72216Khz64Kbps=38]="G72216Khz64Kbps"})(m_=xn.SpeechSynthesisOutputFormat||(xn.SpeechSynthesisOutputFormat={}))});var Ai=u(Do=>{"use strict";Object.defineProperty(Do,"__esModule",{value:!0});Do.AudioOutputFormatImpl=void 0;var O=Zl(),b=gr(),Mo=class r extends b.AudioStreamFormatImpl{constructor(e,t,i,n,s,o,a,c,p){super(i,o,t,e),this.formatTag=e,this.avgBytesPerSec=n,this.blockAlign=s,this.priAudioFormatString=a,this.priRequestAudioFormatString=c,this.priHasHeader=p}static fromSpeechSynthesisOutputFormat(e){return e===void 0?r.getDefaultOutputFormat():r.fromSpeechSynthesisOutputFormatString(r.SpeechSynthesisOutputFormatToString[e])}static fromSpeechSynthesisOutputFormatString(e){switch(e){case"raw-8khz-8bit-mono-mulaw":return new r(b.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,e,!1);case"riff-16khz-16kbps-mono-siren":return new r(b.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,"audio-16khz-16kbps-mono-siren",!0);case"audio-16khz-16kbps-mono-siren":return new r(b.AudioFormatTag.Siren,1,16e3,2e3,40,0,e,e,!1);case"audio-16khz-32kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,16e3,4096,2,16,e,e,!1);case"audio-16khz-128kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,16e3,16384,2,16,e,e,!1);case"audio-16khz-64kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,16e3,8192,2,16,e,e,!1);case"audio-24khz-48kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,24e3,6144,2,16,e,e,!1);case"audio-24khz-96kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,24e3,12288,2,16,e,e,!1);case"audio-24khz-160kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,24e3,20480,2,16,e,e,!1);case"raw-16khz-16bit-mono-truesilk":return new r(b.AudioFormatTag.SILKSkype,1,16e3,32e3,2,16,e,e,!1);case"riff-8khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!0);case"riff-24khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!0);case"riff-8khz-8bit-mono-mulaw":return new r(b.AudioFormatTag.MuLaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-mulaw",!0);case"raw-16khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,16e3,32e3,2,16,e,"raw-16khz-16bit-mono-pcm",!1);case"raw-24khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,24e3,48e3,2,16,e,"raw-24khz-16bit-mono-pcm",!1);case"raw-8khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,8e3,16e3,2,16,e,"raw-8khz-16bit-mono-pcm",!1);case"ogg-16khz-16bit-mono-opus":return new r(b.AudioFormatTag.OGG_OPUS,1,16e3,8192,2,16,e,e,!1);case"ogg-24khz-16bit-mono-opus":return new r(b.AudioFormatTag.OGG_OPUS,1,24e3,8192,2,16,e,e,!1);case"raw-48khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!1);case"riff-48khz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,48e3,96e3,2,16,e,"raw-48khz-16bit-mono-pcm",!0);case"audio-48khz-96kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,48e3,12288,2,16,e,e,!1);case"audio-48khz-192kbitrate-mono-mp3":return new r(b.AudioFormatTag.MP3,1,48e3,24576,2,16,e,e,!1);case"ogg-48khz-16bit-mono-opus":return new r(b.AudioFormatTag.OGG_OPUS,1,48e3,12e3,2,16,e,e,!1);case"webm-16khz-16bit-mono-opus":return new r(b.AudioFormatTag.WEBM_OPUS,1,16e3,4e3,2,16,e,e,!1);case"webm-24khz-16bit-mono-opus":return new r(b.AudioFormatTag.WEBM_OPUS,1,24e3,6e3,2,16,e,e,!1);case"webm-24khz-16bit-24kbps-mono-opus":return new r(b.AudioFormatTag.WEBM_OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-16khz-16bit-32kbps-mono-opus":return new r(b.AudioFormatTag.OPUS,1,16e3,4e3,2,16,e,e,!1);case"audio-24khz-16bit-48kbps-mono-opus":return new r(b.AudioFormatTag.OPUS,1,24e3,6e3,2,16,e,e,!1);case"audio-24khz-16bit-24kbps-mono-opus":return new r(b.AudioFormatTag.OPUS,1,24e3,3e3,2,16,e,e,!1);case"audio-24khz-16bit-mono-flac":return new r(b.AudioFormatTag.FLAC,1,24e3,24e3,2,16,e,e,!1);case"audio-48khz-16bit-mono-flac":return new r(b.AudioFormatTag.FLAC,1,48e3,3e4,2,16,e,e,!1);case"raw-24khz-16bit-mono-truesilk":return new r(b.AudioFormatTag.SILKSkype,1,24e3,48e3,2,16,e,e,!1);case"raw-8khz-8bit-mono-alaw":return new r(b.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,e,!1);case"riff-8khz-8bit-mono-alaw":return new r(b.AudioFormatTag.ALaw,1,8e3,8e3,1,8,e,"raw-8khz-8bit-mono-alaw",!0);case"raw-22050hz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,22050,44100,2,16,e,e,!1);case"riff-22050hz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,22050,44100,2,16,e,"raw-22050hz-16bit-mono-pcm",!0);case"raw-44100hz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,44100,88200,2,16,e,e,!1);case"riff-44100hz-16bit-mono-pcm":return new r(b.AudioFormatTag.PCM,1,44100,88200,2,16,e,"raw-44100hz-16bit-mono-pcm",!0);case"amr-wb-16000h":return new r(b.AudioFormatTag.AMR_WB,1,16e3,3052,2,16,e,e,!1);case"g722-16khz-64kbps":return new r(b.AudioFormatTag.G722,1,16e3,8e3,2,16,e,e,!1);case"riff-16khz-16bit-mono-pcm":default:return new r(b.AudioFormatTag.PCM,1,16e3,32e3,2,16,"riff-16khz-16bit-mono-pcm","raw-16khz-16bit-mono-pcm",!0)}}static getDefaultOutputFormat(){return r.fromSpeechSynthesisOutputFormatString(typeof window<"u"?"audio-24khz-48kbitrate-mono-mp3":"riff-16khz-16bit-mono-pcm")}get hasHeader(){return this.priHasHeader}get header(){if(this.hasHeader)return this.privHeader}updateHeader(e){if(this.priHasHeader){let t=new DataView(this.privHeader);t.setUint32(4,e+this.privHeader.byteLength-8,!0),t.setUint32(40,e,!0)}}get requestAudioFormatString(){return this.priRequestAudioFormatString}addHeader(e){if(!this.hasHeader)return e;this.updateHeader(e.byteLength);let t=new Uint8Array(e.byteLength+this.header.byteLength);return t.set(new Uint8Array(this.header),0),t.set(new Uint8Array(e),this.header.byteLength),t.buffer}};Do.AudioOutputFormatImpl=Mo;Mo.SpeechSynthesisOutputFormatToString={[O.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoMULaw]:"raw-8khz-8bit-mono-mulaw",[O.SpeechSynthesisOutputFormat.Riff16Khz16KbpsMonoSiren]:"riff-16khz-16kbps-mono-siren",[O.SpeechSynthesisOutputFormat.Audio16Khz16KbpsMonoSiren]:"audio-16khz-16kbps-mono-siren",[O.SpeechSynthesisOutputFormat.Audio16Khz32KBitRateMonoMp3]:"audio-16khz-32kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio16Khz128KBitRateMonoMp3]:"audio-16khz-128kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio16Khz64KBitRateMonoMp3]:"audio-16khz-64kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio24Khz48KBitRateMonoMp3]:"audio-24khz-48kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio24Khz96KBitRateMonoMp3]:"audio-24khz-96kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio24Khz160KBitRateMonoMp3]:"audio-24khz-160kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoTrueSilk]:"raw-16khz-16bit-mono-truesilk",[O.SpeechSynthesisOutputFormat.Riff16Khz16BitMonoPcm]:"riff-16khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff8Khz16BitMonoPcm]:"riff-8khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm]:"riff-24khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoMULaw]:"riff-8khz-8bit-mono-mulaw",[O.SpeechSynthesisOutputFormat.Raw16Khz16BitMonoPcm]:"raw-16khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoPcm]:"raw-24khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Raw8Khz16BitMonoPcm]:"raw-8khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Ogg16Khz16BitMonoOpus]:"ogg-16khz-16bit-mono-opus",[O.SpeechSynthesisOutputFormat.Ogg24Khz16BitMonoOpus]:"ogg-24khz-16bit-mono-opus",[O.SpeechSynthesisOutputFormat.Raw48Khz16BitMonoPcm]:"raw-48khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff48Khz16BitMonoPcm]:"riff-48khz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Audio48Khz96KBitRateMonoMp3]:"audio-48khz-96kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3]:"audio-48khz-192kbitrate-mono-mp3",[O.SpeechSynthesisOutputFormat.Ogg48Khz16BitMonoOpus]:"ogg-48khz-16bit-mono-opus",[O.SpeechSynthesisOutputFormat.Webm16Khz16BitMonoOpus]:"webm-16khz-16bit-mono-opus",[O.SpeechSynthesisOutputFormat.Webm24Khz16BitMonoOpus]:"webm-24khz-16bit-mono-opus",[O.SpeechSynthesisOutputFormat.Webm24Khz16Bit24KbpsMonoOpus]:"webm-24khz-16bit-24kbps-mono-opus",[O.SpeechSynthesisOutputFormat.Raw24Khz16BitMonoTrueSilk]:"raw-24khz-16bit-mono-truesilk",[O.SpeechSynthesisOutputFormat.Raw8Khz8BitMonoALaw]:"raw-8khz-8bit-mono-alaw",[O.SpeechSynthesisOutputFormat.Riff8Khz8BitMonoALaw]:"riff-8khz-8bit-mono-alaw",[O.SpeechSynthesisOutputFormat.Audio16Khz16Bit32KbpsMonoOpus]:"audio-16khz-16bit-32kbps-mono-opus",[O.SpeechSynthesisOutputFormat.Audio24Khz16Bit48KbpsMonoOpus]:"audio-24khz-16bit-48kbps-mono-opus",[O.SpeechSynthesisOutputFormat.Audio24Khz16Bit24KbpsMonoOpus]:"audio-24khz-16bit-24kbps-mono-opus",[O.SpeechSynthesisOutputFormat.Raw22050Hz16BitMonoPcm]:"raw-22050hz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff22050Hz16BitMonoPcm]:"riff-22050hz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Raw44100Hz16BitMonoPcm]:"raw-44100hz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.Riff44100Hz16BitMonoPcm]:"riff-44100hz-16bit-mono-pcm",[O.SpeechSynthesisOutputFormat.AmrWb16000Hz]:"amr-wb-16000hz",[O.SpeechSynthesisOutputFormat.G72216Khz64Kbps]:"g722-16khz-64kbps"}});var Xr=u(et=>{"use strict";Object.defineProperty(et,"__esModule",{value:!0});et.PushAudioOutputStreamImpl=et.PushAudioOutputStream=et.PullAudioOutputStreamImpl=et.PullAudioOutputStream=et.AudioOutputStream=void 0;var Yl=P(),y_=I(),S_=Ai(),Nn=class{constructor(){}static createPullStream(){return jn.create()}};et.AudioOutputStream=Nn;var jn=class extends Nn{static create(){return new xo}};et.PullAudioOutputStream=jn;var xo=class extends jn{constructor(){super(),this.privId=(0,Yl.createNoDashGuid)(),this.privStream=new Yl.Stream}set format(e){e==null&&(this.privFormat=S_.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privFormat=e}get format(){return this.privFormat}get isClosed(){return this.privStream.isClosed}id(){return this.privId}async read(e){let t=new Int8Array(e),i=0;if(this.privLastChunkView!==void 0){if(this.privLastChunkView.length>e.byteLength)return t.set(this.privLastChunkView.slice(0,e.byteLength)),this.privLastChunkView=this.privLastChunkView.slice(e.byteLength),Promise.resolve(e.byteLength);t.set(this.privLastChunkView),i=this.privLastChunkView.length,this.privLastChunkView=void 0}for(;i<e.byteLength&&!this.privStream.isReadEnded;){let n=await this.privStream.read();if(n!==void 0&&!n.isEnd){let s;n.buffer.byteLength>e.byteLength-i?(s=n.buffer.slice(0,e.byteLength-i),this.privLastChunkView=new Int8Array(n.buffer.slice(e.byteLength-i))):s=n.buffer,t.set(new Int8Array(s),i),i+=s.byteLength}else this.privStream.readEnded()}return i}write(e){y_.Contracts.throwIfNullOrUndefined(this.privStream,"must set format before writing"),this.privStream.writeStreamChunk({buffer:e,isEnd:!1,timeReceived:Date.now()})}close(){this.privStream.close()}};et.PullAudioOutputStreamImpl=xo;var No=class extends Nn{constructor(){super()}static create(e){return new jo(e)}};et.PushAudioOutputStream=No;var jo=class extends No{constructor(e){super(),this.privId=(0,Yl.createNoDashGuid)(),this.privCallback=e}set format(e){}write(e){this.privCallback.write&&this.privCallback.write(e)}close(){this.privCallback.close&&this.privCallback.close()}id(){return this.privId}};et.PushAudioOutputStreamImpl=jo});var eh=u(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.AudioOutputConfigImpl=mr.AudioConfigImpl=mr.AudioConfig=void 0;var Zr=ue(),C_=I(),Yr=f(),P_=Ql(),R_=Xl(),E_=Xr(),qn=class r{static fromDefaultMicrophoneInput(){let e=new Zr.PcmRecorder(!0);return new Gt(new Zr.MicAudioSource(e))}static fromMicrophoneInput(e){let t=new Zr.PcmRecorder(!0);return new Gt(new Zr.MicAudioSource(t,e))}static fromWavFileInput(e,t="unnamedBuffer.wav"){return new Gt(new Zr.FileAudioSource(e,t))}static fromStreamInput(e){if(e instanceof Yr.PullAudioInputStreamCallback)return new Gt(new R_.PullAudioInputStreamImpl(e));if(e instanceof Yr.AudioInputStream)return new Gt(e);if(typeof MediaStream<"u"&&e instanceof MediaStream){let t=new Zr.PcmRecorder(!1);return new Gt(new Zr.MicAudioSource(t,null,null,e))}throw new Error("Not Supported Type")}static fromDefaultSpeakerOutput(){return new Qt(new Yr.SpeakerAudioDestination)}static fromSpeakerOutput(e){if(e===void 0)return r.fromDefaultSpeakerOutput();if(e instanceof Yr.SpeakerAudioDestination)return new Qt(e);throw new Error("Not Supported Type")}static fromAudioFileOutput(e){return new Qt(new P_.AudioFileWriter(e))}static fromStreamOutput(e){if(e instanceof Yr.PushAudioOutputStreamCallback)return new Qt(new E_.PushAudioOutputStreamImpl(e));if(e instanceof Yr.PushAudioOutputStream)return new Qt(e);if(e instanceof Yr.PullAudioOutputStream)return new Qt(e);throw new Error("Not Supported Type")}};mr.AudioConfig=qn;var Gt=class extends qn{constructor(e){super(),this.privSource=e}get format(){return this.privSource.format}close(e,t){this.privSource.turnOff().then(()=>{e&&e()},i=>{t&&t(i)})}id(){return this.privSource.id()}turnOn(){return this.privSource.turnOn()}attach(e){return this.privSource.attach(e)}detach(e){return this.privSource.detach(e)}turnOff(){return this.privSource.turnOff()}get events(){return this.privSource.events}setProperty(e,t){if(C_.Contracts.throwIfNull(t,"value"),this.privSource.setProperty!==void 0)this.privSource.setProperty(e,t);else throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(e,t){if(this.privSource.getProperty!==void 0)return this.privSource.getProperty(e,t);throw new Error("This AudioConfig instance does not support getting properties.")}get deviceInfo(){return this.privSource.deviceInfo}};mr.AudioConfigImpl=Gt;var Qt=class extends qn{constructor(e){super(),this.privDestination=e}set format(e){this.privDestination.format=e}write(e){this.privDestination.write(e)}close(){this.privDestination.close()}id(){return this.privDestination.id()}setProperty(){throw new Error("This AudioConfig instance does not support setting properties.")}getProperty(){throw new Error("This AudioConfig instance does not support getting properties.")}};mr.AudioOutputConfigImpl=Qt});var Oy=u(zn=>{"use strict";Object.defineProperty(zn,"__esModule",{value:!0});zn.CancellationReason=void 0;var w_;(function(r){r[r.Error=0]="Error",r[r.EndOfStream=1]="EndOfStream"})(w_=zn.CancellationReason||(zn.CancellationReason={}))});var ky=u(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.PullAudioInputStreamCallback=void 0;var th=class{};qo.PullAudioInputStreamCallback=th});var My=u(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.PushAudioOutputStreamCallback=void 0;var rh=class{};zo.PushAudioOutputStreamCallback=rh});var xy=u(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.KeywordRecognitionModel=void 0;var Dy=I(),ih=class{constructor(){this.privDisposed=!1}static fromFile(e){throw Dy.Contracts.throwIfFileDoesNotExist(e,"fileName"),new Error("Not yet implemented.")}static fromStream(e){throw Dy.Contracts.throwIfNull(e,"file"),new Error("Not yet implemented.")}close(){this.privDisposed||(this.privDisposed=!0)}};Lo.KeywordRecognitionModel=ih});var Ny=u(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.SessionEventArgs=void 0;var nh=class{constructor(e){this.privSessionId=e}get sessionId(){return this.privSessionId}};Bo.SessionEventArgs=nh});var jy=u(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.RecognitionEventArgs=void 0;var I_=f(),sh=class extends I_.SessionEventArgs{constructor(e,t){super(t),this.privOffset=e}get offset(){return this.privOffset}};Fo.RecognitionEventArgs=sh});var qy=u(Ln=>{"use strict";Object.defineProperty(Ln,"__esModule",{value:!0});Ln.OutputFormat=void 0;var __;(function(r){r[r.Simple=0]="Simple",r[r.Detailed=1]="Detailed"})(__=Ln.OutputFormat||(Ln.OutputFormat={}))});var zy=u(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.IntentRecognitionEventArgs=void 0;var b_=f(),oh=class extends b_.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}};Vo.IntentRecognitionEventArgs=oh});var Ly=u(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.RecognitionResult=void 0;var ah=class{constructor(e,t,i,n,s,o,a,c,p,h){this.privResultId=e,this.privReason=t,this.privText=i,this.privDuration=n,this.privOffset=s,this.privLanguage=o,this.privLanguageDetectionConfidence=a,this.privErrorDetails=c,this.privJson=p,this.privProperties=h}get resultId(){return this.privResultId}get reason(){return this.privReason}get text(){return this.privText}get duration(){return this.privDuration}get offset(){return this.privOffset}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}get errorDetails(){return this.privErrorDetails}get json(){return this.privJson}get properties(){return this.privProperties}};Uo.RecognitionResult=ah});var By=u(Wo=>{"use strict";Object.defineProperty(Wo,"__esModule",{value:!0});Wo.SpeechRecognitionResult=void 0;var A_=f(),ch=class extends A_.RecognitionResult{constructor(e,t,i,n,s,o,a,c,p,h,d){super(e,t,i,n,s,o,a,p,h,d),this.privSpeakerId=c}get speakerId(){return this.privSpeakerId}};Wo.SpeechRecognitionResult=ch});var Fy=u(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.IntentRecognitionResult=void 0;var T_=f(),uh=class extends T_.SpeechRecognitionResult{constructor(e,t,i,n,s,o,a,c,p,h,d){super(t,i,n,s,o,a,c,void 0,p,h,d),this.privIntentId=e}get intentId(){return this.privIntentId}};Ho.IntentRecognitionResult=uh});var Vy=u(ki=>{"use strict";Object.defineProperty(ki,"__esModule",{value:!0});ki.LanguageUnderstandingModelImpl=ki.LanguageUnderstandingModel=void 0;var Ti=I(),Ko=class{constructor(){}static fromEndpoint(e){Ti.Contracts.throwIfNull(e,"uri"),Ti.Contracts.throwIfNullOrWhitespace(e.hostname,"uri");let t=new Oi,i=e.host.indexOf(".");if(i===-1)throw new Error("Could not determine region from endpoint");t.region=e.host.substr(0,i);let n=e.pathname.lastIndexOf("/")+1;if(n===-1)throw new Error("Could not determine appId from endpoint");if(t.appId=e.pathname.substr(n),t.subscriptionKey=e.searchParams.get("subscription-key"),t.subscriptionKey===void 0)throw new Error("Could not determine subscription key from endpoint");return t}static fromAppId(e){Ti.Contracts.throwIfNullOrWhitespace(e,"appId");let t=new Oi;return t.appId=e,t}static fromSubscription(e,t,i){Ti.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),Ti.Contracts.throwIfNullOrWhitespace(t,"appId"),Ti.Contracts.throwIfNullOrWhitespace(i,"region");let n=new Oi;return n.appId=t,n.region=i,n.subscriptionKey=e,n}};ki.LanguageUnderstandingModel=Ko;var Oi=class extends Ko{};ki.LanguageUnderstandingModelImpl=Oi});var Wy=u(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.MeetingTranscriptionEventArgs=yr.ConversationTranscriptionEventArgs=yr.SpeechRecognitionEventArgs=void 0;var Uy=f(),Jo=class extends Uy.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}};yr.SpeechRecognitionEventArgs=Jo;var ph=class extends Uy.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}};yr.ConversationTranscriptionEventArgs=ph;var lh=class extends Jo{};yr.MeetingTranscriptionEventArgs=lh});var Mi=u($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.CancellationEventArgsBase=void 0;var O_=f(),hh=class extends O_.RecognitionEventArgs{constructor(e,t,i,n,s){super(n,s),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};$o.CancellationEventArgsBase=hh});var Hy=u(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.SpeechRecognitionCanceledEventArgs=void 0;var k_=Mi(),dh=class extends k_.CancellationEventArgsBase{};Go.SpeechRecognitionCanceledEventArgs=dh});var Ky=u(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.TranslationRecognitionEventArgs=void 0;var M_=f(),vh=class extends M_.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}};Qo.TranslationRecognitionEventArgs=vh});var Jy=u(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.TranslationSynthesisEventArgs=void 0;var D_=f(),fh=class extends D_.SessionEventArgs{constructor(e,t){super(t),this.privResult=e}get result(){return this.privResult}};Xo.TranslationSynthesisEventArgs=fh});var mh=u(Zo=>{"use strict";Object.defineProperty(Zo,"__esModule",{value:!0});Zo.TranslationRecognitionResult=void 0;var x_=f(),gh=class r extends x_.SpeechRecognitionResult{constructor(e,t,i,n,s,o,a,c,p,h,d){super(t,i,n,s,o,a,c,void 0,p,h,d),this.privTranslations=e}static fromSpeechRecognitionResult(e){return new r(void 0,e.resultId,e.reason,e.text,e.duration,e.offset,e.language,e.languageDetectionConfidence,e.errorDetails,e.json,e.properties)}get translations(){return this.privTranslations}};Zo.TranslationRecognitionResult=gh});var $y=u(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.TranslationSynthesisResult=void 0;var yh=class{constructor(e,t){this.privReason=e,this.privAudio=t}get audio(){return this.privAudio}get reason(){return this.privReason}};Yo.TranslationSynthesisResult=yh});var Gy=u(Bn=>{"use strict";Object.defineProperty(Bn,"__esModule",{value:!0});Bn.ResultReason=void 0;var N_;(function(r){r[r.NoMatch=0]="NoMatch",r[r.Canceled=1]="Canceled",r[r.RecognizingSpeech=2]="RecognizingSpeech",r[r.RecognizedSpeech=3]="RecognizedSpeech",r[r.RecognizedKeyword=4]="RecognizedKeyword",r[r.RecognizingIntent=5]="RecognizingIntent",r[r.RecognizedIntent=6]="RecognizedIntent",r[r.TranslatingSpeech=7]="TranslatingSpeech",r[r.TranslatedSpeech=8]="TranslatedSpeech",r[r.SynthesizingAudio=9]="SynthesizingAudio",r[r.SynthesizingAudioCompleted=10]="SynthesizingAudioCompleted",r[r.SynthesizingAudioStarted=11]="SynthesizingAudioStarted",r[r.EnrollingVoiceProfile=12]="EnrollingVoiceProfile",r[r.EnrolledVoiceProfile=13]="EnrolledVoiceProfile",r[r.RecognizedSpeakers=14]="RecognizedSpeakers",r[r.RecognizedSpeaker=15]="RecognizedSpeaker",r[r.ResetVoiceProfile=16]="ResetVoiceProfile",r[r.DeletedVoiceProfile=17]="DeletedVoiceProfile",r[r.VoicesListRetrieved=18]="VoicesListRetrieved",r[r.TranslatingParticipantSpeech=19]="TranslatingParticipantSpeech",r[r.TranslatedParticipantSpeech=20]="TranslatedParticipantSpeech",r[r.TranslatedInstantMessage=21]="TranslatedInstantMessage",r[r.TranslatedParticipantInstantMessage=22]="TranslatedParticipantInstantMessage"})(N_=Bn.ResultReason||(Bn.ResultReason={}))});var Qy=u(xi=>{"use strict";Object.defineProperty(xi,"__esModule",{value:!0});xi.SpeechConfigImpl=xi.SpeechConfig=void 0;var Di=C(),ei=I(),w=f(),ea=class{constructor(){}static fromSubscription(e,t){ei.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),ei.Contracts.throwIfNullOrWhitespace(t,"region");let i=new Ot;return i.setProperty(w.PropertyId.SpeechServiceConnection_Region,t),i.setProperty(w.PropertyId.SpeechServiceConnection_IntentRegion,t),i.setProperty(w.PropertyId.SpeechServiceConnection_Key,e),i}static fromEndpoint(e,t){ei.Contracts.throwIfNull(e,"endpoint");let i=typeof t=="string"&&t.trim().length>0,n=typeof t=="object"&&t!==null&&typeof t.getToken=="function",s=typeof t=="object"&&t!==null&&typeof t.key=="string";if(t!==void 0&&!i&&!n&&!s)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let o;return typeof t=="string"?(o=new Ot,o.setProperty(w.PropertyId.SpeechServiceConnection_Key,t)):typeof t=="object"&&typeof t.getToken=="function"?o=new Ot(t):typeof t=="object"&&typeof t.key=="string"?(o=new Ot,o.setProperty(w.PropertyId.SpeechServiceConnection_Key,t.key)):o=new Ot,o.setProperty(w.PropertyId.SpeechServiceConnection_Endpoint,e.href),o}static fromHost(e,t){ei.Contracts.throwIfNull(e,"hostName");let i=new Ot;return i.setProperty(w.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(e.port===""?"":":"+e.port)),i.setProperty(w.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),t!==void 0&&i.setProperty(w.PropertyId.SpeechServiceConnection_Key,t),i}static fromAuthorizationToken(e,t){ei.Contracts.throwIfNull(e,"authorizationToken"),ei.Contracts.throwIfNullOrWhitespace(t,"region");let i=new Ot;return i.setProperty(w.PropertyId.SpeechServiceConnection_Region,t),i.setProperty(w.PropertyId.SpeechServiceConnection_IntentRegion,t),i.authorizationToken=e,i}close(){}};xi.SpeechConfig=ea;var Ot=class r extends ea{constructor(e){super(),this.privProperties=new w.PropertyCollection,this.speechRecognitionLanguage="en-US",this.outputFormat=w.OutputFormat.Simple,this.privTokenCredential=e}get properties(){return this.privProperties}get endPoint(){return new URL(this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_Endpoint))}get subscriptionKey(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_Key)}get region(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_Region)}get authorizationToken(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_RecoLanguage)}set speechRecognitionLanguage(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get autoDetectSourceLanguages(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)}set autoDetectSourceLanguages(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e)}get outputFormat(){return w.OutputFormat[this.privProperties.getProperty(Di.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privProperties.setProperty(Di.OutputFormatPropertyName,w.OutputFormat[e])}get endpointId(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_EndpointId,e)}get tokenCredential(){return this.privTokenCredential}setProperty(e,t){ei.Contracts.throwIfNull(t,"value"),this.privProperties.setProperty(e,t)}getProperty(e,t){return this.privProperties.getProperty(e,t)}setProxy(e,t,i,n){this.setProperty(w.PropertyId[w.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(w.PropertyId[w.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(w.PropertyId[w.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(w.PropertyId[w.PropertyId.SpeechServiceConnection_ProxyPassword],n)}setServiceProperty(e,t){let i=JSON.parse(this.privProperties.getProperty(Di.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privProperties.setProperty(Di.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceResponse_ProfanityOption,w.ProfanityOption[e])}enableAudioLogging(){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privProperties.setProperty(w.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true"),this.privProperties.setProperty(Di.OutputFormatPropertyName,w.OutputFormat[w.OutputFormat.Detailed])}enableDictation(){this.privProperties.setProperty(Di.ForceDictationPropertyName,"true")}clone(){let e=new r(this.tokenCredential);return e.privProperties=this.privProperties.clone(),e}get speechSynthesisLanguage(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return w.SpeechSynthesisOutputFormat[this.privProperties.getProperty(w.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privProperties.setProperty(w.PropertyId.SpeechServiceConnection_SynthOutputFormat,w.SpeechSynthesisOutputFormat[e])}};xi.SpeechConfigImpl=Ot});var Xy=u(Ni=>{"use strict";Object.defineProperty(Ni,"__esModule",{value:!0});Ni.SpeechTranslationConfigImpl=Ni.SpeechTranslationConfig=void 0;var Fn=C(),Mt=I(),E=f(),ta=class extends E.SpeechConfig{constructor(){super()}static fromSubscription(e,t){Mt.Contracts.throwIfNullOrWhitespace(e,"subscriptionKey"),Mt.Contracts.throwIfNullOrWhitespace(t,"region");let i=new kt;return i.properties.setProperty(E.PropertyId.SpeechServiceConnection_Key,e),i.properties.setProperty(E.PropertyId.SpeechServiceConnection_Region,t),i}static fromAuthorizationToken(e,t){Mt.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),Mt.Contracts.throwIfNullOrWhitespace(t,"region");let i=new kt;return i.properties.setProperty(E.PropertyId.SpeechServiceAuthorization_Token,e),i.properties.setProperty(E.PropertyId.SpeechServiceConnection_Region,t),i}static fromHost(e,t){Mt.Contracts.throwIfNull(e,"hostName");let i=new kt;return i.setProperty(E.PropertyId.SpeechServiceConnection_Host,e.protocol+"//"+e.hostname+(e.port===""?"":":"+e.port)),t!==void 0&&i.setProperty(E.PropertyId.SpeechServiceConnection_Key,t),i}static fromEndpoint(e,t){Mt.Contracts.throwIfNull(e,"endpoint");let i=typeof t=="string"&&t.trim().length>0,n=typeof t=="object"&&t!==null&&typeof t.getToken=="function",s=typeof t=="object"&&t!==null&&typeof t.key=="string";if(t!==void 0&&!i&&!n&&!s)throw new Error("Invalid 'auth' parameter: expected a non-empty API key string, a TokenCredential, or a KeyCredential.");let o;return typeof t=="string"?(o=new kt,o.setProperty(E.PropertyId.SpeechServiceConnection_Key,t)):typeof t=="object"&&typeof t.getToken=="function"?o=new kt(t):typeof t=="object"&&typeof t.key=="string"?(o=new kt,o.setProperty(E.PropertyId.SpeechServiceConnection_Key,t.key)):o=new kt,o.setProperty(E.PropertyId.SpeechServiceConnection_Endpoint,e.href),o}};Ni.SpeechTranslationConfig=ta;var kt=class extends ta{constructor(e){super(),this.privSpeechProperties=new E.PropertyCollection,this.outputFormat=E.OutputFormat.Simple,this.privTokenCredential=e}set authorizationToken(e){Mt.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceAuthorization_Token,e)}set speechRecognitionLanguage(e){Mt.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_RecoLanguage,e)}get speechRecognitionLanguage(){return this.privSpeechProperties.getProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_RecoLanguage])}get subscriptionKey(){return this.privSpeechProperties.getProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_Key])}get outputFormat(){return E.OutputFormat[this.privSpeechProperties.getProperty(Fn.OutputFormatPropertyName,void 0)]}set outputFormat(e){this.privSpeechProperties.setProperty(Fn.OutputFormatPropertyName,E.OutputFormat[e])}get endpointId(){return this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_EndpointId)}set endpointId(e){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_EndpointId,e)}addTargetLanguage(e){Mt.Contracts.throwIfNullOrWhitespace(e,"value");let t=this.targetLanguages;t.includes(e)||(t.push(e),this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")))}get targetLanguages(){return this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","):[]}get voiceName(){return this.getProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_TranslationVoice])}set voiceName(e){Mt.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_TranslationVoice,e)}get region(){return this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_Region)}get tokenCredential(){return this.privTokenCredential}setProxy(e,t,i,n){this.setProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_ProxyHostName],e),this.setProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_ProxyPort],t),this.setProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_ProxyUserName],i),this.setProperty(E.PropertyId[E.PropertyId.SpeechServiceConnection_ProxyPassword],n)}getProperty(e,t){return this.privSpeechProperties.getProperty(e,t)}setProperty(e,t){this.privSpeechProperties.setProperty(e,t)}get properties(){return this.privSpeechProperties}close(){}setServiceProperty(e,t){let i=JSON.parse(this.privSpeechProperties.getProperty(Fn.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privSpeechProperties.setProperty(Fn.ServicePropertiesPropertyName,JSON.stringify(i))}setProfanity(e){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceResponse_ProfanityOption,E.ProfanityOption[e])}enableAudioLogging(){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_EnableAudioLogging,"true")}requestWordLevelTimestamps(){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"true")}enableDictation(){this.privSpeechProperties.setProperty(Fn.ForceDictationPropertyName,"true")}get speechSynthesisLanguage(){return this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_SynthLanguage)}set speechSynthesisLanguage(e){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_SynthLanguage,e)}get speechSynthesisVoiceName(){return this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_SynthVoice)}set speechSynthesisVoiceName(e){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_SynthVoice,e)}get speechSynthesisOutputFormat(){return E.SpeechSynthesisOutputFormat[this.privSpeechProperties.getProperty(E.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)]}set speechSynthesisOutputFormat(e){this.privSpeechProperties.setProperty(E.PropertyId.SpeechServiceConnection_SynthOutputFormat,E.SpeechSynthesisOutputFormat[e])}};Ni.SpeechTranslationConfigImpl=kt});var Ch=u(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.PropertyCollection=void 0;var Zy=f(),Sh=class r{constructor(){this.privKeys=[],this.privValues=[]}getProperty(e,t){let i;typeof e=="string"?i=e:i=Zy.PropertyId[e];for(let n=0;n<this.privKeys.length;n++)if(this.privKeys[n]===i)return this.privValues[n];if(t!==void 0)return String(t)}setProperty(e,t){let i;typeof e=="string"?i=e:i=Zy.PropertyId[e];for(let n=0;n<this.privKeys.length;n++)if(this.privKeys[n]===i){this.privValues[n]=t;return}this.privKeys.push(i),this.privValues.push(t)}clone(){let e=new r;for(let t=0;t<this.privKeys.length;t++)e.privKeys.push(this.privKeys[t]),e.privValues.push(this.privValues[t]);return e}mergeTo(e){this.privKeys.forEach(t=>{if(e.getProperty(t,void 0)===void 0){let i=this.getProperty(t);e.setProperty(t,i)}})}get keys(){return this.privKeys}};ra.PropertyCollection=Sh});var ia=u(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.PropertyId=void 0;var j_;(function(r){r[r.SpeechServiceConnection_Key=0]="SpeechServiceConnection_Key",r[r.SpeechServiceConnection_Endpoint=1]="SpeechServiceConnection_Endpoint",r[r.SpeechServiceConnection_Region=2]="SpeechServiceConnection_Region",r[r.SpeechServiceAuthorization_Token=3]="SpeechServiceAuthorization_Token",r[r.SpeechServiceAuthorization_Type=4]="SpeechServiceAuthorization_Type",r[r.SpeechServiceConnection_EndpointId=5]="SpeechServiceConnection_EndpointId",r[r.SpeechServiceConnection_TranslationToLanguages=6]="SpeechServiceConnection_TranslationToLanguages",r[r.SpeechServiceConnection_TranslationVoice=7]="SpeechServiceConnection_TranslationVoice",r[r.SpeechServiceConnection_TranslationFeatures=8]="SpeechServiceConnection_TranslationFeatures",r[r.SpeechServiceConnection_TranslationCategoryId=9]="SpeechServiceConnection_TranslationCategoryId",r[r.SpeechServiceConnection_IntentRegion=10]="SpeechServiceConnection_IntentRegion",r[r.SpeechServiceConnection_ProxyHostName=11]="SpeechServiceConnection_ProxyHostName",r[r.SpeechServiceConnection_ProxyPort=12]="SpeechServiceConnection_ProxyPort",r[r.SpeechServiceConnection_ProxyUserName=13]="SpeechServiceConnection_ProxyUserName",r[r.SpeechServiceConnection_ProxyPassword=14]="SpeechServiceConnection_ProxyPassword",r[r.SpeechServiceConnection_RecoMode=15]="SpeechServiceConnection_RecoMode",r[r.SpeechServiceConnection_RecoLanguage=16]="SpeechServiceConnection_RecoLanguage",r[r.Speech_SessionId=17]="Speech_SessionId",r[r.SpeechServiceConnection_SynthLanguage=18]="SpeechServiceConnection_SynthLanguage",r[r.SpeechServiceConnection_SynthVoice=19]="SpeechServiceConnection_SynthVoice",r[r.SpeechServiceConnection_SynthOutputFormat=20]="SpeechServiceConnection_SynthOutputFormat",r[r.SpeechServiceConnection_AutoDetectSourceLanguages=21]="SpeechServiceConnection_AutoDetectSourceLanguages",r[r.SpeechServiceResponse_RequestDetailedResultTrueFalse=22]="SpeechServiceResponse_RequestDetailedResultTrueFalse",r[r.SpeechServiceResponse_RequestProfanityFilterTrueFalse=23]="SpeechServiceResponse_RequestProfanityFilterTrueFalse",r[r.SpeechServiceResponse_JsonResult=24]="SpeechServiceResponse_JsonResult",r[r.SpeechServiceResponse_JsonErrorDetails=25]="SpeechServiceResponse_JsonErrorDetails",r[r.CancellationDetails_Reason=26]="CancellationDetails_Reason",r[r.CancellationDetails_ReasonText=27]="CancellationDetails_ReasonText",r[r.CancellationDetails_ReasonDetailedText=28]="CancellationDetails_ReasonDetailedText",r[r.LanguageUnderstandingServiceResponse_JsonResult=29]="LanguageUnderstandingServiceResponse_JsonResult",r[r.SpeechServiceConnection_Url=30]="SpeechServiceConnection_Url",r[r.SpeechServiceConnection_InitialSilenceTimeoutMs=31]="SpeechServiceConnection_InitialSilenceTimeoutMs",r[r.SpeechServiceConnection_EndSilenceTimeoutMs=32]="SpeechServiceConnection_EndSilenceTimeoutMs",r[r.Speech_SegmentationSilenceTimeoutMs=33]="Speech_SegmentationSilenceTimeoutMs",r[r.Speech_SegmentationMaximumTimeMs=34]="Speech_SegmentationMaximumTimeMs",r[r.Speech_SegmentationStrategy=35]="Speech_SegmentationStrategy",r[r.SpeechServiceConnection_EnableAudioLogging=36]="SpeechServiceConnection_EnableAudioLogging",r[r.SpeechServiceConnection_LanguageIdMode=37]="SpeechServiceConnection_LanguageIdMode",r[r.SpeechServiceConnection_RecognitionEndpointVersion=38]="SpeechServiceConnection_RecognitionEndpointVersion",r[r.SpeechServiceConnection_SpeakerIdMode=39]="SpeechServiceConnection_SpeakerIdMode",r[r.SpeechServiceResponse_ProfanityOption=40]="SpeechServiceResponse_ProfanityOption",r[r.SpeechServiceResponse_PostProcessingOption=41]="SpeechServiceResponse_PostProcessingOption",r[r.SpeechServiceResponse_RequestWordLevelTimestamps=42]="SpeechServiceResponse_RequestWordLevelTimestamps",r[r.SpeechServiceResponse_StablePartialResultThreshold=43]="SpeechServiceResponse_StablePartialResultThreshold",r[r.SpeechServiceResponse_OutputFormatOption=44]="SpeechServiceResponse_OutputFormatOption",r[r.SpeechServiceResponse_TranslationRequestStablePartialResult=45]="SpeechServiceResponse_TranslationRequestStablePartialResult",r[r.SpeechServiceResponse_RequestWordBoundary=46]="SpeechServiceResponse_RequestWordBoundary",r[r.SpeechServiceResponse_RequestPunctuationBoundary=47]="SpeechServiceResponse_RequestPunctuationBoundary",r[r.SpeechServiceResponse_RequestSentenceBoundary=48]="SpeechServiceResponse_RequestSentenceBoundary",r[r.SpeechServiceResponse_DiarizeIntermediateResults=49]="SpeechServiceResponse_DiarizeIntermediateResults",r[r.Conversation_ApplicationId=50]="Conversation_ApplicationId",r[r.Conversation_DialogType=51]="Conversation_DialogType",r[r.Conversation_Initial_Silence_Timeout=52]="Conversation_Initial_Silence_Timeout",r[r.Conversation_From_Id=53]="Conversation_From_Id",r[r.Conversation_Conversation_Id=54]="Conversation_Conversation_Id",r[r.Conversation_Custom_Voice_Deployment_Ids=55]="Conversation_Custom_Voice_Deployment_Ids",r[r.Conversation_Speech_Activity_Template=56]="Conversation_Speech_Activity_Template",r[r.Conversation_Request_Bot_Status_Messages=57]="Conversation_Request_Bot_Status_Messages",r[r.Conversation_Agent_Connection_Id=58]="Conversation_Agent_Connection_Id",r[r.SpeechServiceConnection_Host=59]="SpeechServiceConnection_Host",r[r.ConversationTranslator_Host=60]="ConversationTranslator_Host",r[r.ConversationTranslator_Name=61]="ConversationTranslator_Name",r[r.ConversationTranslator_CorrelationId=62]="ConversationTranslator_CorrelationId",r[r.ConversationTranslator_Token=63]="ConversationTranslator_Token",r[r.PronunciationAssessment_ReferenceText=64]="PronunciationAssessment_ReferenceText",r[r.PronunciationAssessment_GradingSystem=65]="PronunciationAssessment_GradingSystem",r[r.PronunciationAssessment_Granularity=66]="PronunciationAssessment_Granularity",r[r.PronunciationAssessment_EnableMiscue=67]="PronunciationAssessment_EnableMiscue",r[r.PronunciationAssessment_Json=68]="PronunciationAssessment_Json",r[r.PronunciationAssessment_Params=69]="PronunciationAssessment_Params",r[r.SpeakerRecognition_Api_Version=70]="SpeakerRecognition_Api_Version",r[r.WebWorkerLoadType=71]="WebWorkerLoadType",r[r.TalkingAvatarService_WebRTC_SDP=72]="TalkingAvatarService_WebRTC_SDP"})(j_=Vn.PropertyId||(Vn.PropertyId={}))});var eS=u(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.Recognizer=void 0;var Sr=C(),Yy=P(),na=I(),sa=f(),Ph=class r{constructor(e,t,i,n){this.audioConfig=e!==void 0?e:sa.AudioConfig.fromDefaultMicrophoneInput(),this.privDisposed=!1,this.privProperties=t.clone(),this.privConnectionFactory=i,this.tokenCredential=n,this.implCommonRecognizerSetup()}close(e,t){na.Contracts.throwIfDisposed(this.privDisposed),(0,Yy.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privReco}async dispose(e){this.privDisposed||(this.privDisposed=!0,e&&this.privReco&&(await this.privReco.audioSource.turnOff(),await this.privReco.dispose()))}static get telemetryEnabled(){return Sr.ServiceRecognizerBase.telemetryDataEnabled}static enableTelemetry(e){Sr.ServiceRecognizerBase.telemetryDataEnabled=e}implCommonRecognizerSetup(){let e=typeof window<"u"?"Browser":"Node",t="unknown",i="unknown";typeof navigator<"u"&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);let n=this.createRecognizerConfig(new Sr.SpeechServiceConfig(new Sr.Context(new Sr.OS(e,t,i))));this.privReco=this.createServiceRecognizer(r.getAuth(this.privProperties,this.tokenCredential),this.privConnectionFactory,this.audioConfig,n)}async recognizeOnceAsyncImpl(e){na.Contracts.throwIfDisposed(this.privDisposed);let t=new Yy.Deferred;await this.implRecognizerStop(),await this.privReco.recognize(e,t.resolve,t.reject);let i=await t.promise;return await this.implRecognizerStop(),i}async startContinuousRecognitionAsyncImpl(e){na.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop(),await this.privReco.recognize(e,void 0,void 0)}async stopContinuousRecognitionAsyncImpl(){na.Contracts.throwIfDisposed(this.privDisposed),await this.implRecognizerStop()}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}static getAuth(e,t){let i=e.getProperty(sa.PropertyId.SpeechServiceConnection_Key,void 0);return i&&i!==""?new Sr.CognitiveSubscriptionKeyAuthentication(i):t?new Sr.CognitiveTokenAuthentication(async()=>{try{return(await t.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(n){throw n}},async()=>{try{return(await t.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(n){throw n}}):new Sr.CognitiveTokenAuthentication(()=>{let n=e.getProperty(sa.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(n)},()=>{let n=e.getProperty(sa.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(n)})}};oa.Recognizer=Ph});var He=u(Un=>{"use strict";Object.defineProperty(Un,"__esModule",{value:!0});Un.RecognitionMode=void 0;var q_;(function(r){r.Interactive="Interactive",r.Dictation="Dictation",r.Conversation="Conversation",r.None="None"})(q_=Un.RecognitionMode||(Un.RecognitionMode={}))});var tS=u(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.SpeechRecognizer=void 0;var Wn=C(),Rh=He(),aa=P(),Cr=I(),je=f(),Eh=class r extends je.Recognizer{constructor(e,t){let i=e;Cr.Contracts.throwIfNull(i,"speechConfig"),Cr.Contracts.throwIfNullOrWhitespace(i.properties.getProperty(je.PropertyId.SpeechServiceConnection_RecoLanguage),je.PropertyId[je.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new Wn.SpeechConnectionFactory,e.tokenCredential),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){let n=e;return t.properties.mergeTo(n.properties),new r(e,i)}get endpointId(){return Cr.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(je.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(je.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){Cr.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(je.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return Cr.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(je.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return Cr.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(Wn.OutputFormatPropertyName,je.OutputFormat[je.OutputFormat.Simple])===je.OutputFormat[je.OutputFormat.Simple]?je.OutputFormat.Simple:je.OutputFormat.Detailed}get properties(){return this.privProperties}recognizeOnceAsync(e,t){(0,aa.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(Rh.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){(0,aa.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(this.properties.getProperty(Wn.ForceDictationPropertyName,void 0)===void 0?Rh.RecognitionMode.Conversation:Rh.RecognitionMode.Dictation),e,t)}stopContinuousRecognitionAsync(e,t){(0,aa.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){Cr.Contracts.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e){e&&e()}close(e,t){Cr.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,aa.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new Wn.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new Wn.SpeechServiceRecognizer(e,t,s,n,this)}};ca.SpeechRecognizer=Eh});var iS=u(pa=>{"use strict";Object.defineProperty(pa,"__esModule",{value:!0});pa.IntentRecognizer=void 0;var Hn=C(),rS=He(),ua=P(),be=I(),Xt=f(),wh=class extends Xt.Recognizer{constructor(e,t){be.Contracts.throwIfNullOrUndefined(e,"speechConfig");let i=e;be.Contracts.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new Hn.IntentConnectionFactory),this.privAddedIntents=[],this.privAddedLmIntents={},this.privDisposedIntentRecognizer=!1,this.privProperties=i.properties,be.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(Xt.PropertyId.SpeechServiceConnection_RecoLanguage),Xt.PropertyId[Xt.PropertyId.SpeechServiceConnection_RecoLanguage])}get speechRecognitionLanguage(){return be.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),this.properties.getProperty(Xt.PropertyId.SpeechServiceConnection_RecoLanguage)}get authorizationToken(){return this.properties.getProperty(Xt.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(Xt.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}recognizeOnceAsync(e,t){if(be.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){let i=this.buildSpeechContext();this.privReco.speechContext.getContext().intent=i.Intent,this.privReco.dynamicGrammar.addReferenceGrammar(i.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,ua.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(rS.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){if(Object.keys(this.privAddedLmIntents).length!==0||this.privUmbrellaIntent!==void 0){let i=this.buildSpeechContext();this.privReco.speechContext.getContext().intent=i.Intent,this.privReco.dynamicGrammar.addReferenceGrammar(i.ReferenceGrammars),this.privReco.setIntents(this.privAddedLmIntents,this.privUmbrellaIntent)}(0,ua.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(rS.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,ua.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}startKeywordRecognitionAsync(e,t,i){be.Contracts.throwIfNull(e,"model"),i&&i("Not yet implemented.")}stopKeywordRecognitionAsync(e,t){if(e)try{e()}catch(i){t&&t(i)}}addIntent(e,t){be.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),be.Contracts.throwIfNullOrWhitespace(t,"intentId"),be.Contracts.throwIfNullOrWhitespace(e,"simplePhrase"),this.privAddedIntents.push([t,e])}addIntentWithLanguageModel(e,t,i){be.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),be.Contracts.throwIfNullOrWhitespace(e,"intentId"),be.Contracts.throwIfNull(t,"model");let n=t;be.Contracts.throwIfNullOrWhitespace(n.appId,"model.appId"),this.privAddedLmIntents[e]=new Hn.AddedLmIntent(n,i)}addAllIntents(e,t){be.Contracts.throwIfNull(e,"model");let i=e;be.Contracts.throwIfNullOrWhitespace(i.appId,"model.appId"),this.privUmbrellaIntent=new Hn.AddedLmIntent(i,t)}close(e,t){be.Contracts.throwIfDisposed(this.privDisposedIntentRecognizer),(0,ua.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}createRecognizerConfig(e){return new Hn.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new Hn.IntentServiceRecognizer(e,t,s,n,this)}async dispose(e){this.privDisposedIntentRecognizer||e&&(this.privDisposedIntentRecognizer=!0,await super.dispose(e))}buildSpeechContext(){let e,t,i,n=[];this.privUmbrellaIntent!==void 0&&(e=this.privUmbrellaIntent.modelImpl.appId,t=this.privUmbrellaIntent.modelImpl.region,i=this.privUmbrellaIntent.modelImpl.subscriptionKey);for(let s of Object.keys(this.privAddedLmIntents)){let o=this.privAddedLmIntents[s];if(e===void 0)e=o.modelImpl.appId;else if(e!==o.modelImpl.appId)throw new Error("Intents must all be from the same LUIS model");if(t===void 0)t=o.modelImpl.region;else if(t!==o.modelImpl.region)throw new Error("Intents must all be from the same LUIS model in a single region");if(i===void 0)i=o.modelImpl.subscriptionKey;else if(i!==o.modelImpl.subscriptionKey)throw new Error("Intents must all use the same subscription key");let a="luis/"+e+"-PRODUCTION#"+s;n.push(a)}return{Intent:{id:e,key:i===void 0?this.privProperties.getProperty(Xt.PropertyId[Xt.PropertyId.SpeechServiceConnection_Key]):i,provider:"LUIS"},ReferenceGrammars:this.privUmbrellaIntent===void 0?n:["luis/"+e+"-PRODUCTION"]}}};pa.IntentRecognizer=wh});var nS=u(Kn=>{"use strict";Object.defineProperty(Kn,"__esModule",{value:!0});Kn.VoiceProfileType=void 0;var z_;(function(r){r[r.TextIndependentIdentification=0]="TextIndependentIdentification",r[r.TextDependentVerification=1]="TextDependentVerification",r[r.TextIndependentVerification=2]="TextIndependentVerification"})(z_=Kn.VoiceProfileType||(Kn.VoiceProfileType={}))});var bh=u(ji=>{"use strict";Object.defineProperty(ji,"__esModule",{value:!0});ji.ConnectionMessageImpl=ji.ConnectionMessage=void 0;var sS=_e(),oS=P(),L_=Ch(),B_=ia(),Ih=class{};ji.ConnectionMessage=Ih;var _h=class{constructor(e){this.privConnectionMessage=e,this.privProperties=new L_.PropertyCollection,this.privConnectionMessage.headers[sS.HeaderNames.ConnectionId]&&this.privProperties.setProperty(B_.PropertyId.Speech_SessionId,this.privConnectionMessage.headers[sS.HeaderNames.ConnectionId]),Object.keys(this.privConnectionMessage.headers).forEach(t=>{this.privProperties.setProperty(t,this.privConnectionMessage.headers[t])})}get path(){return this.privConnectionMessage.headers[Object.keys(this.privConnectionMessage.headers).find(e=>e.toLowerCase()==="path".toLowerCase())]}get isTextMessage(){return this.privConnectionMessage.messageType===oS.MessageType.Text}get isBinaryMessage(){return this.privConnectionMessage.messageType===oS.MessageType.Binary}get TextMessage(){return this.privConnectionMessage.textBody}get binaryMessage(){return this.privConnectionMessage.binaryBody}get properties(){return this.privProperties}toString(){return""}};ji.ConnectionMessageImpl=_h});var kh=u(la=>{"use strict";Object.defineProperty(la,"__esModule",{value:!0});la.Connection=void 0;var Ah=C(),Th=P(),aS=bh(),F_=I(),Jn=f(),Oh=class r{static fromRecognizer(e){let t=e.internalData,i=new r;return i.privInternalData=t,i.setupEvents(),i}static fromSynthesizer(e){let t=e.internalData,i=new r;return i.privInternalData=t,i.setupEvents(),i}openConnection(e,t){(0,Th.marshalPromiseToCallbacks)(this.privInternalData.connect(),e,t)}closeConnection(e,t){if(this.privInternalData instanceof Ah.SynthesisAdapterBase)throw new Error("Disconnecting a synthesizer's connection is currently not supported");(0,Th.marshalPromiseToCallbacks)(this.privInternalData.disconnect(),e,t)}setMessageProperty(e,t,i){if(F_.Contracts.throwIfNullOrWhitespace(t,"propertyName"),this.privInternalData instanceof Ah.ServiceRecognizerBase){if(e.toLowerCase()!=="speech.context")throw new Error("Only speech.context message property sets are currently supported for recognizer");{let n=this.privInternalData.speechContext.getContext();n[t]=i}}else if(this.privInternalData instanceof Ah.SynthesisAdapterBase){if(e.toLowerCase()!=="speech.config"&&e.toLowerCase()!=="synthesis.context")throw new Error("Only speech.config and synthesis.context message paths are currently supported for synthesizer");if(e.toLowerCase()==="speech.config"){if(t.toLowerCase()!=="context")throw new Error("Only context property is currently supported for speech.config message path for synthesizer");this.privInternalData.synthesizerConfig.setContextFromJson(i)}else this.privInternalData.synthesisContext.setSection(t,i)}}sendMessageAsync(e,t,i,n){(0,Th.marshalPromiseToCallbacks)(this.privInternalData.sendNetworkMessage(e,t),i,n)}close(){}setupEvents(){this.privEventListener=this.privInternalData.connectionEvents.attach(e=>{e.name==="ConnectionEstablishedEvent"?this.connected&&this.connected(new Jn.ConnectionEventArgs(e.connectionId)):e.name==="ConnectionClosedEvent"?this.disconnected&&this.disconnected(new Jn.ConnectionEventArgs(e.connectionId)):e.name==="ConnectionMessageSentEvent"?this.messageSent&&this.messageSent(new Jn.ConnectionMessageEventArgs(new aS.ConnectionMessageImpl(e.message))):e.name==="ConnectionMessageReceivedEvent"&&this.messageReceived&&this.messageReceived(new Jn.ConnectionMessageEventArgs(new aS.ConnectionMessageImpl(e.message)))}),this.privServiceEventListener=this.privInternalData.serviceEvents.attach(e=>{this.receivedServiceMessage&&this.receivedServiceMessage(new Jn.ServiceEventArgs(e.jsonString,e.name))})}};la.Connection=Oh});var uS=u(va=>{"use strict";Object.defineProperty(va,"__esModule",{value:!0});va.TranslationRecognizer=void 0;var ha=C(),cS=He(),da=P(),V_=kh(),ft=I(),K=f(),Mh=class r extends K.Recognizer{constructor(e,t,i){let n=e;ft.Contracts.throwIfNull(n,"speechConfig"),super(t,n.properties,i||new ha.TranslationConnectionFactory,e.tokenCredential),this.privDisposedTranslationRecognizer=!1,this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&ft.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationVoice),K.PropertyId[K.PropertyId.SpeechServiceConnection_TranslationVoice]),ft.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages),K.PropertyId[K.PropertyId.SpeechServiceConnection_TranslationToLanguages]),ft.Contracts.throwIfNullOrWhitespace(this.properties.getProperty(K.PropertyId.SpeechServiceConnection_RecoLanguage),K.PropertyId[K.PropertyId.SpeechServiceConnection_RecoLanguage])}static FromConfig(e,t,i){let n=e;return t.properties.mergeTo(n.properties),t.properties.getProperty(K.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)===ha.AutoDetectSourceLanguagesOpenRangeOptionName&&n.properties.setProperty(K.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),new r(e,i)}get speechRecognitionLanguage(){return ft.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(K.PropertyId.SpeechServiceConnection_RecoLanguage)}get targetLanguages(){return ft.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(",")}get voiceName(){return ft.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(K.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){this.properties.setProperty(K.PropertyId.SpeechServiceAuthorization_Token,e)}recognizeOnceAsync(e,t){ft.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,da.marshalPromiseToCallbacks)(this.recognizeOnceAsyncImpl(cS.RecognitionMode.Interactive),e,t)}startContinuousRecognitionAsync(e,t){(0,da.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(cS.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,da.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}removeTargetLanguage(e){if(ft.Contracts.throwIfNullOrUndefined(e,"language to be removed"),this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0){let t=this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),i=t.indexOf(e);i>-1&&(t.splice(i,1),this.properties.setProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")),this.updateLanguages(t))}}addTargetLanguage(e){ft.Contracts.throwIfNullOrUndefined(e,"language to be added");let t=[];this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0?(t=this.properties.getProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages).split(","),t.includes(e)||(t.push(e),this.properties.setProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages,t.join(",")))):(this.properties.setProperty(K.PropertyId.SpeechServiceConnection_TranslationToLanguages,e),t=[e]),this.updateLanguages(t)}close(e,t){ft.Contracts.throwIfDisposed(this.privDisposedTranslationRecognizer),(0,da.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}onConnection(){}async dispose(e){this.privDisposedTranslationRecognizer||(this.privDisposedTranslationRecognizer=!0,e&&(await this.implRecognizerStop(),await super.dispose(e)))}createRecognizerConfig(e){return new ha.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new ha.TranslationServiceRecognizer(e,t,s,n,this)}updateLanguages(e){let t=V_.Connection.fromRecognizer(this);t&&(t.setMessageProperty("speech.context","translationcontext",{to:e}),t.sendMessageAsync("event",JSON.stringify({id:"translation",name:"updateLanguage",to:e})))}};va.TranslationRecognizer=Mh});var pS=u(fa=>{"use strict";Object.defineProperty(fa,"__esModule",{value:!0});fa.Translations=void 0;var U_=f(),Dh=class{constructor(){this.privMap=new U_.PropertyCollection}get languages(){return this.privMap.keys}get(e,t){return this.privMap.getProperty(e,t)}set(e,t){this.privMap.setProperty(e,t)}};fa.Translations=Dh});var lS=u($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.NoMatchReason=void 0;var W_;(function(r){r[r.NotRecognized=0]="NotRecognized",r[r.InitialSilenceTimeout=1]="InitialSilenceTimeout",r[r.InitialBabbleTimeout=2]="InitialBabbleTimeout"})(W_=$n.NoMatchReason||($n.NoMatchReason={}))});var hS=u(ma=>{"use strict";Object.defineProperty(ma,"__esModule",{value:!0});ma.NoMatchDetails=void 0;var xh=C(),ga=f(),Nh=class r{constructor(e){this.privReason=e}static fromResult(e){let t=xh.SimpleSpeechPhrase.fromJSON(e.json,0),i=ga.NoMatchReason.NotRecognized;switch(t.RecognitionStatus){case xh.RecognitionStatus.BabbleTimeout:i=ga.NoMatchReason.InitialBabbleTimeout;break;case xh.RecognitionStatus.InitialSilenceTimeout:i=ga.NoMatchReason.InitialSilenceTimeout;break;default:i=ga.NoMatchReason.NotRecognized;break}return new r(i)}get reason(){return this.privReason}};ma.NoMatchDetails=Nh});var dS=u(ya=>{"use strict";Object.defineProperty(ya,"__esModule",{value:!0});ya.TranslationRecognitionCanceledEventArgs=void 0;var jh=class{constructor(e,t,i,n,s){this.privCancelReason=t,this.privErrorDetails=i,this.privResult=s,this.privSessionId=e,this.privErrorCode=n}get result(){return this.privResult}get sessionId(){return this.privSessionId}get reason(){return this.privCancelReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};ya.TranslationRecognitionCanceledEventArgs=jh});var vS=u(Sa=>{"use strict";Object.defineProperty(Sa,"__esModule",{value:!0});Sa.IntentRecognitionCanceledEventArgs=void 0;var H_=f(),qh=class extends H_.IntentRecognitionEventArgs{constructor(e,t,i,n,s,o){super(n,s,o),this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorCode(){return this.privErrorCode}get errorDetails(){return this.privErrorDetails}};Sa.IntentRecognitionCanceledEventArgs=qh});var Lh=u(Ca=>{"use strict";Object.defineProperty(Ca,"__esModule",{value:!0});Ca.CancellationDetailsBase=void 0;var zh=class{constructor(e,t,i){this.privReason=e,this.privErrorDetails=t,this.privErrorCode=i}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get ErrorCode(){return this.privErrorCode}};Ca.CancellationDetailsBase=zh});var fS=u(Ra=>{"use strict";Object.defineProperty(Ra,"__esModule",{value:!0});Ra.CancellationDetails=void 0;var Pa=C(),K_=Lh(),qi=f(),Bh=class r extends K_.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=qi.CancellationReason.Error,i=qi.CancellationErrorCode.NoError;if(e instanceof qi.RecognitionResult&&e.json){let n=Pa.SimpleSpeechPhrase.fromJSON(e.json,0);t=Pa.EnumTranslation.implTranslateCancelResult(n.RecognitionStatus)}return e.properties&&(i=qi.CancellationErrorCode[e.properties.getProperty(Pa.CancellationErrorCodePropertyName,qi.CancellationErrorCode[qi.CancellationErrorCode.NoError])]),new r(t,e.errorDetails||Pa.EnumTranslation.implTranslateErrorDetails(i),i)}};Ra.CancellationDetails=Bh});var gS=u(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.CancellationErrorCode=void 0;var J_;(function(r){r[r.NoError=0]="NoError",r[r.AuthenticationFailure=1]="AuthenticationFailure",r[r.BadRequestParameters=2]="BadRequestParameters",r[r.TooManyRequests=3]="TooManyRequests",r[r.ConnectionFailure=4]="ConnectionFailure",r[r.ServiceTimeout=5]="ServiceTimeout",r[r.ServiceError=6]="ServiceError",r[r.RuntimeError=7]="RuntimeError",r[r.Forbidden=8]="Forbidden"})(J_=Gn.CancellationErrorCode||(Gn.CancellationErrorCode={}))});var mS=u(Ea=>{"use strict";Object.defineProperty(Ea,"__esModule",{value:!0});Ea.ConnectionEventArgs=void 0;var $_=f(),Fh=class extends $_.SessionEventArgs{};Ea.ConnectionEventArgs=Fh});var yS=u(wa=>{"use strict";Object.defineProperty(wa,"__esModule",{value:!0});wa.ServiceEventArgs=void 0;var G_=f(),Vh=class extends G_.SessionEventArgs{constructor(e,t,i){super(i),this.privJsonResult=e,this.privEventName=t}get jsonString(){return this.privJsonResult}get eventName(){return this.privEventName}};wa.ServiceEventArgs=Vh});var SS=u(Ia=>{"use strict";Object.defineProperty(Ia,"__esModule",{value:!0});Ia.PhraseListGrammar=void 0;var Q_=I(),Uh=class r{constructor(e){this.privGrammerBuilder=e.dynamicGrammar}static fromRecognizer(e){let t=e.internalData;return new r(t)}addPhrase(e){this.privGrammerBuilder.addPhrase(e)}addPhrases(e){this.privGrammerBuilder.addPhrase(e)}clear(){this.privGrammerBuilder.clearPhrases()}setWeight(e){Q_.Contracts.throwIfNumberOutOfRange(e,"weight",0,2),this.privGrammerBuilder.setWeight(e)}};Ia.PhraseListGrammar=Uh});var ba=u(zi=>{"use strict";Object.defineProperty(zi,"__esModule",{value:!0});zi.DialogServiceConfigImpl=zi.DialogServiceConfig=void 0;var X_=I(),Qn=f(),_a=class{constructor(){}set applicationId(e){}static get DialogTypes(){return{BotFramework:"bot_framework",CustomCommands:"custom_commands"}}};zi.DialogServiceConfig=_a;var Wh=class extends _a{constructor(){super(),this.privSpeechConfig=new Qn.SpeechConfigImpl}get properties(){return this.privSpeechConfig.properties}get speechRecognitionLanguage(){return this.privSpeechConfig.speechRecognitionLanguage}set speechRecognitionLanguage(e){X_.Contracts.throwIfNullOrWhitespace(e,"value"),this.privSpeechConfig.speechRecognitionLanguage=e}get outputFormat(){return this.privSpeechConfig.outputFormat}set outputFormat(e){this.privSpeechConfig.outputFormat=e}setProperty(e,t){this.privSpeechConfig.setProperty(e,t)}getProperty(e,t){return this.privSpeechConfig.getProperty(e)}setProxy(e,t,i,n){this.setProperty(Qn.PropertyId.SpeechServiceConnection_ProxyHostName,e),this.setProperty(Qn.PropertyId.SpeechServiceConnection_ProxyPort,`${t}`),i&&this.setProperty(Qn.PropertyId.SpeechServiceConnection_ProxyUserName,i),n&&this.setProperty(Qn.PropertyId.SpeechServiceConnection_ProxyPassword,n)}setServiceProperty(e,t,i){this.privSpeechConfig.setServiceProperty(e,t)}close(){}};zi.DialogServiceConfigImpl=Wh});var CS=u(Aa=>{"use strict";Object.defineProperty(Aa,"__esModule",{value:!0});Aa.BotFrameworkConfig=void 0;var ti=I(),Zt=ba(),qe=f(),Hh=class extends Zt.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,t,i){ti.Contracts.throwIfNullOrWhitespace(e,"subscription"),ti.Contracts.throwIfNullOrWhitespace(t,"region");let n=new Zt.DialogServiceConfigImpl;return n.setProperty(qe.PropertyId.Conversation_DialogType,Zt.DialogServiceConfig.DialogTypes.BotFramework),n.setProperty(qe.PropertyId.SpeechServiceConnection_Key,e),n.setProperty(qe.PropertyId.SpeechServiceConnection_Region,t),i&&n.setProperty(qe.PropertyId.Conversation_ApplicationId,i),n}static fromAuthorizationToken(e,t,i){ti.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),ti.Contracts.throwIfNullOrWhitespace(t,"region");let n=new Zt.DialogServiceConfigImpl;return n.setProperty(qe.PropertyId.Conversation_DialogType,Zt.DialogServiceConfig.DialogTypes.BotFramework),n.setProperty(qe.PropertyId.SpeechServiceAuthorization_Token,e),n.setProperty(qe.PropertyId.SpeechServiceConnection_Region,t),i&&n.setProperty(qe.PropertyId.Conversation_ApplicationId,i),n}static fromHost(e,t,i){ti.Contracts.throwIfNullOrUndefined(e,"host");let n=e instanceof URL?e:new URL(`wss://${e}.convai.speech.azure.us`);ti.Contracts.throwIfNullOrUndefined(n,"resolvedHost");let s=new Zt.DialogServiceConfigImpl;return s.setProperty(qe.PropertyId.Conversation_DialogType,Zt.DialogServiceConfig.DialogTypes.BotFramework),s.setProperty(qe.PropertyId.SpeechServiceConnection_Host,n.toString()),t!==void 0&&s.setProperty(qe.PropertyId.SpeechServiceConnection_Key,t),s}static fromEndpoint(e,t){ti.Contracts.throwIfNull(e,"endpoint");let i=new Zt.DialogServiceConfigImpl;return i.setProperty(qe.PropertyId.Conversation_DialogType,Zt.DialogServiceConfig.DialogTypes.BotFramework),i.setProperty(qe.PropertyId.SpeechServiceConnection_Endpoint,e.toString()),t!==void 0&&i.setProperty(qe.PropertyId.SpeechServiceConnection_Key,t),i}};Aa.BotFrameworkConfig=Hh});var PS=u(Ta=>{"use strict";Object.defineProperty(Ta,"__esModule",{value:!0});Ta.CustomCommandsConfig=void 0;var ri=I(),Xn=ba(),Dt=f(),Kh=class extends Xn.DialogServiceConfigImpl{constructor(){super()}static fromSubscription(e,t,i){ri.Contracts.throwIfNullOrWhitespace(e,"applicationId"),ri.Contracts.throwIfNullOrWhitespace(t,"subscription"),ri.Contracts.throwIfNullOrWhitespace(i,"region");let n=new Xn.DialogServiceConfigImpl;return n.setProperty(Dt.PropertyId.Conversation_DialogType,Xn.DialogServiceConfig.DialogTypes.CustomCommands),n.setProperty(Dt.PropertyId.Conversation_ApplicationId,e),n.setProperty(Dt.PropertyId.SpeechServiceConnection_Key,t),n.setProperty(Dt.PropertyId.SpeechServiceConnection_Region,i),n}static fromAuthorizationToken(e,t,i){ri.Contracts.throwIfNullOrWhitespace(e,"applicationId"),ri.Contracts.throwIfNullOrWhitespace(t,"authorizationToken"),ri.Contracts.throwIfNullOrWhitespace(i,"region");let n=new Xn.DialogServiceConfigImpl;return n.setProperty(Dt.PropertyId.Conversation_DialogType,Xn.DialogServiceConfig.DialogTypes.CustomCommands),n.setProperty(Dt.PropertyId.Conversation_ApplicationId,e),n.setProperty(Dt.PropertyId.SpeechServiceAuthorization_Token,t),n.setProperty(Dt.PropertyId.SpeechServiceConnection_Region,i),n}set applicationId(e){ri.Contracts.throwIfNullOrWhitespace(e,"value"),this.setProperty(Dt.PropertyId.Conversation_ApplicationId,e)}get applicationId(){return this.getProperty(Dt.PropertyId.Conversation_ApplicationId)}};Ta.CustomCommandsConfig=Kh});var Yt=u(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});Oa.QueryParameterNames=void 0;var W=class{};Oa.QueryParameterNames=W;W.BotId="botid";W.CustomSpeechDeploymentId="cid";W.CustomVoiceDeploymentId="deploymentId";W.EnableAudioLogging="storeAudio";W.EnableLanguageId="lidEnabled";W.EnableWordLevelTimestamps="wordLevelTimestamps";W.EndSilenceTimeoutMs="endSilenceTimeoutMs";W.SegmentationSilenceTimeoutMs="segmentationSilenceTimeoutMs";W.SegmentationMaximumTimeMs="segmentationMaximumTimeMs";W.SegmentationStrategy="segmentationStrategy";W.Format="format";W.InitialSilenceTimeoutMs="initialSilenceTimeoutMs";W.Language="language";W.Profanity="profanity";W.RequestBotStatusMessages="enableBotMessageStatus";W.StableIntermediateThreshold="stableIntermediateThreshold";W.StableTranslation="stableTranslation";W.TestHooks="testhooks";W.Postprocessing="postprocessing";W.CtsMeetingId="meetingId";W.CtsDeviceId="deviceId";W.CtsIsParticipant="isParticipant";W.EnableAvatar="enableTalkingAvatar"});var tt=u(Ma=>{"use strict";Object.defineProperty(Ma,"__esModule",{value:!0});Ma.ConnectionFactoryBase=void 0;var Z_=C(),ka=P(),Pr=f(),Rr=Yt(),Jh=class{static getHostSuffix(e){if(e){if(e.toLowerCase().startsWith("china"))return".azure.cn";if(e.toLowerCase().startsWith("usgov"))return".azure.us"}return".microsoft.com"}setCommonUrlParams(e,t,i){new Map([[Pr.PropertyId.Speech_SegmentationSilenceTimeoutMs,Rr.QueryParameterNames.SegmentationSilenceTimeoutMs],[Pr.PropertyId.SpeechServiceConnection_EnableAudioLogging,Rr.QueryParameterNames.EnableAudioLogging],[Pr.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,Rr.QueryParameterNames.EndSilenceTimeoutMs],[Pr.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,Rr.QueryParameterNames.InitialSilenceTimeoutMs],[Pr.PropertyId.SpeechServiceResponse_PostProcessingOption,Rr.QueryParameterNames.Postprocessing],[Pr.PropertyId.SpeechServiceResponse_ProfanityOption,Rr.QueryParameterNames.Profanity],[Pr.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,Rr.QueryParameterNames.EnableWordLevelTimestamps],[Pr.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,Rr.QueryParameterNames.StableIntermediateThreshold]]).forEach((o,a)=>{this.setUrlParameter(a,o,e,t,i)});let s=JSON.parse(e.parameters.getProperty(Z_.ServicePropertiesPropertyName,"{}"));Object.keys(s).forEach(o=>{t[o]=s[o]})}setUrlParameter(e,t,i,n,s){let o=i.parameters.getProperty(e,void 0);o&&(!s||s.search(t)===-1)&&(n[t]=o.toLocaleLowerCase())}static async getRedirectUrlFromEndpoint(e){let t=new URL(e);t.protocol="https:",t.port="443",t.searchParams.append("GenerateRedirectResponse","true");let n=t.toString();ka.Events.instance.onEvent(new ka.ConnectionRedirectEvent("",n,void 0,"ConnectionFactoryBase: redirectUrl request"));let s=await fetch(n);if(s.status!==200)return e;let o=await s.text();ka.Events.instance.onEvent(new ka.ConnectionRedirectEvent("",o,e,"ConnectionFactoryBase: redirectUrlString"));try{return new URL(o.trim()).toString()}catch{return e}}};Ma.ConnectionFactoryBase=Jh});var IS=u(xa=>{"use strict";Object.defineProperty(xa,"__esModule",{value:!0});xa.DialogConnectionFactory=void 0;var RS=ue(),Y_=C(),Ke=f(),ES=tt(),eb=C(),wS=_e(),Da=Yt(),Zn=class r extends ES.ConnectionFactoryBase{create(e,t,i){let n=e.parameters.getProperty(Ke.PropertyId.Conversation_ApplicationId,""),s=e.parameters.getProperty(Ke.PropertyId.Conversation_DialogType),o=e.parameters.getProperty(Ke.PropertyId.SpeechServiceConnection_Region),a=e.parameters.getProperty(Ke.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),c=e.parameters.getProperty(Ke.PropertyId.Conversation_Request_Bot_Status_Messages,"true"),p={};p[wS.HeaderNames.ConnectionId]=i,p[Da.QueryParameterNames.Format]=e.parameters.getProperty(Y_.OutputFormatPropertyName,Ke.OutputFormat[Ke.OutputFormat.Simple]).toLowerCase(),p[Da.QueryParameterNames.Language]=a,p[Da.QueryParameterNames.RequestBotStatusMessages]=c,n&&(p[Da.QueryParameterNames.BotId]=n,s===Ke.DialogServiceConfig.DialogTypes.CustomCommands&&(p[wS.HeaderNames.CustomCommandsAppId]=n));let h=s===Ke.DialogServiceConfig.DialogTypes.CustomCommands?"commands/":"",d=s===Ke.DialogServiceConfig.DialogTypes.CustomCommands?"v1":s===Ke.DialogServiceConfig.DialogTypes.BotFramework?"v3":"v0",v={};t.token!=null&&t.token!==""&&(v[t.headerName]=t.token);let g=e.parameters.getProperty(Ke.PropertyId.SpeechServiceConnection_Endpoint,"");if(!g){let A=ES.ConnectionFactoryBase.getHostSuffix(o),H=e.parameters.getProperty(Ke.PropertyId.SpeechServiceConnection_Host,`wss://${o}.${r.BaseUrl}${A}`);g=`${H.endsWith("/")?H:H+"/"}${h}${r.ApiKey}/${d}`}this.setCommonUrlParams(e,p,g);let M=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new RS.WebsocketConnection(g,p,v,new eb.WebsocketMessageFormatter,RS.ProxyInfo.fromRecognizerConfig(e),M,i))}};xa.DialogConnectionFactory=Zn;Zn.ApiKey="api";Zn.BaseUrl="convai.speech"});var bS=u(ja=>{"use strict";Object.defineProperty(ja,"__esModule",{value:!0});ja.DialogServiceConnector=void 0;var tb=IS(),_S=C(),rb=He(),Li=P(),Na=I(),ib=f(),Er=ia(),$h=class extends ib.Recognizer{constructor(e,t){let i=e;Na.Contracts.throwIfNull(e,"dialogConfig"),super(t,i.properties,new tb.DialogConnectionFactory),this.isTurnComplete=!0,this.privIsDisposed=!1,this.privProperties=i.properties.clone();let n=this.buildAgentConfig();this.privReco.agentConfig.set(n)}connect(e,t){(0,Li.marshalPromiseToCallbacks)(this.privReco.connect(),e,t)}disconnect(e,t){(0,Li.marshalPromiseToCallbacks)(this.privReco.disconnect(),e,t)}get authorizationToken(){return this.properties.getProperty(Er.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){Na.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(Er.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get speechActivityTemplate(){return this.properties.getProperty(Er.PropertyId.Conversation_Speech_Activity_Template)}set speechActivityTemplate(e){this.properties.setProperty(Er.PropertyId.Conversation_Speech_Activity_Template,e)}listenOnceAsync(e,t){if(this.isTurnComplete){Na.Contracts.throwIfDisposed(this.privIsDisposed);let n=(async()=>{await this.privReco.connect(),await this.implRecognizerStop(),this.isTurnComplete=!1;let s=new Li.Deferred;await this.privReco.recognize(rb.RecognitionMode.Conversation,s.resolve,s.reject);let o=await s.promise;return await this.implRecognizerStop(),o})();n.catch(()=>{this.dispose(!0).catch(()=>{})}),(0,Li.marshalPromiseToCallbacks)(n.finally(()=>{this.isTurnComplete=!0}),e,t)}}sendActivityAsync(e,t,i){(0,Li.marshalPromiseToCallbacks)(this.privReco.sendMessage(e),t,i)}close(e,t){Na.Contracts.throwIfDisposed(this.privIsDisposed),(0,Li.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privIsDisposed||e&&(this.privIsDisposed=!0,await this.implRecognizerStop(),await super.dispose(e))}createRecognizerConfig(e){return new _S.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new _S.DialogServiceAdapter(e,t,s,n,this)}buildAgentConfig(){return{botInfo:{commType:this.properties.getProperty("Conversation_Communication_Type","Default"),commandsCulture:void 0,connectionId:this.properties.getProperty(Er.PropertyId.Conversation_Agent_Connection_Id),conversationId:this.properties.getProperty(Er.PropertyId.Conversation_Conversation_Id,void 0),fromId:this.properties.getProperty(Er.PropertyId.Conversation_From_Id,void 0),ttsAudioFormat:this.properties.getProperty(Er.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)},version:.2}}};ja.DialogServiceConnector=$h});var AS=u(qa=>{"use strict";Object.defineProperty(qa,"__esModule",{value:!0});qa.ActivityReceivedEventArgs=void 0;var Gh=class{constructor(e,t){this.privActivity=e,this.privAudioStream=t}get activity(){return this.privActivity}get audioStream(){return this.privAudioStream}};qa.ActivityReceivedEventArgs=Gh});var TS=u(za=>{"use strict";Object.defineProperty(za,"__esModule",{value:!0});za.TurnStatusResponsePayload=void 0;var Qh=class r{constructor(e){this.privMessageStatusResponse=JSON.parse(e)}static fromJSON(e){return new r(e)}get interactionId(){return this.privMessageStatusResponse.interactionId}get conversationId(){return this.privMessageStatusResponse.conversationId}get statusCode(){switch(this.privMessageStatusResponse.statusCode){case"Success":return 200;case"Failed":return 400;case"TimedOut":return 429;default:return this.privMessageStatusResponse.statusCode}}};za.TurnStatusResponsePayload=Qh});var OS=u(La=>{"use strict";Object.defineProperty(La,"__esModule",{value:!0});La.TurnStatusReceivedEventArgs=void 0;var nb=TS(),Xh=class{constructor(e){this.privTurnStatus=nb.TurnStatusResponsePayload.fromJSON(e)}get interactionId(){return this.privTurnStatus.interactionId}get conversationId(){return this.privTurnStatus.conversationId}get statusCode(){return this.privTurnStatus.statusCode}};La.TurnStatusReceivedEventArgs=Xh});var kS=u(Yn=>{"use strict";Object.defineProperty(Yn,"__esModule",{value:!0});Yn.ServicePropertyChannel=void 0;var sb;(function(r){r[r.UriQueryParameter=0]="UriQueryParameter"})(sb=Yn.ServicePropertyChannel||(Yn.ServicePropertyChannel={}))});var MS=u(es=>{"use strict";Object.defineProperty(es,"__esModule",{value:!0});es.ProfanityOption=void 0;var ob;(function(r){r[r.Masked=0]="Masked",r[r.Removed=1]="Removed",r[r.Raw=2]="Raw"})(ob=es.ProfanityOption||(es.ProfanityOption={}))});var DS=u(Ba=>{"use strict";Object.defineProperty(Ba,"__esModule",{value:!0});Ba.BaseAudioPlayer=void 0;var ab=vt(),cb=f(),ub=gr(),Zh=class{constructor(e){this.audioContext=null,this.gainNode=null,this.autoUpdateBufferTimer=0,e===void 0&&(e=cb.AudioStreamFormat.getDefaultInputFormat()),this.init(e)}playAudioSample(e,t,i){try{this.ensureInitializedContext();let n=this.formatAudioData(e),s=new Float32Array(this.samples.length+n.length);s.set(this.samples,0),s.set(n,this.samples.length),this.samples=s,t&&t()}catch(n){i&&i(n)}}stopAudio(e,t){this.audioContext!==null&&(this.samples=new Float32Array,clearInterval(this.autoUpdateBufferTimer),this.audioContext.close().then(()=>{e&&e()},i=>{t&&t(i)}),this.audioContext=null)}init(e){this.audioFormat=e,this.samples=new Float32Array}ensureInitializedContext(){if(this.audioContext===null){this.createAudioContext();let e=200;this.autoUpdateBufferTimer=setInterval(()=>{this.updateAudioBuffer()},e)}}createAudioContext(){this.audioContext=ub.AudioStreamFormatImpl.getAudioContext(),this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioContext.destination),this.startTime=this.audioContext.currentTime}formatAudioData(e){switch(this.audioFormat.bitsPerSample){case 8:return this.formatArrayBuffer(new Int8Array(e),128);case 16:return this.formatArrayBuffer(new Int16Array(e),32768);case 32:return this.formatArrayBuffer(new Int32Array(e),2147483648);default:throw new ab.InvalidOperationError("Only WAVE_FORMAT_PCM (8/16/32 bps) format supported at this time")}}formatArrayBuffer(e,t){let i=new Float32Array(e.length);for(let n=0;n<e.length;n++)i[n]=e[n]/t;return i}updateAudioBuffer(){if(this.samples.length===0)return;let e=this.audioFormat.channels,t=this.audioContext.createBufferSource(),i=this.samples.length/e,n=this.audioContext.createBuffer(e,i,this.audioFormat.samplesPerSec);for(let s=0;s<e;s++){let o=s,a=n.getChannelData(s);for(let c=0;c<this.samples.length;c++,o+=e)a[c]=this.samples[o]}this.startTime<this.audioContext.currentTime&&(this.startTime=this.audioContext.currentTime),t.buffer=n,t.connect(this.gainNode),t.start(this.startTime),this.startTime+=n.duration,this.samples=new Float32Array}async playAudio(e){this.audioContext===null&&this.createAudioContext();let t=this.audioContext.createBufferSource(),i=this.audioContext.destination;await this.audioContext.decodeAudioData(e,n=>{t.buffer=n,t.connect(i),t.start(0)})}};Ba.BaseAudioPlayer=Zh});var xS=u(Fa=>{"use strict";Object.defineProperty(Fa,"__esModule",{value:!0});Fa.ConnectionMessageEventArgs=void 0;var Yh=class{constructor(e){this.privConnectionMessage=e}get message(){return this.privConnectionMessage}toString(){return"Message: "+this.privConnectionMessage.toString()}};Fa.ConnectionMessageEventArgs=Yh});var NS=u(Va=>{"use strict";Object.defineProperty(Va,"__esModule",{value:!0});Va.VoiceProfile=void 0;var ed=class{constructor(e,t){this.privId=e,this.privProfileType=t}get profileId(){return this.privId}get profileType(){return this.privProfileType}};Va.VoiceProfile=ed});var qS=u(Bi=>{"use strict";Object.defineProperty(Bi,"__esModule",{value:!0});Bi.VoiceProfileEnrollmentCancellationDetails=Bi.VoiceProfileEnrollmentResult=void 0;var jS=C(),me=f(),td=class r{constructor(e,t,i){this.privReason=e,this.privProperties=new me.PropertyCollection,this.privReason!==me.ResultReason.Canceled?t&&(this.privDetails=JSON.parse(t),this.privDetails.enrollmentStatus.toLowerCase()==="enrolling"&&(this.privReason=me.ResultReason.EnrollingVoiceProfile)):(this.privErrorDetails=i,this.privProperties.setProperty(jS.CancellationErrorCodePropertyName,me.CancellationErrorCode[me.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get enrollmentsCount(){return this.privDetails.enrollmentsCount}get enrollmentsLength(){return this.privDetails.enrollmentsLength}get properties(){return this.privProperties}get enrollmentResultDetails(){return this.privDetails}get errorDetails(){return this.privErrorDetails}static FromIdentificationProfileList(e){let t=[];for(let i of e.value){let n=i.enrollmentStatus.toLowerCase()==="enrolling"?me.ResultReason.EnrollingVoiceProfile:i.enrollmentStatus.toLowerCase()==="enrolled"?me.ResultReason.EnrolledVoiceProfile:me.ResultReason.Canceled,s=new r(n,null,null);s.privDetails=this.getIdentificationDetails(i),t.push(s)}return t}static FromVerificationProfileList(e){let t=[];for(let i of e.value){let n=i.enrollmentStatus.toLowerCase()==="enrolling"?me.ResultReason.EnrollingVoiceProfile:i.enrollmentStatus.toLowerCase()==="enrolled"?me.ResultReason.EnrolledVoiceProfile:me.ResultReason.Canceled,s=new r(n,null,null);s.privDetails=this.getVerificationDetails(i),t.push(s)}return t}static getIdentificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount||0,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.identificationProfileId,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}static getVerificationDetails(e){return{audioLength:e.audioLength?parseFloat(e.audioLength):0,audioSpeechLength:e.audioSpeechLength?parseFloat(e.audioSpeechLength):0,enrollmentStatus:e.enrollmentStatus,enrollmentsCount:e.enrollmentsCount,enrollmentsLength:e.enrollmentsLength?parseFloat(e.enrollmentsLength):0,enrollmentsSpeechLength:e.enrollmentsSpeechLength?parseFloat(e.enrollmentsSpeechLength):0,profileId:e.profileId||e.verificationProfileId,remainingEnrollmentsCount:e.remainingEnrollments||e.remainingEnrollmentsCount,remainingEnrollmentsSpeechLength:e.remainingEnrollmentsSpeechLength?parseFloat(e.remainingEnrollmentsSpeechLength):0}}};Bi.VoiceProfileEnrollmentResult=td;var rd=class r extends me.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=me.CancellationReason.Error,i=me.CancellationErrorCode.NoError;return e.properties&&(i=me.CancellationErrorCode[e.properties.getProperty(jS.CancellationErrorCodePropertyName,me.CancellationErrorCode[me.CancellationErrorCode.NoError])]),new r(t,e.errorDetails,i)}};Bi.VoiceProfileEnrollmentCancellationDetails=rd});var LS=u(Fi=>{"use strict";Object.defineProperty(Fi,"__esModule",{value:!0});Fi.VoiceProfileCancellationDetails=Fi.VoiceProfileResult=void 0;var zS=C(),pb=I(),xt=f(),id=class{constructor(e,t){this.privReason=e,this.privProperties=new xt.PropertyCollection,e===xt.ResultReason.Canceled&&(pb.Contracts.throwIfNullOrUndefined(t,"statusText"),this.privErrorDetails=t,this.privProperties.setProperty(zS.CancellationErrorCodePropertyName,xt.CancellationErrorCode[xt.CancellationErrorCode.ServiceError]))}get reason(){return this.privReason}get properties(){return this.privProperties}get errorDetails(){return this.privErrorDetails}};Fi.VoiceProfileResult=id;var nd=class r extends xt.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=xt.CancellationReason.Error,i=xt.CancellationErrorCode.NoError;return e.properties&&(i=xt.CancellationErrorCode[e.properties.getProperty(zS.CancellationErrorCodePropertyName,xt.CancellationErrorCode[xt.CancellationErrorCode.NoError])]),new r(t,e.errorDetails,i)}};Fi.VoiceProfileCancellationDetails=nd});var BS=u(Ua=>{"use strict";Object.defineProperty(Ua,"__esModule",{value:!0});Ua.VoiceProfilePhraseResult=void 0;var lb=I(),hb=f(),sd=class extends hb.VoiceProfileResult{constructor(e,t,i,n){super(e,t),this.privPhrases=[],lb.Contracts.throwIfNullOrUndefined(n,"phrase array"),this.privType=i,n&&n[0]&&(this.privPhrases=n)}get phrases(){return this.privPhrases}get type(){return this.privType}};Ua.VoiceProfilePhraseResult=sd});var FS=u(Ha=>{"use strict";Object.defineProperty(Ha,"__esModule",{value:!0});Ha.VoiceProfileClient=void 0;var od=C(),db=eh(),Wa=I(),ii=f(),ad=class extends ii.Recognizer{constructor(e){Wa.Contracts.throwIfNullOrUndefined(e,"speechConfig");let t=e;Wa.Contracts.throwIfNull(t,"speechConfig"),super(db.AudioConfig.fromStreamInput(ii.AudioInputStream.createPushStream()),t.properties,new od.VoiceProfileConnectionFactory),this.privProperties=t.properties.clone(),this.privVoiceAdapter=this.privReco,this.privDisposedVoiceAdapter=!1}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(ii.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){Wa.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(ii.PropertyId.SpeechServiceAuthorization_Token,e)}async createProfileAsync(e,t){let i=await this.privVoiceAdapter.createProfile(e,t);return new ii.VoiceProfile(i[0],e)}async retrieveEnrollmentResultAsync(e){return this.privVoiceAdapter.retrieveEnrollmentResult(e)}async getAllProfilesAsync(e){return this.privVoiceAdapter.getAllProfiles(e)}async getActivationPhrasesAsync(e,t){return this.privVoiceAdapter.getActivationPhrases(e,t)}async enrollProfileAsync(e,t){let i=t;return Wa.Contracts.throwIfNullOrUndefined(i,"audioConfig"),this.audioConfig=t,this.privVoiceAdapter.SpeakerAudioSource=i,this.privVoiceAdapter.enrollProfile(e)}async deleteProfileAsync(e){return this.privVoiceAdapter.deleteProfile(e)}async resetProfileAsync(e){return this.privVoiceAdapter.resetProfile(e)}async close(){await this.dispose(!0)}createServiceRecognizer(e,t,i,n){let s=i;return new od.VoiceServiceRecognizer(e,t,s,n,this)}async dispose(e){this.privDisposedVoiceAdapter||(this.privDisposedVoiceAdapter=!0,e&&await super.dispose(e))}createRecognizerConfig(e){return new od.RecognizerConfig(e,this.properties)}getResult(e,t){return new ii.VoiceProfileResult(e.ok?t:ii.ResultReason.Canceled,e.statusText)}};Ha.VoiceProfileClient=ad});var VS=u(Ka=>{"use strict";Object.defineProperty(Ka,"__esModule",{value:!0});Ka.SpeakerRecognizer=void 0;var cd=C(),ni=I(),ud=f(),pd=class extends ud.Recognizer{constructor(e,t){ni.Contracts.throwIfNullOrUndefined(e,"speechConfig");let i=e;ni.Contracts.throwIfNullOrUndefined(i,"speechConfig"),super(t,i.properties,new cd.SpeakerRecognitionConnectionFactory),this.privAudioConfigImpl=t,ni.Contracts.throwIfNull(this.privAudioConfigImpl,"audioConfig"),this.privDisposedSpeakerRecognizer=!1,this.privProperties=i.properties}get authorizationToken(){return this.properties.getProperty(ud.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){ni.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(ud.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}async recognizeOnceAsync(e){return ni.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),this.recognizeSpeakerOnceAsyncImpl(e)}async close(){ni.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.dispose(!0)}async recognizeSpeakerOnceAsyncImpl(e){ni.Contracts.throwIfDisposed(this.privDisposedSpeakerRecognizer),await this.implRecognizerStop();let t=await this.privReco.recognizeSpeaker(e);return await this.implRecognizerStop(),t}async implRecognizerStop(){this.privReco&&await this.privReco.stopRecognizing()}createRecognizerConfig(e){return new cd.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new cd.SpeakerServiceRecognizer(e,t,s,n,this)}async dispose(e){this.privDisposedSpeakerRecognizer||e&&(this.privDisposedSpeakerRecognizer=!0,await super.dispose(e))}};Ka.SpeakerRecognizer=pd});var US=u(Ja=>{"use strict";Object.defineProperty(Ja,"__esModule",{value:!0});Ja.SpeakerIdentificationModel=void 0;var vb=I(),fb=f(),ld=class r{constructor(e){if(this.privVoiceProfiles=[],this.privProfileIds=[],vb.Contracts.throwIfNullOrUndefined(e,"VoiceProfiles"),e.length===0)throw new Error("Empty Voice Profiles array");for(let t of e){if(t.profileType!==fb.VoiceProfileType.TextIndependentIdentification)throw new Error("Identification model can only be created from Identification profile: "+t.profileId);this.privVoiceProfiles.push(t),this.privProfileIds.push(t.profileId)}}static fromProfiles(e){return new r(e)}get voiceProfileIds(){return this.privProfileIds.join(",")}get profileIds(){return this.privProfileIds}get scenario(){return"TextIndependentIdentification"}};Ja.SpeakerIdentificationModel=ld});var HS=u($a=>{"use strict";Object.defineProperty($a,"__esModule",{value:!0});$a.SpeakerVerificationModel=void 0;var gb=I(),WS=f(),hd=class r{constructor(e){if(gb.Contracts.throwIfNullOrUndefined(e,"VoiceProfile"),e.profileType===WS.VoiceProfileType.TextIndependentIdentification)throw new Error("Verification model cannot be created from Identification profile");this.privVoiceProfile=e}static fromProfile(e){return new r(e)}get voiceProfile(){return this.privVoiceProfile}get profileIds(){return[this.voiceProfile.profileId]}get scenario(){return this.voiceProfile.profileType===WS.VoiceProfileType.TextDependentVerification?"TextDependentVerification":"TextIndependentVerification"}};$a.SpeakerVerificationModel=hd});var dd=u(ts=>{"use strict";Object.defineProperty(ts,"__esModule",{value:!0});ts.LanguageIdMode=void 0;var mb;(function(r){r[r.AtStart=0]="AtStart",r[r.Continuous=1]="Continuous"})(mb=ts.LanguageIdMode||(ts.LanguageIdMode={}))});var JS=u(Ga=>{"use strict";Object.defineProperty(Ga,"__esModule",{value:!0});Ga.AutoDetectSourceLanguageConfig=void 0;var yb=C(),Sb=I(),gt=f(),KS=dd(),vd=class r{constructor(){this.privProperties=new gt.PropertyCollection,this.privProperties.setProperty(gt.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart"),this.privLanguageIdMode=KS.LanguageIdMode.AtStart}static fromOpenRange(){let e=new r;return e.properties.setProperty(gt.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,yb.AutoDetectSourceLanguagesOpenRangeOptionName),e.properties.setProperty(gt.PropertyId.SpeechServiceConnection_RecoLanguage,"en-US"),e}static fromLanguages(e){Sb.Contracts.throwIfArrayEmptyOrWhitespace(e,"languages");let t=new r;return t.properties.setProperty(gt.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,e.join()),t}static fromSourceLanguageConfigs(e){if(e.length<1)throw new Error("Expected non-empty SourceLanguageConfig array.");let t=new r,i=[];return e.forEach(n=>{if(i.push(n.language),n.endpointId!==void 0&&n.endpointId!==""){let s=n.language+gt.PropertyId.SpeechServiceConnection_EndpointId.toString();t.properties.setProperty(s,n.endpointId)}}),t.properties.setProperty(gt.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,i.join()),t}get properties(){return this.privProperties}set mode(e){e===KS.LanguageIdMode.Continuous?(this.privProperties.setProperty(gt.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privProperties.setProperty(gt.PropertyId.SpeechServiceConnection_LanguageIdMode,"Continuous")):(this.privProperties.setProperty(gt.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"1"),this.privProperties.setProperty(gt.PropertyId.SpeechServiceConnection_LanguageIdMode,"AtStart")),this.privLanguageIdMode=e}};Ga.AutoDetectSourceLanguageConfig=vd});var GS=u(Qa=>{"use strict";Object.defineProperty(Qa,"__esModule",{value:!0});Qa.AutoDetectSourceLanguageResult=void 0;var $S=I(),fd=class r{constructor(e,t){$S.Contracts.throwIfNullOrUndefined(e,"language"),$S.Contracts.throwIfNullOrUndefined(t,"languageDetectionConfidence"),this.privLanguage=e,this.privLanguageDetectionConfidence=t}static fromResult(e){return new r(e.language,e.languageDetectionConfidence)}static fromConversationTranscriptionResult(e){return new r(e.language,e.languageDetectionConfidence)}get language(){return this.privLanguage}get languageDetectionConfidence(){return this.privLanguageDetectionConfidence}};Qa.AutoDetectSourceLanguageResult=fd});var QS=u(Xa=>{"use strict";Object.defineProperty(Xa,"__esModule",{value:!0});Xa.SourceLanguageConfig=void 0;var Cb=I(),gd=class r{constructor(e,t){Cb.Contracts.throwIfNullOrUndefined(e,"language"),this.privLanguage=e,this.privEndpointId=t}static fromLanguage(e,t){return new r(e,t)}get language(){return this.privLanguage}get endpointId(){return this.privEndpointId}};Xa.SourceLanguageConfig=gd});var ZS=u(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.SpeakerRecognitionCancellationDetails=er.SpeakerRecognitionResult=er.SpeakerRecognitionResultType=void 0;var XS=C(),ze=f(),Za;(function(r){r[r.Verify=0]="Verify",r[r.Identify=1]="Identify"})(Za=er.SpeakerRecognitionResultType||(er.SpeakerRecognitionResultType={}));var md=class{constructor(e,t=ze.ResultReason.RecognizedSpeaker,i=ze.CancellationErrorCode.NoError,n=""){this.privProperties=new ze.PropertyCollection;let s=e.scenario==="TextIndependentIdentification"?Za.Identify:Za.Verify;this.privReason=t,this.privReason!==ze.ResultReason.Canceled?s===Za.Identify?(this.privProfileId=e.identificationResult.identifiedProfile.profileId,this.privScore=e.identificationResult.identifiedProfile.score,this.privReason=ze.ResultReason.RecognizedSpeakers):(this.privScore=e.verificationResult.score,e.verificationResult.recognitionResult.toLowerCase()!=="accept"&&(this.privReason=ze.ResultReason.NoMatch),e.verificationResult.profileId!==void 0&&e.verificationResult.profileId!==""&&(this.privProfileId=e.verificationResult.profileId)):(this.privErrorDetails=n,this.privProperties.setProperty(XS.CancellationErrorCodePropertyName,ze.CancellationErrorCode[i])),this.privProperties.setProperty(ze.PropertyId.SpeechServiceResponse_JsonResult,JSON.stringify(e))}get properties(){return this.privProperties}get reason(){return this.privReason}get profileId(){return this.privProfileId}get errorDetails(){return this.privErrorDetails}get score(){return this.privScore}};er.SpeakerRecognitionResult=md;var yd=class r extends ze.CancellationDetailsBase{constructor(e,t,i){super(e,t,i)}static fromResult(e){let t=ze.CancellationReason.Error,i=ze.CancellationErrorCode.NoError;return e.properties&&(i=ze.CancellationErrorCode[e.properties.getProperty(XS.CancellationErrorCodePropertyName,ze.CancellationErrorCode[ze.CancellationErrorCode.NoError])]),new r(t,e.errorDetails,i)}};er.SpeakerRecognitionCancellationDetails=yd});var Sd=u(Vi=>{"use strict";Object.defineProperty(Vi,"__esModule",{value:!0});Vi.ConversationImpl=Vi.Conversation=void 0;var L=C(),rs=P(),y=I(),z=f(),Ya=class{constructor(){}static createConversationAsync(e,t,i,n){y.Contracts.throwIfNullOrUndefined(e,L.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),y.Contracts.throwIfNullOrUndefined(e.region,L.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),!e.subscriptionKey&&!e.getProperty(z.PropertyId[z.PropertyId.SpeechServiceAuthorization_Token])&&y.Contracts.throwIfNullOrUndefined(e.subscriptionKey,L.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let s,o,a;return typeof t=="string"?(s=new is(e,t),(0,rs.marshalPromiseToCallbacks)((async()=>{})(),i,n)):(s=new is(e),o=t,a=i,s.createConversationAsync(()=>{o&&o()},c=>{a&&a(c)})),s}};Vi.Conversation=Ya;var is=class extends Ya{constructor(e,t){if(super(),this.privErrors=L.ConversationConnectionConfig.restErrors,this.onConnected=s=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,s)}catch{}},this.onDisconnected=s=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,s)}catch{}finally{this.close(!1)}},this.onCanceled=(s,o)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,o)}catch{}},this.onParticipantUpdateCommandReceived=(s,o)=>{try{let a=this.privParticipants.getParticipant(o.id);if(a!==void 0){switch(o.key){case L.ConversationTranslatorCommandTypes.changeNickname:a.displayName=o.value;break;case L.ConversationTranslatorCommandTypes.setUseTTS:a.isUsingTts=o.value;break;case L.ConversationTranslatorCommandTypes.setProfanityFiltering:a.profanity=o.value;break;case L.ConversationTranslatorCommandTypes.setMute:a.isMuted=o.value;break;case L.ConversationTranslatorCommandTypes.setTranslateToLanguages:a.translateToLanguages=o.value;break}this.privParticipants.addOrUpdateParticipant(a),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new z.ConversationParticipantsChangedEventArgs(z.ParticipantChangedReason.Updated,[this.toParticipant(a)],o.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(s,o)=>{try{this.privParticipants.participants.forEach(a=>a.isMuted=a.isHost?!1:o.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new z.ConversationParticipantsChangedEventArgs(z.ParticipantChangedReason.Updated,this.toParticipants(!1),o.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(s,o)=>{try{let a=this.privParticipants.addOrUpdateParticipant(o.participant);a!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new z.ConversationParticipantsChangedEventArgs(z.ParticipantChangedReason.JoinedConversation,[this.toParticipant(a)],o.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(s,o)=>{try{let a=this.privParticipants.getParticipant(o.participant.id);a!==void 0&&(this.privParticipants.deleteParticipant(o.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new z.ConversationParticipantsChangedEventArgs(z.ParticipantChangedReason.LeftConversation,[this.toParticipant(a)],o.sessionId)))}catch{}},this.onTranslationReceived=(s,o)=>{try{switch(o.command){case L.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new z.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break;case L.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new z.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break;case L.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new z.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break}}catch{}},this.onParticipantsListReceived=(s,o)=>{try{if(o.sessionToken!==void 0&&o.sessionToken!==null&&(this.privRoom.token=o.sessionToken),this.privParticipants.participants=[...o.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new z.ConversationParticipantsChangedEventArgs(z.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),o.sessionId)),this.me.isHost){let a=this.privConversationTranslator?.properties.getProperty(z.PropertyId.ConversationTranslator_Name);a!==void 0&&a.length>0&&a!==this.me.displayName&&this.changeNicknameAsync(a)}}catch{}},this.onConversationExpiration=(s,o)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,o)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new z.PropertyCollection,this.privManager=new L.ConversationManager,e.getProperty(z.PropertyId[z.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(z.PropertyId[z.PropertyId.SpeechServiceConnection_RecoLanguage],L.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(z.PropertyId[z.PropertyId.SpeechServiceConnection_RecoLanguage]),t)this.privConversationId=t;else{e.targetLanguages.length===0&&e.addTargetLanguage(this.privLanguage),e.getProperty(z.PropertyId[z.PropertyId.SpeechServiceResponse_ProfanityOption])||e.setProfanity(z.ProfanityOption.Masked);let o=e.getProperty(z.PropertyId[z.PropertyId.ConversationTranslator_Name]);o==null&&(o="Host"),y.Contracts.throwIfNullOrTooLong(o,"nickname",50),y.Contracts.throwIfNullOrTooShort(o,"nickname",2),e.setProperty(z.PropertyId[z.PropertyId.ConversationTranslator_Name],o)}this.privConfig=e;let n=e;y.Contracts.throwIfNull(n,"speechConfig"),this.privProperties=n.properties.clone(),this.privIsConnected=!1,this.privParticipants=new L.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get conversationId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get conversationInfo(){let e=this.conversationId,t=this.participants.map(s=>({id:s.id,preferredLanguage:s.preferredLanguage,voice:s.voice})),i={};for(let s of L.ConversationConnectionConfig.transcriptionEventKeys){let o=this.properties.getProperty(s,"");o!==""&&(i[s]=o)}return{id:e,participants:t,conversationProperties:i}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(e){y.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}set conversationTranslator(e){this.privConversationTranslator=e}onToken(e){this.privConversationTranslator.onToken(e)}createConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,i=>{i||this.handleError(new Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=i,this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}startConversationAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer=L.ConversationRecognizerFactory.fromConfig(this,this.privConfig),this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}addParticipantAsync(e,t,i){y.Contracts.throwIfNullOrUndefined(e,"Participant"),(0,rs.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinConversationAsync(e,t,i,n,s){try{y.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","conversationId")),y.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),y.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,o=>{y.Contracts.throwIfNullOrUndefined(o,this.privErrors.permissionDeniedConnect),this.privRoom=o,this.privConfig.authorizationToken=o.cognitiveSpeechAuthToken,n&&n(o.cognitiveSpeechAuthToken)},o=>{this.handleError(o,s)})}catch(o){this.handleError(o,s)}}deleteConversationAsync(e,t){(0,rs.marshalPromiseToCallbacks)(this.deleteConversationImplAsync(),e,t)}async deleteConversationImplAsync(){y.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),y.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endConversationAsync(e,t){(0,rs.marshalPromiseToCallbacks)(this.endConversationImplAsync(),e,t)}endConversationImplAsync(){return this.close(!0)}lockConversationAsync(e,t){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}muteAllParticipantsAsync(e,t){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}muteParticipantAsync(e,t,i){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),!this.me.isHost&&this.me.id!==e&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),()=>{this.handleCallback(t,i)},s=>{this.handleError(s,i)})}catch(n){this.handleError(n,i)}}removeParticipantAsync(e,t,i){try{if(y.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty("id"))(0,rs.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),i);let n="";typeof e=="string"?n=e:e.hasOwnProperty("id")?n=e.id:e.hasOwnProperty("userId")&&(n=e.userId),y.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(o=>o.id===n)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(n),()=>{this.handleCallback(t,i)},o=>{this.handleError(o,i)})}}catch(n){this.handleError(n,i)}}unlockConversationAsync(e,t){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}unmuteAllParticipantsAsync(e,t){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}unmuteParticipantAsync(e,t,i){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),!this.me.isHost&&this.me.id!==e&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),()=>{this.handleCallback(t,i)},s=>{this.handleError(s,i)})}catch(n){this.handleError(n,i)}}sendTextMessageAsync(e,t,i){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","message")),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),e.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}setTranslatedLanguagesAsync(e,t,i){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","languages")),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}changeNicknameAsync(e,t,i){try{y.Contracts.throwIfDisposed(this.privIsDisposed),y.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),y.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","nickname")),y.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(e){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.conversation=this}getKeepAlive(){let e=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(this.privParticipants.addOrUpdateParticipant(e)!==void 0&&this.privTranscriberRecognizer){let i=this.conversationInfo;return i.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(i,"join")}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);let t=this.conversationInfo;return t.participants=[e],this.privTranscriberRecognizer.pushConversationEvent(t,"leave")}async close(e){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(t){throw t}e&&this.dispose()}handleCallback(e,t){if(e){try{e()}catch(i){t&&t(i)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let i=e;t(i.name+": "+i.message)}else t(e)}toParticipants(e){let t=this.privParticipants.participants.map(i=>this.toParticipant(i));return e?t:t.filter(i=>i.isHost===!1)}toParticipant(e){return new z.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,t){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand,value:t})}getLockCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(e,"nickname"),y.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:L.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:L.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return y.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),y.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),y.Contracts.throwIfNullOrWhitespace(e,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:L.ConversationTranslatorMessageTypes.instantMessage})}};Vi.ConversationImpl=is});var YS=u(ec=>{"use strict";Object.defineProperty(ec,"__esModule",{value:!0});ec.ConversationCommon=void 0;var Cd=class{constructor(e){this.privAudioConfig=e}handleCallback(e,t){if(e){try{e()}catch(i){t&&t(i)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let i=e;t(i.name+": "+i.message)}else t(e)}};ec.ConversationCommon=Cd});var eC=u(tc=>{"use strict";Object.defineProperty(tc,"__esModule",{value:!0});tc.ConversationExpirationEventArgs=void 0;var Pb=f(),Pd=class extends Pb.SessionEventArgs{constructor(e,t){super(t),this.privExpirationTime=e}get expirationTime(){return this.privExpirationTime}};tc.ConversationExpirationEventArgs=Pd});var tC=u(rc=>{"use strict";Object.defineProperty(rc,"__esModule",{value:!0});rc.ConversationParticipantsChangedEventArgs=void 0;var Rb=f(),Rd=class extends Rb.SessionEventArgs{constructor(e,t,i){super(i),this.privReason=e,this.privParticipant=t}get reason(){return this.privReason}get participants(){return this.privParticipant}};rc.ConversationParticipantsChangedEventArgs=Rd});var rC=u(ic=>{"use strict";Object.defineProperty(ic,"__esModule",{value:!0});ic.ConversationTranslationCanceledEventArgs=void 0;var Eb=Mi(),Ed=class extends Eb.CancellationEventArgsBase{};ic.ConversationTranslationCanceledEventArgs=Ed});var iC=u(nc=>{"use strict";Object.defineProperty(nc,"__esModule",{value:!0});nc.ConversationTranslationEventArgs=void 0;var wb=f(),wd=class extends wb.RecognitionEventArgs{constructor(e,t,i){super(t,i),this.privResult=e}get result(){return this.privResult}};nc.ConversationTranslationEventArgs=wd});var nC=u(sc=>{"use strict";Object.defineProperty(sc,"__esModule",{value:!0});sc.ConversationTranslationResult=void 0;var Ib=mh(),Id=class extends Ib.TranslationRecognitionResult{constructor(e,t,i,n,s,o,a,c,p,h,d){super(t,n,s,o,a,c,void 0,void 0,p,h,d),this.privId=e,this.privOrigLang=i}get participantId(){return this.privId}get originalLang(){return this.privOrigLang}};sc.ConversationTranslationResult=Id});var bd=u(oc=>{"use strict";Object.defineProperty(oc,"__esModule",{value:!0});oc.StringUtils=void 0;var _d=class{static formatString(e,t){if(!e)return"";if(!t)return e;let i="",n="",s=c=>{i+=c},o=c=>{n+=c},a=s;for(let c=0;c<e.length;c++){let p=e[c],h=c+1<e.length?e[c+1]:"";switch(p){case"{":h==="{"?(a("{"),c++):a=o;break;case"}":h==="}"?(a("}"),c++):(t.hasOwnProperty(n)&&(i+=t[n]),a=s,n="");break;default:a(p);break}}return i}};oc.StringUtils=_d});var aC=u(uc=>{"use strict";Object.defineProperty(uc,"__esModule",{value:!0});uc.ConversationTranslatorConnectionFactory=void 0;var Ad=ue(),sC=bd(),_b=I(),ac=f(),bb=_e(),rt=Yt(),oC=tt(),Td=C(),cc=class r extends oC.ConnectionFactoryBase{constructor(e){super(),_b.Contracts.throwIfNullOrUndefined(e,"convGetter"),this.privConvGetter=e}create(e,t,i){let n=e.parameters.getProperty("ConversationTranslator_MultiChannelAudio","").toUpperCase()==="TRUE",s=this.privConvGetter().room,o=s.cognitiveSpeechRegion||e.parameters.getProperty(ac.PropertyId.SpeechServiceConnection_Region,""),a={hostSuffix:oC.ConnectionFactoryBase.getHostSuffix(o),path:r.CTS_VIRT_MIC_PATH,region:encodeURIComponent(o)};a[rt.QueryParameterNames.Language]=encodeURIComponent(e.parameters.getProperty(ac.PropertyId.SpeechServiceConnection_RecoLanguage,"")),a[rt.QueryParameterNames.CtsMeetingId]=encodeURIComponent(s.roomId),a[rt.QueryParameterNames.CtsDeviceId]=encodeURIComponent(s.participantId),a[rt.QueryParameterNames.CtsIsParticipant]=s.isHost?"":"&"+rt.QueryParameterNames.CtsIsParticipant;let c="",p={},h={};if(n){c=e.parameters.getProperty(ac.PropertyId.SpeechServiceConnection_Endpoint),c||(c="wss://"+e.parameters.getProperty(ac.PropertyId.SpeechServiceConnection_Host,"transcribe.{region}.cts.speech{hostSuffix}")+"{path}"),c=sC.StringUtils.formatString(c,a);let v=new URL(c);v.searchParams.forEach((M,A)=>{p[A]=M}),new Td.TranscriberConnectionFactory().setQueryParams(p,e,c),p[rt.QueryParameterNames.CtsMeetingId]=a[rt.QueryParameterNames.CtsMeetingId],p[rt.QueryParameterNames.CtsDeviceId]=a[rt.QueryParameterNames.CtsDeviceId],s.isHost||(p[rt.QueryParameterNames.CtsIsParticipant]=""),rt.QueryParameterNames.Format in p||(p[rt.QueryParameterNames.Format]="simple"),v.searchParams.forEach((M,A)=>{v.searchParams.set(A,p[A]),delete p[A]}),c=v.toString()}else{let v=new Td.TranslationConnectionFactory;c=v.getEndpointUrl(e,!0),c=sC.StringUtils.formatString(c,a),v.setQueryParams(p,e,c)}h[bb.HeaderNames.ConnectionId]=i,h[Ad.RestConfigBase.configParams.token]=s.token,t.token&&(h[t.headerName]=t.token);let d=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","").toUpperCase()==="TRUE";return Promise.resolve(new Ad.WebsocketConnection(c,p,h,new Td.WebsocketMessageFormatter,Ad.ProxyInfo.fromRecognizerConfig(e),d,i))}};uc.ConversationTranslatorConnectionFactory=cc;cc.CTS_VIRT_MIC_PATH="/speech/recognition/dynamicaudio"});var uC=u(si=>{"use strict";Object.defineProperty(si,"__esModule",{value:!0});si.ConversationTranslator=si.SpeechState=void 0;var ns=C(),Ab=aC(),pc=P(),mt=I(),J=f(),Tb=Sd(),cC=lc(),yt;(function(r){r[r.Inactive=0]="Inactive",r[r.Connecting=1]="Connecting",r[r.Connected=2]="Connected"})(yt=si.SpeechState||(si.SpeechState={}));var Od=class extends J.TranslationRecognizer{constructor(e,t,i,n){super(e,t,new Ab.ConversationTranslatorConnectionFactory(n)),this.privSpeechState=yt.Inactive,i&&(this.privTranslator=i,this.sessionStarted=()=>{this.privSpeechState=yt.Connected},this.sessionStopped=()=>{this.privSpeechState=yt.Inactive},this.recognizing=(s,o)=>{this.privTranslator.recognizing&&this.privTranslator.recognizing(this.privTranslator,o)},this.recognized=async(s,o)=>{o.result?.errorDetails?(await this.cancelSpeech(),this.fireCancelEvent(o.result.errorDetails)):this.privTranslator.recognized&&this.privTranslator.recognized(this.privTranslator,o)},this.canceled=async()=>{if(this.privSpeechState!==yt.Inactive)try{await this.cancelSpeech()}catch{this.privSpeechState=yt.Inactive}})}get state(){return this.privSpeechState}set state(e){this.privSpeechState=e}set authentication(e){this.privReco.authentication=e}onConnection(){this.privSpeechState=yt.Connected}async onCancelSpeech(){this.privSpeechState=yt.Inactive,await this.cancelSpeech()}fireCancelEvent(e){try{if(this.privTranslator.canceled){let t=new cC.ConversationTranslationCanceledEventArgs(J.CancellationReason.Error,e,J.CancellationErrorCode.RuntimeError);this.privTranslator.canceled(this.privTranslator,t)}}catch{}}async cancelSpeech(){try{this.stopContinuousRecognitionAsync(),await this.privReco?.disconnect(),this.privSpeechState=yt.Inactive}catch{}}},kd=class extends cC.ConversationCommon{constructor(e){super(e),this.privErrors=ns.ConversationConnectionConfig.restErrors,this.privIsDisposed=!1,this.privIsSpeaking=!1,this.privPlaceholderKey="abcdefghijklmnopqrstuvwxyz012345",this.privPlaceholderRegion="westus",this.privProperties=new J.PropertyCollection}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get participants(){return this.privConversation?.participants}get canSpeak(){return!(!this.privConversation.isConnected||!this.privCTRecognizer||this.privIsSpeaking||this.privCTRecognizer.state===yt.Connected||this.privCTRecognizer.state===yt.Connecting||this.privConversation.isMutedByHost)}onToken(e){this.privCTRecognizer.authentication=e}setServiceProperty(e,t){let i=JSON.parse(this.privProperties.getProperty(ns.ServicePropertiesPropertyName,"{}"));i[e]=t,this.privProperties.setProperty(ns.ServicePropertiesPropertyName,JSON.stringify(i))}joinConversationAsync(e,t,i,n,s){try{if(typeof e=="string"){mt.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),mt.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privConversation&&this.handleError(new Error(this.privErrors.permissionDeniedStart),s);let o=i;(o==null||o==="")&&(o=ns.ConversationConnectionConfig.defaultLanguageCode),this.privSpeechTranslationConfig=J.SpeechTranslationConfig.fromSubscription(this.privPlaceholderKey,this.privPlaceholderRegion),this.privSpeechTranslationConfig.setProfanity(J.ProfanityOption.Masked),this.privSpeechTranslationConfig.addTargetLanguage(o),this.privSpeechTranslationConfig.setProperty(J.PropertyId[J.PropertyId.SpeechServiceConnection_RecoLanguage],o),this.privSpeechTranslationConfig.setProperty(J.PropertyId[J.PropertyId.ConversationTranslator_Name],t);let a=[J.PropertyId.SpeechServiceConnection_Host,J.PropertyId.ConversationTranslator_Host,J.PropertyId.SpeechServiceConnection_Endpoint,J.PropertyId.SpeechServiceConnection_ProxyHostName,J.PropertyId.SpeechServiceConnection_ProxyPassword,J.PropertyId.SpeechServiceConnection_ProxyPort,J.PropertyId.SpeechServiceConnection_ProxyUserName,"ConversationTranslator_MultiChannelAudio","ConversationTranslator_Region"];for(let p of a){let h=this.privProperties.getProperty(p);if(h){let d=typeof p=="string"?p:J.PropertyId[p];this.privSpeechTranslationConfig.setProperty(d,h)}}let c=JSON.parse(this.privProperties.getProperty(ns.ServicePropertiesPropertyName,"{}"));for(let p of Object.keys(c))this.privSpeechTranslationConfig.setServiceProperty(p,c[p],J.ServicePropertyChannel.UriQueryParameter);this.privConversation=new Tb.ConversationImpl(this.privSpeechTranslationConfig),this.privConversation.conversationTranslator=this,this.privConversation.joinConversationAsync(e,t,o,p=>{p||this.handleError(new Error(this.privErrors.permissionDeniedConnect),s),this.privSpeechTranslationConfig.authorizationToken=p,this.privConversation.room.isHost=!1,this.privConversation.startConversationAsync(()=>{this.handleCallback(n,s)},h=>{this.handleError(h,s)})},p=>{this.handleError(p,s)})}else typeof e=="object"?(mt.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","conversation id")),mt.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),this.privProperties.setProperty(J.PropertyId.ConversationTranslator_Name,t),this.privConversation=e,this.privConversation.conversationTranslator=this,this.privConversation.room.isHost=!0,mt.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedConnect),mt.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privSpeechTranslationConfig=e.config,this.handleCallback(i,n)):this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","invalid conversation type")),n)}catch(o){this.handleError(o,typeof i=="string"?s:n)}}leaveConversationAsync(e,t){(0,pc.marshalPromiseToCallbacks)((async()=>{await this.cancelSpeech(),await this.privConversation.endConversationImplAsync(),await this.privConversation.deleteConversationImplAsync(),this.dispose()})(),e,t)}sendTextMessageAsync(e,t,i){try{mt.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),mt.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}",e)),this.privConversation.sendTextMessageAsync(e,t,i)}catch(n){this.handleError(n,i)}}startTranscribingAsync(e,t){(0,pc.marshalPromiseToCallbacks)((async()=>{try{mt.Contracts.throwIfNullOrUndefined(this.privConversation,this.privErrors.permissionDeniedSend),mt.Contracts.throwIfNullOrUndefined(this.privConversation.room.token,this.privErrors.permissionDeniedConnect),this.privCTRecognizer===void 0&&await this.connectTranslatorRecognizer(),mt.Contracts.throwIfNullOrUndefined(this.privCTRecognizer,this.privErrors.permissionDeniedSend),this.canSpeak||this.handleError(new Error(this.privErrors.permissionDeniedSend),t),await this.startContinuousRecognition(),this.privIsSpeaking=!0}catch(i){throw this.privIsSpeaking=!1,await this.cancelSpeech(),i}})(),e,t)}stopTranscribingAsync(e,t){(0,pc.marshalPromiseToCallbacks)((async()=>{try{if(!this.privIsSpeaking){await this.cancelSpeech();return}this.privIsSpeaking=!1,await new Promise((i,n)=>{this.privCTRecognizer.stopContinuousRecognitionAsync(i,n)})}catch{await this.cancelSpeech()}})(),e,t)}isDisposed(){return this.privIsDisposed}dispose(e,t,i){(0,pc.marshalPromiseToCallbacks)((async()=>{this.isDisposed&&!this.privIsSpeaking||(await this.cancelSpeech(),this.privIsDisposed=!0,this.privSpeechTranslationConfig.close(),this.privSpeechRecognitionLanguage=void 0,this.privProperties=void 0,this.privAudioConfig=void 0,this.privSpeechTranslationConfig=void 0,this.privConversation.dispose(),this.privConversation=void 0)})(),t,i)}async cancelSpeech(){try{this.privIsSpeaking=!1,await this.privCTRecognizer?.onCancelSpeech(),this.privCTRecognizer=void 0}catch{}}async connectTranslatorRecognizer(){try{this.privAudioConfig===void 0&&(this.privAudioConfig=J.AudioConfig.fromDefaultMicrophoneInput()),this.privSpeechTranslationConfig.getProperty(J.PropertyId[J.PropertyId.SpeechServiceConnection_Key])===this.privPlaceholderKey&&this.privSpeechTranslationConfig.setProperty(J.PropertyId[J.PropertyId.SpeechServiceConnection_Key],"");let e=()=>this.privConversation;this.privCTRecognizer=new Od(this.privSpeechTranslationConfig,this.privAudioConfig,this,e)}catch(e){throw await this.cancelSpeech(),e}}startContinuousRecognition(){return new Promise((e,t)=>{this.privCTRecognizer.startContinuousRecognitionAsync(e,t)})}};si.ConversationTranslator=kd});var pC=u(dc=>{"use strict";Object.defineProperty(dc,"__esModule",{value:!0});dc.ConversationTranscriber=void 0;var hc=C(),Ob=He(),Md=P(),oi=I(),De=f(),Dd=class r extends De.Recognizer{constructor(e,t){let i=e;oi.Contracts.throwIfNull(i,"speechConfig"),oi.Contracts.throwIfNullOrWhitespace(i.properties.getProperty(De.PropertyId.SpeechServiceConnection_RecoLanguage),De.PropertyId[De.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new hc.ConversationTranscriberConnectionFactory,e.tokenCredential),this.privProperties.setProperty(De.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2"),this.privDisposedRecognizer=!1}static FromConfig(e,t,i){let n=e;return t.properties.mergeTo(n.properties),new r(e,i)}get endpointId(){return oi.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(De.PropertyId.SpeechServiceConnection_EndpointId,"00000000-0000-0000-0000-000000000000")}get authorizationToken(){return this.properties.getProperty(De.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){oi.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(De.PropertyId.SpeechServiceAuthorization_Token,e)}get speechRecognitionLanguage(){return oi.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(De.PropertyId.SpeechServiceConnection_RecoLanguage)}get outputFormat(){return oi.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(hc.OutputFormatPropertyName,De.OutputFormat[De.OutputFormat.Simple])===De.OutputFormat[De.OutputFormat.Simple]?De.OutputFormat.Simple:De.OutputFormat.Detailed}get properties(){return this.privProperties}startTranscribingAsync(e,t){(0,Md.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(Ob.RecognitionMode.Conversation),e,t)}stopTranscribingAsync(e,t){(0,Md.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}close(e,t){oi.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,Md.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new hc.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return n.isSpeakerDiarizationEnabled=!0,new hc.ConversationTranscriptionServiceRecognizer(e,t,s,n,this)}};dc.ConversationTranscriber=Dd});var lC=u(Ui=>{"use strict";Object.defineProperty(Ui,"__esModule",{value:!0});Ui.Participant=Ui.User=void 0;var kb=f(),xd=class{constructor(e){this.privUserId=e}get userId(){return this.privUserId}};Ui.User=xd;var Nd=class r{constructor(e,t,i,n,s,o,a,c){this.privId=e,this.privAvatar=t,this.privDisplayName=i,this.privIsHost=n,this.privIsMuted=s,this.privIsUsingTts=o,this.privPreferredLanguage=a,this.privVoice=c,this.privProperties=new kb.PropertyCollection}get avatar(){return this.privAvatar}get displayName(){return this.privDisplayName}get id(){return this.privId}get preferredLanguage(){return this.privPreferredLanguage}get isHost(){return this.privIsHost}get isMuted(){return this.privIsMuted}get isUsingTts(){return this.privIsUsingTts}get voice(){return this.privVoice}get properties(){return this.privProperties}static From(e,t,i){return new r(e,"",e,!1,!1,!1,t,i)}};Ui.Participant=Nd});var hC=u(ss=>{"use strict";Object.defineProperty(ss,"__esModule",{value:!0});ss.ParticipantChangedReason=void 0;var Mb;(function(r){r[r.JoinedConversation=0]="JoinedConversation",r[r.LeftConversation=1]="LeftConversation",r[r.Updated=2]="Updated"})(Mb=ss.ParticipantChangedReason||(ss.ParticipantChangedReason={}))});var dC=u(Wi=>{"use strict";Object.defineProperty(Wi,"__esModule",{value:!0});Wi.MeetingImpl=Wi.Meeting=void 0;var B=C(),os=P(),S=I(),G=f(),vc=class{constructor(){}static createMeetingAsync(e,t,i,n){if(S.Contracts.throwIfNullOrUndefined(e,B.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","config")),S.Contracts.throwIfNullOrUndefined(e.region,B.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Region")),S.Contracts.throwIfNull(t,"meetingId"),t.length===0)throw new Error("meetingId cannot be empty");!e.subscriptionKey&&!e.getProperty(G.PropertyId[G.PropertyId.SpeechServiceAuthorization_Token])&&S.Contracts.throwIfNullOrUndefined(e.subscriptionKey,B.ConversationConnectionConfig.restErrors.invalidArgs.replace("{arg}","SpeechServiceConnection_Key"));let s=new fc(e,t);return(0,os.marshalPromiseToCallbacks)((async()=>{})(),i,n),s}};Wi.Meeting=vc;var fc=class extends vc{constructor(e,t){super(),this.privErrors=B.ConversationConnectionConfig.restErrors,this.onConnected=s=>{this.privIsConnected=!0;try{this.privConversationTranslator?.sessionStarted&&this.privConversationTranslator.sessionStarted(this.privConversationTranslator,s)}catch{}},this.onDisconnected=s=>{try{this.privConversationTranslator?.sessionStopped&&this.privConversationTranslator.sessionStopped(this.privConversationTranslator,s)}catch{}finally{this.close(!1)}},this.onCanceled=(s,o)=>{try{this.privConversationTranslator?.canceled&&this.privConversationTranslator.canceled(this.privConversationTranslator,o)}catch{}},this.onParticipantUpdateCommandReceived=(s,o)=>{try{let a=this.privParticipants.getParticipant(o.id);if(a!==void 0){switch(o.key){case B.ConversationTranslatorCommandTypes.changeNickname:a.displayName=o.value;break;case B.ConversationTranslatorCommandTypes.setUseTTS:a.isUsingTts=o.value;break;case B.ConversationTranslatorCommandTypes.setProfanityFiltering:a.profanity=o.value;break;case B.ConversationTranslatorCommandTypes.setMute:a.isMuted=o.value;break;case B.ConversationTranslatorCommandTypes.setTranslateToLanguages:a.translateToLanguages=o.value;break}this.privParticipants.addOrUpdateParticipant(a),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new G.ConversationParticipantsChangedEventArgs(G.ParticipantChangedReason.Updated,[this.toParticipant(a)],o.sessionId))}}catch{}},this.onLockRoomCommandReceived=()=>{},this.onMuteAllCommandReceived=(s,o)=>{try{this.privParticipants.participants.forEach(a=>a.isMuted=a.isHost?!1:o.isMuted),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new G.ConversationParticipantsChangedEventArgs(G.ParticipantChangedReason.Updated,this.toParticipants(!1),o.sessionId))}catch{}},this.onParticipantJoinCommandReceived=(s,o)=>{try{let a=this.privParticipants.addOrUpdateParticipant(o.participant);a!==void 0&&this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new G.ConversationParticipantsChangedEventArgs(G.ParticipantChangedReason.JoinedConversation,[this.toParticipant(a)],o.sessionId))}catch{}},this.onParticipantLeaveCommandReceived=(s,o)=>{try{let a=this.privParticipants.getParticipant(o.participant.id);a!==void 0&&(this.privParticipants.deleteParticipant(o.participant.id),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new G.ConversationParticipantsChangedEventArgs(G.ParticipantChangedReason.LeftConversation,[this.toParticipant(a)],o.sessionId)))}catch{}},this.onTranslationReceived=(s,o)=>{try{switch(o.command){case B.ConversationTranslatorMessageTypes.final:this.privConversationTranslator&&this.privConversationTranslator.transcribed(this.privConversationTranslator,new G.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break;case B.ConversationTranslatorMessageTypes.partial:this.privConversationTranslator&&this.privConversationTranslator.transcribing(this.privConversationTranslator,new G.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break;case B.ConversationTranslatorMessageTypes.instantMessage:this.privConversationTranslator&&this.privConversationTranslator.textMessageReceived(this.privConversationTranslator,new G.ConversationTranslationEventArgs(o.payload,void 0,o.sessionId));break}}catch{}},this.onParticipantsListReceived=(s,o)=>{try{if(o.sessionToken!==void 0&&o.sessionToken!==null&&(this.privRoom.token=o.sessionToken),this.privParticipants.participants=[...o.participants],this.privParticipants.me!==void 0&&(this.privIsReady=!0),this.privConversationTranslator&&this.privConversationTranslator.participantsChanged(this.privConversationTranslator,new G.ConversationParticipantsChangedEventArgs(G.ParticipantChangedReason.JoinedConversation,this.toParticipants(!0),o.sessionId)),this.me.isHost){let a=this.privConversationTranslator?.properties.getProperty(G.PropertyId.ConversationTranslator_Name);a!==void 0&&a.length>0&&a!==this.me.displayName&&this.changeNicknameAsync(a)}}catch{}},this.onConversationExpiration=(s,o)=>{try{this.privConversationTranslator&&this.privConversationTranslator.conversationExpiration(this.privConversationTranslator,o)}catch{}},this.privIsConnected=!1,this.privIsDisposed=!1,this.privConversationId="",this.privProperties=new G.PropertyCollection,this.privManager=new B.ConversationManager,e.getProperty(G.PropertyId[G.PropertyId.SpeechServiceConnection_RecoLanguage])||e.setProperty(G.PropertyId[G.PropertyId.SpeechServiceConnection_RecoLanguage],B.ConversationConnectionConfig.defaultLanguageCode),this.privLanguage=e.getProperty(G.PropertyId[G.PropertyId.SpeechServiceConnection_RecoLanguage]),this.privConversationId=t,this.privConfig=e;let n=e;S.Contracts.throwIfNull(n,"speechConfig"),this.privProperties=n.properties.clone(),this.privIsConnected=!1,this.privParticipants=new B.InternalParticipants,this.privIsReady=!1,this.privTextMessageMaxLength=1e3}get room(){return this.privRoom}get connection(){return this.privConversationRecognizer}get config(){return this.privConfig}get meetingId(){return this.privRoom?this.privRoom.roomId:this.privConversationId}get properties(){return this.privProperties}get speechRecognitionLanguage(){return this.privLanguage}get isMutedByHost(){return this.privParticipants.me?.isHost?!1:this.privParticipants.me?.isMuted}get isConnected(){return this.privIsConnected&&this.privIsReady}get participants(){return this.toParticipants(!0)}get me(){return this.toParticipant(this.privParticipants.me)}get host(){return this.toParticipant(this.privParticipants.host)}get transcriberRecognizer(){return this.privTranscriberRecognizer}get meetingInfo(){let e=this.meetingId,t=this.participants.map(s=>({id:s.id,preferredLanguage:s.preferredLanguage,voice:s.voice})),i={};for(let s of B.ConversationConnectionConfig.transcriptionEventKeys){let o=this.properties.getProperty(s,"");o!==""&&(i[s]=o)}return{id:e,participants:t,meetingProperties:i}}get canSend(){return this.privIsConnected&&!this.privParticipants.me?.isMuted}get canSendAsHost(){return this.privIsConnected&&this.privParticipants.me?.isHost}get authorizationToken(){return this.privToken}set authorizationToken(e){S.Contracts.throwIfNullOrWhitespace(e,"authorizationToken"),this.privToken=e}createMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),this.privManager.createOrJoin(this.privProperties,void 0,i=>{i||this.handleError(new Error(this.privErrors.permissionDeniedConnect),t),this.privRoom=i,this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}startMeetingAsync(e,t){try{this.privConversationRecognizer&&this.handleError(new Error(this.privErrors.permissionDeniedStart),t),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedConnect),this.privParticipants.meId=this.privRoom.participantId,this.privConversationRecognizer.connected=this.onConnected,this.privConversationRecognizer.disconnected=this.onDisconnected,this.privConversationRecognizer.canceled=this.onCanceled,this.privConversationRecognizer.participantUpdateCommandReceived=this.onParticipantUpdateCommandReceived,this.privConversationRecognizer.lockRoomCommandReceived=this.onLockRoomCommandReceived,this.privConversationRecognizer.muteAllCommandReceived=this.onMuteAllCommandReceived,this.privConversationRecognizer.participantJoinCommandReceived=this.onParticipantJoinCommandReceived,this.privConversationRecognizer.participantLeaveCommandReceived=this.onParticipantLeaveCommandReceived,this.privConversationRecognizer.translationReceived=this.onTranslationReceived,this.privConversationRecognizer.participantsListReceived=this.onParticipantsListReceived,this.privConversationRecognizer.conversationExpiration=this.onConversationExpiration,this.privConversationRecognizer.connect(this.privRoom.token,()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}addParticipantAsync(e,t,i){S.Contracts.throwIfNullOrUndefined(e,"Participant"),(0,os.marshalPromiseToCallbacks)(this.addParticipantImplAsync(e),t,i)}joinMeetingAsync(e,t,i,n,s){try{S.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","conversationId")),S.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","nickname")),S.Contracts.throwIfNullOrWhitespace(i,this.privErrors.invalidArgs.replace("{arg}","language")),this.privManager.createOrJoin(this.privProperties,e,o=>{S.Contracts.throwIfNullOrUndefined(o,this.privErrors.permissionDeniedConnect),this.privRoom=o,this.privConfig.authorizationToken=o.cognitiveSpeechAuthToken,n&&n(o.cognitiveSpeechAuthToken)},o=>{this.handleError(o,s)})}catch(o){this.handleError(o,s)}}deleteMeetingAsync(e,t){(0,os.marshalPromiseToCallbacks)(this.deleteMeetingImplAsync(),e,t)}async deleteMeetingImplAsync(){S.Contracts.throwIfNullOrUndefined(this.privProperties,this.privErrors.permissionDeniedConnect),S.Contracts.throwIfNullOrWhitespace(this.privRoom.token,this.privErrors.permissionDeniedConnect),await this.privManager.leave(this.privProperties,this.privRoom.token),this.dispose()}endMeetingAsync(e,t){(0,os.marshalPromiseToCallbacks)(this.endMeetingImplAsync(),e,t)}endMeetingImplAsync(){return this.close(!0)}lockMeetingAsync(e,t){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","lock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!0),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}muteAllParticipantsAsync(e,t){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrUndefined(this.privConversationRecognizer,this.privErrors.permissionDeniedSend),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","mute")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!0),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}muteParticipantAsync(e,t,i){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),!this.me.isHost&&this.me.id!==e&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!0),()=>{this.handleCallback(t,i)},s=>{this.handleError(s,i)})}catch(n){this.handleError(n,i)}}removeParticipantAsync(e,t,i){try{if(S.Contracts.throwIfDisposed(this.privIsDisposed),this.privTranscriberRecognizer&&e.hasOwnProperty("id"))(0,os.marshalPromiseToCallbacks)(this.removeParticipantImplAsync(e),t,i);else{S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","remove")),i);let n="";typeof e=="string"?n=e:e.hasOwnProperty("id")?n=e.id:e.hasOwnProperty("userId")&&(n=e.userId),S.Contracts.throwIfNullOrWhitespace(n,this.privErrors.invalidArgs.replace("{arg}","userId")),this.participants.findIndex(o=>o.id===n)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getEjectCommand(n),()=>{this.handleCallback(t,i)},o=>{this.handleError(o,i)})}}catch(n){this.handleError(n,i)}}unlockMeetingAsync(e,t){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unlock")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getLockCommand(!1),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}unmuteAllParticipantsAsync(e,t){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSendAsHost||this.handleError(new Error(this.privErrors.permissionDeniedConversation.replace("{command}","unmute all")),t),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteAllCommand(!1),()=>{this.handleCallback(e,t)},i=>{this.handleError(i,t)})}catch(i){this.handleError(i,t)}}unmuteParticipantAsync(e,t,i){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","userId")),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),!this.me.isHost&&this.me.id!==e&&this.handleError(new Error(this.privErrors.permissionDeniedParticipant.replace("{command}","mute")),i),this.privParticipants.getParticipantIndex(e)===-1&&this.handleError(new Error(this.privErrors.invalidParticipantRequest),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMuteCommand(e,!1),()=>{this.handleCallback(t,i)},s=>{this.handleError(s,i)})}catch(n){this.handleError(n,i)}}sendTextMessageAsync(e,t,i){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","message")),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),e.length>this.privTextMessageMaxLength&&this.handleError(new Error(this.privErrors.invalidArgs.replace("{arg}","message length")),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getMessageCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}setTranslatedLanguagesAsync(e,t,i){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfArrayEmptyOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","languages")),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getSetTranslateToLanguagesCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}changeNicknameAsync(e,t,i){try{S.Contracts.throwIfDisposed(this.privIsDisposed),S.Contracts.throwIfDisposed(this.privConversationRecognizer.isDisposed()),S.Contracts.throwIfNullOrWhitespace(e,this.privErrors.invalidArgs.replace("{arg}","nickname")),S.Contracts.throwIfNullOrUndefined(this.privRoom,this.privErrors.permissionDeniedSend),this.canSend||this.handleError(new Error(this.privErrors.permissionDeniedSend),i),this.privConversationRecognizer&&this.privConversationRecognizer.sendRequest(this.getChangeNicknameCommand(e),()=>{this.handleCallback(t,i)},n=>{this.handleError(n,i)})}catch(n){this.handleError(n,i)}}isDisposed(){return this.privIsDisposed}dispose(){this.isDisposed||(this.privIsDisposed=!0,this.config&&this.config.close(),this.privConfig=void 0,this.privLanguage=void 0,this.privProperties=void 0,this.privRoom=void 0,this.privToken=void 0,this.privManager=void 0,this.privIsConnected=!1,this.privIsReady=!1,this.privParticipants=void 0)}async connectTranscriberRecognizer(e){this.privTranscriberRecognizer&&await this.privTranscriberRecognizer.close(),await e.enforceAudioGating(),this.privTranscriberRecognizer=e,this.privTranscriberRecognizer.meeting=this}getKeepAlive(){let e=this.me?this.me.displayName:"default_nickname";return JSON.stringify({id:"0",nickname:e,participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.keepAlive})}addParticipantImplAsync(e){if(this.privParticipants.addOrUpdateParticipant(e)!==void 0&&this.privTranscriberRecognizer){let i=this.meetingInfo;return i.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(i,"join")}}removeParticipantImplAsync(e){this.privParticipants.deleteParticipant(e.id);let t=this.meetingInfo;return t.participants=[e],this.privTranscriberRecognizer.pushMeetingEvent(t,"leave")}async close(e){try{this.privIsConnected=!1,await this.privConversationRecognizer?.close(),this.privConversationRecognizer=void 0,this.privConversationTranslator&&this.privConversationTranslator.dispose()}catch(t){throw t}e&&this.dispose()}handleCallback(e,t){if(e){try{e()}catch(i){t&&t(i)}e=void 0}}handleError(e,t){if(t)if(e instanceof Error){let i=e;t(i.name+": "+i.message)}else t(e)}toParticipants(e){let t=this.privParticipants.participants.map(i=>this.toParticipant(i));return e?t:t.filter(i=>i.isHost===!1)}toParticipant(e){return new G.Participant(e.id,e.avatar,e.displayName,e.isHost,e.isMuted,e.isUsingTts,e.preferredLanguage,e.voice)}getMuteAllCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingd"),S.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.setMuteAll,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMuteCommand(e,t){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"conversationId"),S.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.setMute,participantId:e,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand,value:t})}getLockCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),S.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.setLockState,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand,value:e})}getEjectCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),S.Contracts.throwIfNullOrWhitespace(e,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.ejectParticipant,participantId:e,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand})}getSetTranslateToLanguagesCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),S.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.setTranslateToLanguages,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand,value:e})}getChangeNicknameCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),S.Contracts.throwIfNullOrWhitespace(e,"nickname"),S.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),JSON.stringify({command:B.ConversationTranslatorCommandTypes.changeNickname,nickname:e,participantId:this.privRoom.participantId,roomid:this.privRoom.roomId,type:B.ConversationTranslatorMessageTypes.participantCommand,value:e})}getMessageCommand(e){return S.Contracts.throwIfNullOrWhitespace(this.privRoom.roomId,"meetingId"),S.Contracts.throwIfNullOrWhitespace(this.privRoom.participantId,"participantId"),S.Contracts.throwIfNullOrWhitespace(e,"message"),JSON.stringify({participantId:this.privRoom.participantId,roomId:this.privRoom.roomId,text:e,type:B.ConversationTranslatorMessageTypes.instantMessage})}};Wi.MeetingImpl=fc});var vC=u(gc=>{"use strict";Object.defineProperty(gc,"__esModule",{value:!0});gc.MeetingTranscriptionCanceledEventArgs=void 0;var Db=Mi(),jd=class extends Db.CancellationEventArgsBase{};gc.MeetingTranscriptionCanceledEventArgs=jd});var fC=u(mc=>{"use strict";Object.defineProperty(mc,"__esModule",{value:!0});mc.MeetingTranscriber=void 0;var xb=C(),qd=P(),as=I(),cs=f(),Nb=lc(),zd=class{constructor(e){this.privAudioConfig=e,this.privProperties=new cs.PropertyCollection,this.privRecognizer=void 0,this.privDisposedRecognizer=!1}get speechRecognitionLanguage(){return as.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(cs.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get internalData(){return this.privRecognizer.internalData}get connection(){return cs.Connection.fromRecognizer(this.privRecognizer)}get authorizationToken(){return this.properties.getProperty(cs.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){as.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(cs.PropertyId.SpeechServiceAuthorization_Token,e)}joinMeetingAsync(e,t,i){let n=e;as.Contracts.throwIfNullOrUndefined(Nb.MeetingImpl,"Meeting"),this.privRecognizer=new xb.TranscriberRecognizer(e.config,this.privAudioConfig),as.Contracts.throwIfNullOrUndefined(this.privRecognizer,"Recognizer"),this.privRecognizer.connectMeetingCallbacks(this),(0,qd.marshalPromiseToCallbacks)(n.connectTranscriberRecognizer(this.privRecognizer),t,i)}startTranscribingAsync(e,t){this.privRecognizer.startContinuousRecognitionAsync(e,t)}stopTranscribingAsync(e,t){this.privRecognizer.stopContinuousRecognitionAsync(e,t)}leaveMeetingAsync(e,t){this.privRecognizer.disconnectCallbacks(),(0,qd.marshalPromiseToCallbacks)((async()=>{})(),e,t)}close(e,t){as.Contracts.throwIfDisposed(this.privDisposedRecognizer),(0,qd.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}async dispose(e){this.privDisposedRecognizer||(this.privRecognizer&&(await this.privRecognizer.close(),this.privRecognizer=void 0),e&&(this.privDisposedRecognizer=!0))}};mc.MeetingTranscriber=zd});var gC=u(yc=>{"use strict";Object.defineProperty(yc,"__esModule",{value:!0});yc.ConversationTranscriptionResult=void 0;var jb=f(),Ld=class extends jb.RecognitionResult{constructor(e,t,i,n,s,o,a,c,p,h,d){super(e,t,i,n,s,o,a,p,h,d),this.privSpeakerId=c}get speakerId(){return this.privSpeakerId}};yc.ConversationTranscriptionResult=Ld});var lc=u(k=>{"use strict";Object.defineProperty(k,"__esModule",{value:!0});k.ConversationTranscriptionResult=k.MeetingTranscriber=k.MeetingTranscriptionCanceledEventArgs=k.MeetingImpl=k.Meeting=k.ParticipantChangedReason=k.User=k.Participant=k.ConversationTranscriber=k.ConversationTranslator=k.ConversationTranslationResult=k.ConversationTranslationEventArgs=k.ConversationTranslationCanceledEventArgs=k.ConversationParticipantsChangedEventArgs=k.ConversationExpirationEventArgs=k.ConversationCommon=k.ConversationImpl=k.Conversation=void 0;var mC=Sd();Object.defineProperty(k,"Conversation",{enumerable:!0,get:function(){return mC.Conversation}});Object.defineProperty(k,"ConversationImpl",{enumerable:!0,get:function(){return mC.ConversationImpl}});var qb=YS();Object.defineProperty(k,"ConversationCommon",{enumerable:!0,get:function(){return qb.ConversationCommon}});var zb=eC();Object.defineProperty(k,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return zb.ConversationExpirationEventArgs}});var Lb=tC();Object.defineProperty(k,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return Lb.ConversationParticipantsChangedEventArgs}});var Bb=rC();Object.defineProperty(k,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return Bb.ConversationTranslationCanceledEventArgs}});var Fb=iC();Object.defineProperty(k,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return Fb.ConversationTranslationEventArgs}});var Vb=nC();Object.defineProperty(k,"ConversationTranslationResult",{enumerable:!0,get:function(){return Vb.ConversationTranslationResult}});var Ub=uC();Object.defineProperty(k,"ConversationTranslator",{enumerable:!0,get:function(){return Ub.ConversationTranslator}});var Wb=pC();Object.defineProperty(k,"ConversationTranscriber",{enumerable:!0,get:function(){return Wb.ConversationTranscriber}});var yC=lC();Object.defineProperty(k,"Participant",{enumerable:!0,get:function(){return yC.Participant}});Object.defineProperty(k,"User",{enumerable:!0,get:function(){return yC.User}});var Hb=hC();Object.defineProperty(k,"ParticipantChangedReason",{enumerable:!0,get:function(){return Hb.ParticipantChangedReason}});var SC=dC();Object.defineProperty(k,"Meeting",{enumerable:!0,get:function(){return SC.Meeting}});Object.defineProperty(k,"MeetingImpl",{enumerable:!0,get:function(){return SC.MeetingImpl}});var Kb=vC();Object.defineProperty(k,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return Kb.MeetingTranscriptionCanceledEventArgs}});var Jb=fC();Object.defineProperty(k,"MeetingTranscriber",{enumerable:!0,get:function(){return Jb.MeetingTranscriber}});var $b=gC();Object.defineProperty(k,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return $b.ConversationTranscriptionResult}})});var Sc=u(Hi=>{"use strict";Object.defineProperty(Hi,"__esModule",{value:!0});Hi.SynthesisRequest=Hi.Synthesizer=void 0;var wr=C(),Gb=P(),CC=I(),Ir=f(),Bd=class r{constructor(e){let t=e;CC.Contracts.throwIfNull(t,"speechConfig"),this.privProperties=t.properties.clone(),this.privDisposed=!1,this.privSynthesizing=!1,this.synthesisRequestQueue=new Gb.Queue,this.tokenCredential=e.tokenCredential}get authorizationToken(){return this.properties.getProperty(Ir.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){CC.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(Ir.PropertyId.SpeechServiceAuthorization_Token,e)}get properties(){return this.privProperties}get autoDetectSourceLanguage(){return this.properties.getProperty(Ir.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages)===wr.AutoDetectSourceLanguagesOpenRangeOptionName}buildSsml(e){let t={"af-ZA":"af-ZA-AdriNeural","am-ET":"am-ET-AmehaNeural","ar-AE":"ar-AE-FatimaNeural","ar-BH":"ar-BH-AliNeural","ar-DZ":"ar-DZ-AminaNeural","ar-EG":"ar-EG-SalmaNeural","ar-IQ":"ar-IQ-BasselNeural","ar-JO":"ar-JO-SanaNeural","ar-KW":"ar-KW-FahedNeural","ar-LY":"ar-LY-ImanNeural","ar-MA":"ar-MA-JamalNeural","ar-QA":"ar-QA-AmalNeural","ar-SA":"ar-SA-HamedNeural","ar-SY":"ar-SY-AmanyNeural","ar-TN":"ar-TN-HediNeural","ar-YE":"ar-YE-MaryamNeural","bg-BG":"bg-BG-BorislavNeural","bn-BD":"bn-BD-NabanitaNeural","bn-IN":"bn-IN-BashkarNeural","ca-ES":"ca-ES-JoanaNeural","cs-CZ":"cs-CZ-AntoninNeural","cy-GB":"cy-GB-AledNeural","da-DK":"da-DK-ChristelNeural","de-AT":"de-AT-IngridNeural","de-CH":"de-CH-JanNeural","de-DE":"de-DE-KatjaNeural","el-GR":"el-GR-AthinaNeural","en-AU":"en-AU-NatashaNeural","en-CA":"en-CA-ClaraNeural","en-GB":"en-GB-LibbyNeural","en-HK":"en-HK-SamNeural","en-IE":"en-IE-ConnorNeural","en-IN":"en-IN-NeerjaNeural","en-KE":"en-KE-AsiliaNeural","en-NG":"en-NG-AbeoNeural","en-NZ":"en-NZ-MitchellNeural","en-PH":"en-PH-JamesNeural","en-SG":"en-SG-LunaNeural","en-TZ":"en-TZ-ElimuNeural","en-US":"en-US-AvaMultilingualNeural","en-ZA":"en-ZA-LeahNeural","es-AR":"es-AR-ElenaNeural","es-BO":"es-BO-MarceloNeural","es-CL":"es-CL-CatalinaNeural","es-CO":"es-CO-GonzaloNeural","es-CR":"es-CR-JuanNeural","es-CU":"es-CU-BelkysNeural","es-DO":"es-DO-EmilioNeural","es-EC":"es-EC-AndreaNeural","es-ES":"es-ES-AlvaroNeural","es-GQ":"es-GQ-JavierNeural","es-GT":"es-GT-AndresNeural","es-HN":"es-HN-CarlosNeural","es-MX":"es-MX-DaliaNeural","es-NI":"es-NI-FedericoNeural","es-PA":"es-PA-MargaritaNeural","es-PE":"es-PE-AlexNeural","es-PR":"es-PR-KarinaNeural","es-PY":"es-PY-MarioNeural","es-SV":"es-SV-LorenaNeural","es-US":"es-US-AlonsoNeural","es-UY":"es-UY-MateoNeural","es-VE":"es-VE-PaolaNeural","et-EE":"et-EE-AnuNeural","fa-IR":"fa-IR-DilaraNeural","fi-FI":"fi-FI-SelmaNeural","fil-PH":"fil-PH-AngeloNeural","fr-BE":"fr-BE-CharlineNeural","fr-CA":"fr-CA-SylvieNeural","fr-CH":"fr-CH-ArianeNeural","fr-FR":"fr-FR-DeniseNeural","ga-IE":"ga-IE-ColmNeural","gl-ES":"gl-ES-RoiNeural","gu-IN":"gu-IN-DhwaniNeural","he-IL":"he-IL-AvriNeural","hi-IN":"hi-IN-MadhurNeural","hr-HR":"hr-HR-GabrijelaNeural","hu-HU":"hu-HU-NoemiNeural","id-ID":"id-ID-ArdiNeural","is-IS":"is-IS-GudrunNeural","it-IT":"it-IT-IsabellaNeural","ja-JP":"ja-JP-NanamiNeural","jv-ID":"jv-ID-DimasNeural","kk-KZ":"kk-KZ-AigulNeural","km-KH":"km-KH-PisethNeural","kn-IN":"kn-IN-GaganNeural","ko-KR":"ko-KR-SunHiNeural","lo-LA":"lo-LA-ChanthavongNeural","lt-LT":"lt-LT-LeonasNeural","lv-LV":"lv-LV-EveritaNeural","mk-MK":"mk-MK-AleksandarNeural","ml-IN":"ml-IN-MidhunNeural","mr-IN":"mr-IN-AarohiNeural","ms-MY":"ms-MY-OsmanNeural","mt-MT":"mt-MT-GraceNeural","my-MM":"my-MM-NilarNeural","nb-NO":"nb-NO-PernilleNeural","nl-BE":"nl-BE-ArnaudNeural","nl-NL":"nl-NL-ColetteNeural","pl-PL":"pl-PL-AgnieszkaNeural","ps-AF":"ps-AF-GulNawazNeural","pt-BR":"pt-BR-FranciscaNeural","pt-PT":"pt-PT-DuarteNeural","ro-RO":"ro-RO-AlinaNeural","ru-RU":"ru-RU-SvetlanaNeural","si-LK":"si-LK-SameeraNeural","sk-SK":"sk-SK-LukasNeural","sl-SI":"sl-SI-PetraNeural","so-SO":"so-SO-MuuseNeural","sr-RS":"sr-RS-NicholasNeural","su-ID":"su-ID-JajangNeural","sv-SE":"sv-SE-SofieNeural","sw-KE":"sw-KE-RafikiNeural","sw-TZ":"sw-TZ-DaudiNeural","ta-IN":"ta-IN-PallaviNeural","ta-LK":"ta-LK-KumarNeural","ta-SG":"ta-SG-AnbuNeural","te-IN":"te-IN-MohanNeural","th-TH":"th-TH-PremwadeeNeural","tr-TR":"tr-TR-AhmetNeural","uk-UA":"uk-UA-OstapNeural","ur-IN":"ur-IN-GulNeural","ur-PK":"ur-PK-AsadNeural","uz-UZ":"uz-UZ-MadinaNeural","vi-VN":"vi-VN-HoaiMyNeural","zh-CN":"zh-CN-XiaoxiaoNeural","zh-HK":"zh-HK-HiuMaanNeural","zh-TW":"zh-TW-HsiaoChenNeural","zu-ZA":"zu-ZA-ThandoNeural"},i=this.properties.getProperty(Ir.PropertyId.SpeechServiceConnection_SynthLanguage,"en-US"),n=this.properties.getProperty(Ir.PropertyId.SpeechServiceConnection_SynthVoice,""),s=r.XMLEncode(e);return this.autoDetectSourceLanguage?i="en-US":n=n||t[i],n&&(s=`<voice name='${n}'>${s}</voice>`),s=`<speak version='1.0' xmlns='http://www.w3.org/2001/10/synthesis' xmlns:mstts='http://www.w3.org/2001/mstts' xmlns:emo='http://www.w3.org/2009/10/emotionml' xml:lang='${i}'>${s}</speak>`,s}async dispose(e){this.privDisposed||(e&&this.privAdapter&&await this.privAdapter.dispose(),this.privDisposed=!0)}async adapterSpeak(){if(!this.privDisposed&&!this.privSynthesizing){this.privSynthesizing=!0;let e=await this.synthesisRequestQueue.dequeue();return this.privAdapter.Speak(e.text,e.isSSML,e.requestId,e.cb,e.err,e.dataStream)}}createSynthesizerConfig(e){return new wr.SynthesizerConfig(e,this.privProperties)}implCommonSynthesizeSetup(){let e=typeof window<"u"?"Browser":"Node",t="unknown",i="unknown";typeof navigator<"u"&&(e=e+"/"+navigator.platform,t=navigator.userAgent,i=navigator.appVersion);let n=this.createSynthesizerConfig(new wr.SpeechServiceConfig(new wr.Context(new wr.OS(e,t,i)))),s=this.privProperties.getProperty(Ir.PropertyId.SpeechServiceConnection_Key,void 0),o=s&&s!==""?new wr.CognitiveSubscriptionKeyAuthentication(s):this.tokenCredential?new wr.CognitiveTokenAuthentication(async()=>{try{return(await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(a){throw a}},async()=>{try{return(await this.tokenCredential.getToken("https://cognitiveservices.azure.com/.default"))?.token??""}catch(a){throw a}}):new wr.CognitiveTokenAuthentication(()=>{let a=this.privProperties.getProperty(Ir.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(a)},()=>{let a=this.privProperties.getProperty(Ir.PropertyId.SpeechServiceAuthorization_Token,void 0);return Promise.resolve(a)});this.privAdapter=this.createSynthesisAdapter(o,this.privConnectionFactory,n),this.privRestAdapter=this.createRestSynthesisAdapter(o,n)}static XMLEncode(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")}};Hi.Synthesizer=Bd;var Fd=class{constructor(e,t,i,n,s,o){this.requestId=e,this.text=t,this.isSSML=i,this.cb=n,this.err=s,this.dataStream=o}};Hi.SynthesisRequest=Fd});var RC=u(Cc=>{"use strict";Object.defineProperty(Cc,"__esModule",{value:!0});Cc.SpeechSynthesizer=void 0;var Vd=C(),Ud=P(),Qb=Ql(),Xb=Ai(),Zb=Xr(),PC=I(),_r=f(),Yb=Sc(),Wd=class r extends _r.Synthesizer{constructor(e,t){super(e),t!==null&&(t===void 0?this.audioConfig=typeof window>"u"?void 0:_r.AudioConfig.fromDefaultSpeakerOutput():this.audioConfig=t),this.privConnectionFactory=new Vd.SpeechSynthesisConnectionFactory,this.implCommonSynthesizeSetup()}static FromConfig(e,t,i){let n=e;return t.properties.mergeTo(n.properties),new r(e,i)}speakTextAsync(e,t,i,n){this.speakImpl(e,!1,t,i,n)}speakSsmlAsync(e,t,i,n){this.speakImpl(e,!0,t,i,n)}async getVoicesAsync(e=""){return this.getVoices(e)}close(e,t){PC.Contracts.throwIfDisposed(this.privDisposed),(0,Ud.marshalPromiseToCallbacks)(this.dispose(!0),e,t)}get internalData(){return this.privAdapter}createSynthesisAdapter(e,t,i){return new Vd.SpeechSynthesisAdapter(e,t,i,this,this.audioConfig)}createRestSynthesisAdapter(e,t){return new Vd.SynthesisRestAdapter(t,e)}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=Xb.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(_r.SpeechSynthesisOutputFormat[this.properties.getProperty(_r.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0)])}speakImpl(e,t,i,n,s){try{PC.Contracts.throwIfDisposed(this.privDisposed);let o=(0,Ud.createNoDashGuid)(),a;s instanceof _r.PushAudioOutputStreamCallback?a=new Zb.PushAudioOutputStreamImpl(s):s instanceof _r.PullAudioOutputStream?a=s:s!==void 0?a=new Qb.AudioFileWriter(s):a=void 0,this.synthesisRequestQueue.enqueue(new Yb.SynthesisRequest(o,e,t,c=>{if(this.privSynthesizing=!1,i)try{i(c)}catch(p){n&&n(p)}i=void 0,this.adapterSpeak().catch(()=>{})},c=>{n&&n(c)},a)),this.adapterSpeak().catch(()=>{})}catch(o){if(n)if(o instanceof Error){let a=o;n(a.name+": "+a.message)}else n(o);this.dispose(!0).catch(()=>{})}}async getVoices(e){let t=(0,Ud.createNoDashGuid)(),i=await this.privRestAdapter.getVoicesList(t);if(i.ok&&Array.isArray(i.json)){let n=i.json;return e&&e.length>0&&(n=n.filter(s=>!!s.Locale&&s.Locale.toLowerCase()===e.toLowerCase())),new _r.SynthesisVoicesResult(t,n,void 0)}else return new _r.SynthesisVoicesResult(t,void 0,`Error: ${i.status}: ${i.statusText}`)}};Cc.SpeechSynthesizer=Wd});var EC=u(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.SynthesisResult=void 0;var Hd=class{constructor(e,t,i,n){this.privResultId=e,this.privReason=t,this.privErrorDetails=i,this.privProperties=n}get resultId(){return this.privResultId}get reason(){return this.privReason}get errorDetails(){return this.privErrorDetails}get properties(){return this.privProperties}};Pc.SynthesisResult=Hd});var wC=u(Rc=>{"use strict";Object.defineProperty(Rc,"__esModule",{value:!0});Rc.SpeechSynthesisResult=void 0;var eA=f(),Kd=class extends eA.SynthesisResult{constructor(e,t,i,n,s,o){super(e,t,n,s),this.privAudioData=i,this.privAudioDuration=o}get audioData(){return this.privAudioData}get audioDuration(){return this.privAudioDuration}};Rc.SpeechSynthesisResult=Kd});var IC=u(Ec=>{"use strict";Object.defineProperty(Ec,"__esModule",{value:!0});Ec.SpeechSynthesisEventArgs=void 0;var Jd=class{constructor(e){this.privResult=e}get result(){return this.privResult}};Ec.SpeechSynthesisEventArgs=Jd});var _C=u(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});wc.SpeechSynthesisWordBoundaryEventArgs=void 0;var $d=class{constructor(e,t,i,n,s,o){this.privAudioOffset=e,this.privDuration=t,this.privText=i,this.privWordLength=n,this.privTextOffset=s,this.privBoundaryType=o}get audioOffset(){return this.privAudioOffset}get duration(){return this.privDuration}get text(){return this.privText}get wordLength(){return this.privWordLength}get textOffset(){return this.privTextOffset}get boundaryType(){return this.privBoundaryType}};wc.SpeechSynthesisWordBoundaryEventArgs=$d});var bC=u(Ic=>{"use strict";Object.defineProperty(Ic,"__esModule",{value:!0});Ic.SpeechSynthesisBookmarkEventArgs=void 0;var Gd=class{constructor(e,t){this.privAudioOffset=e,this.privText=t}get audioOffset(){return this.privAudioOffset}get text(){return this.privText}};Ic.SpeechSynthesisBookmarkEventArgs=Gd});var AC=u(_c=>{"use strict";Object.defineProperty(_c,"__esModule",{value:!0});_c.SpeechSynthesisVisemeEventArgs=void 0;var Qd=class{constructor(e,t,i){this.privAudioOffset=e,this.privVisemeId=t,this.privAnimation=i}get audioOffset(){return this.privAudioOffset}get visemeId(){return this.privVisemeId}get animation(){return this.privAnimation}};_c.SpeechSynthesisVisemeEventArgs=Qd});var TC=u(us=>{"use strict";Object.defineProperty(us,"__esModule",{value:!0});us.SpeechSynthesisBoundaryType=void 0;var tA;(function(r){r.Word="WordBoundary",r.Punctuation="PunctuationBoundary",r.Sentence="SentenceBoundary"})(tA=us.SpeechSynthesisBoundaryType||(us.SpeechSynthesisBoundaryType={}))});var OC=u(bc=>{"use strict";Object.defineProperty(bc,"__esModule",{value:!0});bc.SynthesisVoicesResult=void 0;var Ki=f(),Xd=class extends Ki.SynthesisResult{constructor(e,t,i){if(Array.isArray(t)){super(e,Ki.ResultReason.VoicesListRetrieved,void 0,new Ki.PropertyCollection),this.privVoices=[];for(let n of t)this.privVoices.push(new Ki.VoiceInfo(n))}else super(e,Ki.ResultReason.Canceled,i||"Error information unavailable",new Ki.PropertyCollection)}get voices(){return this.privVoices}};bc.SynthesisVoicesResult=Xd});var kC=u(Nt=>{"use strict";Object.defineProperty(Nt,"__esModule",{value:!0});Nt.VoiceInfo=Nt.SynthesisVoiceType=Nt.SynthesisVoiceGender=void 0;var St;(function(r){r[r.Unknown=0]="Unknown",r[r.Female=1]="Female",r[r.Male=2]="Male",r[r.Neutral=3]="Neutral"})(St=Nt.SynthesisVoiceGender||(Nt.SynthesisVoiceGender={}));var Ac;(function(r){r[r.Unknown=0]="Unknown",r[r.OnlineNeural=1]="OnlineNeural",r[r.OnlineStandard=2]="OnlineStandard",r[r.OfflineNeural=3]="OfflineNeural",r[r.OfflineStandard=4]="OfflineStandard",r[r.OnlineNeuralHD=5]="OnlineNeuralHD"})(Ac=Nt.SynthesisVoiceType||(Nt.SynthesisVoiceType={}));var rA={[St[St.Neutral]]:St.Neutral,[St[St.Male]]:St.Male,[St[St.Female]]:St.Female},iA={Neural:Ac.OnlineNeural,NeuralHD:Ac.OnlineNeuralHD},Zd=class{constructor(e){if(this.privStyleList=[],e){if(this.privName=e.Name,this.privLocale=e.Locale,this.privShortName=e.ShortName,this.privLocaleName=e.LocaleName,this.privDisplayName=e.DisplayName,this.privLocalName=e.LocalName,this.privVoiceType=iA[e.VoiceType]||Ac.Unknown,this.privGender=rA[e.Gender]||St.Unknown,e.StyleList&&Array.isArray(e.StyleList))for(let t of e.StyleList)this.privStyleList.push(t);this.privSampleRateHertz=e.SampleRateHertz,this.privStatus=e.Status,e.ExtendedPropertyMap&&(this.privExtendedPropertyMap=e.ExtendedPropertyMap),this.privWordsPerMinute=e.WordsPerMinute,Array.isArray(e.SecondaryLocaleList)&&(this.privSecondaryLocaleList=[...e.SecondaryLocaleList]),Array.isArray(e.RolePlayList)&&(this.privRolePlayList=[...e.RolePlayList]),e.VoiceTag&&(this.privVoiceTag=e.VoiceTag)}}get name(){return this.privName}get locale(){return this.privLocale}get shortName(){return this.privShortName}get displayName(){return this.privDisplayName}get localName(){return this.privLocalName}get localeName(){return this.privLocaleName}get gender(){return this.privGender}get voiceType(){return this.privVoiceType}get styleList(){return this.privStyleList}get sampleRateHertz(){return this.privSampleRateHertz}get status(){return this.privStatus}get extendedPropertyMap(){return this.privExtendedPropertyMap}get wordsPerMinute(){return this.privWordsPerMinute}get secondaryLocaleList(){return this.privSecondaryLocaleList}get rolePlayList(){return this.privRolePlayList}get voiceTag(){return this.privVoiceTag}};Nt.VoiceInfo=Zd});var DC=u(Tc=>{"use strict";Object.defineProperty(Tc,"__esModule",{value:!0});Tc.SpeakerAudioDestination=void 0;var ai=P(),nA=Xr(),Le=gr(),sA=1800,MC={[Le.AudioFormatTag.PCM]:"audio/wav",[Le.AudioFormatTag.MuLaw]:"audio/x-wav",[Le.AudioFormatTag.MP3]:"audio/mpeg",[Le.AudioFormatTag.OGG_OPUS]:"audio/ogg",[Le.AudioFormatTag.WEBM_OPUS]:"audio/webm; codecs=opus",[Le.AudioFormatTag.ALaw]:"audio/x-wav",[Le.AudioFormatTag.FLAC]:"audio/flac",[Le.AudioFormatTag.AMR_WB]:"audio/amr-wb",[Le.AudioFormatTag.G722]:"audio/G722"},Yd=class{constructor(e){this.privPlaybackStarted=!1,this.privAppendingToBuffer=!1,this.privMediaSourceOpened=!1,this.privBytesReceived=0,this.privId=e||(0,ai.createNoDashGuid)(),this.privIsPaused=!1,this.privIsClosed=!1}id(){return this.privId}write(e,t,i){this.privAudioBuffer!==void 0?(this.privAudioBuffer.push(e),this.updateSourceBuffer().then(()=>{t&&t()},n=>{i&&i(n)})):this.privAudioOutputStream!==void 0&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength)}close(e,t){if(this.privIsClosed=!0,this.privSourceBuffer!==void 0)this.handleSourceBufferUpdateEnd().then(()=>{e&&e()},i=>{t&&t(i)});else if(this.privAudioOutputStream!==void 0&&typeof window<"u")if((this.privFormat.formatTag===Le.AudioFormatTag.PCM||this.privFormat.formatTag===Le.AudioFormatTag.MuLaw||this.privFormat.formatTag===Le.AudioFormatTag.ALaw)&&this.privFormat.hasHeader===!1)console.warn("Play back is not supported for raw PCM, mulaw or alaw format without header."),this.onAudioEnd&&this.onAudioEnd(this);else{let i=new ArrayBuffer(this.privBytesReceived);this.privAudioOutputStream.read(i).then(()=>{i=this.privFormat.addHeader(i);let n=new Blob([i],{type:MC[this.privFormat.formatTag]});this.privAudio.src=window.URL.createObjectURL(n),this.notifyPlayback().then(()=>{e&&e()},s=>{t&&t(s)})},n=>{t&&t(n)})}else this.onAudioEnd&&this.onAudioEnd(this)}set format(e){if(typeof AudioContext<"u"||typeof window<"u"&&typeof window.webkitAudioContext<"u"){this.privFormat=e;let t=MC[this.privFormat.formatTag];t===void 0?console.warn(`Unknown mimeType for format ${Le.AudioFormatTag[this.privFormat.formatTag]}; playback is not supported.`):typeof MediaSource<"u"&&MediaSource.isTypeSupported(t)?(this.privAudio=new Audio,this.privAudioBuffer=[],this.privMediaSource=new MediaSource,this.privAudio.src=URL.createObjectURL(this.privMediaSource),this.privAudio.load(),this.privMediaSource.onsourceopen=()=>{this.privMediaSourceOpened=!0,this.privMediaSource.duration=sA,this.privSourceBuffer=this.privMediaSource.addSourceBuffer(t),this.privSourceBuffer.onupdate=()=>{this.updateSourceBuffer().catch(i=>{ai.Events.instance.onEvent(new ai.BackgroundEvent(i))})},this.privSourceBuffer.onupdateend=()=>{this.handleSourceBufferUpdateEnd().catch(i=>{ai.Events.instance.onEvent(new ai.BackgroundEvent(i))})},this.privSourceBuffer.onupdatestart=()=>{this.privAppendingToBuffer=!1}},this.updateSourceBuffer().catch(i=>{ai.Events.instance.onEvent(new ai.BackgroundEvent(i))})):(console.warn(`Format ${Le.AudioFormatTag[this.privFormat.formatTag]} could not be played by MSE, streaming playback is not enabled.`),this.privAudioOutputStream=new nA.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privFormat,this.privAudio=new Audio)}}get volume(){return this.privAudio?.volume??-1}set volume(e){this.privAudio&&(this.privAudio.volume=e)}mute(){this.privAudio&&(this.privAudio.muted=!0)}unmute(){this.privAudio&&(this.privAudio.muted=!1)}get isClosed(){return this.privIsClosed}get currentTime(){return this.privAudio!==void 0?this.privAudio.currentTime:-1}pause(){!this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.pause(),this.privIsPaused=!0)}resume(e,t){this.privIsPaused&&this.privAudio!==void 0&&(this.privAudio.play().then(()=>{e&&e()},i=>{t&&t(i)}),this.privIsPaused=!1)}get internalAudio(){return this.privAudio}async updateSourceBuffer(){if(this.privAudioBuffer!==void 0&&this.privAudioBuffer.length>0&&this.sourceBufferAvailable()){this.privAppendingToBuffer=!0;let e=this.privAudioBuffer.shift();try{this.privSourceBuffer.appendBuffer(e)}catch{this.privAudioBuffer.unshift(e),console.log("buffer filled, pausing addition of binaries until space is made");return}await this.notifyPlayback()}else this.canEndStream()&&await this.handleSourceBufferUpdateEnd()}async handleSourceBufferUpdateEnd(){this.canEndStream()&&this.sourceBufferAvailable()&&(this.privMediaSource.endOfStream(),await this.notifyPlayback())}async notifyPlayback(){!this.privPlaybackStarted&&this.privAudio!==void 0&&(this.privPlaybackStarted=!0,this.onAudioStart&&this.onAudioStart(this),this.privAudio.onended=()=>{this.onAudioEnd&&this.onAudioEnd(this)},this.privIsPaused||await this.privAudio.play())}canEndStream(){return this.isClosed&&this.privSourceBuffer!==void 0&&this.privAudioBuffer.length===0&&this.privMediaSourceOpened&&!this.privAppendingToBuffer&&this.privMediaSource.readyState==="open"}sourceBufferAvailable(){return this.privSourceBuffer!==void 0&&!this.privSourceBuffer.updating}};Tc.SpeakerAudioDestination=Yd});var xC=u(Oc=>{"use strict";Object.defineProperty(Oc,"__esModule",{value:!0});Oc.ConversationTranscriptionCanceledEventArgs=void 0;var oA=Mi(),ev=class extends oA.CancellationEventArgsBase{};Oc.ConversationTranscriptionCanceledEventArgs=ev});var NC=u(kc=>{"use strict";Object.defineProperty(kc,"__esModule",{value:!0});kc.MeetingTranscriptionCanceledEventArgs=void 0;var aA=Mi(),tv=class extends aA.CancellationEventArgsBase{};kc.MeetingTranscriptionCanceledEventArgs=tv});var jC=u(ps=>{"use strict";Object.defineProperty(ps,"__esModule",{value:!0});ps.PronunciationAssessmentGradingSystem=void 0;var cA;(function(r){r[r.FivePoint=1]="FivePoint",r[r.HundredMark=2]="HundredMark"})(cA=ps.PronunciationAssessmentGradingSystem||(ps.PronunciationAssessmentGradingSystem={}))});var qC=u(ls=>{"use strict";Object.defineProperty(ls,"__esModule",{value:!0});ls.PronunciationAssessmentGranularity=void 0;var uA;(function(r){r[r.Phoneme=1]="Phoneme",r[r.Word=2]="Word",r[r.FullText=3]="FullText"})(uA=ls.PronunciationAssessmentGranularity||(ls.PronunciationAssessmentGranularity={}))});var zC=u(Dc=>{"use strict";Object.defineProperty(Dc,"__esModule",{value:!0});Dc.PronunciationAssessmentConfig=void 0;var Mc=I(),X=f(),rv=class r{constructor(e,t=X.PronunciationAssessmentGradingSystem.FivePoint,i=X.PronunciationAssessmentGranularity.Phoneme,n=!1){Mc.Contracts.throwIfNullOrUndefined(e,"referenceText"),this.privProperties=new X.PropertyCollection,this.privProperties.setProperty(X.PropertyId.PronunciationAssessment_ReferenceText,e),this.privProperties.setProperty(X.PropertyId.PronunciationAssessment_GradingSystem,X.PronunciationAssessmentGradingSystem[t]),this.privProperties.setProperty(X.PropertyId.PronunciationAssessment_Granularity,X.PronunciationAssessmentGranularity[i]),this.privProperties.setProperty(X.PropertyId.PronunciationAssessment_EnableMiscue,String(n))}static fromJSON(e){Mc.Contracts.throwIfNullOrUndefined(e,"json");let t=new r("");return t.privProperties=new X.PropertyCollection,t.properties.setProperty(X.PropertyId.PronunciationAssessment_Json,e),t}toJSON(){return this.updateJson(),this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_Params)}applyTo(e){this.updateJson();let t=e.internalData;t.expectContentAssessmentResponse=!!this.privContentAssessmentTopic,t.speechContext.setPronunciationAssessmentParams(this.properties.getProperty(X.PropertyId.PronunciationAssessment_Params),this.privContentAssessmentTopic,t.isSpeakerDiarizationEnabled)}get referenceText(){return this.properties.getProperty(X.PropertyId.PronunciationAssessment_ReferenceText)}set referenceText(e){Mc.Contracts.throwIfNullOrWhitespace(e,"referenceText"),this.properties.setProperty(X.PropertyId.PronunciationAssessment_ReferenceText,e)}set phonemeAlphabet(e){Mc.Contracts.throwIfNullOrWhitespace(e,"phonemeAlphabet"),this.privPhonemeAlphabet=e}set enableMiscue(e){let t=e?"true":"false";this.properties.setProperty(X.PropertyId.PronunciationAssessment_EnableMiscue,t)}get enableMiscue(){return this.properties.getProperty(X.PropertyId.PronunciationAssessment_EnableMiscue,"false").toLowerCase()==="true"}set nbestPhonemeCount(e){this.privNBestPhonemeCount=e}set enableProsodyAssessment(e){this.privEnableProsodyAssessment=e}enableContentAssessmentWithTopic(e){this.privContentAssessmentTopic=e}get properties(){return this.privProperties}updateJson(){let e=this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_Json,"{}"),t=JSON.parse(e),i=this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_ReferenceText);i&&(t.referenceText=i);let n=this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_GradingSystem);n&&(t.gradingSystem=n);let s=this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_Granularity);s&&(t.granularity=s),this.privPhonemeAlphabet&&(t.phonemeAlphabet=this.privPhonemeAlphabet),this.privNBestPhonemeCount&&(t.nbestPhonemeCount=this.privNBestPhonemeCount),t.enableProsodyAssessment=this.privEnableProsodyAssessment,t.dimension="Comprehensive",this.privProperties.getProperty(X.PropertyId.PronunciationAssessment_EnableMiscue)&&(t.enableMiscue=this.enableMiscue),this.privProperties.setProperty(X.PropertyId.PronunciationAssessment_Params,JSON.stringify(t))}};Dc.PronunciationAssessmentConfig=rv});var LC=u(Ji=>{"use strict";Object.defineProperty(Ji,"__esModule",{value:!0});Ji.PronunciationAssessmentResult=Ji.ContentAssessmentResult=void 0;var iv=I(),pA=f(),xc=class{constructor(e){this.privPronJson=e}get grammarScore(){return this.privPronJson.ContentAssessment.GrammarScore}get vocabularyScore(){return this.privPronJson.ContentAssessment.VocabularyScore}get topicScore(){return this.privPronJson.ContentAssessment.TopicScore}};Ji.ContentAssessmentResult=xc;var nv=class r{constructor(e){let t=JSON.parse(e);iv.Contracts.throwIfNullOrUndefined(t.NBest[0],"NBest"),this.privPronJson=t.NBest[0]}static fromResult(e){iv.Contracts.throwIfNullOrUndefined(e,"result");let t=e.properties.getProperty(pA.PropertyId.SpeechServiceResponse_JsonResult);return iv.Contracts.throwIfNullOrUndefined(t,"json"),new r(t)}get detailResult(){return this.privPronJson}get accuracyScore(){return this.detailResult.PronunciationAssessment?.AccuracyScore}get pronunciationScore(){return this.detailResult.PronunciationAssessment?.PronScore}get completenessScore(){return this.detailResult.PronunciationAssessment?.CompletenessScore}get fluencyScore(){return this.detailResult.PronunciationAssessment?.FluencyScore}get prosodyScore(){return this.detailResult.PronunciationAssessment?.ProsodyScore}get contentAssessmentResult(){if(this.detailResult.ContentAssessment!==void 0)return new xc(this.detailResult)}};Ji.PronunciationAssessmentResult=nv});var BC=u(Nc=>{"use strict";Object.defineProperty(Nc,"__esModule",{value:!0});Nc.AvatarConfig=void 0;var lA=I(),hA=f(),sv=class{constructor(e,t,i){this.privCustomized=!1,this.privUseBuiltInVoice=!1,lA.Contracts.throwIfNullOrWhitespace(e,"character"),this.character=e,this.style=t,i===void 0&&(i=new hA.AvatarVideoFormat),this.videoFormat=i}get customized(){return this.privCustomized}set customized(e){this.privCustomized=e}get useBuiltInVoice(){return this.privUseBuiltInVoice}set useBuiltInVoice(e){this.privUseBuiltInVoice=e}get backgroundColor(){return this.privBackgroundColor}set backgroundColor(e){this.privBackgroundColor=e}get backgroundImage(){return this.privBackgroundImage}set backgroundImage(e){this.privBackgroundImage=e}get remoteIceServers(){return this.privRemoteIceServers}set remoteIceServers(e){this.privRemoteIceServers=e}};Nc.AvatarConfig=sv});var FC=u(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.AvatarEventArgs=ci.AvatarEventTypes=void 0;var dA;(function(r){r.SwitchedToSpeaking="SwitchedToSpeaking",r.SwitchedToIdle="SwitchedToIdle",r.SessionClosed="SessionClosed"})(dA=ci.AvatarEventTypes||(ci.AvatarEventTypes={}));var ov=class{constructor(e,t){this.privOffset=e,this.privDescription=t}get type(){return this.privType}get offset(){return this.privOffset}get description(){return this.privDescription}};ci.AvatarEventArgs=ov});var cv=u(qc=>{"use strict";Object.defineProperty(qc,"__esModule",{value:!0});qc.SpeechSynthesisConnectionFactory=void 0;var VC=ue(),hs=f(),UC=tt(),vA=C(),fA=_e(),jc=Yt(),av=class{constructor(){this.synthesisUri="/tts/cognitiveservices/websocket/v1"}async create(e,t,i){let n=e.parameters.getProperty(hs.PropertyId.SpeechServiceConnection_Endpoint,void 0),s=e.parameters.getProperty(hs.PropertyId.SpeechServiceConnection_Region,void 0),o=UC.ConnectionFactoryBase.getHostSuffix(s),a=e.parameters.getProperty(hs.PropertyId.SpeechServiceConnection_EndpointId,void 0),c=a===void 0?"tts":"voice",p=e.parameters.getProperty(hs.PropertyId.SpeechServiceConnection_Host,"wss://"+s+"."+c+".speech"+o),h={},d={};if(t.token!==void 0&&t.token!==""&&(d[t.headerName]=t.token),d[fA.HeaderNames.ConnectionId]=i,a!==void 0&&a!==""&&(!n||n.search(jc.QueryParameterNames.CustomVoiceDeploymentId)===-1)&&(h[jc.QueryParameterNames.CustomVoiceDeploymentId]=a),e.avatarEnabled&&(!n||n.search(jc.QueryParameterNames.EnableAvatar)===-1)&&(h[jc.QueryParameterNames.EnableAvatar]="true"),n){let g=new URL(n),M=g.pathname;(M===""||M==="/")&&(g.pathname=this.synthesisUri,n=await UC.ConnectionFactoryBase.getRedirectUrlFromEndpoint(g.toString()))}n||(n=p+this.synthesisUri),e.parameters.setProperty(hs.PropertyId.SpeechServiceConnection_Url,n);let v=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new VC.WebsocketConnection(n,h,d,new vA.WebsocketMessageFormatter,VC.ProxyInfo.fromParameters(e.parameters),v,i)}};qc.SpeechSynthesisConnectionFactory=av});var WC=u(Lc=>{"use strict";Object.defineProperty(Lc,"__esModule",{value:!0});Lc.AvatarSynthesizer=void 0;var gA=cv(),mA=C(),te=P(),yA=Ai(),tr=f(),zc=I(),SA=Sc(),uv=class extends tr.Synthesizer{constructor(e,t){super(e),zc.Contracts.throwIfNullOrUndefined(t,"avatarConfig"),this.privConnectionFactory=new gA.SpeechSynthesisConnectionFactory,this.privAvatarConfig=t,this.implCommonSynthesizeSetup()}implCommonSynthesizeSetup(){super.implCommonSynthesizeSetup(),this.privAdapter.audioOutputFormat=yA.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormat(tr.SpeechSynthesisOutputFormat.Riff24Khz16BitMonoPcm)}async startAvatarAsync(e){zc.Contracts.throwIfNullOrUndefined(e,"peerConnection"),this.privIceServers=e.getConfiguration().iceServers,zc.Contracts.throwIfNullOrUndefined(this.privIceServers,"Ice servers must be set.");let t=new te.Deferred;e.onicegatheringstatechange=()=>{te.Events.instance.onEvent(new te.PlatformEvent("peer connection: ice gathering state: "+e.iceGatheringState,te.EventType.Debug)),e.iceGatheringState==="complete"&&(te.Events.instance.onEvent(new te.PlatformEvent("peer connection: ice gathering complete.",te.EventType.Info)),t.resolve())},e.onicecandidate=a=>{a.candidate?te.Events.instance.onEvent(new te.PlatformEvent("peer connection: ice candidate: "+a.candidate.candidate,te.EventType.Debug)):(te.Events.instance.onEvent(new te.PlatformEvent("peer connection: ice candidate: complete",te.EventType.Debug)),t.resolve())},setTimeout(()=>{e.iceGatheringState!=="complete"&&(te.Events.instance.onEvent(new te.PlatformEvent("peer connection: ice gathering timeout.",te.EventType.Warning)),t.resolve())},2e3);let i=await e.createOffer();await e.setLocalDescription(i),await t.promise,te.Events.instance.onEvent(new te.PlatformEvent("peer connection: got local SDP.",te.EventType.Info)),this.privProperties.setProperty(tr.PropertyId.TalkingAvatarService_WebRTC_SDP,JSON.stringify(e.localDescription));let n=await this.speak("",!1);if(n.reason!==tr.ResultReason.SynthesizingAudioCompleted)return new tr.SynthesisResult(n.resultId,n.reason,n.errorDetails,n.properties);let s=atob(n.properties.getProperty(tr.PropertyId.TalkingAvatarService_WebRTC_SDP)),o=new RTCSessionDescription(JSON.parse(s));return await e.setRemoteDescription(o),new tr.SynthesisResult(n.resultId,n.reason,void 0,n.properties)}async speakTextAsync(e){let t=await this.speak(e,!1);return new tr.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}async speakSsmlAsync(e){let t=await this.speak(e,!0);return new tr.SynthesisResult(t.resultId,t.reason,t.errorDetails,t.properties)}async stopSpeakingAsync(){for(;this.synthesisRequestQueue.length()>0;)(await this.synthesisRequestQueue.dequeue()).err("Synthesis is canceled by user.");return this.privAdapter.stopSpeaking()}async stopAvatarAsync(){return zc.Contracts.throwIfDisposed(this.privDisposed),this.dispose(!0)}async close(){if(!this.privDisposed)return this.dispose(!0)}get iceServers(){return this.privIceServers}createSynthesisAdapter(e,t,i){return new mA.AvatarSynthesisAdapter(e,t,i,this,this.privAvatarConfig)}createRestSynthesisAdapter(e,t){}createSynthesizerConfig(e){let t=super.createSynthesizerConfig(e);return t.avatarEnabled=!0,t}async speak(e,t){let i=(0,te.createNoDashGuid)(),n=new te.Deferred;return this.synthesisRequestQueue.enqueue(new SA.SynthesisRequest(i,e,t,s=>{n.resolve(s),this.privSynthesizing=!1,this.adapterSpeak()},s=>{n.reject(s),this.privSynthesizing=!1})),this.adapterSpeak(),n.promise}};Lc.AvatarSynthesizer=uv});var HC=u($i=>{"use strict";Object.defineProperty($i,"__esModule",{value:!0});$i.AvatarVideoFormat=$i.Coordinate=void 0;var pv=class{constructor(e,t){this.x=e,this.y=t}};$i.Coordinate=pv;var lv=class{constructor(e="H264",t=2e6,i=1920,n=1080){this.codec=e,this.bitrate=t,this.width=i,this.height=n}setCropRange(e,t){this.cropRange={bottomRight:t,topLeft:e}}};$i.AvatarVideoFormat=lv});var KC=u(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});Bc.AvatarWebRTCConnectionResult=void 0;var CA=f(),hv=class extends CA.SynthesisResult{constructor(e,t,i,n,s){super(t,i,n,s),this.privSDPAnswer=e}get SDPAnswer(){return this.privSDPAnswer}};Bc.AvatarWebRTCConnectionResult=hv});var JC=u(Vc=>{"use strict";Object.defineProperty(Vc,"__esModule",{value:!0});Vc.Diagnostics=void 0;var PA=ue(),RA=P(),Fc=class{static SetLoggingLevel(e){this.privListener=new PA.ConsoleLoggingListener(e),RA.Events.instance.attachConsoleListener(this.privListener)}static StartConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!0)}static StopConsoleOutput(){this.privListener&&(this.privListener.enableConsoleOutput=!1)}static SetLogOutputPath(e){if(typeof window>"u")this.privListener&&(this.privListener.logPath=e);else throw new Error("File system logging not available in browser.")}static set onLogOutput(e){this.privListener&&(this.privListener.logCallback=e)}};Vc.Diagnostics=Fc;Fc.privListener=void 0});var f=u(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.ConnectionEventArgs=l.CancellationErrorCode=l.CancellationDetails=l.CancellationDetailsBase=l.IntentRecognitionCanceledEventArgs=l.TranslationRecognitionCanceledEventArgs=l.NoMatchDetails=l.NoMatchReason=l.Translations=l.TranslationRecognizer=l.VoiceProfileType=l.IntentRecognizer=l.SpeechRecognizer=l.Recognizer=l.PropertyId=l.PropertyCollection=l.SpeechTranslationConfigImpl=l.SpeechTranslationConfig=l.SpeechConfigImpl=l.SpeechConfig=l.ResultReason=l.TranslationSynthesisResult=l.TranslationRecognitionResult=l.TranslationSynthesisEventArgs=l.TranslationRecognitionEventArgs=l.SpeechRecognitionCanceledEventArgs=l.MeetingTranscriptionEventArgs=l.ConversationTranscriptionEventArgs=l.SpeechRecognitionEventArgs=l.LanguageUnderstandingModel=l.IntentRecognitionResult=l.SpeechRecognitionResult=l.RecognitionResult=l.IntentRecognitionEventArgs=l.OutputFormat=l.RecognitionEventArgs=l.SessionEventArgs=l.KeywordRecognitionModel=l.PushAudioOutputStreamCallback=l.PullAudioInputStreamCallback=l.CancellationReason=l.PushAudioOutputStream=l.PullAudioOutputStream=l.AudioOutputStream=l.PushAudioInputStream=l.PullAudioInputStream=l.AudioInputStream=l.AudioFormatTag=l.AudioStreamFormat=l.AudioConfig=void 0;l.SpeechSynthesisEventArgs=l.SpeechSynthesisResult=l.SynthesisResult=l.SpeechSynthesizer=l.SpeechSynthesisOutputFormat=l.Synthesizer=l.User=l.ParticipantChangedReason=l.Participant=l.MeetingTranscriber=l.Meeting=l.ConversationTranscriptionResult=l.ConversationTranscriber=l.ConversationTranslator=l.ConversationTranslationResult=l.ConversationTranslationEventArgs=l.ConversationTranslationCanceledEventArgs=l.ConversationParticipantsChangedEventArgs=l.ConversationExpirationEventArgs=l.Conversation=l.SpeakerRecognitionCancellationDetails=l.SpeakerRecognitionResultType=l.SpeakerRecognitionResult=l.SourceLanguageConfig=l.AutoDetectSourceLanguageResult=l.AutoDetectSourceLanguageConfig=l.SpeakerVerificationModel=l.SpeakerIdentificationModel=l.SpeakerRecognizer=l.VoiceProfileClient=l.VoiceProfilePhraseResult=l.VoiceProfileCancellationDetails=l.VoiceProfileResult=l.VoiceProfileEnrollmentCancellationDetails=l.VoiceProfileEnrollmentResult=l.VoiceProfile=l.ConnectionMessage=l.ConnectionMessageEventArgs=l.BaseAudioPlayer=l.ProfanityOption=l.ServicePropertyChannel=l.TurnStatusReceivedEventArgs=l.ActivityReceivedEventArgs=l.DialogServiceConnector=l.CustomCommandsConfig=l.BotFrameworkConfig=l.DialogServiceConfig=l.PhraseListGrammar=l.Connection=l.ServiceEventArgs=void 0;l.LogLevel=l.Diagnostics=l.AvatarWebRTCConnectionResult=l.Coordinate=l.AvatarVideoFormat=l.AvatarSynthesizer=l.AvatarEventArgs=l.AvatarConfig=l.LanguageIdMode=l.PronunciationAssessmentResult=l.PronunciationAssessmentConfig=l.PronunciationAssessmentGranularity=l.PronunciationAssessmentGradingSystem=l.MeetingTranscriptionCanceledEventArgs=l.ConversationTranscriptionCanceledEventArgs=l.SpeakerAudioDestination=l.VoiceInfo=l.SynthesisVoiceType=l.SynthesisVoiceGender=l.SynthesisVoicesResult=l.SpeechSynthesisBoundaryType=l.SpeechSynthesisVisemeEventArgs=l.SpeechSynthesisBookmarkEventArgs=l.SpeechSynthesisWordBoundaryEventArgs=void 0;var EA=eh();Object.defineProperty(l,"AudioConfig",{enumerable:!0,get:function(){return EA.AudioConfig}});var $C=gr();Object.defineProperty(l,"AudioStreamFormat",{enumerable:!0,get:function(){return $C.AudioStreamFormat}});Object.defineProperty(l,"AudioFormatTag",{enumerable:!0,get:function(){return $C.AudioFormatTag}});var dv=Xl();Object.defineProperty(l,"AudioInputStream",{enumerable:!0,get:function(){return dv.AudioInputStream}});Object.defineProperty(l,"PullAudioInputStream",{enumerable:!0,get:function(){return dv.PullAudioInputStream}});Object.defineProperty(l,"PushAudioInputStream",{enumerable:!0,get:function(){return dv.PushAudioInputStream}});var vv=Xr();Object.defineProperty(l,"AudioOutputStream",{enumerable:!0,get:function(){return vv.AudioOutputStream}});Object.defineProperty(l,"PullAudioOutputStream",{enumerable:!0,get:function(){return vv.PullAudioOutputStream}});Object.defineProperty(l,"PushAudioOutputStream",{enumerable:!0,get:function(){return vv.PushAudioOutputStream}});var wA=Oy();Object.defineProperty(l,"CancellationReason",{enumerable:!0,get:function(){return wA.CancellationReason}});var IA=ky();Object.defineProperty(l,"PullAudioInputStreamCallback",{enumerable:!0,get:function(){return IA.PullAudioInputStreamCallback}});var _A=My();Object.defineProperty(l,"PushAudioOutputStreamCallback",{enumerable:!0,get:function(){return _A.PushAudioOutputStreamCallback}});var bA=xy();Object.defineProperty(l,"KeywordRecognitionModel",{enumerable:!0,get:function(){return bA.KeywordRecognitionModel}});var AA=Ny();Object.defineProperty(l,"SessionEventArgs",{enumerable:!0,get:function(){return AA.SessionEventArgs}});var TA=jy();Object.defineProperty(l,"RecognitionEventArgs",{enumerable:!0,get:function(){return TA.RecognitionEventArgs}});var OA=qy();Object.defineProperty(l,"OutputFormat",{enumerable:!0,get:function(){return OA.OutputFormat}});var kA=zy();Object.defineProperty(l,"IntentRecognitionEventArgs",{enumerable:!0,get:function(){return kA.IntentRecognitionEventArgs}});var MA=Ly();Object.defineProperty(l,"RecognitionResult",{enumerable:!0,get:function(){return MA.RecognitionResult}});var DA=By();Object.defineProperty(l,"SpeechRecognitionResult",{enumerable:!0,get:function(){return DA.SpeechRecognitionResult}});var xA=Fy();Object.defineProperty(l,"IntentRecognitionResult",{enumerable:!0,get:function(){return xA.IntentRecognitionResult}});var NA=Vy();Object.defineProperty(l,"LanguageUnderstandingModel",{enumerable:!0,get:function(){return NA.LanguageUnderstandingModel}});var fv=Wy();Object.defineProperty(l,"SpeechRecognitionEventArgs",{enumerable:!0,get:function(){return fv.SpeechRecognitionEventArgs}});Object.defineProperty(l,"ConversationTranscriptionEventArgs",{enumerable:!0,get:function(){return fv.ConversationTranscriptionEventArgs}});Object.defineProperty(l,"MeetingTranscriptionEventArgs",{enumerable:!0,get:function(){return fv.MeetingTranscriptionEventArgs}});var jA=Hy();Object.defineProperty(l,"SpeechRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return jA.SpeechRecognitionCanceledEventArgs}});var qA=Ky();Object.defineProperty(l,"TranslationRecognitionEventArgs",{enumerable:!0,get:function(){return qA.TranslationRecognitionEventArgs}});var zA=Jy();Object.defineProperty(l,"TranslationSynthesisEventArgs",{enumerable:!0,get:function(){return zA.TranslationSynthesisEventArgs}});var LA=mh();Object.defineProperty(l,"TranslationRecognitionResult",{enumerable:!0,get:function(){return LA.TranslationRecognitionResult}});var BA=$y();Object.defineProperty(l,"TranslationSynthesisResult",{enumerable:!0,get:function(){return BA.TranslationSynthesisResult}});var FA=Gy();Object.defineProperty(l,"ResultReason",{enumerable:!0,get:function(){return FA.ResultReason}});var GC=Qy();Object.defineProperty(l,"SpeechConfig",{enumerable:!0,get:function(){return GC.SpeechConfig}});Object.defineProperty(l,"SpeechConfigImpl",{enumerable:!0,get:function(){return GC.SpeechConfigImpl}});var QC=Xy();Object.defineProperty(l,"SpeechTranslationConfig",{enumerable:!0,get:function(){return QC.SpeechTranslationConfig}});Object.defineProperty(l,"SpeechTranslationConfigImpl",{enumerable:!0,get:function(){return QC.SpeechTranslationConfigImpl}});var VA=Ch();Object.defineProperty(l,"PropertyCollection",{enumerable:!0,get:function(){return VA.PropertyCollection}});var UA=ia();Object.defineProperty(l,"PropertyId",{enumerable:!0,get:function(){return UA.PropertyId}});var WA=eS();Object.defineProperty(l,"Recognizer",{enumerable:!0,get:function(){return WA.Recognizer}});var HA=tS();Object.defineProperty(l,"SpeechRecognizer",{enumerable:!0,get:function(){return HA.SpeechRecognizer}});var KA=iS();Object.defineProperty(l,"IntentRecognizer",{enumerable:!0,get:function(){return KA.IntentRecognizer}});var JA=nS();Object.defineProperty(l,"VoiceProfileType",{enumerable:!0,get:function(){return JA.VoiceProfileType}});var $A=uS();Object.defineProperty(l,"TranslationRecognizer",{enumerable:!0,get:function(){return $A.TranslationRecognizer}});var GA=pS();Object.defineProperty(l,"Translations",{enumerable:!0,get:function(){return GA.Translations}});var QA=lS();Object.defineProperty(l,"NoMatchReason",{enumerable:!0,get:function(){return QA.NoMatchReason}});var XA=hS();Object.defineProperty(l,"NoMatchDetails",{enumerable:!0,get:function(){return XA.NoMatchDetails}});var ZA=dS();Object.defineProperty(l,"TranslationRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return ZA.TranslationRecognitionCanceledEventArgs}});var YA=vS();Object.defineProperty(l,"IntentRecognitionCanceledEventArgs",{enumerable:!0,get:function(){return YA.IntentRecognitionCanceledEventArgs}});var eT=Lh();Object.defineProperty(l,"CancellationDetailsBase",{enumerable:!0,get:function(){return eT.CancellationDetailsBase}});var tT=fS();Object.defineProperty(l,"CancellationDetails",{enumerable:!0,get:function(){return tT.CancellationDetails}});var rT=gS();Object.defineProperty(l,"CancellationErrorCode",{enumerable:!0,get:function(){return rT.CancellationErrorCode}});var iT=mS();Object.defineProperty(l,"ConnectionEventArgs",{enumerable:!0,get:function(){return iT.ConnectionEventArgs}});var nT=yS();Object.defineProperty(l,"ServiceEventArgs",{enumerable:!0,get:function(){return nT.ServiceEventArgs}});var sT=kh();Object.defineProperty(l,"Connection",{enumerable:!0,get:function(){return sT.Connection}});var oT=SS();Object.defineProperty(l,"PhraseListGrammar",{enumerable:!0,get:function(){return oT.PhraseListGrammar}});var aT=ba();Object.defineProperty(l,"DialogServiceConfig",{enumerable:!0,get:function(){return aT.DialogServiceConfig}});var cT=CS();Object.defineProperty(l,"BotFrameworkConfig",{enumerable:!0,get:function(){return cT.BotFrameworkConfig}});var uT=PS();Object.defineProperty(l,"CustomCommandsConfig",{enumerable:!0,get:function(){return uT.CustomCommandsConfig}});var pT=bS();Object.defineProperty(l,"DialogServiceConnector",{enumerable:!0,get:function(){return pT.DialogServiceConnector}});var lT=AS();Object.defineProperty(l,"ActivityReceivedEventArgs",{enumerable:!0,get:function(){return lT.ActivityReceivedEventArgs}});var hT=OS();Object.defineProperty(l,"TurnStatusReceivedEventArgs",{enumerable:!0,get:function(){return hT.TurnStatusReceivedEventArgs}});var dT=kS();Object.defineProperty(l,"ServicePropertyChannel",{enumerable:!0,get:function(){return dT.ServicePropertyChannel}});var vT=MS();Object.defineProperty(l,"ProfanityOption",{enumerable:!0,get:function(){return vT.ProfanityOption}});var fT=DS();Object.defineProperty(l,"BaseAudioPlayer",{enumerable:!0,get:function(){return fT.BaseAudioPlayer}});var gT=xS();Object.defineProperty(l,"ConnectionMessageEventArgs",{enumerable:!0,get:function(){return gT.ConnectionMessageEventArgs}});var mT=bh();Object.defineProperty(l,"ConnectionMessage",{enumerable:!0,get:function(){return mT.ConnectionMessage}});var yT=NS();Object.defineProperty(l,"VoiceProfile",{enumerable:!0,get:function(){return yT.VoiceProfile}});var XC=qS();Object.defineProperty(l,"VoiceProfileEnrollmentResult",{enumerable:!0,get:function(){return XC.VoiceProfileEnrollmentResult}});Object.defineProperty(l,"VoiceProfileEnrollmentCancellationDetails",{enumerable:!0,get:function(){return XC.VoiceProfileEnrollmentCancellationDetails}});var ZC=LS();Object.defineProperty(l,"VoiceProfileResult",{enumerable:!0,get:function(){return ZC.VoiceProfileResult}});Object.defineProperty(l,"VoiceProfileCancellationDetails",{enumerable:!0,get:function(){return ZC.VoiceProfileCancellationDetails}});var ST=BS();Object.defineProperty(l,"VoiceProfilePhraseResult",{enumerable:!0,get:function(){return ST.VoiceProfilePhraseResult}});var CT=FS();Object.defineProperty(l,"VoiceProfileClient",{enumerable:!0,get:function(){return CT.VoiceProfileClient}});var PT=VS();Object.defineProperty(l,"SpeakerRecognizer",{enumerable:!0,get:function(){return PT.SpeakerRecognizer}});var RT=US();Object.defineProperty(l,"SpeakerIdentificationModel",{enumerable:!0,get:function(){return RT.SpeakerIdentificationModel}});var ET=HS();Object.defineProperty(l,"SpeakerVerificationModel",{enumerable:!0,get:function(){return ET.SpeakerVerificationModel}});var wT=JS();Object.defineProperty(l,"AutoDetectSourceLanguageConfig",{enumerable:!0,get:function(){return wT.AutoDetectSourceLanguageConfig}});var IT=GS();Object.defineProperty(l,"AutoDetectSourceLanguageResult",{enumerable:!0,get:function(){return IT.AutoDetectSourceLanguageResult}});var _T=QS();Object.defineProperty(l,"SourceLanguageConfig",{enumerable:!0,get:function(){return _T.SourceLanguageConfig}});var gv=ZS();Object.defineProperty(l,"SpeakerRecognitionResult",{enumerable:!0,get:function(){return gv.SpeakerRecognitionResult}});Object.defineProperty(l,"SpeakerRecognitionResultType",{enumerable:!0,get:function(){return gv.SpeakerRecognitionResultType}});Object.defineProperty(l,"SpeakerRecognitionCancellationDetails",{enumerable:!0,get:function(){return gv.SpeakerRecognitionCancellationDetails}});var Be=lc();Object.defineProperty(l,"Conversation",{enumerable:!0,get:function(){return Be.Conversation}});Object.defineProperty(l,"ConversationExpirationEventArgs",{enumerable:!0,get:function(){return Be.ConversationExpirationEventArgs}});Object.defineProperty(l,"ConversationParticipantsChangedEventArgs",{enumerable:!0,get:function(){return Be.ConversationParticipantsChangedEventArgs}});Object.defineProperty(l,"ConversationTranslationCanceledEventArgs",{enumerable:!0,get:function(){return Be.ConversationTranslationCanceledEventArgs}});Object.defineProperty(l,"ConversationTranslationEventArgs",{enumerable:!0,get:function(){return Be.ConversationTranslationEventArgs}});Object.defineProperty(l,"ConversationTranslationResult",{enumerable:!0,get:function(){return Be.ConversationTranslationResult}});Object.defineProperty(l,"ConversationTranslator",{enumerable:!0,get:function(){return Be.ConversationTranslator}});Object.defineProperty(l,"ConversationTranscriber",{enumerable:!0,get:function(){return Be.ConversationTranscriber}});Object.defineProperty(l,"ConversationTranscriptionResult",{enumerable:!0,get:function(){return Be.ConversationTranscriptionResult}});Object.defineProperty(l,"Meeting",{enumerable:!0,get:function(){return Be.Meeting}});Object.defineProperty(l,"MeetingTranscriber",{enumerable:!0,get:function(){return Be.MeetingTranscriber}});Object.defineProperty(l,"Participant",{enumerable:!0,get:function(){return Be.Participant}});Object.defineProperty(l,"ParticipantChangedReason",{enumerable:!0,get:function(){return Be.ParticipantChangedReason}});Object.defineProperty(l,"User",{enumerable:!0,get:function(){return Be.User}});var bT=Sc();Object.defineProperty(l,"Synthesizer",{enumerable:!0,get:function(){return bT.Synthesizer}});var AT=Zl();Object.defineProperty(l,"SpeechSynthesisOutputFormat",{enumerable:!0,get:function(){return AT.SpeechSynthesisOutputFormat}});var TT=RC();Object.defineProperty(l,"SpeechSynthesizer",{enumerable:!0,get:function(){return TT.SpeechSynthesizer}});var OT=EC();Object.defineProperty(l,"SynthesisResult",{enumerable:!0,get:function(){return OT.SynthesisResult}});var kT=wC();Object.defineProperty(l,"SpeechSynthesisResult",{enumerable:!0,get:function(){return kT.SpeechSynthesisResult}});var MT=IC();Object.defineProperty(l,"SpeechSynthesisEventArgs",{enumerable:!0,get:function(){return MT.SpeechSynthesisEventArgs}});var DT=_C();Object.defineProperty(l,"SpeechSynthesisWordBoundaryEventArgs",{enumerable:!0,get:function(){return DT.SpeechSynthesisWordBoundaryEventArgs}});var xT=bC();Object.defineProperty(l,"SpeechSynthesisBookmarkEventArgs",{enumerable:!0,get:function(){return xT.SpeechSynthesisBookmarkEventArgs}});var NT=AC();Object.defineProperty(l,"SpeechSynthesisVisemeEventArgs",{enumerable:!0,get:function(){return NT.SpeechSynthesisVisemeEventArgs}});var jT=TC();Object.defineProperty(l,"SpeechSynthesisBoundaryType",{enumerable:!0,get:function(){return jT.SpeechSynthesisBoundaryType}});var qT=OC();Object.defineProperty(l,"SynthesisVoicesResult",{enumerable:!0,get:function(){return qT.SynthesisVoicesResult}});var mv=kC();Object.defineProperty(l,"SynthesisVoiceGender",{enumerable:!0,get:function(){return mv.SynthesisVoiceGender}});Object.defineProperty(l,"SynthesisVoiceType",{enumerable:!0,get:function(){return mv.SynthesisVoiceType}});Object.defineProperty(l,"VoiceInfo",{enumerable:!0,get:function(){return mv.VoiceInfo}});var zT=DC();Object.defineProperty(l,"SpeakerAudioDestination",{enumerable:!0,get:function(){return zT.SpeakerAudioDestination}});var LT=xC();Object.defineProperty(l,"ConversationTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return LT.ConversationTranscriptionCanceledEventArgs}});var BT=NC();Object.defineProperty(l,"MeetingTranscriptionCanceledEventArgs",{enumerable:!0,get:function(){return BT.MeetingTranscriptionCanceledEventArgs}});var FT=jC();Object.defineProperty(l,"PronunciationAssessmentGradingSystem",{enumerable:!0,get:function(){return FT.PronunciationAssessmentGradingSystem}});var VT=qC();Object.defineProperty(l,"PronunciationAssessmentGranularity",{enumerable:!0,get:function(){return VT.PronunciationAssessmentGranularity}});var UT=zC();Object.defineProperty(l,"PronunciationAssessmentConfig",{enumerable:!0,get:function(){return UT.PronunciationAssessmentConfig}});var WT=LC();Object.defineProperty(l,"PronunciationAssessmentResult",{enumerable:!0,get:function(){return WT.PronunciationAssessmentResult}});var HT=dd();Object.defineProperty(l,"LanguageIdMode",{enumerable:!0,get:function(){return HT.LanguageIdMode}});var KT=BC();Object.defineProperty(l,"AvatarConfig",{enumerable:!0,get:function(){return KT.AvatarConfig}});var JT=FC();Object.defineProperty(l,"AvatarEventArgs",{enumerable:!0,get:function(){return JT.AvatarEventArgs}});var $T=WC();Object.defineProperty(l,"AvatarSynthesizer",{enumerable:!0,get:function(){return $T.AvatarSynthesizer}});var YC=HC();Object.defineProperty(l,"AvatarVideoFormat",{enumerable:!0,get:function(){return YC.AvatarVideoFormat}});Object.defineProperty(l,"Coordinate",{enumerable:!0,get:function(){return YC.Coordinate}});var GT=KC();Object.defineProperty(l,"AvatarWebRTCConnectionResult",{enumerable:!0,get:function(){return GT.AvatarWebRTCConnectionResult}});var QT=JC();Object.defineProperty(l,"Diagnostics",{enumerable:!0,get:function(){return QT.Diagnostics}});var XT=ql();Object.defineProperty(l,"LogLevel",{enumerable:!0,get:function(){return XT.LogLevel}})});var eP=u(Wc=>{"use strict";Object.defineProperty(Wc,"__esModule",{value:!0});Wc.ProxyInfo=void 0;var Uc=f(),yv=class r{constructor(e,t,i,n){this.privProxyHostName=e,this.privProxyPort=t,this.privProxyUserName=i,this.privProxyPassword=n}static fromParameters(e){return new r(e.getProperty(Uc.PropertyId.SpeechServiceConnection_ProxyHostName),parseInt(e.getProperty(Uc.PropertyId.SpeechServiceConnection_ProxyPort),10),e.getProperty(Uc.PropertyId.SpeechServiceConnection_ProxyUserName),e.getProperty(Uc.PropertyId.SpeechServiceConnection_ProxyPassword))}static fromRecognizerConfig(e){return this.fromParameters(e.parameters)}get HostName(){return this.privProxyHostName}get Port(){return this.privProxyPort}get UserName(){return this.privProxyUserName}get Password(){return this.privProxyPassword}};Wc.ProxyInfo=yv});var rP=u((L1,tP)=>{"use strict";var ZT=new Set(["json","buffer","string"]);tP.exports=r=>(...e)=>{let t=new Set,i,n,s,o="";return e.forEach(a=>{if(typeof a=="string")if(a.toUpperCase()===a)if(i){let c=`Can't set method to ${a}, already set to ${i}.`;throw new Error(c)}else i=a;else if(a.startsWith("http:")||a.startsWith("https:"))o=a;else if(ZT.has(a))n=a;else throw new Error(`Unknown encoding, ${a}`);else if(typeof a=="number")t.add(a);else if(typeof a=="object")if(Array.isArray(a)||a instanceof Set)a.forEach(c=>t.add(c));else{if(s)throw new Error("Cannot set headers twice.");s=a}else throw new Error(`Unknown type: ${typeof a}`)}),i||(i="GET"),t.size===0&&t.add(200),r(t,i,n,s,o)}});var nP=u((B1,iP)=>{"use strict";var YT=rP(),Sv=class r extends Error{constructor(e,...t){super(...t),Error.captureStackTrace&&Error.captureStackTrace(this,r),this.name="StatusError",this.message=e.statusMessage,this.statusCode=e.status,this.res=e,this.json=e.json.bind(e),this.text=e.text.bind(e),this.arrayBuffer=e.arrayBuffer.bind(e);let i;Object.defineProperty(this,"responseBody",{get:()=>(i||(i=this.arrayBuffer()),i)}),this.headers={};for(let[s,o]of e.headers.entries())this.headers[s.toLowerCase()]=o}},eO=(r,e,t,i,n)=>async(s,o,a={})=>{s=n+(s||"");let c=new URL(s);if(i||(i={}),c.username&&(i.Authorization="Basic "+btoa(c.username+":"+c.password),c=new URL(c.protocol+"//"+c.host+c.pathname+c.search)),c.protocol!=="https:"&&c.protocol!=="http:")throw new Error(`Unknown protocol, ${c.protocol}`);if(o&&!(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="string"))if(typeof o=="object")o=JSON.stringify(o),i["Content-Type"]="application/json";else throw new Error("Unknown body type.");a=new Headers({...i||{},...a});let p=await fetch(c,{method:e,headers:a,body:o});if(p.statusCode=p.status,!r.has(p.status))throw new Sv(p);return t==="json"?p.json():t==="buffer"?p.arrayBuffer():t==="string"?p.text():p};iP.exports=YT(eO)});var oP=u(rr=>{"use strict";var tO=rr&&rr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(rr,"__esModule",{value:!0});rr.RestMessageAdapter=rr.RestRequestType=void 0;var rO=tO(nP()),sP=P(),Hc;(function(r){r.Get="GET",r.Post="POST",r.Delete="DELETE",r.File="file"})(Hc=rr.RestRequestType||(rr.RestRequestType={}));var Cv=class{constructor(e){if(!e)throw new sP.ArgumentNullError("configParams");this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}static extractHeaderValue(e,t){let i="";try{let n=t.trim().split(/[\r\n]+/),s={};n.forEach(o=>{let a=o.split(": "),c=a.shift().toLowerCase(),p=a.join(": ");s[c]=p}),i=s[e.toLowerCase()]}catch{}return i}set options(e){this.privHeaders=e.headers,this.privIgnoreCache=e.ignoreCache}setHeaders(e,t){this.privHeaders[e]=t}request(e,t,i={},n=null){let s=new sP.Deferred,o=e===Hc.File?"POST":e,a=(p,h={})=>{let d=p;return{data:JSON.stringify(h),headers:JSON.stringify(p.headers),json:h,ok:p.statusCode>=200&&p.statusCode<300,status:p.statusCode,statusText:h.error?h.error.message:d.statusText?d.statusText:d.statusMessage}},c=p=>{let h=(0,rO.default)(t,o,this.privHeaders,200,201,202,204,400,401,402,403,404),d=this.queryParams(i)===""?"":`?${this.queryParams(i)}`;h(d,p).then(async v=>{if(e===Hc.Delete||v.statusCode===204)s.resolve(a(v));else try{let g=await v.json();s.resolve(a(v,g))}catch{s.resolve(a(v))}}).catch(v=>{s.reject(v)})};return this.privIgnoreCache&&(this.privHeaders["Cache-Control"]="no-cache"),e===Hc.Post&&n&&(this.privHeaders["content-type"]="application/json",this.privHeaders["Content-Type"]="application/json"),c(n),s.promise}queryParams(e={}){return Object.keys(e).map(t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t])).join("&")}};rr.RestMessageAdapter=Cv});var Pv=u(Kc=>{"use strict";Object.defineProperty(Kc,"__esModule",{value:!0});Kc.RestConfigBase=void 0;var Gi=class r{static get requestOptions(){return r.privDefaultRequestOptions}static get configParams(){return r.privDefaultParams}static get restErrors(){return r.privRestErrors}};Kc.RestConfigBase=Gi;Gi.privDefaultRequestOptions={headers:{Accept:"application/json"},ignoreCache:!1,timeout:1e4};Gi.privRestErrors={authInvalidSubscriptionKey:"You must specify either an authentication token to use, or a Cognitive Speech subscription key.",authInvalidSubscriptionRegion:"You must specify the Cognitive Speech region to use.",invalidArgs:"Required input not found: {arg}.",invalidCreateJoinConversationResponse:"Creating/Joining conversation failed with HTTP {status}.",invalidParticipantRequest:"The requested participant was not found.",permissionDeniedConnect:"Required credentials not found.",permissionDeniedConversation:"Invalid operation: only the host can {command} the conversation.",permissionDeniedParticipant:"Invalid operation: only the host can {command} a participant.",permissionDeniedSend:"Invalid operation: the conversation is not in a connected state.",permissionDeniedStart:"Invalid operation: there is already an active conversation."};Gi.privDefaultParams={apiVersion:"api-version",authorization:"Authorization",clientAppId:"X-ClientAppId",contentTypeKey:"Content-Type",correlationId:"X-CorrelationId",languageCode:"language",nickname:"nickname",profanity:"profanity",requestId:"X-RequestId",roomId:"roomid",sessionToken:"token",subscriptionKey:"Ocp-Apim-Subscription-Key",subscriptionRegion:"Ocp-Apim-Subscription-Region",token:"X-CapitoToken"}});var ue=u(ye=>{"use strict";var iO=ye&&ye.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),Ct=ye&&ye.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&iO(e,r,t)};Object.defineProperty(ye,"__esModule",{value:!0});Ct(hy(),ye);Ct(vy(),ye);Ct(my(),ye);Ct(Sy(),ye);Ct(Cy(),ye);Ct(by(),ye);Ct(Ul(),ye);Ct(Ay(),ye);Ct(eP(),ye);Ct(oP(),ye);Ct(Pv(),ye)});var uP=u(Jc=>{"use strict";Object.defineProperty(Jc,"__esModule",{value:!0});Jc.IntentConnectionFactory=void 0;var aP=ue(),ds=f(),cP=tt(),nO=C(),sO=_e(),Rv=class extends cP.ConnectionFactoryBase{create(e,t,i){let n=e.parameters.getProperty(ds.PropertyId.SpeechServiceConnection_Endpoint);if(!n){let c=e.parameters.getProperty(ds.PropertyId.SpeechServiceConnection_IntentRegion),p=cP.ConnectionFactoryBase.getHostSuffix(c);n=e.parameters.getProperty(ds.PropertyId.SpeechServiceConnection_Host,"wss://"+c+".sr.speech"+p)+"/speech/recognition/interactive/cognitiveservices/v1"}let s={format:"simple",language:e.parameters.getProperty(ds.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,s,n);let o={};t.token!==void 0&&t.token!==""&&(o[t.headerName]=t.token),o[sO.HeaderNames.ConnectionId]=i,e.parameters.setProperty(ds.PropertyId.SpeechServiceConnection_Url,n);let a=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new aP.WebsocketConnection(n,s,o,new nO.WebsocketMessageFormatter,aP.ProxyInfo.fromRecognizerConfig(e),a,i))}getSpeechRegionFromIntentRegion(e){switch(e){case"West US":case"US West":case"westus":return"uswest";case"West US 2":case"US West 2":case"westus2":return"uswest2";case"South Central US":case"US South Central":case"southcentralus":return"ussouthcentral";case"West Central US":case"US West Central":case"westcentralus":return"uswestcentral";case"East US":case"US East":case"eastus":return"useast";case"East US 2":case"US East 2":case"eastus2":return"useast2";case"West Europe":case"Europe West":case"westeurope":return"europewest";case"North Europe":case"Europe North":case"northeurope":return"europenorth";case"Brazil South":case"South Brazil":case"southbrazil":return"brazilsouth";case"Australia East":case"East Australia":case"eastaustralia":return"australiaeast";case"Southeast Asia":case"Asia Southeast":case"southeastasia":return"asiasoutheast";case"East Asia":case"Asia East":case"eastasia":return"asiaeast";default:return e}}};Jc.IntentConnectionFactory=Rv});var dP=u(Qi=>{"use strict";Object.defineProperty(Qi,"__esModule",{value:!0});Qi.VoiceProfileConnectionFactory=Qi.SpeakerRecognitionConnectionFactory=void 0;var pP=ue(),ui=f(),lP=tt(),oO=C(),hP=_e(),$c=class extends lP.ConnectionFactoryBase{create(e,t,i,n){let s=e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_Endpoint);if(!s){let p=e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_Region),h=lP.ConnectionFactoryBase.getHostSuffix(p),d=e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_Host,`wss://${p}.spr-frontend.speech${h}`),v=e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_SpeakerIdMode,"TextIndependentIdentification");s=`${d}/speaker/ws/${this.scenarioToPath(v)}/${i}`}let o={format:"simple",language:e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_RecoLanguage)};this.setCommonUrlParams(e,o,s);let a={};t.token!==void 0&&t.token!==""&&(a[t.headerName]=t.token),a[hP.HeaderNames.ConnectionId]=n,a[hP.HeaderNames.SpIDAuthKey]=e.parameters.getProperty(ui.PropertyId.SpeechServiceConnection_Key),e.parameters.setProperty(ui.PropertyId.SpeechServiceConnection_Url,s);let c=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new pP.WebsocketConnection(s,o,a,new oO.WebsocketMessageFormatter,pP.ProxyInfo.fromRecognizerConfig(e),c,n))}scenarioToPath(e){switch(e){case"TextIndependentVerification":case"2":return"verification/text-independent";case"TextDependentVerification":case"1":return"verification/text-dependent";default:return"identification/text-independent"}}},Ev=class extends $c{create(e,t,i){return super.create(e,t,"recognition",i)}};Qi.SpeakerRecognitionConnectionFactory=Ev;var wv=class extends $c{create(e,t,i){return super.create(e,t,"profile",i)}};Qi.VoiceProfileConnectionFactory=wv});var Qc=u(Se=>{"use strict";Object.defineProperty(Se,"__esModule",{value:!0});Se.RecognitionEndedEvent=Se.RecognitionCompletionStatus=Se.RecognitionStartedEvent=Se.ConnectingToServiceEvent=Se.ListeningStartedEvent=Se.RecognitionTriggeredEvent=Se.SpeechRecognitionEvent=void 0;var Gc=P(),br=class extends Gc.PlatformEvent{constructor(e,t,i,n=Gc.EventType.Info){super(e,n),this.privRequestId=t,this.privSessionId=i}get requestId(){return this.privRequestId}get sessionId(){return this.privSessionId}};Se.SpeechRecognitionEvent=br;var Iv=class extends br{constructor(e,t,i,n){super("RecognitionTriggeredEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}};Se.RecognitionTriggeredEvent=Iv;var _v=class extends br{constructor(e,t,i,n){super("ListeningStartedEvent",e,t),this.privAudioSourceId=i,this.privAudioNodeId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}};Se.ListeningStartedEvent=_v;var bv=class extends br{constructor(e,t,i){super("ConnectingToServiceEvent",e,i),this.privAuthFetchEventid=t}get authFetchEventid(){return this.privAuthFetchEventid}};Se.ConnectingToServiceEvent=bv;var Av=class extends br{constructor(e,t,i,n,s){super("RecognitionStartedEvent",e,s),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=n}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}};Se.RecognitionStartedEvent=Av;var vP;(function(r){r[r.Success=0]="Success",r[r.AudioSourceError=1]="AudioSourceError",r[r.AudioSourceTimeout=2]="AudioSourceTimeout",r[r.AuthTokenFetchError=3]="AuthTokenFetchError",r[r.AuthTokenFetchTimeout=4]="AuthTokenFetchTimeout",r[r.UnAuthorized=5]="UnAuthorized",r[r.ConnectTimeout=6]="ConnectTimeout",r[r.ConnectError=7]="ConnectError",r[r.ClientRecognitionActivityTimeout=8]="ClientRecognitionActivityTimeout",r[r.UnknownError=9]="UnknownError"})(vP=Se.RecognitionCompletionStatus||(Se.RecognitionCompletionStatus={}));var Tv=class extends br{constructor(e,t,i,n,s,o,a,c){super("RecognitionEndedEvent",e,s,a===vP.Success?Gc.EventType.Info:Gc.EventType.Error),this.privAudioSourceId=t,this.privAudioNodeId=i,this.privAuthFetchEventId=n,this.privStatus=a,this.privError=c,this.privServiceTag=o}get audioSourceId(){return this.privAudioSourceId}get audioNodeId(){return this.privAudioNodeId}get authFetchEventId(){return this.privAuthFetchEventId}get serviceTag(){return this.privServiceTag}get status(){return this.privStatus}get error(){return this.privError}};Se.RecognitionEndedEvent=Tv});var pi=u(Xc=>{"use strict";Object.defineProperty(Xc,"__esModule",{value:!0});Xc.SpeechConnectionMessage=void 0;var Ov=P(),ir=_e(),kv=class r extends Ov.ConnectionMessage{constructor(e,t,i,n,s,o,a,c){if(!t)throw new Ov.ArgumentNullError("path");if(!i)throw new Ov.ArgumentNullError("requestId");let p={};if(p[ir.HeaderNames.Path]=t,p[ir.HeaderNames.RequestId]=i,p[ir.HeaderNames.RequestTimestamp]=new Date().toISOString(),n&&(p[ir.HeaderNames.ContentType]=n),o&&(p[ir.HeaderNames.RequestStreamId]=o),a)for(let h in a)h&&(p[h]=a[h]);c?super(e,s,p,c):super(e,s,p),this.privPath=t,this.privRequestId=i,this.privContentType=n,this.privStreamId=o,this.privAdditionalHeaders=a}get path(){return this.privPath}get requestId(){return this.privRequestId}get contentType(){return this.privContentType}get streamId(){return this.privStreamId}get additionalHeaders(){return this.privAdditionalHeaders}static fromConnectionMessage(e){let t=null,i=null,n=null,s=null,o={};if(e.headers)for(let a in e.headers)a&&(a.toLowerCase()===ir.HeaderNames.Path.toLowerCase()?t=e.headers[a]:a.toLowerCase()===ir.HeaderNames.RequestId.toLowerCase()?i=e.headers[a]:a.toLowerCase()===ir.HeaderNames.ContentType.toLowerCase()?n=e.headers[a]:a.toLowerCase()===ir.HeaderNames.RequestStreamId.toLowerCase()?s=e.headers[a]:o[a]=e.headers[a]);return new r(e.messageType,t,i,n,e.body,s,o,e.id)}};Xc.SpeechConnectionMessage=kv});var fP=u(vs=>{"use strict";Object.defineProperty(vs,"__esModule",{value:!0});vs.SegmentationMode=void 0;var aO;(function(r){r.Normal="Normal",r.Disabled="Disabled",r.Custom="Custom",r.Semantic="Semantic"})(aO=vs.SegmentationMode||(vs.SegmentationMode={}))});var gP=u(fs=>{"use strict";Object.defineProperty(fs,"__esModule",{value:!0});fs.NextAction=void 0;var cO;(function(r){r.None="None",r.Synthesize="Synthesize"})(cO=fs.NextAction||(fs.NextAction={}))});var mP=u(gs=>{"use strict";Object.defineProperty(gs,"__esModule",{value:!0});gs.Mode=void 0;var uO;(function(r){r.None="None",r.Always="Always"})(uO=gs.Mode||(gs.Mode={}))});var yP=u(Ar=>{"use strict";Object.defineProperty(Ar,"__esModule",{value:!0});Ar.LanguageIdDetectionPriority=Ar.LanguageIdDetectionMode=void 0;var pO;(function(r){r.DetectAtAudioStart="DetectAtAudioStart",r.DetectContinuous="DetectContinuous",r.DetectSegments="DetectSegments"})(pO=Ar.LanguageIdDetectionMode||(Ar.LanguageIdDetectionMode={}));var lO;(function(r){r.Auto="Auto",r.PrioritizeLatency="PrioritizeLatency",r.PrioritizeAccuracy="PrioritizeAccuracy"})(lO=Ar.LanguageIdDetectionPriority||(Ar.LanguageIdDetectionPriority={}))});var SP=u(ms=>{"use strict";Object.defineProperty(ms,"__esModule",{value:!0});ms.NextAction=void 0;var hO;(function(r){r.Recognize="Recognize",r.None="None"})(hO=ms.NextAction||(ms.NextAction={}))});var CP=u(ys=>{"use strict";Object.defineProperty(ys,"__esModule",{value:!0});ys.OnUnknownAction=void 0;var dO;(function(r){r.RecognizeWithDefaultLanguage="RecognizeWithDefaultLanguage",r.None="None"})(dO=ys.OnUnknownAction||(ys.OnUnknownAction={}))});var PP=u(Ss=>{"use strict";Object.defineProperty(Ss,"__esModule",{value:!0});Ss.ResultType=void 0;var vO;(function(r){r.Auto="Auto",r.StableFragment="StableFragment",r.Hypothesis="Hypothesis",r.None="None"})(vO=Ss.ResultType||(Ss.ResultType={}))});var RP=u(Cs=>{"use strict";Object.defineProperty(Cs,"__esModule",{value:!0});Cs.PhraseResultOutputType=void 0;var fO;(function(r){r.Always="Always",r.None="None"})(fO=Cs.PhraseResultOutputType||(Cs.PhraseResultOutputType={}))});var EP=u(Ps=>{"use strict";Object.defineProperty(Ps,"__esModule",{value:!0});Ps.NextAction=void 0;var gO;(function(r){r.None="None",r.Translate="Translate"})(gO=Ps.NextAction||(Ps.NextAction={}))});var _P=u(tu=>{"use strict";Object.defineProperty(tu,"__esModule",{value:!0});tu.ServiceRecognizerBase=void 0;var mO=ue(),re=P(),N=f(),nr=C(),Tr=pi(),Xi=fP(),Mv=He(),Zc=gP(),yO=mP(),Dv=yP(),SO=SP(),CO=CP(),wP=PP(),IP=RP(),Yc=EP(),eu=class r{constructor(e,t,i,n,s){if(this.privConnectionConfigurationPromise=void 0,this.privConnectionPromise=void 0,this.privSetTimeout=setTimeout,this.privIsLiveAudio=!1,this.privAverageBytesPerMs=0,this.privEnableSpeakerId=!1,this.privExpectContentAssessmentResponse=!1,this.recognizeOverride=void 0,this.recognizeSpeaker=void 0,this.disconnectOverride=void 0,this.receiveMessageOverride=void 0,this.sendPrePayloadJSONOverride=void 0,this.postConnectImplOverride=void 0,this.configConnectionOverride=void 0,this.handleSpeechPhraseMessage=void 0,this.handleSpeechHypothesisMessage=void 0,!e)throw new re.ArgumentNullError("authentication");if(!t)throw new re.ArgumentNullError("connectionFactory");if(!i)throw new re.ArgumentNullError("audioSource");if(!n)throw new re.ArgumentNullError("recognizerConfig");this.privEnableSpeakerId=n.isSpeakerDiarizationEnabled,this.privMustReportEndOfStream=!1,this.privAuthentication=e,this.privConnectionFactory=t,this.privAudioSource=i,this.privRecognizerConfig=n,this.privIsDisposed=!1,this.privRecognizer=s,this.privRequestSession=new nr.RequestSession(this.privAudioSource.id()),this.privConnectionEvents=new re.EventSource,this.privServiceEvents=new re.EventSource,this.privDynamicGrammar=new nr.DynamicGrammarBuilder,this.privSpeechContext=new nr.SpeechContext(this.privDynamicGrammar),this.privAgentConfig=new nr.AgentConfig,this.privRecognizerConfig.parameters.getProperty(N.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?this.privSetTimeout=re.Timeout.setTimeout:(typeof window<"u"&&(this.privSetTimeout=window.setTimeout.bind(window)),typeof globalThis<"u"&&(this.privSetTimeout=globalThis.setTimeout.bind(globalThis))),this.connectionEvents.attach(a=>{if(a.name==="ConnectionClosedEvent"){let c=a;(c.statusCode===1003||c.statusCode===1007||c.statusCode===1002||c.statusCode===4e3||this.privRequestSession.numConnectionAttempts>this.privRecognizerConfig.maxRetryCount)&&this.cancelRecognitionLocal(N.CancellationReason.Error,c.statusCode===1007?N.CancellationErrorCode.BadRequestParameters:N.CancellationErrorCode.ConnectionFailure,`${c.reason} websocket error code: ${c.statusCode}`)}}),this.privEnableSpeakerId&&(this.privDiarizationSessionId=(0,re.createNoDashGuid)())}setTranslationJson(){let e=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0);if(e!==void 0){let t=e.split(","),i=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationVoice,void 0),n=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationCategoryId,void 0),s=i!==void 0?Zc.NextAction.Synthesize:Zc.NextAction.None;if(this.privSpeechContext.getContext().translation={onPassthrough:{action:s},onSuccess:{action:s},output:{includePassThroughResults:!0,interimResults:{mode:yO.Mode.Always}},targetLanguages:t},n!==void 0&&(this.privSpeechContext.getContext().translation.category=n),i!==void 0){let a={};for(let c of t)a[c]=i;this.privSpeechContext.getContext().synthesis={defaultVoices:a}}let o=this.privSpeechContext.getContext().phraseDetection||{};o.onSuccess={action:Yc.NextAction.Translate},o.onInterim={action:Yc.NextAction.Translate},this.privSpeechContext.getContext().phraseDetection=o}}setSpeechSegmentationTimeoutJson(){let e=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.Speech_SegmentationSilenceTimeoutMs,void 0),t=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.Speech_SegmentationMaximumTimeMs,void 0),i=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.Speech_SegmentationStrategy,void 0),n={mode:Xi.SegmentationMode.Normal},s=!1;if(i!==void 0){s=!0;let o=Xi.SegmentationMode.Normal;switch(i.toLowerCase()){case"default":break;case"time":o=Xi.SegmentationMode.Custom;break;case"semantic":o=Xi.SegmentationMode.Semantic;break}n.mode=o}if(e!==void 0){s=!0;let o=parseInt(e,10);n.mode=Xi.SegmentationMode.Custom,n.segmentationSilenceTimeoutMs=o}if(t!==void 0){s=!0;let o=parseInt(t,10);n.mode=Xi.SegmentationMode.Custom,n.segmentationForcedTimeoutMs=o}if(s){let o=this.privSpeechContext.getContext().phraseDetection||{};switch(o.mode=this.recognitionMode,this.recognitionMode){case Mv.RecognitionMode.Conversation:o.conversation=o.conversation??{segmentation:{}},o.conversation.segmentation=n;break;case Mv.RecognitionMode.Interactive:o.interactive=o.interactive??{segmentation:{}},o.interactive.segmentation=n;break;case Mv.RecognitionMode.Dictation:o.dictation=o.dictation??{},o.dictation.segmentation=n;break}this.privSpeechContext.getContext().phraseDetection=o}}setLanguageIdJson(){let e=this.privSpeechContext.getContext().phraseDetection||{};if(this.privRecognizerConfig.autoDetectSourceLanguages!==void 0){let t=this.privRecognizerConfig.autoDetectSourceLanguages.split(",");t.length===1&&t[0]===nr.AutoDetectSourceLanguagesOpenRangeOptionName&&(t[0]="UND");let i;this.privRecognizerConfig.languageIdMode==="Continuous"?i=Dv.LanguageIdDetectionMode.DetectContinuous:i=Dv.LanguageIdDetectionMode.DetectAtAudioStart,this.privSpeechContext.getContext().languageId={languages:t,mode:i,onSuccess:{action:SO.NextAction.Recognize},onUnknown:{action:CO.OnUnknownAction.None},priority:Dv.LanguageIdDetectionPriority.PrioritizeLatency},this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:wP.ResultType.Auto},phraseResults:{resultType:IP.PhraseResultOutputType.Always}};let n=this.privRecognizerConfig.sourceLanguageModels;n!==void 0&&(e.customModels=n,e.onInterim={action:Yc.NextAction.None},e.onSuccess={action:Yc.NextAction.None})}this.privSpeechContext.getContext().phraseDetection=e}setOutputDetailLevelJson(){this.privEnableSpeakerId&&(this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true"?this.privSpeechContext.setWordLevelTimings():this.privRecognizerConfig.parameters.getProperty(nr.OutputFormatPropertyName,N.OutputFormat[N.OutputFormat.Simple]).toLowerCase()===N.OutputFormat[N.OutputFormat.Detailed].toLocaleLowerCase()&&this.privSpeechContext.setDetailedOutputFormat())}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}get audioSource(){return this.privAudioSource}get speechContext(){return this.privSpeechContext}get dynamicGrammar(){return this.privDynamicGrammar}get agentConfig(){return this.privAgentConfig}set conversationTranslatorToken(e){this.privRecognizerConfig.parameters.setProperty(N.PropertyId.ConversationTranslator_Token,e)}set voiceProfileType(e){this.privRecognizerConfig.parameters.setProperty(N.PropertyId.SpeechServiceConnection_SpeakerIdMode,e)}set authentication(e){this.privAuthentication=e}isDisposed(){return this.privIsDisposed}async dispose(e){if(this.privIsDisposed=!0,this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose(e)}catch{return}}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}get recognitionMode(){return this.privRecognizerConfig.recognitionMode}async recognize(e,t,i){if(this.recognizeOverride!==void 0){await this.recognizeOverride(e,t,i);return}if(this.privConnectionConfigurationPromise=void 0,this.privRecognizerConfig.recognitionMode=e,this.privRecognizerConfig.recognitionEndpointVersion==="2"){let c=this.privSpeechContext.getContext().phraseDetection||{};c.mode=e,this.privSpeechContext.getContext().phraseDetection=c}this.setLanguageIdJson(),this.setTranslationJson(),this.privRecognizerConfig.autoDetectSourceLanguages!==void 0&&this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0)!==void 0&&this.setupTranslationWithLanguageId(),this.setSpeechSegmentationTimeoutJson(),this.setOutputDetailLevelJson(),this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privAudioSource.events);let n=this.connectImpl(),s;try{let c=await this.audioSource.attach(this.privRequestSession.audioNodeId),p=await this.audioSource.format,h=await this.audioSource.deviceInfo;this.privIsLiveAudio=h.type&&h.type===nr.type.Microphones,s=new mO.ReplayableAudioNode(c,p.avgBytesPerSec),await this.privRequestSession.onAudioSourceAttachCompleted(s,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:h}}catch(c){throw await this.privRequestSession.onStopRecognizing(),c}try{await n}catch(c){await this.cancelRecognitionLocal(N.CancellationReason.Error,N.CancellationErrorCode.ConnectionFailure,c);return}let o=new N.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,o),this.receiveMessage(),this.sendAudio(s).catch(async c=>{await this.cancelRecognitionLocal(N.CancellationReason.Error,N.CancellationErrorCode.RuntimeError,c)})}async stopRecognizing(){if(this.privRequestSession.isRecognizing)try{await this.audioSource.turnOff(),await this.sendFinalAudio(),await this.privRequestSession.onStopRecognizing(),await this.privRequestSession.turnCompletionPromise}finally{await this.privRequestSession.dispose()}}async connect(){return await this.connectImpl(),Promise.resolve()}connectAsync(e,t){this.connectImpl().then(()=>{try{e&&e()}catch(i){t&&t(i)}},i=>{try{t&&t(i)}catch{}})}async disconnect(){if(await this.cancelRecognitionLocal(N.CancellationReason.Error,N.CancellationErrorCode.NoError,"Disconnecting"),this.disconnectOverride!==void 0&&await this.disconnectOverride(),this.privConnectionPromise!==void 0)try{await(await this.privConnectionPromise).dispose()}catch{}this.privConnectionPromise=void 0}sendMessage(e){}async sendNetworkMessage(e,t){let i=typeof t=="string"?re.MessageType.Text:re.MessageType.Binary,n=typeof t=="string"?"application/json":"";return(await this.fetchConnection()).send(new Tr.SpeechConnectionMessage(i,e,this.privRequestSession.requestId,n,t))}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set expectContentAssessmentResponse(e){this.privExpectContentAssessmentResponse=e}async sendTelemetryData(){let e=this.privRequestSession.getTelemetry();if(r.telemetryDataEnabled!==!0||this.privIsDisposed||e===null)return;if(r.telemetryData)try{r.telemetryData(e)}catch{}await(await this.fetchConnection()).send(new Tr.SpeechConnectionMessage(re.MessageType.Text,"telemetry",this.privRequestSession.requestId,"application/json",e))}async cancelRecognitionLocal(e,t,i){this.privRequestSession.isRecognizing&&(await this.privRequestSession.onStopRecognizing(),this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,e,t,i))}async receiveMessage(){try{if(this.privIsDisposed)return;let e=await this.fetchConnection(),t=await e.read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(!t)return this.receiveMessage();this.privServiceHasSentMessage=!0;let i=Tr.SpeechConnectionMessage.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privRequestSession.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privMustReportEndOfStream=!0,this.privRequestSession.onServiceTurnStartResponse();break;case"speech.startdetected":let n=nr.SpeechDetected.fromJSON(i.textBody,this.privRequestSession.currentTurnAudioOffset),s=new N.RecognitionEventArgs(n.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,s);break;case"speech.enddetected":let o;i.textBody.length>0?o=i.textBody:o="{ Offset: 0 }";let a=nr.SpeechDetected.fromJSON(o,this.privRequestSession.currentTurnAudioOffset),c=new N.RecognitionEventArgs(a.Offset+this.privRequestSession.currentTurnAudioOffset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,c);break;case"turn.end":await this.sendTelemetryData(),this.privRequestSession.isSpeechEnded&&this.privMustReportEndOfStream&&(this.privMustReportEndOfStream=!1,await this.cancelRecognitionLocal(N.CancellationReason.EndOfStream,N.CancellationErrorCode.NoError,void 0));let p=new N.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition),!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing){this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,p);return}else e=await this.fetchConnection(),await this.sendPrePayloadJSON(e);break;default:await this.processTypeSpecificMessages(i)||this.privServiceEvents&&this.serviceEvents.onEvent(new re.ServiceEvent(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch{return null}}updateSpeakerDiarizationAudioOffset(){let e=this.privRequestSession.recognitionBytesSent,t=this.privAverageBytesPerMs!==0?e/this.privAverageBytesPerMs:0;this.privSpeechContext.setSpeakerDiarizationAudioOffsetMs(t)}sendSpeechContext(e,t){this.privEnableSpeakerId&&this.updateSpeakerDiarizationAudioOffset();let i=this.speechContext.toJSON();if(t&&this.privRequestSession.onSpeechContext(),i)return e.send(new Tr.SpeechConnectionMessage(re.MessageType.Text,"speech.context",this.privRequestSession.requestId,"application/json",i))}setupTranslationWithLanguageId(){let e=this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationToLanguages,void 0),t=this.privRecognizerConfig.autoDetectSourceLanguages!==void 0;if(e!==void 0&&t){this.privSpeechContext.getContext().phraseOutput={interimResults:{resultType:wP.ResultType.None},phraseResults:{resultType:IP.PhraseResultOutputType.None}};let i=this.privSpeechContext.getContext().translation;if(i){let n=this.privRecognizerConfig.sourceLanguageModels;if(n!==void 0&&n.length>0){let o=this.privSpeechContext.getContext().phraseDetection||{};o.customModels=n,this.privSpeechContext.getContext().phraseDetection=o}this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_TranslationVoice,void 0)!==void 0&&(i.onSuccess={action:Zc.NextAction.Synthesize},i.onPassthrough={action:Zc.NextAction.Synthesize})}}}noOp(){}async sendPrePayloadJSON(e,t=!0){if(this.sendPrePayloadJSONOverride!==void 0)return this.sendPrePayloadJSONOverride(e);await this.sendSpeechContext(e,t),await this.sendWaveHeader(e)}async sendWaveHeader(e){let t=await this.audioSource.format;return e.send(new Tr.SpeechConnectionMessage(re.MessageType.Binary,"audio",this.privRequestSession.requestId,"audio/x-wav",t.header))}connectImpl(){return this.privConnectionPromise!==void 0?this.privConnectionPromise.then(e=>e.state()===re.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=void 0,this.privServiceHasSentMessage=!1,this.connectImpl())):(this.privConnectionPromise=this.retryableConnect(),this.privConnectionPromise.catch(()=>{}),this.postConnectImplOverride!==void 0?this.postConnectImplOverride(this.privConnectionPromise):this.privConnectionPromise)}sendSpeechServiceConfig(e,t,i){if(t.onSpeechContext(),r.telemetryDataEnabled!==!0){let s={context:{system:JSON.parse(i).context.system}};i=JSON.stringify(s)}if(this.privRecognizerConfig.parameters.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()==="true"){let n=JSON.parse(i);n.context.DisableReferenceChannel="True",n.context.MicSpec="1_0_0",i=JSON.stringify(n)}if(i)return e.send(new Tr.SpeechConnectionMessage(re.MessageType.Text,"speech.config",t.requestId,"application/json",i))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(e=>e.state()===re.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.privServiceHasSentMessage=!1,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async sendAudio(e){let t=await this.audioSource.format;this.privAverageBytesPerMs=t.avgBytesPerSec/1e3;let i=Date.now(),n=this.privRecognizerConfig.parameters.getProperty("SPEECH-TransmitLengthBeforThrottleMs","5000"),s=t.avgBytesPerSec/1e3*parseInt(n,10),o=this.privRequestSession.recogNumber,a=async()=>{if(!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===o){let c=await this.fetchConnection(),p=await e.read();if(this.privRequestSession.isSpeechEnded)return;let h,d;if(!p||p.isEnd?(h=null,d=0):(h=p.buffer,this.privRequestSession.onAudioSent(h.byteLength),s>=this.privRequestSession.bytesSent?d=0:d=Math.max(0,i-Date.now())),d!==0&&await this.delay(d),h!==null&&(i=Date.now()+h.byteLength*1e3/(t.avgBytesPerSec*2)),!this.privIsDisposed&&!this.privRequestSession.isSpeechEnded&&this.privRequestSession.isRecognizing&&this.privRequestSession.recogNumber===o)if(c.send(new Tr.SpeechConnectionMessage(re.MessageType.Binary,"audio",this.privRequestSession.requestId,null,h)).catch(()=>{this.privRequestSession.onServiceTurnEndResponse(this.privRecognizerConfig.isContinuousRecognition).catch(()=>{})}),p?.isEnd)this.privIsLiveAudio||this.privRequestSession.onSpeechEnded();else return a()}};return a()}async retryableConnect(){let e=!1;this.privAuthFetchEventId=(0,re.createNoDashGuid)();let t=this.privRequestSession.sessionId;this.privConnectionId=t!==void 0?t:(0,re.createNoDashGuid)(),this.privRequestSession.onPreConnectionStart(this.privAuthFetchEventId,this.privConnectionId);let i=0,n="";for(;this.privRequestSession.numConnectionAttempts<=this.privRecognizerConfig.maxRetryCount;){this.privRequestSession.onRetryConnection();let o=await(e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId));await this.privRequestSession.onAuthCompleted(!1);let a=await this.privConnectionFactory.create(this.privRecognizerConfig,o,this.privConnectionId);this.privRequestSession.listenForServiceTelemetry(a.events),a.events.attach(p=>{this.connectionEvents.onEvent(p)});let c=await a.open();if(c.statusCode===200)return await this.privRequestSession.onConnectionEstablishCompleted(c.statusCode),Promise.resolve(a);c.statusCode===1006&&(e=!0),i=c.statusCode,n=c.reason}return await this.privRequestSession.onConnectionEstablishCompleted(i,n),Promise.reject(`Unable to contact server. StatusCode: ${i}, ${this.privRecognizerConfig.parameters.getProperty(N.PropertyId.SpeechServiceConnection_Endpoint)} Reason: ${n}`)}delay(e){return new Promise(t=>this.privSetTimeout(t,e))}writeBufferToConsole(e){let t="Buffer Size: ";if(e===null)t+="null";else{let i=new Uint8Array(e);t+=`${e.byteLength}\r
`;for(let n=0;n<e.byteLength;n++)t+=i[n].toString(16).padStart(2,"0")+" ",(n+1)%16===0&&(console.info(t),t="")}console.info(t)}async sendFinalAudio(){await(await this.fetchConnection()).send(new Tr.SpeechConnectionMessage(re.MessageType.Binary,"audio",this.privRequestSession.requestId,null,null))}async configureConnection(){let e=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(e):(await this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendPrePayloadJSON(e,!1),e)}};tu.ServiceRecognizerBase=eu;eu.telemetryDataEnabled=!0});var bP=u(ru=>{"use strict";Object.defineProperty(ru,"__esModule",{value:!0});ru.ConversationServiceRecognizer=void 0;var Pt=f(),jt=C(),xv=class extends jt.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.handleSpeechPhraseMessage=async o=>this.handleSpeechPhrase(o),this.handleSpeechHypothesisMessage=o=>this.handleSpeechHypothesis(o)}processTypeSpecificMessages(e){}handleRecognizedCallback(e,t,i){}handleRecognizingCallback(e,t,i){}async processSpeechMessages(e){let t=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":this.handleSpeechHypothesisMessage&&this.handleSpeechHypothesisMessage(e.textBody),t=!0;break;case"speech.phrase":this.handleSpeechPhraseMessage&&await this.handleSpeechPhraseMessage(e.textBody),t=!0;break;default:break}return t}cancelRecognition(e,t,i,n,s){}async handleSpeechPhrase(e){let t=jt.SimpleSpeechPhrase.fromJSON(e,this.privRequestSession.currentTurnAudioOffset),i=jt.EnumTranslation.implTranslateRecognitionResult(t.RecognitionStatus),n,s=new Pt.PropertyCollection;if(s.setProperty(Pt.PropertyId.SpeechServiceResponse_JsonResult,e),this.privRequestSession.onPhraseRecognized(t.Offset+t.Duration),Pt.ResultReason.Canceled===i){let o=jt.EnumTranslation.implTranslateCancelResult(t.RecognitionStatus),a=jt.EnumTranslation.implTranslateCancelErrorCode(t.RecognitionStatus);await this.cancelRecognitionLocal(o,a,jt.EnumTranslation.implTranslateErrorDetails(a))}else if(t.RecognitionStatus!==jt.RecognitionStatus.EndOfDictation){if(this.privRecognizerConfig.parameters.getProperty(jt.OutputFormatPropertyName)===Pt.OutputFormat[Pt.OutputFormat.Simple])n=new Pt.SpeechRecognitionResult(this.privRequestSession.requestId,i,t.DisplayText,t.Duration,t.Offset,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,t.asJson(),s);else{let o=jt.DetailedSpeechPhrase.fromJSON(e,this.privRequestSession.currentTurnAudioOffset);n=new Pt.SpeechRecognitionResult(this.privRequestSession.requestId,i,o.Text,o.Duration,o.Offset,o.Language,o.LanguageDetectionConfidence,o.SpeakerId,void 0,o.asJson(),s)}this.handleRecognizedCallback(n,n.offset,this.privRequestSession.sessionId)}}handleSpeechHypothesis(e){let t=jt.SpeechHypothesis.fromJSON(e,this.privRequestSession.currentTurnAudioOffset),i=new Pt.PropertyCollection;i.setProperty(Pt.PropertyId.SpeechServiceResponse_JsonResult,e);let n=new Pt.SpeechRecognitionResult(this.privRequestSession.requestId,Pt.ResultReason.RecognizingSpeech,t.Text,t.Duration,t.Offset,t.Language,t.LanguageDetectionConfidence,t.SpeakerId,void 0,t.asJson(),i);this.privRequestSession.onHypothesis(t.Offset),this.handleRecognizingCallback(n,t.Duration,this.privRequestSession.sessionId)}};ru.ConversationServiceRecognizer=xv});var TP=u(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.RecognizerConfig=li.SpeechResultFormat=void 0;var Rs=f(),AP=C(),Nv=He(),PO;(function(r){r[r.Simple=0]="Simple",r[r.Detailed=1]="Detailed"})(PO=li.SpeechResultFormat||(li.SpeechResultFormat={}));var jv=class{constructor(e,t){this.privSpeechServiceConfig=e||new AP.SpeechServiceConfig(new AP.Context(null)),this.privParameters=t,this.privMaxRetryCount=parseInt(t.getProperty("SPEECH-Error-MaxRetryCount","4"),10),this.privLanguageIdMode=t.getProperty(Rs.PropertyId.SpeechServiceConnection_LanguageIdMode,void 0),this.privEnableSpeakerId=!1}get parameters(){return this.privParameters}get recognitionMode(){return this.privRecognitionMode}set recognitionMode(e){this.privRecognitionMode=e,this.privRecognitionActivityTimeout=e===Nv.RecognitionMode.Interactive?8e3:25e3,this.privSpeechServiceConfig.Recognition=Nv.RecognitionMode[e]}get SpeechServiceConfig(){return this.privSpeechServiceConfig}get recognitionActivityTimeout(){return this.privRecognitionActivityTimeout}get isContinuousRecognition(){return this.privRecognitionMode!==Nv.RecognitionMode.Interactive}get languageIdMode(){return this.privLanguageIdMode}get autoDetectSourceLanguages(){return this.parameters.getProperty(Rs.PropertyId.SpeechServiceConnection_AutoDetectSourceLanguages,void 0)}get recognitionEndpointVersion(){return this.parameters.getProperty(Rs.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,"2")}set recognitionEndpointVersion(e){this.parameters.setProperty(Rs.PropertyId.SpeechServiceConnection_RecognitionEndpointVersion,e)}get sourceLanguageModels(){let e=[],t=!1;if(this.autoDetectSourceLanguages!==void 0)for(let i of this.autoDetectSourceLanguages.split(",")){let n=i+Rs.PropertyId.SpeechServiceConnection_EndpointId.toString(),s=this.parameters.getProperty(n,void 0);s!==void 0?(e.push({language:i,endpoint:s}),t=!0):e.push({language:i,endpoint:""})}return t?e:void 0}get maxRetryCount(){return this.privMaxRetryCount}get isSpeakerDiarizationEnabled(){return this.privEnableSpeakerId}set isSpeakerDiarizationEnabled(e){this.privEnableSpeakerId=e}};li.RecognizerConfig=jv});var kP=u(OP=>{"use strict";Object.defineProperty(OP,"__esModule",{value:!0})});var DP=u(iu=>{"use strict";Object.defineProperty(iu,"__esModule",{value:!0});iu.WebsocketMessageFormatter=void 0;var it=P(),MP=`\r
`,qv=class{toConnectionMessage(e){let t=new it.Deferred;try{if(e.messageType===it.MessageType.Text){let i=e.textContent,n={},s=null;if(i){let o=i.split(`\r
\r
`);o&&o.length>0&&(n=this.parseHeaders(o[0]),o.length>1&&(s=o[1]))}t.resolve(new it.ConnectionMessage(e.messageType,s,n,e.id))}else if(e.messageType===it.MessageType.Binary){let i=e.binaryContent,n={},s=null;if(!i||i.byteLength<2)throw new Error("Invalid binary message format. Header length missing.");let o=new DataView(i),a=o.getInt16(0);if(i.byteLength<a+2)throw new Error("Invalid binary message format. Header content missing.");let c="";for(let p=0;p<a;p++)c+=String.fromCharCode(o.getInt8(p+2));n=this.parseHeaders(c),i.byteLength>a+2&&(s=i.slice(2+a)),t.resolve(new it.ConnectionMessage(e.messageType,s,n,e.id))}}catch(i){t.reject(`Error formatting the message. Error: ${i}`)}return t.promise}fromConnectionMessage(e){let t=new it.Deferred;try{if(e.messageType===it.MessageType.Text){let i=`${this.makeHeaders(e)}${MP}${e.textBody?e.textBody:""}`;t.resolve(new it.RawWebsocketMessage(it.MessageType.Text,i,e.id))}else if(e.messageType===it.MessageType.Binary){let i=this.makeHeaders(e),n=e.binaryBody,s=this.stringToArrayBuffer(i),o=new Int8Array(s),a=o.byteLength,c=new Int8Array(2+a+(n?n.byteLength:0));if(c[0]=a>>8&255,c[1]=a&255,c.set(o,2),n){let h=new Int8Array(n);c.set(h,2+a)}let p=c.buffer;t.resolve(new it.RawWebsocketMessage(it.MessageType.Binary,p,e.id))}}catch(i){t.reject(`Error formatting the message. ${i}`)}return t.promise}makeHeaders(e){let t="";if(e.headers)for(let i in e.headers)i&&(t+=`${i}: ${e.headers[i]}${MP}`);return t}parseHeaders(e){let t={};if(e){let i=e.match(/[^\r\n]+/g);if(t){for(let n of i)if(n){let s=n.indexOf(":"),o=s>0?n.substr(0,s).trim().toLowerCase():n,a=s>0&&n.length>s+1?n.substr(s+1).trim():"";t[o]=a}}}return t}stringToArrayBuffer(e){let t=new ArrayBuffer(e.length),i=new DataView(t);for(let n=0;n<e.length;n++)i.setUint8(n,e.charCodeAt(n));return t}};iu.WebsocketMessageFormatter=qv});var qP=u(nu=>{"use strict";Object.defineProperty(nu,"__esModule",{value:!0});nu.SpeechConnectionFactory=void 0;var xP=ue(),NP=C(),Or=f(),zv=tt(),RO=C(),EO=_e(),hi=Yt(),jP=He(),Lv=class extends zv.ConnectionFactoryBase{constructor(){super(...arguments),this.interactiveRelativeUri="/speech/recognition/interactive/cognitiveservices/v1",this.conversationRelativeUri="/speech/recognition/conversation/cognitiveservices/v1",this.dictationRelativeUri="/speech/recognition/dictation/cognitiveservices/v1",this.universalUri="/stt/speech/universal/v"}async create(e,t,i){let n=e.parameters.getProperty(Or.PropertyId.SpeechServiceConnection_Endpoint,void 0),s=e.parameters.getProperty(Or.PropertyId.SpeechServiceConnection_Region,void 0),o=zv.ConnectionFactoryBase.getHostSuffix(s),a=e.parameters.getProperty(Or.PropertyId.SpeechServiceConnection_Host,"wss://"+s+".stt.speech"+o),c={},p=e.parameters.getProperty(Or.PropertyId.SpeechServiceConnection_EndpointId,void 0),h=e.parameters.getProperty(Or.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(p?(!n||n.search(hi.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(c[hi.QueryParameterNames.CustomSpeechDeploymentId]=p):h&&(!n||n.search(hi.QueryParameterNames.Language)===-1)&&(c[hi.QueryParameterNames.Language]=h),(!n||n.search(hi.QueryParameterNames.Format)===-1)&&(c[hi.QueryParameterNames.Format]=e.parameters.getProperty(NP.OutputFormatPropertyName,Or.OutputFormat[Or.OutputFormat.Simple]).toLowerCase()),e.autoDetectSourceLanguages!==void 0&&(c[hi.QueryParameterNames.EnableLanguageId]="true"),this.setCommonUrlParams(e,c,n),n){let A=new URL(n),H=A.pathname;(H===""||H==="/")&&(A.pathname=this.universalUri+e.recognitionEndpointVersion,n=await zv.ConnectionFactoryBase.getRedirectUrlFromEndpoint(A.toString()))}if(!n)switch(e.recognitionMode){case jP.RecognitionMode.Conversation:e.parameters.getProperty(NP.ForceDictationPropertyName,"false")==="true"?n=a+this.dictationRelativeUri:e.recognitionEndpointVersion!==void 0&&parseInt(e.recognitionEndpointVersion,10)>1?n=`${a}${this.universalUri}${e.recognitionEndpointVersion}`:n=a+this.conversationRelativeUri;break;case jP.RecognitionMode.Dictation:n=a+this.dictationRelativeUri;break;default:e.recognitionEndpointVersion!==void 0&&parseInt(e.recognitionEndpointVersion,10)>1?n=`${a}${this.universalUri}${e.recognitionEndpointVersion}`:n=a+this.interactiveRelativeUri;break}let d={};t.token!==void 0&&t.token!==""&&(d[t.headerName]=t.token),d[EO.HeaderNames.ConnectionId]=i,d.connectionId=i;let v=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",g=new xP.WebsocketConnection(n,c,d,new RO.WebsocketMessageFormatter,xP.ProxyInfo.fromRecognizerConfig(e),v,i),M=g.uri;return e.parameters.setProperty(Or.PropertyId.SpeechServiceConnection_Url,M),g}};nu.SpeechConnectionFactory=Lv});var LP=u(su=>{"use strict";Object.defineProperty(su,"__esModule",{value:!0});su.ConversationTranscriberConnectionFactory=void 0;var zP=ue(),Je=f(),wO=C(),Bv=tt(),IO=C(),_O=_e(),nt=Yt(),Fv=class extends Bv.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2"}async create(e,t,i){let n=e.parameters.getProperty(Je.PropertyId.SpeechServiceConnection_Endpoint,void 0),s=e.parameters.getProperty(Je.PropertyId.SpeechServiceConnection_Region,void 0),o=Bv.ConnectionFactoryBase.getHostSuffix(s),a=e.parameters.getProperty(Je.PropertyId.SpeechServiceConnection_Host,"wss://"+s+".stt.speech"+o),c={},p=e.parameters.getProperty(Je.PropertyId.SpeechServiceConnection_EndpointId,void 0),h=e.parameters.getProperty(Je.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);if(p?(!n||n.search(nt.QueryParameterNames.CustomSpeechDeploymentId)===-1)&&(c[nt.QueryParameterNames.CustomSpeechDeploymentId]=p):h&&(!n||n.search(nt.QueryParameterNames.Language)===-1)&&(c[nt.QueryParameterNames.Language]=h),e.autoDetectSourceLanguages!==void 0&&(c[nt.QueryParameterNames.EnableLanguageId]="true"),this.setV2UrlParams(e,c,n),n){let A=new URL(n),H=A.pathname;(H===""||H==="/")&&(A.pathname=this.universalUri,n=await Bv.ConnectionFactoryBase.getRedirectUrlFromEndpoint(A.toString()))}n||(n=`${a}${this.universalUri}`);let d={};t.token!==void 0&&t.token!==""&&(d[t.headerName]=t.token),d[_O.HeaderNames.ConnectionId]=i;let v=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true",g=new zP.WebsocketConnection(n,c,d,new IO.WebsocketMessageFormatter,zP.ProxyInfo.fromRecognizerConfig(e),v,i),M=g.uri;return e.parameters.setProperty(Je.PropertyId.SpeechServiceConnection_Url,M),g}setV2UrlParams(e,t,i){new Map([[Je.PropertyId.Speech_SegmentationSilenceTimeoutMs,nt.QueryParameterNames.SegmentationSilenceTimeoutMs],[Je.PropertyId.SpeechServiceConnection_EnableAudioLogging,nt.QueryParameterNames.EnableAudioLogging],[Je.PropertyId.SpeechServiceConnection_EndSilenceTimeoutMs,nt.QueryParameterNames.EndSilenceTimeoutMs],[Je.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,nt.QueryParameterNames.InitialSilenceTimeoutMs],[Je.PropertyId.SpeechServiceResponse_PostProcessingOption,nt.QueryParameterNames.Postprocessing],[Je.PropertyId.SpeechServiceResponse_ProfanityOption,nt.QueryParameterNames.Profanity],[Je.PropertyId.SpeechServiceResponse_StablePartialResultThreshold,nt.QueryParameterNames.StableIntermediateThreshold]]).forEach((o,a)=>{this.setUrlParameter(a,o,e,t,i)});let s=JSON.parse(e.parameters.getProperty(wO.ServicePropertiesPropertyName,"{}"));Object.keys(s).forEach(o=>{t[o]=s[o]})}};su.ConversationTranscriberConnectionFactory=Fv});var UP=u(ou=>{"use strict";Object.defineProperty(ou,"__esModule",{value:!0});ou.TranscriberConnectionFactory=void 0;var BP=ue(),$e=f(),FP=tt(),VP=C(),bO=_e(),Es=Yt(),Vv=class extends FP.ConnectionFactoryBase{constructor(){super(...arguments),this.multiaudioRelativeUri="/speech/recognition/multiaudio"}create(e,t,i){let n=e.parameters.getProperty($e.PropertyId.SpeechServiceConnection_Endpoint,void 0),s=e.parameters.getProperty($e.PropertyId.SpeechServiceConnection_Region,"centralus"),o=FP.ConnectionFactoryBase.getHostSuffix(s),a="wss://transcribe."+s+".cts.speech"+o+this.multiaudioRelativeUri,c=e.parameters.getProperty($e.PropertyId.SpeechServiceConnection_Host,a),p={};this.setQueryParams(p,e,n),n||(n=c);let h={};t.token!==void 0&&t.token!==""&&(h[t.headerName]=t.token),h[bO.HeaderNames.ConnectionId]=i,e.parameters.setProperty($e.PropertyId.SpeechServiceConnection_Url,n);let d=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new BP.WebsocketConnection(n,p,h,new VP.WebsocketMessageFormatter,BP.ProxyInfo.fromRecognizerConfig(e),d,i))}setQueryParams(e,t,i){let n=t.parameters.getProperty($e.PropertyId.SpeechServiceConnection_EndpointId,void 0),s=t.parameters.getProperty($e.PropertyId.SpeechServiceConnection_RecoLanguage,void 0);n&&!(Es.QueryParameterNames.CustomSpeechDeploymentId in e)&&(e[Es.QueryParameterNames.CustomSpeechDeploymentId]=n),s&&!(Es.QueryParameterNames.Language in e)&&(e[Es.QueryParameterNames.Language]=s);let o=t.parameters.getProperty($e.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps,"false").toLowerCase()==="true",a=t.parameters.getProperty(VP.OutputFormatPropertyName,$e.OutputFormat[$e.OutputFormat.Simple])!==$e.OutputFormat[$e.OutputFormat.Simple];(o||a)&&(e[Es.QueryParameterNames.Format]=$e.OutputFormat[$e.OutputFormat.Detailed].toLowerCase()),this.setCommonUrlParams(t,e,i)}};ou.TranscriberConnectionFactory=Vv});var JP=u(au=>{"use strict";Object.defineProperty(au,"__esModule",{value:!0});au.TranslationConnectionFactory=void 0;var WP=ue(),HP=bd(),sr=f(),Uv=tt(),AO=C(),TO=_e(),OO=Yt(),KP=He(),Wv=class extends Uv.ConnectionFactoryBase{constructor(){super(...arguments),this.universalUri="/stt/speech/universal/v2",this.translationV1Uri="/speech/translation/cognitiveservices/v1"}async create(e,t,i){let n=this.getEndpointUrl(e),s={};if(this.setQueryParams(s,e,n),n){let p=new URL(n),h=p.pathname;(h===""||h==="/")&&(p.pathname=this.universalUri,n=await Uv.ConnectionFactoryBase.getRedirectUrlFromEndpoint(p.toString()))}let o={};t.token!==void 0&&t.token!==""&&(o[t.headerName]=t.token),o[TO.HeaderNames.ConnectionId]=i,e.parameters.setProperty(sr.PropertyId.SpeechServiceConnection_Url,n);let a=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return new WP.WebsocketConnection(n,s,o,new AO.WebsocketMessageFormatter,WP.ProxyInfo.fromRecognizerConfig(e),a,i)}getEndpointUrl(e,t){let i=e.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_Region),n=Uv.ConnectionFactoryBase.getHostSuffix(i),s=e.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_Endpoint,void 0);return s?t===!0?s:HP.StringUtils.formatString(s,{region:i}):(e.parameters.getProperty("SPEECH-ForceV1Endpoint","false")==="true"?s=e.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_Host,"wss://{region}.s2s.speech"+n)+this.translationV1Uri:s=e.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_Host,"wss://{region}.stt.speech"+n)+this.universalUri,t===!0?s:HP.StringUtils.formatString(s,{region:i}))}setQueryParams(e,t,i){e.from=t.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_RecoLanguage),e.to=t.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_TranslationToLanguages),e.scenario=t.recognitionMode===KP.RecognitionMode.Interactive?"interactive":t.recognitionMode===KP.RecognitionMode.Conversation?"conversation":"",this.setCommonUrlParams(t,e,i),this.setUrlParameter(sr.PropertyId.SpeechServiceResponse_TranslationRequestStablePartialResult,OO.QueryParameterNames.StableTranslation,t,e,i);let n=t.parameters.getProperty(sr.PropertyId.SpeechServiceConnection_TranslationVoice,void 0);n!==void 0&&(e.voice=n,e.features="requireVoice")}};au.TranslationConnectionFactory=Wv});var $P=u(cu=>{"use strict";Object.defineProperty(cu,"__esModule",{value:!0});cu.EnumTranslation=void 0;var pe=f(),se=C(),Hv=class{static implTranslateRecognitionResult(e,t=!1){let i=pe.ResultReason.Canceled;switch(e){case se.RecognitionStatus.Success:i=pe.ResultReason.RecognizedSpeech;break;case se.RecognitionStatus.EndOfDictation:i=t?pe.ResultReason.RecognizedSpeech:pe.ResultReason.NoMatch;break;case se.RecognitionStatus.NoMatch:case se.RecognitionStatus.InitialSilenceTimeout:case se.RecognitionStatus.BabbleTimeout:i=pe.ResultReason.NoMatch;break;case se.RecognitionStatus.Error:case se.RecognitionStatus.BadRequest:case se.RecognitionStatus.Forbidden:default:i=pe.ResultReason.Canceled;break}return i}static implTranslateCancelResult(e){let t=pe.CancellationReason.EndOfStream;switch(e){case se.RecognitionStatus.Success:case se.RecognitionStatus.EndOfDictation:case se.RecognitionStatus.NoMatch:t=pe.CancellationReason.EndOfStream;break;case se.RecognitionStatus.InitialSilenceTimeout:case se.RecognitionStatus.BabbleTimeout:case se.RecognitionStatus.Error:case se.RecognitionStatus.BadRequest:case se.RecognitionStatus.Forbidden:default:t=pe.CancellationReason.Error;break}return t}static implTranslateCancelErrorCode(e){let t=pe.CancellationErrorCode.NoError;switch(e){case se.RecognitionStatus.Error:t=pe.CancellationErrorCode.ServiceError;break;case se.RecognitionStatus.TooManyRequests:t=pe.CancellationErrorCode.TooManyRequests;break;case se.RecognitionStatus.BadRequest:t=pe.CancellationErrorCode.BadRequestParameters;break;case se.RecognitionStatus.Forbidden:t=pe.CancellationErrorCode.Forbidden;break;default:t=pe.CancellationErrorCode.NoError;break}return t}static implTranslateErrorDetails(e){let t="The speech service encountered an internal error and could not continue.";switch(e){case pe.CancellationErrorCode.Forbidden:t="The recognizer is using a free subscription that ran out of quota.";break;case pe.CancellationErrorCode.BadRequestParameters:t="Invalid parameter or unsupported audio format in the request.";break;case pe.CancellationErrorCode.TooManyRequests:t="The number of parallel requests exceeded the number of allowed concurrent transcriptions.";break;default:break}return t}};cu.EnumTranslation=Hv});var GP=u(kr=>{"use strict";Object.defineProperty(kr,"__esModule",{value:!0});kr.RecognitionStatus=kr.SynthesisStatus=void 0;var kO;(function(r){r[r.Success=0]="Success",r[r.SynthesisEnd=1]="SynthesisEnd",r[r.Error=2]="Error"})(kO=kr.SynthesisStatus||(kr.SynthesisStatus={}));var MO;(function(r){r[r.Success=0]="Success",r[r.NoMatch=1]="NoMatch",r[r.InitialSilenceTimeout=2]="InitialSilenceTimeout",r[r.BabbleTimeout=3]="BabbleTimeout",r[r.Error=4]="Error",r[r.EndOfDictation=5]="EndOfDictation",r[r.TooManyRequests=6]="TooManyRequests",r[r.BadRequest=7]="BadRequest",r[r.Forbidden=8]="Forbidden"})(MO=kr.RecognitionStatus||(kr.RecognitionStatus={}))});var XP=u(uu=>{"use strict";Object.defineProperty(uu,"__esModule",{value:!0});uu.TranslationSynthesisEnd=void 0;var QP=C(),Kv=class r{constructor(e){this.privSynthesisEnd=JSON.parse(e),this.privSynthesisEnd.SynthesisStatus&&(this.privSynthesisEnd.SynthesisStatus=QP.SynthesisStatus[this.privSynthesisEnd.SynthesisStatus]),this.privSynthesisEnd.Status&&(this.privSynthesisEnd.SynthesisStatus=QP.SynthesisStatus[this.privSynthesisEnd.Status])}static fromJSON(e){return new r(e)}get SynthesisStatus(){return this.privSynthesisEnd.SynthesisStatus}get FailureReason(){return this.privSynthesisEnd.FailureReason}};uu.TranslationSynthesisEnd=Kv});var YP=u(pu=>{"use strict";Object.defineProperty(pu,"__esModule",{value:!0});pu.TranslationHypothesis=void 0;var DO=I(),ZP=uo(),Jv=class r{constructor(e,t){this.privTranslationHypothesis=e,this.privTranslationHypothesis.Offset+=t,this.privTranslationHypothesis.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationHypothesis.Translation.TranslationStatus)}static fromJSON(e,t){return new r(JSON.parse(e),t)}static fromTranslationResponse(e,t){DO.Contracts.throwIfNullOrUndefined(e,"translationHypothesis");let i=e.SpeechHypothesis;return e.SpeechHypothesis=void 0,i.Translation=e,new r(i,t)}get Duration(){return this.privTranslationHypothesis.Duration}get Offset(){return this.privTranslationHypothesis.Offset}get Text(){return this.privTranslationHypothesis.Text}get Translation(){return this.privTranslationHypothesis.Translation}get Language(){return this.privTranslationHypothesis.PrimaryLanguage?.Language}asJson(){let e={...this.privTranslationHypothesis};return e.Translation!==void 0?JSON.stringify({...e,TranslationStatus:ZP.TranslationStatus[e.Translation.TranslationStatus]}):JSON.stringify(e)}mapTranslationStatus(e){if(typeof e=="string")return ZP.TranslationStatus[e];if(typeof e=="number")return e}};pu.TranslationHypothesis=Jv});var rR=u(lu=>{"use strict";Object.defineProperty(lu,"__esModule",{value:!0});lu.TranslationPhrase=void 0;var xO=I(),eR=C(),tR=uo(),$v=class r{constructor(e,t){this.privTranslationPhrase=e,this.privTranslationPhrase.Offset+=t,this.privTranslationPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privTranslationPhrase.RecognitionStatus),this.privTranslationPhrase.Translation!==void 0&&(this.privTranslationPhrase.Translation.TranslationStatus=this.mapTranslationStatus(this.privTranslationPhrase.Translation.TranslationStatus))}static fromJSON(e,t){return new r(JSON.parse(e),t)}static fromTranslationResponse(e,t){xO.Contracts.throwIfNullOrUndefined(e,"translationResponse");let i=e.SpeechPhrase;return e.SpeechPhrase=void 0,i.Translation=e,i.Text=i.DisplayText,new r(i,t)}get RecognitionStatus(){return this.privTranslationPhrase.RecognitionStatus}get Offset(){return this.privTranslationPhrase.Offset}get Duration(){return this.privTranslationPhrase.Duration}get Text(){return this.privTranslationPhrase.Text}get Language(){return this.privTranslationPhrase.PrimaryLanguage?.Language}get Confidence(){return this.privTranslationPhrase.PrimaryLanguage?.Confidence}get Translation(){return this.privTranslationPhrase.Translation}asJson(){let e={...this.privTranslationPhrase},t={...e,RecognitionStatus:eR.RecognitionStatus[e.RecognitionStatus]};return e.Translation&&(t.Translation={...e.Translation,TranslationStatus:tR.TranslationStatus[e.Translation.TranslationStatus]}),JSON.stringify(t)}mapRecognitionStatus(e){if(typeof e=="string")return eR.RecognitionStatus[e];if(typeof e=="number")return e}mapTranslationStatus(e){if(typeof e=="string")return tR.TranslationStatus[e];if(typeof e=="number")return e}};lu.TranslationPhrase=$v});var nR=u(hu=>{"use strict";Object.defineProperty(hu,"__esModule",{value:!0});hu.TranslationServiceRecognizer=void 0;var iR=P(),q=f(),Ae=C(),Gv=class extends Ae.ConversationServiceRecognizer{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privTranslationRecognizer=s,this.connectionEvents.attach(o=>{o.name==="ConnectionEstablishedEvent"&&this.privTranslationRecognizer.onConnection()})}async processTypeSpecificMessages(e){let t=new q.PropertyCollection,i=await this.processSpeechMessages(e);if(i)return!0;let n=async o=>{if(t.setProperty(q.PropertyId.SpeechServiceResponse_JsonResult,o.asJson()),this.privRequestSession.onPhraseRecognized(o.Offset+o.Duration),o.RecognitionStatus===Ae.RecognitionStatus.Success){let a=this.fireEventForResult(o,t);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,a)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(a.result)}catch(c){this.privErrorCallback&&this.privErrorCallback(c)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}else{let a=Ae.EnumTranslation.implTranslateRecognitionResult(o.RecognitionStatus),c=new q.TranslationRecognitionResult(void 0,this.privRequestSession.requestId,a,o.Text,o.Duration,o.Offset,o.Language,o.Confidence,void 0,o.asJson(),t);if(a===q.ResultReason.Canceled){let p=Ae.EnumTranslation.implTranslateCancelResult(o.RecognitionStatus),h=Ae.EnumTranslation.implTranslateCancelErrorCode(o.RecognitionStatus);await this.cancelRecognitionLocal(p,h,Ae.EnumTranslation.implTranslateErrorDetails(h))}else if(o.RecognitionStatus!==Ae.RecognitionStatus.EndOfDictation){let p=new q.TranslationRecognitionEventArgs(c,c.offset,this.privRequestSession.sessionId);if(this.privTranslationRecognizer.recognized)try{this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,p)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(c)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}i=!0}},s=o=>{t.setProperty(q.PropertyId.SpeechServiceResponse_JsonResult,o.asJson());let a=this.fireEventForResult(o,t);if(this.privRequestSession.onHypothesis(a.offset),this.privTranslationRecognizer.recognizing)try{this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,a)}catch{}i=!0};switch(e.messageType===iR.MessageType.Text&&t.setProperty(q.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"translation.hypothesis":s(Ae.TranslationHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.response":let o=JSON.parse(e.textBody);if(o.SpeechPhrase)await n(Ae.TranslationPhrase.fromTranslationResponse(o,this.privRequestSession.currentTurnAudioOffset));else{let c=JSON.parse(e.textBody);c.SpeechHypothesis&&s(Ae.TranslationHypothesis.fromTranslationResponse(c,this.privRequestSession.currentTurnAudioOffset))}break;case"translation.phrase":await n(Ae.TranslationPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset));break;case"translation.synthesis":case"audio":this.sendSynthesisAudio(e.binaryBody,this.privRequestSession.sessionId),i=!0;break;case"audio.end":case"translation.synthesis.end":let a=Ae.TranslationSynthesisEnd.fromJSON(e.textBody);switch(a.SynthesisStatus){case Ae.SynthesisStatus.Error:if(this.privTranslationRecognizer.synthesizing){let c=new q.TranslationSynthesisResult(q.ResultReason.Canceled,void 0),p=new q.TranslationSynthesisEventArgs(c,this.privRequestSession.sessionId);try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,p)}catch{}}if(this.privTranslationRecognizer.canceled){let c=new q.TranslationRecognitionCanceledEventArgs(this.privRequestSession.sessionId,q.CancellationReason.Error,a.FailureReason,q.CancellationErrorCode.ServiceError,null);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,c)}catch{}}break;case Ae.SynthesisStatus.Success:this.sendSynthesisAudio(void 0,this.privRequestSession.sessionId);break;default:break}i=!0;break;default:break}return i}cancelRecognition(e,t,i,n,s){let o=new q.PropertyCollection;if(o.setProperty(Ae.CancellationErrorCodePropertyName,q.CancellationErrorCode[n]),this.privTranslationRecognizer.canceled){let a=new q.TranslationRecognitionCanceledEventArgs(e,i,s,n,void 0);try{this.privTranslationRecognizer.canceled(this.privTranslationRecognizer,a)}catch{}}if(this.privSuccessCallback){let a=new q.TranslationRecognitionResult(void 0,t,q.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,s,void 0,o);try{this.privSuccessCallback(a),this.privSuccessCallback=void 0}catch{}}}handleRecognizingCallback(e,t,i){try{let n=new q.TranslationRecognitionEventArgs(q.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognizing(this.privTranslationRecognizer,n)}catch{}}handleRecognizedCallback(e,t,i){try{let n=new q.TranslationRecognitionEventArgs(q.TranslationRecognitionResult.fromSpeechRecognitionResult(e),t,i);this.privTranslationRecognizer.recognized(this.privTranslationRecognizer,n)}catch{}}fireEventForResult(e,t){let i;if(e.Translation.Translations!==void 0){i=new q.Translations;for(let p of e.Translation.Translations)i.set(p.Language,p.Text||p.DisplayText)}let n,s;e instanceof Ae.TranslationPhrase?(e.Translation&&e.Translation.TranslationStatus===iR.TranslationStatus.Success?n=q.ResultReason.TranslatedSpeech:n=q.ResultReason.RecognizedSpeech,s=e.Confidence):n=q.ResultReason.TranslatingSpeech;let o=e.Language,a=new q.TranslationRecognitionResult(i,this.privRequestSession.requestId,n,e.Text,e.Duration,e.Offset,o,s,e.Translation.FailureReason,e.asJson(),t);return new q.TranslationRecognitionEventArgs(a,e.Offset,this.privRequestSession.sessionId)}sendSynthesisAudio(e,t){let i=e===void 0?q.ResultReason.SynthesizingAudioCompleted:q.ResultReason.SynthesizingAudio,n=new q.TranslationSynthesisResult(i,e),s=new q.TranslationSynthesisEventArgs(n,t);if(this.privTranslationRecognizer.synthesizing)try{this.privTranslationRecognizer.synthesizing(this.privTranslationRecognizer,s)}catch{}}};hu.TranslationServiceRecognizer=Gv});var sR=u(du=>{"use strict";Object.defineProperty(du,"__esModule",{value:!0});du.SpeechDetected=void 0;var Qv=class r{constructor(e,t){this.privSpeechStartDetected=JSON.parse(e),this.privSpeechStartDetected.Offset+=t}static fromJSON(e,t){return new r(e,t)}get Offset(){return this.privSpeechStartDetected.Offset}};du.SpeechDetected=Qv});var oR=u(vu=>{"use strict";Object.defineProperty(vu,"__esModule",{value:!0});vu.SpeechHypothesis=void 0;var Xv=class r{constructor(e,t){this.privSpeechHypothesis=JSON.parse(e),this.updateOffset(t)}static fromJSON(e,t){return new r(e,t)}updateOffset(e){this.privSpeechHypothesis.Offset+=e}asJson(){return JSON.stringify(this.privSpeechHypothesis)}get Text(){return this.privSpeechHypothesis.Text}get Offset(){return this.privSpeechHypothesis.Offset}get Duration(){return this.privSpeechHypothesis.Duration}get Language(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSpeechHypothesis.PrimaryLanguage===void 0?void 0:this.privSpeechHypothesis.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSpeechHypothesis.SpeakerId}};vu.SpeechHypothesis=Xv});var aR=u(fu=>{"use strict";Object.defineProperty(fu,"__esModule",{value:!0});fu.SpeechKeyword=void 0;var Zv=class r{constructor(e,t){this.privSpeechKeyword=JSON.parse(e),this.privSpeechKeyword.Offset+=t}static fromJSON(e,t){return new r(e,t)}get Status(){return this.privSpeechKeyword.Status}get Text(){return this.privSpeechKeyword.Text}get Offset(){return this.privSpeechKeyword.Offset}get Duration(){return this.privSpeechKeyword.Duration}asJson(){return JSON.stringify(this.privSpeechKeyword)}};fu.SpeechKeyword=Zv});var cR=u(gu=>{"use strict";Object.defineProperty(gu,"__esModule",{value:!0});gu.SpeechServiceRecognizer=void 0;var le=f(),st=C(),Yv=class extends st.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privSpeechRecognizer=s}async processTypeSpecificMessages(e){let t,i=new le.PropertyCollection,n=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":let s=st.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(le.PropertyId.SpeechServiceResponse_JsonResult,s.asJson()),t=new le.SpeechRecognitionResult(this.privRequestSession.requestId,le.ResultReason.RecognizingSpeech,s.Text,s.Duration,s.Offset,s.Language,s.LanguageDetectionConfidence,void 0,void 0,s.asJson(),i),this.privRequestSession.onHypothesis(s.Offset);let o=new le.SpeechRecognitionEventArgs(t,s.Offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognizing)try{this.privSpeechRecognizer.recognizing(this.privSpeechRecognizer,o)}catch{}n=!0;break;case"speech.phrase":let a=st.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(le.PropertyId.SpeechServiceResponse_JsonResult,a.asJson());let c=st.EnumTranslation.implTranslateRecognitionResult(a.RecognitionStatus,this.privExpectContentAssessmentResponse);if(this.privRequestSession.onPhraseRecognized(a.Offset+a.Duration),le.ResultReason.Canceled===c){let p=st.EnumTranslation.implTranslateCancelResult(a.RecognitionStatus),h=st.EnumTranslation.implTranslateCancelErrorCode(a.RecognitionStatus);await this.cancelRecognitionLocal(p,h,st.EnumTranslation.implTranslateErrorDetails(h))}else{if(a.RecognitionStatus===st.RecognitionStatus.EndOfDictation)break;if(this.privRecognizerConfig.parameters.getProperty(st.OutputFormatPropertyName)===le.OutputFormat[le.OutputFormat.Simple])t=new le.SpeechRecognitionResult(this.privRequestSession.requestId,c,a.DisplayText,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,void 0,void 0,a.asJson(),i);else{let h=st.DetailedSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i.setProperty(le.PropertyId.SpeechServiceResponse_JsonResult,h.asJson()),t=new le.SpeechRecognitionResult(this.privRequestSession.requestId,c,h.RecognitionStatus===st.RecognitionStatus.Success?h.NBest[0].Display:"",h.Duration,h.Offset,h.Language,h.LanguageDetectionConfidence,void 0,void 0,h.asJson(),i)}let p=new le.SpeechRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);if(this.privSpeechRecognizer.recognized)try{this.privSpeechRecognizer.recognized(this.privSpeechRecognizer,p)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(h){this.privErrorCallback&&this.privErrorCallback(h)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}n=!0;break;default:break}return n}cancelRecognition(e,t,i,n,s){let o=new le.PropertyCollection;if(o.setProperty(st.CancellationErrorCodePropertyName,le.CancellationErrorCode[n]),this.privSpeechRecognizer.canceled){let a=new le.SpeechRecognitionCanceledEventArgs(i,s,n,void 0,e);try{this.privSpeechRecognizer.canceled(this.privSpeechRecognizer,a)}catch{}}if(this.privSuccessCallback){let a=new le.SpeechRecognitionResult(t,le.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,s,void 0,o);try{this.privSuccessCallback(a),this.privSuccessCallback=void 0}catch{}}}};gu.SpeechServiceRecognizer=Yv});var uR=u(Mr=>{"use strict";Object.defineProperty(Mr,"__esModule",{value:!0});Mr.IdentityProvider=Mr.SpeakerDiarizationMode=void 0;var NO;(function(r){r.None="None",r.Identity="Identity",r.Anonymous="Anonymous"})(NO=Mr.SpeakerDiarizationMode||(Mr.SpeakerDiarizationMode={}));var jO;(function(r){r.CallCenter="CallCenter"})(jO=Mr.IdentityProvider||(Mr.IdentityProvider={}))});var pR=u(mu=>{"use strict";Object.defineProperty(mu,"__esModule",{value:!0});mu.ConversationTranscriptionServiceRecognizer=void 0;var Te=f(),ot=C(),qO=uR(),zO=He(),ef=class extends ot.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privConversationTranscriber=s,this.setSpeakerDiarizationJson()}setSpeakerDiarizationJson(){if(this.privEnableSpeakerId){let e=this.privSpeechContext.getContext().phraseDetection||{};e.mode=zO.RecognitionMode.Conversation;let t={};t.mode=qO.SpeakerDiarizationMode.Anonymous,t.audioSessionId=this.privDiarizationSessionId,t.audioOffsetMs=0,t.diarizeIntermediates=this.privRecognizerConfig.parameters.getProperty(Te.PropertyId.SpeechServiceResponse_DiarizeIntermediateResults,"false")==="true",e.speakerDiarization=t,this.privSpeechContext.getContext().phraseDetection=e}}async processTypeSpecificMessages(e){let t,i=new Te.PropertyCollection;i.setProperty(Te.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let n=!1;switch(e.path.toLowerCase()){case"speech.hypothesis":case"speech.fragment":let s=ot.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);t=new Te.ConversationTranscriptionResult(this.privRequestSession.requestId,Te.ResultReason.RecognizingSpeech,s.Text,s.Duration,s.Offset,s.Language,s.LanguageDetectionConfidence,s.SpeakerId,void 0,s.asJson(),i),this.privRequestSession.onHypothesis(s.Offset);let o=new Te.ConversationTranscriptionEventArgs(t,s.Duration,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribing)try{this.privConversationTranscriber.transcribing(this.privConversationTranscriber,o)}catch{}n=!0;break;case"speech.phrase":let a=ot.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset),c=ot.EnumTranslation.implTranslateRecognitionResult(a.RecognitionStatus);if(this.privRequestSession.onPhraseRecognized(a.Offset+a.Duration),Te.ResultReason.Canceled===c){let p=ot.EnumTranslation.implTranslateCancelResult(a.RecognitionStatus),h=ot.EnumTranslation.implTranslateCancelErrorCode(a.RecognitionStatus);await this.cancelRecognitionLocal(p,h,ot.EnumTranslation.implTranslateErrorDetails(h))}else if(!(this.privRequestSession.isSpeechEnded&&c===Te.ResultReason.NoMatch&&a.RecognitionStatus!==ot.RecognitionStatus.InitialSilenceTimeout)){if(this.privRecognizerConfig.parameters.getProperty(ot.OutputFormatPropertyName)===Te.OutputFormat[Te.OutputFormat.Simple])t=new Te.ConversationTranscriptionResult(this.privRequestSession.requestId,c,a.DisplayText,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,a.SpeakerId,void 0,a.asJson(),i);else{let h=ot.DetailedSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);t=new Te.ConversationTranscriptionResult(this.privRequestSession.requestId,c,h.RecognitionStatus===ot.RecognitionStatus.Success?h.NBest[0].Display:void 0,h.Duration,h.Offset,h.Language,h.LanguageDetectionConfidence,a.SpeakerId,void 0,h.asJson(),i)}let p=new Te.ConversationTranscriptionEventArgs(t,t.offset,this.privRequestSession.sessionId);if(this.privConversationTranscriber.transcribed)try{this.privConversationTranscriber.transcribed(this.privConversationTranscriber,p)}catch{}}n=!0;break;default:break}return n}cancelRecognition(e,t,i,n,s){if(new Te.PropertyCollection().setProperty(ot.CancellationErrorCodePropertyName,Te.CancellationErrorCode[n]),this.privConversationTranscriber.canceled){let a=new Te.ConversationTranscriptionCanceledEventArgs(i,s,n,void 0,e);try{this.privConversationTranscriber.canceled(this.privConversationTranscriber,a)}catch{}}}};mu.ConversationTranscriptionServiceRecognizer=ef});var hR=u(yu=>{"use strict";Object.defineProperty(yu,"__esModule",{value:!0});yu.TranscriptionServiceRecognizer=void 0;var LO=P(),or=f(),lR=C(),BO=pi(),tf=class extends lR.ConversationServiceRecognizer{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privTranscriberRecognizer=s,this.sendPrePayloadJSONOverride=o=>this.sendTranscriptionStartJSON(o),this.privRecognizerConfig.parameters.getProperty(or.PropertyId.SpeechServiceResponse_RequestWordLevelTimestamps)==="true"&&this.privSpeechContext.setWordLevelTimings()}async sendSpeechEventAsync(e,t){if(this.privRequestSession.isRecognizing){let i=await this.fetchConnection();await this.sendSpeechEvent(i,this.createSpeechEventPayload(e,t))}}async sendMeetingSpeechEventAsync(e,t){if(this.privRequestSession.isRecognizing){let i=await this.fetchConnection();await this.sendSpeechEvent(i,this.createMeetingSpeechEventPayload(e,t))}}processTypeSpecificMessages(e){return this.processSpeechMessages(e)}handleRecognizedCallback(e,t,i){try{let n=new or.SpeechRecognitionEventArgs(e,t,i);if(this.privTranscriberRecognizer.recognized(this.privTranscriberRecognizer,n),this.privSuccessCallback){try{this.privSuccessCallback(e)}catch(s){this.privErrorCallback&&this.privErrorCallback(s)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}catch{}}handleRecognizingCallback(e,t,i){try{let n=new or.SpeechRecognitionEventArgs(e,t,i);this.privTranscriberRecognizer.recognizing(this.privTranscriberRecognizer,n)}catch{}}cancelRecognition(e,t,i,n,s){let o=new or.PropertyCollection;if(o.setProperty(lR.CancellationErrorCodePropertyName,or.CancellationErrorCode[n]),this.privTranscriberRecognizer.IsMeetingRecognizer()){if(this.privTranscriberRecognizer.canceled){let a=new or.MeetingTranscriptionCanceledEventArgs(i,s,n,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,a)}catch{}}}else if(this.privTranscriberRecognizer.canceled){let a=new or.ConversationTranscriptionCanceledEventArgs(i,s,n,void 0,e);try{this.privTranscriberRecognizer.canceled(this.privTranscriberRecognizer,a)}catch{}}if(this.privSuccessCallback){let a=new or.SpeechRecognitionResult(t,or.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,s,void 0,o);try{this.privSuccessCallback(a),this.privSuccessCallback=void 0}catch{}}}async sendTranscriptionStartJSON(e){if(await this.sendSpeechContext(e,!0),this.privTranscriberRecognizer.IsMeetingRecognizer()){let t=this.privTranscriberRecognizer.getMeetingInfo(),i=this.createMeetingSpeechEventPayload(t,"start");await this.sendSpeechEvent(e,i)}else{let t=this.privTranscriberRecognizer.getConversationInfo(),i=this.createSpeechEventPayload(t,"start");await this.sendSpeechEvent(e,i)}await this.sendWaveHeader(e)}sendSpeechEvent(e,t){let i=JSON.stringify(t);if(i)return e.send(new BO.SpeechConnectionMessage(LO.MessageType.Text,"speech.event",this.privRequestSession.requestId,"application/json",i))}createSpeechEventPayload(e,t){let i={id:"meeting",name:t,meeting:e.conversationProperties};return i.meeting.id=e.id,i.meeting.attendees=e.participants,i}createMeetingSpeechEventPayload(e,t){let i={id:"meeting",name:t,meeting:e.meetingProperties};return i.meeting.id=e.id,i.meeting.attendees=e.participants,i}};yu.TranscriptionServiceRecognizer=tf});var vR=u(Su=>{"use strict";Object.defineProperty(Su,"__esModule",{value:!0});Su.DetailedSpeechPhrase=void 0;var dR=C(),rf=class r{constructor(e,t){this.privDetailedSpeechPhrase=JSON.parse(e),this.privDetailedSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privDetailedSpeechPhrase.RecognitionStatus),this.updateOffsets(t)}static fromJSON(e,t){return new r(e,t)}updateOffsets(e){if(this.privDetailedSpeechPhrase.Offset+=e,this.privDetailedSpeechPhrase.NBest)for(let t of this.privDetailedSpeechPhrase.NBest){if(t.Words)for(let i of t.Words)i.Offset+=e;if(t.DisplayWords)for(let i of t.DisplayWords)i.Offset+=e}}asJson(){let e={...this.privDetailedSpeechPhrase};return JSON.stringify({...e,RecognitionStatus:dR.RecognitionStatus[e.RecognitionStatus]})}get RecognitionStatus(){return this.privDetailedSpeechPhrase.RecognitionStatus}get NBest(){return this.privDetailedSpeechPhrase.NBest}get Duration(){return this.privDetailedSpeechPhrase.Duration}get Offset(){return this.privDetailedSpeechPhrase.Offset}get Language(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privDetailedSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privDetailedSpeechPhrase.PrimaryLanguage.Confidence}get Text(){return this.privDetailedSpeechPhrase.NBest&&this.privDetailedSpeechPhrase.NBest[0]?this.privDetailedSpeechPhrase.NBest[0].Display||this.privDetailedSpeechPhrase.NBest[0].DisplayText:this.privDetailedSpeechPhrase.DisplayText}get SpeakerId(){return this.privDetailedSpeechPhrase.SpeakerId}mapRecognitionStatus(e){if(typeof e=="string")return dR.RecognitionStatus[e];if(typeof e=="number")return e}};Su.DetailedSpeechPhrase=rf});var gR=u(Cu=>{"use strict";Object.defineProperty(Cu,"__esModule",{value:!0});Cu.SimpleSpeechPhrase=void 0;var fR=C(),nf=class r{constructor(e,t=0){this.privSimpleSpeechPhrase=JSON.parse(e),this.privSimpleSpeechPhrase.RecognitionStatus=this.mapRecognitionStatus(this.privSimpleSpeechPhrase.RecognitionStatus),this.updateOffset(t)}static fromJSON(e,t){return new r(e,t)}updateOffset(e){this.privSimpleSpeechPhrase.Offset+=e}asJson(){let e={...this.privSimpleSpeechPhrase};return JSON.stringify({...e,RecognitionStatus:fR.RecognitionStatus[e.RecognitionStatus]})}get RecognitionStatus(){return this.privSimpleSpeechPhrase.RecognitionStatus}get DisplayText(){return this.privSimpleSpeechPhrase.DisplayText}get Offset(){return this.privSimpleSpeechPhrase.Offset}get Duration(){return this.privSimpleSpeechPhrase.Duration}get Language(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Language}get LanguageDetectionConfidence(){return this.privSimpleSpeechPhrase.PrimaryLanguage===void 0?void 0:this.privSimpleSpeechPhrase.PrimaryLanguage.Confidence}get SpeakerId(){return this.privSimpleSpeechPhrase.SpeakerId}mapRecognitionStatus(e){if(typeof e=="string")return fR.RecognitionStatus[e];if(typeof e=="number")return e}};Cu.SimpleSpeechPhrase=nf});var mR=u(Pu=>{"use strict";Object.defineProperty(Pu,"__esModule",{value:!0});Pu.AddedLmIntent=void 0;var sf=class{constructor(e,t){this.modelImpl=e,this.intentName=t}};Pu.AddedLmIntent=sf});var SR=u(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});Ru.IntentServiceRecognizer=void 0;var yR=P(),oe=f(),Zi=C(),of=class extends Zi.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privIntentRecognizer=s,this.privIntentDataSent=!1,n.recognitionEndpointVersion="1"}setIntents(e,t){this.privAddedLmIntents=e,this.privUmbrellaIntent=t,this.privIntentDataSent=!0}processTypeSpecificMessages(e){let t,i,n=!1,s=new oe.PropertyCollection;switch(e.messageType===yR.MessageType.Text&&s.setProperty(oe.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speech.hypothesis":let a=Zi.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);if(t=new oe.IntentRecognitionResult(void 0,this.privRequestSession.requestId,oe.ResultReason.RecognizingIntent,a.Text,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,void 0,a.asJson(),s),this.privRequestSession.onHypothesis(t.offset),i=new oe.IntentRecognitionEventArgs(t,a.Offset,this.privRequestSession.sessionId),this.privIntentRecognizer.recognizing)try{this.privIntentRecognizer.recognizing(this.privIntentRecognizer,i)}catch{}n=!0;break;case"speech.phrase":let c=Zi.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);t=new oe.IntentRecognitionResult(void 0,this.privRequestSession.requestId,Zi.EnumTranslation.implTranslateRecognitionResult(c.RecognitionStatus),c.DisplayText,c.Duration,c.Offset,c.Language,c.LanguageDetectionConfidence,void 0,c.asJson(),s),i=new oe.IntentRecognitionEventArgs(t,t.offset,this.privRequestSession.sessionId);let p=()=>{if(this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(t)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}};this.privIntentDataSent===!1||oe.ResultReason.NoMatch===i.result.reason?(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),p()):this.privPendingIntentArgs=i,n=!0;break;case"response":if(i=this.privPendingIntentArgs,this.privPendingIntentArgs=void 0,i===void 0){if(e.textBody==="")return;i=new oe.IntentRecognitionEventArgs(new oe.IntentRecognitionResult,0,this.privRequestSession.sessionId)}let h=Zi.IntentResponse.fromJSON(e.textBody);if(h!==null&&h.topScoringIntent&&h.topScoringIntent.intent){let d=this.privAddedLmIntents[h.topScoringIntent.intent];if(this.privUmbrellaIntent!==void 0&&(d=this.privUmbrellaIntent),d){let v=d===void 0||d.intentName===void 0?h.topScoringIntent.intent:d.intentName,g=i.result.reason;v!==void 0&&(g=oe.ResultReason.RecognizedIntent);let M=i.result.properties!==void 0?i.result.properties:new oe.PropertyCollection;M.setProperty(oe.PropertyId.LanguageUnderstandingServiceResponse_JsonResult,e.textBody),i=new oe.IntentRecognitionEventArgs(new oe.IntentRecognitionResult(v,i.result.resultId,g,i.result.text,i.result.duration,i.result.offset,void 0,void 0,i.result.errorDetails,i.result.json,M),i.offset,i.sessionId)}}if(this.privRequestSession.onPhraseRecognized(i.offset+i.result.duration),this.privIntentRecognizer.recognized)try{this.privIntentRecognizer.recognized(this.privIntentRecognizer,i)}catch{}if(this.privSuccessCallback){try{this.privSuccessCallback(i.result)}catch(d){this.privErrorCallback&&this.privErrorCallback(d)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}n=!0;break;default:break}let o=new yR.Deferred;return o.resolve(n),o.promise}cancelRecognition(e,t,i,n,s){let o=new oe.PropertyCollection;if(o.setProperty(Zi.CancellationErrorCodePropertyName,oe.CancellationErrorCode[n]),this.privIntentRecognizer.canceled){let a=new oe.IntentRecognitionCanceledEventArgs(i,s,n,void 0,void 0,e);try{this.privIntentRecognizer.canceled(this.privIntentRecognizer,a)}catch{}}if(this.privSuccessCallback){let a=new oe.IntentRecognitionResult(void 0,t,oe.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,s,void 0,o);try{this.privSuccessCallback(a),this.privSuccessCallback=void 0}catch{}}}};Ru.IntentServiceRecognizer=of});var CR=u(Eu=>{"use strict";Object.defineProperty(Eu,"__esModule",{value:!0});Eu.IntentResponse=void 0;var af=class r{constructor(e){e===""?this.privIntentResponse={}:this.privIntentResponse=JSON.parse(e)}static fromJSON(e){return new r(e)}get query(){return this.privIntentResponse.query}get topScoringIntent(){return this.privIntentResponse.topScoringIntent}get entities(){return this.privIntentResponse.entities}};Eu.IntentResponse=af});var RR=u(PR=>{"use strict";Object.defineProperty(PR,"__esModule",{value:!0})});var wR=u(wu=>{"use strict";Object.defineProperty(wu,"__esModule",{value:!0});wu.ServiceTelemetryListener=void 0;var ar=P(),ER=Qc(),cf=class{constructor(e,t,i){this.privIsDisposed=!1,this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privRequestId=e,this.privAudioSourceId=t,this.privAudioNodeId=i,this.privReceivedMessages={},this.privPhraseLatencies=[],this.privHypothesisLatencies=[]}phraseReceived(e){e>0&&this.privPhraseLatencies.push(Date.now()-e)}hypothesisReceived(e){e>0&&this.privHypothesisLatencies.push(Date.now()-e)}onEvent(e){this.privIsDisposed||(e instanceof ER.RecognitionTriggeredEvent&&e.requestId===this.privRequestId&&(this.privListeningTriggerMetric={End:e.eventTime,Name:"ListeningTrigger",Start:e.eventTime}),e instanceof ar.AudioStreamNodeAttachingEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof ar.AudioStreamNodeAttachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicStartTime=e.eventTime),e instanceof ar.AudioSourceErrorEvent&&e.audioSourceId===this.privAudioSourceId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof ar.AudioStreamNodeErrorEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Error:e.error,Name:"Microphone",Start:this.privMicStartTime})),e instanceof ar.AudioStreamNodeDetachedEvent&&e.audioSourceId===this.privAudioSourceId&&e.audioNodeId===this.privAudioNodeId&&(this.privMicMetric||(this.privMicMetric={End:e.eventTime,Name:"Microphone",Start:this.privMicStartTime})),e instanceof ER.ConnectingToServiceEvent&&e.requestId===this.privRequestId&&(this.privConnectionId=e.sessionId),e instanceof ar.ConnectionStartEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionStartTime=e.eventTime),e instanceof ar.ConnectionEstablishedEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof ar.ConnectionEstablishErrorEvent&&e.connectionId===this.privConnectionId&&(this.privConnectionEstablishMetric||(this.privConnectionEstablishMetric={End:e.eventTime,Error:this.getConnectionError(e.statusCode),Id:this.privConnectionId,Name:"Connection",Start:this.privConnectionStartTime})),e instanceof ar.ConnectionMessageReceivedEvent&&e.connectionId===this.privConnectionId&&e.message&&e.message.headers&&e.message.headers.path&&(this.privReceivedMessages[e.message.headers.path]||(this.privReceivedMessages[e.message.headers.path]=new Array),this.privReceivedMessages[e.message.headers.path].length<50&&this.privReceivedMessages[e.message.headers.path].push(e.networkReceivedTime)))}getTelemetry(){let e=new Array;this.privListeningTriggerMetric&&e.push(this.privListeningTriggerMetric),this.privMicMetric&&e.push(this.privMicMetric),this.privConnectionEstablishMetric&&e.push(this.privConnectionEstablishMetric),this.privPhraseLatencies.length>0&&e.push({PhraseLatencyMs:this.privPhraseLatencies}),this.privHypothesisLatencies.length>0&&e.push({FirstHypothesisLatencyMs:this.privHypothesisLatencies});let t={Metrics:e,ReceivedMessages:this.privReceivedMessages},i=JSON.stringify(t);return this.privReceivedMessages={},this.privListeningTriggerMetric=null,this.privMicMetric=null,this.privConnectionEstablishMetric=null,this.privPhraseLatencies=[],this.privHypothesisLatencies=[],i}get hasTelemetry(){return Object.keys(this.privReceivedMessages).length!==0||this.privListeningTriggerMetric!==null||this.privMicMetric!==null||this.privConnectionEstablishMetric!==null||this.privPhraseLatencies.length!==0||this.privHypothesisLatencies.length!==0}dispose(){this.privIsDisposed=!0}getConnectionError(e){switch(e){case 400:case 1002:case 1003:case 1005:case 1007:case 1008:case 1009:return"BadRequest";case 401:return"Unauthorized";case 403:return"Forbidden";case 503:case 1001:return"ServerUnavailable";case 500:case 1011:return"ServerError";case 408:case 504:return"Timeout";default:return"statuscode:"+e.toString()}}};wu.ServiceTelemetryListener=cf});var IR=u(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});_u.RequestSession=void 0;var Yi=P(),Iu=Qc(),FO=wR(),uf=class{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privIsAudioNodeDetached=!1,this.privIsRecognizing=!1,this.privIsSpeechEnded=!1,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privHypothesisReceived=!1,this.privBytesSent=0,this.privRecognitionBytesSent=0,this.privRecogNumber=0,this.privInTurn=!1,this.privConnectionAttempts=0,this.privAudioSourceId=e,this.privRequestId=(0,Yi.createNoDashGuid)(),this.privAudioNodeId=(0,Yi.createNoDashGuid)(),this.privTurnDeferral=new Yi.Deferred,this.privTurnDeferral.resolve()}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get audioNodeId(){return this.privAudioNodeId}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSpeechEnded(){return this.privIsSpeechEnded}get isRecognizing(){return this.privIsRecognizing}get currentTurnAudioOffset(){return this.privTurnStartAudioOffset}get recogNumber(){return this.privRecogNumber}get numConnectionAttempts(){return this.privConnectionAttempts}get bytesSent(){return this.privBytesSent}get recognitionBytesSent(){return this.privRecognitionBytesSent}listenForServiceTelemetry(e){this.privServiceTelemetryListener&&this.privDetachables.push(e.attachListener(this.privServiceTelemetryListener))}startNewRecognition(){this.privRecognitionBytesSent=0,this.privIsSpeechEnded=!1,this.privIsRecognizing=!0,this.privTurnStartAudioOffset=0,this.privLastRecoOffset=0,this.privRecogNumber++,this.privServiceTelemetryListener=new FO.ServiceTelemetryListener(this.privRequestId,this.privAudioSourceId,this.privAudioNodeId),this.onEvent(new Iu.RecognitionTriggeredEvent(this.requestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}async onAudioSourceAttachCompleted(e,t){this.privAudioNode=e,this.privIsAudioNodeDetached=!1,t?await this.onComplete():this.onEvent(new Iu.ListeningStartedEvent(this.privRequestId,this.privSessionId,this.privAudioSourceId,this.privAudioNodeId))}onPreConnectionStart(e,t){this.privAuthFetchEventId=e,this.privSessionId=t,this.onEvent(new Iu.ConnectingToServiceEvent(this.privRequestId,this.privAuthFetchEventId,this.privSessionId))}async onAuthCompleted(e){e&&await this.onComplete()}async onConnectionEstablishCompleted(e,t){if(e===200){this.onEvent(new Iu.RecognitionStartedEvent(this.requestId,this.privAudioSourceId,this.privAudioNodeId,this.privAuthFetchEventId,this.privSessionId)),this.privAudioNode&&this.privAudioNode.replay(),this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privBytesSent=0;return}else e===403&&await this.onComplete()}async onServiceTurnEndResponse(e){this.privTurnDeferral.resolve(),!e||this.isSpeechEnded?(await this.onComplete(),this.privInTurn=!1):(this.privTurnStartAudioOffset=this.privLastRecoOffset,this.privAudioNode.replay())}onSpeechContext(){this.privRequestId=(0,Yi.createNoDashGuid)()}onServiceTurnStartResponse(){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new Yi.Deferred}onHypothesis(e){this.privHypothesisReceived||(this.privHypothesisReceived=!0,this.privServiceTelemetryListener.hypothesisReceived(this.privAudioNode.findTimeAtOffset(e)))}onPhraseRecognized(e){this.privServiceTelemetryListener.phraseReceived(this.privAudioNode.findTimeAtOffset(e)),this.onServiceRecognized(e)}onServiceRecognized(e){this.privLastRecoOffset=e,this.privHypothesisReceived=!1,this.privAudioNode.shrinkBuffers(e),this.privConnectionAttempts=0}onAudioSent(e){this.privBytesSent+=e,this.privRecognitionBytesSent+=e}onRetryConnection(){this.privConnectionAttempts++}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(let e of this.privDetachables)await e.detach();this.privServiceTelemetryListener&&this.privServiceTelemetryListener.dispose(),this.privIsRecognizing=!1}}getTelemetry(){return this.privServiceTelemetryListener.hasTelemetry?this.privServiceTelemetryListener.getTelemetry():null}async onStopRecognizing(){await this.onComplete()}onSpeechEnded(){this.privIsSpeechEnded=!0}onEvent(e){this.privServiceTelemetryListener&&this.privServiceTelemetryListener.onEvent(e),Yi.Events.instance.onEvent(e)}async onComplete(){this.privIsRecognizing&&(this.privIsRecognizing=!1,await this.detachAudioNode())}async detachAudioNode(){this.privIsAudioNodeDetached||(this.privIsAudioNodeDetached=!0,this.privAudioNode&&await this.privAudioNode.detach())}};_u.RequestSession=uf});var _R=u(Fe=>{"use strict";Object.defineProperty(Fe,"__esModule",{value:!0});Fe.TentativePhraseResultsOption=Fe.OutputFormat=Fe.PhraseExtension=Fe.PhraseOption=void 0;var VO;(function(r){r.WordTimings="WordTimings",r.SNR="SNR",r.Pronunciation="Pronunciation",r.WordPronunciation="WordPronunciation",r.WordConfidence="WordConfidence",r.Words="Words",r.Sentiment="Sentiment",r.PronunciationAssessment="PronunciationAssessment",r.ContentAssessment="ContentAssessment",r.PhraseAMScore="PhraseAMScore",r.PhraseLMScore="PhraseLMScore",r.WordAMScore="WordAMScore",r.WordLMScore="WordLMScore",r.RuleTree="RuleTree",r.NBestTimings="NBestTimings",r.DecoderDiagnostics="DecoderDiagnostics",r.DisplayWordTimings="DisplayWordTimings",r.DisplayWords="DisplayWords"})(VO=Fe.PhraseOption||(Fe.PhraseOption={}));var UO;(function(r){r.Graph="Graph",r.Corrections="Corrections",r.Sentiment="Sentiment"})(UO=Fe.PhraseExtension||(Fe.PhraseExtension={}));var WO;(function(r){r.Simple="Simple",r.Detailed="Detailed"})(WO=Fe.OutputFormat||(Fe.OutputFormat={}));var HO;(function(r){r.None="None",r.Always="Always"})(HO=Fe.TentativePhraseResultsOption||(Fe.TentativePhraseResultsOption={}))});var bR=u(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});bu.SpeechContext=void 0;var KO=He(),Dr=_R(),pf=class{constructor(e){this.privContext={},this.privDynamicGrammar=e}getContext(){return this.privContext}setPronunciationAssessmentParams(e,t,i=!1){this.privContext.phraseDetection===void 0&&(this.privContext.phraseDetection={enrichment:{pronunciationAssessment:{}}}),this.privContext.phraseDetection.enrichment===void 0&&(this.privContext.phraseDetection.enrichment={pronunciationAssessment:{}}),this.privContext.phraseDetection.enrichment.pronunciationAssessment=JSON.parse(e)||{},i&&(this.privContext.phraseDetection.mode=KO.RecognitionMode.Conversation),this.setWordLevelTimings(),this.privContext.phraseOutput.detailed.options.push(Dr.PhraseOption.PronunciationAssessment),this.privContext.phraseOutput.detailed.options.indexOf(Dr.PhraseOption.SNR)===-1&&this.privContext.phraseOutput.detailed.options.push(Dr.PhraseOption.SNR),t&&(this.privContext.phraseDetection.enrichment.contentAssessment={topic:t},this.privContext.phraseOutput.detailed.options.push(Dr.PhraseOption.ContentAssessment))}setDetailedOutputFormat(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=Dr.OutputFormat.Detailed}setWordLevelTimings(){this.privContext.phraseOutput===void 0&&(this.privContext.phraseOutput={detailed:{options:[]}}),this.privContext.phraseOutput.detailed===void 0&&(this.privContext.phraseOutput.detailed={options:[]}),this.privContext.phraseOutput.format=Dr.OutputFormat.Detailed,this.privContext.phraseOutput.detailed.options.indexOf(Dr.PhraseOption.WordTimings)===-1&&this.privContext.phraseOutput.detailed.options.push(Dr.PhraseOption.WordTimings)}setSpeakerDiarizationAudioOffsetMs(e){this.privContext.phraseDetection.speakerDiarization.audioOffsetMs=e}toJSON(){let e=this.privDynamicGrammar.generateGrammarObject();return this.privContext.dgi=e,JSON.stringify(this.privContext)}};bu.SpeechContext=pf});var AR=u(xr=>{"use strict";Object.defineProperty(xr,"__esModule",{value:!0});xr.SubstringMatchType=xr.GroupType=void 0;var JO;(function(r){r.IntentText="IntentText",r.IntentEntity="IntentEntity",r.Generic="Generic",r.People="People",r.Place="Place",r.DynamicEntity="DynamicEntity"})(JO=xr.GroupType||(xr.GroupType={}));var $O;(function(r){r.None="None",r.LeftRooted="LeftRooted",r.PartialName="PartialName",r.MiddleOfSentence="MiddleOfSentence"})($O=xr.SubstringMatchType||(xr.SubstringMatchType={}))});var TR=u(Au=>{"use strict";Object.defineProperty(Au,"__esModule",{value:!0});Au.DynamicGrammarBuilder=void 0;var GO=AR(),lf=class{constructor(){this.privWeight=1}addPhrase(e){this.privPhrases||(this.privPhrases=[]),e instanceof Array?this.privPhrases=this.privPhrases.concat(e):this.privPhrases.push(e)}clearPhrases(){this.privPhrases=void 0}addReferenceGrammar(e){this.privGrammars||(this.privGrammars=[]),e instanceof Array?this.privGrammars=this.privGrammars.concat(e):this.privGrammars.push(e)}clearGrammars(){this.privGrammars=void 0}setWeight(e){this.privWeight=e}generateGrammarObject(){if(this.privGrammars===void 0&&this.privPhrases===void 0)return;let e={};if(e.referenceGrammars=this.privGrammars,this.privPhrases!==void 0&&this.privPhrases.length!==0){let t=[];this.privPhrases.forEach(i=>{t.push({text:i})}),e.groups=[{type:GO.GroupType.Generic,items:t}],e.bias=this.privWeight}return e}};Au.DynamicGrammarBuilder=lf});var df=u(di=>{"use strict";Object.defineProperty(di,"__esModule",{value:!0});di.MessageDataStreamType=di.ActivityPayloadResponse=void 0;var hf=class r{constructor(e){this.privActivityResponse=JSON.parse(e)}static fromJSON(e){return new r(e)}get conversationId(){return this.privActivityResponse.conversationId}get messageDataStreamType(){return this.privActivityResponse.messageDataStreamType}get messagePayload(){return this.privActivityResponse.messagePayload}get version(){return this.privActivityResponse.version}};di.ActivityPayloadResponse=hf;var QO;(function(r){r[r.None=0]="None",r[r.TextToSpeechAudio=1]="TextToSpeechAudio"})(QO=di.MessageDataStreamType||(di.MessageDataStreamType={}))});var OR=u(Tu=>{"use strict";Object.defineProperty(Tu,"__esModule",{value:!0});Tu.DialogServiceTurnState=void 0;var XO=Ai(),ZO=Xr(),YO=df(),vf=class{constructor(e,t){this.privRequestId=t,this.privIsCompleted=!1,this.privAudioStream=null,this.privTurnManager=e,this.resetTurnEndTimeout()}get audioStream(){return this.resetTurnEndTimeout(),this.privAudioStream}processActivityPayload(e,t){return e.messageDataStreamType===YO.MessageDataStreamType.TextToSpeechAudio&&(this.privAudioStream=ZO.AudioOutputStream.createPullStream(),this.privAudioStream.format=t!==void 0?t:XO.AudioOutputFormatImpl.getDefaultOutputFormat()),this.privAudioStream}endAudioStream(){this.privAudioStream!==null&&!this.privAudioStream.isClosed&&this.privAudioStream.close()}complete(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.endAudioStream()}resetTurnEndTimeout(){this.privTimeoutToken!==void 0&&clearTimeout(this.privTimeoutToken),this.privTimeoutToken=setTimeout(()=>{this.privTurnManager.CompleteTurn(this.privRequestId)},2e3)}};Tu.DialogServiceTurnState=vf});var MR=u(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0});Ou.DialogServiceTurnStateManager=void 0;var kR=vt(),ek=OR(),ff=class{constructor(){this.privTurnMap=new Map}StartTurn(e){if(this.privTurnMap.has(e))throw new kR.InvalidOperationError("Service error: There is already a turn with id:"+e);let t=new ek.DialogServiceTurnState(this,e);return this.privTurnMap.set(e,t),this.privTurnMap.get(e)}GetTurn(e){return this.privTurnMap.get(e)}CompleteTurn(e){if(!this.privTurnMap.has(e))throw new kR.InvalidOperationError("Service error: Received turn end for an unknown turn id:"+e);let t=this.privTurnMap.get(e);return t.complete(),this.privTurnMap.delete(e),t}};Ou.DialogServiceTurnStateManager=ff});var DR=u(ws=>{"use strict";Object.defineProperty(ws,"__esModule",{value:!0});ws.InvocationSource=void 0;var tk;(function(r){r.None="None",r.VoiceActivationWithKeyword="VoiceActivationWithKeyword"})(tk=ws.InvocationSource||(ws.InvocationSource={}))});var xR=u(Nr=>{"use strict";Object.defineProperty(Nr,"__esModule",{value:!0});Nr.OnRejectAction=Nr.KeywordDetectionType=void 0;var rk;(function(r){r.StartTrigger="StartTrigger"})(rk=Nr.KeywordDetectionType||(Nr.KeywordDetectionType={}));var ik;(function(r){r.EndOfTurn="EndOfTurn",r.Continue="Continue"})(ik=Nr.OnRejectAction||(Nr.OnRejectAction={}))});var jR=u(Mu=>{"use strict";Object.defineProperty(Mu,"__esModule",{value:!0});Mu.DialogServiceAdapter=void 0;var nk=ue(),sk=tl(),Oe=P(),ok=Ai(),x=f(),ak=MR(),qt=C(),ck=df(),uk=DR(),NR=xR(),ku=pi(),gf=class extends qt.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privEvents=new Oe.EventSource,this.privDialogServiceConnector=s,this.receiveMessageOverride=()=>this.receiveDialogMessageOverride(),this.privTurnStateManager=new ak.DialogServiceTurnStateManager,this.recognizeOverride=(o,a,c)=>this.listenOnce(o,a,c),this.postConnectImplOverride=o=>this.dialogConnectImpl(o),this.configConnectionOverride=o=>this.configConnection(o),this.disconnectOverride=()=>this.privDisconnect(),this.privDialogAudioSource=i,this.agentConfigSent=!1,this.privLastResult=null,this.connectionEvents.attach(o=>{o.name==="ConnectionClosedEvent"&&(this.terminateMessageLoop=!0)})}async sendMessage(e){let t=(0,Oe.createGuid)(),i=(0,Oe.createNoDashGuid)(),n={context:{interactionId:t},messagePayload:JSON.parse(e),version:.5},s=JSON.stringify(n);await(await this.fetchConnection()).send(new ku.SpeechConnectionMessage(Oe.MessageType.Text,"agent",i,"application/json",s))}async privDisconnect(){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,x.CancellationReason.Error,x.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,this.agentConfigSent=!1}processTypeSpecificMessages(e){let t=new x.PropertyCollection;e.messageType===Oe.MessageType.Text&&t.setProperty(x.PropertyId.SpeechServiceResponse_JsonResult,e.textBody);let i,n;switch(e.path.toLowerCase()){case"speech.phrase":let o=qt.SimpleSpeechPhrase.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);if(this.privRequestSession.onPhraseRecognized(o.Offset+o.Duration),o.RecognitionStatus!==qt.RecognitionStatus.TooManyRequests&&o.RecognitionStatus!==qt.RecognitionStatus.Error){let d=this.fireEventForResult(o,t);if(this.privLastResult=d.result,this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,d)}catch{}}n=!0;break;case"speech.hypothesis":let a=qt.SpeechHypothesis.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i=new x.SpeechRecognitionResult(this.privRequestSession.requestId,x.ResultReason.RecognizingSpeech,a.Text,a.Duration,a.Offset,a.Language,a.LanguageDetectionConfidence,void 0,void 0,a.asJson(),t),this.privRequestSession.onHypothesis(a.Offset);let c=new x.SpeechRecognitionEventArgs(i,a.Offset,this.privRequestSession.sessionId);if(this.privDialogServiceConnector.recognizing)try{this.privDialogServiceConnector.recognizing(this.privDialogServiceConnector,c)}catch{}n=!0;break;case"speech.keyword":let p=qt.SpeechKeyword.fromJSON(e.textBody,this.privRequestSession.currentTurnAudioOffset);i=new x.SpeechRecognitionResult(this.privRequestSession.requestId,p.Status==="Accepted"?x.ResultReason.RecognizedKeyword:x.ResultReason.NoMatch,p.Text,p.Duration,p.Offset,void 0,void 0,void 0,void 0,p.asJson(),t),p.Status!=="Accepted"&&(this.privLastResult=i);let h=new x.SpeechRecognitionEventArgs(i,i.duration,i.resultId);if(this.privDialogServiceConnector.recognized)try{this.privDialogServiceConnector.recognized(this.privDialogServiceConnector,h)}catch{}n=!0;break;case"audio":{let d=e.requestId.toUpperCase(),v=this.privTurnStateManager.GetTurn(d);try{e.binaryBody?v.audioStream.write(e.binaryBody):v.endAudioStream()}catch{}}n=!0;break;case"response":this.handleResponseMessage(e),n=!0;break;default:break}let s=new Oe.Deferred;return s.resolve(n),s.promise}async cancelRecognition(e,t,i,n,s){if(this.terminateMessageLoop=!0,this.privRequestSession.isRecognizing&&await this.privRequestSession.onStopRecognizing(),this.privDialogServiceConnector.canceled){let o=new x.PropertyCollection;o.setProperty(qt.CancellationErrorCodePropertyName,x.CancellationErrorCode[n]);let a=new x.SpeechRecognitionCanceledEventArgs(i,s,n,void 0,e);try{this.privDialogServiceConnector.canceled(this.privDialogServiceConnector,a)}catch{}if(this.privSuccessCallback){let c=new x.SpeechRecognitionResult(void 0,x.ResultReason.Canceled,void 0,void 0,void 0,void 0,void 0,void 0,s,void 0,o);try{this.privSuccessCallback(c),this.privSuccessCallback=void 0}catch{}}}}async listenOnce(e,t,i){this.privRecognizerConfig.recognitionMode=e,this.privSuccessCallback=t,this.privErrorCallback=i,this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privDialogAudioSource.events),this.privRecognizerConfig.parameters.setProperty(x.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);let n=this.connectImpl(),s=this.sendPreAudioMessages(),o=await this.privDialogAudioSource.attach(this.privRequestSession.audioNodeId),a=await this.privDialogAudioSource.format,c=await this.privDialogAudioSource.deviceInfo,p=new nk.ReplayableAudioNode(o,a.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(p,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:c};try{await n,await s}catch(v){return await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,x.CancellationReason.Error,x.CancellationErrorCode.ConnectionFailure,v),Promise.resolve()}let h=new x.SessionEventArgs(this.privRequestSession.sessionId);this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,h),this.sendAudio(p).then(()=>{},async v=>{await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,x.CancellationReason.Error,x.CancellationErrorCode.RuntimeError,v)})}dialogConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}receiveDialogMessageOverride(){let e=new Oe.Deferred,t=async()=>{try{let i=this.isDisposed(),n=!this.isDisposed()&&this.terminateMessageLoop;if(i||n){e.resolve(void 0);return}let o=await(await this.fetchConnection()).read();if(!o)return t();let a=ku.SpeechConnectionMessage.fromConnectionMessage(o);switch(a.path.toLowerCase()){case"turn.start":{let M=a.requestId.toUpperCase(),A=this.privRequestSession.requestId.toUpperCase();M!==A?this.privTurnStateManager.StartTurn(M):this.privRequestSession.onServiceTurnStartResponse()}break;case"speech.startdetected":let p=qt.SpeechDetected.fromJSON(a.textBody,this.privRequestSession.currentTurnAudioOffset),h=new x.RecognitionEventArgs(p.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechStartDetected&&this.privRecognizer.speechStartDetected(this.privRecognizer,h);break;case"speech.enddetected":let d;a.textBody.length>0?d=a.textBody:d="{ Offset: 0 }";let v=qt.SpeechDetected.fromJSON(d,this.privRequestSession.currentTurnAudioOffset);this.privRequestSession.onServiceRecognized(v.Offset);let g=new x.RecognitionEventArgs(v.Offset,this.privRequestSession.sessionId);this.privRecognizer.speechEndDetected&&this.privRecognizer.speechEndDetected(this.privRecognizer,g);break;case"turn.end":{let M=a.requestId.toUpperCase(),A=this.privRequestSession.requestId.toUpperCase();if(M!==A)this.privTurnStateManager.CompleteTurn(M);else{let H=new x.SessionEventArgs(this.privRequestSession.sessionId);if(await this.privRequestSession.onServiceTurnEndResponse(!1),(!this.privRecognizerConfig.isContinuousRecognition||this.privRequestSession.isSpeechEnded||!this.privRequestSession.isRecognizing)&&this.privRecognizer.sessionStopped&&this.privRecognizer.sessionStopped(this.privRecognizer,H),this.privSuccessCallback&&this.privLastResult){try{this.privSuccessCallback(this.privLastResult),this.privLastResult=null}catch(ee){this.privErrorCallback&&this.privErrorCallback(ee)}this.privSuccessCallback=void 0,this.privErrorCallback=void 0}}}break;default:try{await this.processTypeSpecificMessages(a)||this.serviceEvents&&this.serviceEvents.onEvent(new Oe.ServiceEvent(a.path.toLowerCase(),a.textBody))}catch{}}return t()}catch{this.terminateMessageLoop=!0,e.resolve()}};return t().catch(i=>{Oe.Events.instance.onEvent(new Oe.BackgroundEvent(i))}),e.promise}async startMessageLoop(){this.terminateMessageLoop=!1;try{await this.receiveDialogMessageOverride()}catch(e){await this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,x.CancellationReason.Error,x.CancellationErrorCode.RuntimeError,e)}return Promise.resolve()}async configConnection(e){return this.terminateMessageLoop?(this.terminateMessageLoop=!1,Promise.reject("Connection to service terminated.")):(await this.sendSpeechServiceConfig(e,this.privRequestSession,this.privRecognizerConfig.SpeechServiceConfig.serialize()),await this.sendAgentConfig(e),e)}async sendPreAudioMessages(){let e=await this.fetchConnection();this.addKeywordContextData(),await this.sendSpeechContext(e,!0),await this.sendAgentContext(e),await this.sendWaveHeader(e)}sendAgentConfig(e){if(this.agentConfig&&!this.agentConfigSent){if(this.privRecognizerConfig.parameters.getProperty(x.PropertyId.Conversation_DialogType)===x.DialogServiceConfig.DialogTypes.CustomCommands){let i=this.agentConfig.get();i.botInfo.commandsCulture=this.privRecognizerConfig.parameters.getProperty(x.PropertyId.SpeechServiceConnection_RecoLanguage,"en-us"),this.agentConfig.set(i)}this.onEvent(new sk.SendingAgentContextMessageEvent(this.agentConfig));let t=this.agentConfig.toJsonString();return this.agentConfigSent=!0,e.send(new ku.SpeechConnectionMessage(Oe.MessageType.Text,"agent.config",this.privRequestSession.requestId,"application/json",t))}}sendAgentContext(e){let t=(0,Oe.createGuid)(),i=this.privDialogServiceConnector.properties.getProperty(x.PropertyId.Conversation_Speech_Activity_Template),s=JSON.stringify({channelData:"",context:{interactionId:t},messagePayload:typeof i===void 0?void 0:i,version:.5});return e.send(new ku.SpeechConnectionMessage(Oe.MessageType.Text,"speech.agent.context",this.privRequestSession.requestId,"application/json",s))}fireEventForResult(e,t){let i=qt.EnumTranslation.implTranslateRecognitionResult(e.RecognitionStatus),n=new x.SpeechRecognitionResult(this.privRequestSession.requestId,i,e.DisplayText,e.Duration,e.Offset,e.Language,e.LanguageDetectionConfidence,void 0,void 0,e.asJson(),t);return new x.SpeechRecognitionEventArgs(n,e.Offset,this.privRequestSession.sessionId)}handleResponseMessage(e){let t=JSON.parse(e.textBody);switch(t.messageType.toLowerCase()){case"message":let i=e.requestId.toUpperCase(),n=ck.ActivityPayloadResponse.fromJSON(e.textBody),s=this.privTurnStateManager.GetTurn(i);if(n.conversationId){let c=this.agentConfig.get();c.botInfo.conversationId=n.conversationId,this.agentConfig.set(c)}let o=s.processActivityPayload(n,ok.AudioOutputFormatImpl.fromSpeechSynthesisOutputFormatString(this.privDialogServiceConnector.properties.getProperty(x.PropertyId.SpeechServiceConnection_SynthOutputFormat,void 0))),a=new x.ActivityReceivedEventArgs(n.messagePayload,o);if(this.privDialogServiceConnector.activityReceived)try{this.privDialogServiceConnector.activityReceived(this.privDialogServiceConnector,a)}catch{}break;case"messagestatus":if(this.privDialogServiceConnector.turnStatusReceived)try{this.privDialogServiceConnector.turnStatusReceived(this.privDialogServiceConnector,new x.TurnStatusReceivedEventArgs(e.textBody))}catch{}break;default:Oe.Events.instance.onEvent(new Oe.BackgroundEvent(`Unexpected response of type ${t.messageType}. Ignoring.`));break}}onEvent(e){this.privEvents.onEvent(e),Oe.Events.instance.onEvent(e)}addKeywordContextData(){let e=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect");if(e===void 0)return;let t=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Offsets"),i=this.privRecognizerConfig.parameters.getProperty("SPEECH-KeywordsToDetect-Durations"),n=e.split(";"),s=t===void 0?[]:t.split(";"),o=i===void 0?[]:i.split(";"),a=[];for(let c=0;c<n.length;c++){let p={text:n[c]};c<s.length&&(p.startOffset=Number(s[c])),c<o.length&&(p.duration=Number(o[c])),a.push(p)}this.speechContext.getContext().invocationSource=uk.InvocationSource.VoiceActivationWithKeyword,this.speechContext.getContext().keywordDetection=[{clientDetectedKeywords:a,onReject:{action:NR.OnRejectAction.EndOfTurn},type:NR.KeywordDetectionType.StartTrigger}]}};Mu.DialogServiceAdapter=gf});var qR=u(Du=>{"use strict";Object.defineProperty(Du,"__esModule",{value:!0});Du.AgentConfig=void 0;var mf=class{toJsonString(){return JSON.stringify(this.iPrivConfig)}get(){return this.iPrivConfig}set(e){this.iPrivConfig=e}};Du.AgentConfig=mf});var Nu=u(xu=>{"use strict";Object.defineProperty(xu,"__esModule",{value:!0});xu.ConversationConnectionConfig=void 0;var pk=Pv(),zt=class r extends pk.RestConfigBase{static get host(){return r.privHost}static get apiVersion(){return r.privApiVersion}static get clientAppId(){return r.privClientAppId}static get defaultLanguageCode(){return r.privDefaultLanguageCode}static get restPath(){return r.privRestPath}static get webSocketPath(){return r.privWebSocketPath}static get transcriptionEventKeys(){return r.privTranscriptionEventKeys}};xu.ConversationConnectionConfig=zt;zt.privHost="dev.microsofttranslator.com";zt.privRestPath="/capito/room";zt.privApiVersion="2.0";zt.privDefaultLanguageCode="en-US";zt.privClientAppId="FC539C22-1767-4F1F-84BC-B4D811114F15";zt.privWebSocketPath="/capito/translate";zt.privTranscriptionEventKeys=["iCalUid","callId","organizer","FLAC","MTUri","DifferentiateGuestSpeakers","audiorecording","Threadid","OrganizerMri","OrganizerTenantId","UserToken"]});var zR=u(qu=>{"use strict";Object.defineProperty(qu,"__esModule",{value:!0});qu.ConversationManager=void 0;var ju=ue(),jr=I(),cr=f(),vi=Nu(),yf=class{constructor(){this.privRequestParams=vi.ConversationConnectionConfig.configParams,this.privErrors=vi.ConversationConnectionConfig.restErrors,this.privHost=vi.ConversationConnectionConfig.host,this.privApiVersion=vi.ConversationConnectionConfig.apiVersion,this.privRestPath=vi.ConversationConnectionConfig.restPath,this.privRestAdapter=new ju.RestMessageAdapter({})}createOrJoin(e,t,i,n){try{jr.Contracts.throwIfNullOrUndefined(e,"args");let s=e.getProperty(cr.PropertyId.SpeechServiceConnection_RecoLanguage,vi.ConversationConnectionConfig.defaultLanguageCode),o=e.getProperty(cr.PropertyId.ConversationTranslator_Name,"conversation_host"),a=e.getProperty(cr.PropertyId.ConversationTranslator_Host,this.privHost),c=e.getProperty(cr.PropertyId.ConversationTranslator_CorrelationId),p=e.getProperty(cr.PropertyId.SpeechServiceConnection_Key),h=e.getProperty(cr.PropertyId.SpeechServiceConnection_Region),d=e.getProperty(cr.PropertyId.SpeechServiceAuthorization_Token);jr.Contracts.throwIfNullOrWhitespace(s,"languageCode"),jr.Contracts.throwIfNullOrWhitespace(o,"nickname"),jr.Contracts.throwIfNullOrWhitespace(a,"endpointHost");let v={};v[this.privRequestParams.apiVersion]=this.privApiVersion,v[this.privRequestParams.languageCode]=s,v[this.privRequestParams.nickname]=o;let g={};c&&(g[this.privRequestParams.correlationId]=c),g[this.privRequestParams.clientAppId]=vi.ConversationConnectionConfig.clientAppId,t!==void 0?v[this.privRequestParams.roomId]=t:(jr.Contracts.throwIfNullOrUndefined(h,this.privErrors.authInvalidSubscriptionRegion),g[this.privRequestParams.subscriptionRegion]=h,p?g[this.privRequestParams.subscriptionKey]=p:d?g[this.privRequestParams.authorization]=`Bearer ${d}`:jr.Contracts.throwIfNullOrUndefined(p,this.privErrors.authInvalidSubscriptionKey));let M={};M.headers=g,this.privRestAdapter.options=M;let A=`https://${a}${this.privRestPath}`;this.privRestAdapter.request(ju.RestRequestType.Post,A,v,null).then(H=>{let ee=ju.RestMessageAdapter.extractHeaderValue(this.privRequestParams.requestId,H.headers);if(!H.ok){if(n){let Pe=this.privErrors.invalidCreateJoinConversationResponse.replace("{status}",H.status.toString()),U;try{U=JSON.parse(H.data),Pe+=` [${U.error.code}: ${U.error.message}]`}catch{Pe+=` [${H.data}]`}ee&&(Pe+=` ${ee}`),n(Pe)}return}let ne=JSON.parse(H.data);if(ne&&(ne.requestId=ee),i){try{i(ne)}catch(Pe){n&&n(Pe)}i=void 0}}).catch(()=>{})}catch(s){if(n)if(s instanceof Error){let o=s;n(o.name+": "+o.message)}else n(s)}}leave(e,t){return new Promise((i,n)=>{try{jr.Contracts.throwIfNullOrUndefined(e,this.privErrors.invalidArgs.replace("{arg}","config")),jr.Contracts.throwIfNullOrWhitespace(t,this.privErrors.invalidArgs.replace("{arg}","token"));let s=e.getProperty(cr.PropertyId.ConversationTranslator_Host,this.privHost),o=e.getProperty(cr.PropertyId.ConversationTranslator_CorrelationId),a={};a[this.privRequestParams.apiVersion]=this.privApiVersion,a[this.privRequestParams.sessionToken]=t;let c={};o&&(c[this.privRequestParams.correlationId]=o);let p={};p.headers=c,this.privRestAdapter.options=p;let h=`https://${s}${this.privRestPath}`;this.privRestAdapter.request(ju.RestRequestType.Delete,h,a,null).then(d=>{d.ok,i()}).catch(()=>{})}catch(s){if(s instanceof Error){let o=s;n(o.name+": "+o.message)}else n(s)}})}};qu.ConversationManager=yf});var Cf=u(zu=>{"use strict";Object.defineProperty(zu,"__esModule",{value:!0});zu.ConversationConnectionMessage=void 0;var lk=P(),Sf=class extends lk.ConnectionMessage{constructor(e,t,i,n){super(e,t,i,n);let s=JSON.parse(this.textBody);s.type!==void 0&&(this.privConversationMessageType=s.type)}get conversationMessageType(){return this.privConversationMessageType}};zu.ConversationConnectionMessage=Sf});var BR=u(Lu=>{"use strict";Object.defineProperty(Lu,"__esModule",{value:!0});Lu.ConversationWebsocketMessageFormatter=void 0;var fi=P(),LR=Cf(),Pf=class{toConnectionMessage(e){let t=new fi.Deferred;try{if(e.messageType===fi.MessageType.Text){let i=new LR.ConversationConnectionMessage(e.messageType,e.textContent,{},e.id);t.resolve(i)}else e.messageType===fi.MessageType.Binary&&t.resolve(new LR.ConversationConnectionMessage(e.messageType,e.binaryContent,void 0,e.id))}catch(i){t.reject(`Error formatting the message. Error: ${i}`)}return t.promise}fromConnectionMessage(e){let t=new fi.Deferred;try{if(e.messageType===fi.MessageType.Text){let i=`${e.textBody?e.textBody:""}`;t.resolve(new fi.RawWebsocketMessage(fi.MessageType.Text,i,e.id))}}catch(i){t.reject(`Error formatting the message. ${i}`)}return t.promise}};Lu.ConversationWebsocketMessageFormatter=Pf});var VR=u(Bu=>{"use strict";Object.defineProperty(Bu,"__esModule",{value:!0});Bu.ConversationConnectionFactory=void 0;var FR=ue(),hk=P(),dk=I(),Rf=f(),vk=tt(),en=Nu(),fk=BR(),Ef=class extends vk.ConnectionFactoryBase{create(e,t,i){let n=e.parameters.getProperty(Rf.PropertyId.ConversationTranslator_Host,en.ConversationConnectionConfig.host),s=e.parameters.getProperty(Rf.PropertyId.ConversationTranslator_CorrelationId,(0,hk.createGuid)()),o=`wss://${n}${en.ConversationConnectionConfig.webSocketPath}`,a=e.parameters.getProperty(Rf.PropertyId.ConversationTranslator_Token,void 0);dk.Contracts.throwIfNullOrUndefined(a,"token");let c={};c[en.ConversationConnectionConfig.configParams.apiVersion]=en.ConversationConnectionConfig.apiVersion,c[en.ConversationConnectionConfig.configParams.token]=a,c[en.ConversationConnectionConfig.configParams.correlationId]=s;let p=e.parameters.getProperty("SPEECH-EnableWebsocketCompression","false")==="true";return Promise.resolve(new FR.WebsocketConnection(o,c,{},new fk.ConversationWebsocketMessageFormatter,FR.ProxyInfo.fromRecognizerConfig(e),p,i))}};Bu.ConversationConnectionFactory=Ef});var UR=u(Fu=>{"use strict";Object.defineProperty(Fu,"__esModule",{value:!0});Fu.ConversationRequestSession=void 0;var wf=P(),If=class{constructor(e){this.privIsDisposed=!1,this.privDetachables=new Array,this.privSessionId=e,this.privRequestId=(0,wf.createNoDashGuid)(),this.privRequestCompletionDeferral=new wf.Deferred}get sessionId(){return this.privSessionId}get requestId(){return this.privRequestId}get completionPromise(){return this.privRequestCompletionDeferral.promise}onPreConnectionStart(e,t){this.privSessionId=t}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){e!==200&&e===403&&this.onComplete()}onServiceTurnEndResponse(e){e?this.privRequestId=(0,wf.createNoDashGuid)():this.onComplete()}async dispose(){if(!this.privIsDisposed){this.privIsDisposed=!0;for(let e of this.privDetachables)await e.detach()}}onComplete(){}};Fu.ConversationRequestSession=If});var Mf=u(Ve=>{"use strict";Object.defineProperty(Ve,"__esModule",{value:!0});Ve.ConversationReceivedTranslationEventArgs=Ve.ParticipantsListEventArgs=Ve.ParticipantAttributeEventArgs=Ve.ParticipantEventArgs=Ve.LockRoomEventArgs=Ve.MuteAllEventArgs=void 0;var Is=f(),_f=class extends Is.SessionEventArgs{constructor(e,t){super(t),this.privIsMuted=e}get isMuted(){return this.privIsMuted}};Ve.MuteAllEventArgs=_f;var bf=class extends Is.SessionEventArgs{constructor(e,t){super(t),this.privIsLocked=e}get isMuted(){return this.privIsLocked}};Ve.LockRoomEventArgs=bf;var Af=class extends Is.SessionEventArgs{constructor(e,t){super(t),this.privParticipant=e}get participant(){return this.privParticipant}};Ve.ParticipantEventArgs=Af;var Tf=class extends Is.SessionEventArgs{constructor(e,t,i,n){super(n),this.privKey=t,this.privValue=i,this.privParticipantId=e}get value(){return this.privValue}get key(){return this.privKey}get id(){return this.privParticipantId}};Ve.ParticipantAttributeEventArgs=Tf;var Of=class extends Is.SessionEventArgs{constructor(e,t,i,n,s,o,a,c,p){super(p),this.privRoomId=e,this.privSessionToken=t,this.privTranslateTo=i,this.privProfanityFilter=n,this.privRoomProfanityFilter=s,this.privIsRoomLocked=o,this.privIsRoomLocked=a,this.privParticipants=c}get sessionToken(){return this.privSessionToken}get conversationId(){return this.privRoomId}get translateTo(){return this.privTranslateTo}get profanityFilter(){return this.privProfanityFilter}get roomProfanityFilter(){return this.privRoomProfanityFilter}get isRoomLocked(){return this.privIsRoomLocked}get isMuteAll(){return this.privIsMuteAll}get participants(){return this.privParticipants}};Ve.ParticipantsListEventArgs=Of;var kf=class{constructor(e,t,i){this.privPayload=t,this.privCommand=e,this.privSessionId=i}get payload(){return this.privPayload}get command(){return this.privCommand}get sessionId(){return this.privSessionId}};Ve.ConversationReceivedTranslationEventArgs=kf});var xf=u(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.ConversationTranslatorCommandTypes=qr.ConversationTranslatorMessageTypes=qr.InternalParticipants=void 0;var Df=class{constructor(e=[],t){this.participants=e,this.meId=t}addOrUpdateParticipant(e){if(e===void 0)return;let t=this.getParticipantIndex(e.id);return t>-1?this.participants.splice(t,1,e):this.participants.push(e),this.getParticipant(e.id)}getParticipantIndex(e){return this.participants.findIndex(t=>t.id===e)}getParticipant(e){return this.participants.find(t=>t.id===e)}deleteParticipant(e){this.participants=this.participants.filter(t=>t.id!==e)}get host(){return this.participants.find(e=>e.isHost===!0)}get me(){return this.getParticipant(this.meId)}};qr.InternalParticipants=Df;qr.ConversationTranslatorMessageTypes={command:"command",final:"final",info:"info",instantMessage:"instant_message",keepAlive:"keep_alive",partial:"partial",participantCommand:"participant_command",translatedMessage:"translated_message"};qr.ConversationTranslatorCommandTypes={changeNickname:"ChangeNickname",disconnectSession:"DisconnectSession",ejectParticipant:"EjectParticipant",instant_message:"instant_message",joinSession:"JoinSession",leaveSession:"LeaveSession",participantList:"ParticipantList",roomExpirationWarning:"RoomExpirationWarning",setLockState:"SetLockState",setMute:"SetMute",setMuteAll:"SetMuteAll",setProfanityFiltering:"SetProfanityFiltering",setTranslateToLanguages:"SetTranslateToLanguages",setUseTTS:"SetUseTTS"}});var WR=u(Vu=>{"use strict";Object.defineProperty(Vu,"__esModule",{value:!0});Vu.CommandResponsePayload=void 0;var gk=r=>JSON.parse(r),Nf=class r{constructor(e){this.privCommandResponse=gk(e)}get type(){return this.privCommandResponse.type}get command(){return this.privCommandResponse.command}get id(){return this.privCommandResponse.id}get nickname(){return this.privCommandResponse.nickname}get participantId(){return this.privCommandResponse.participantId}get roomid(){return this.privCommandResponse.roomid}get value(){return this.privCommandResponse.value}get token(){return this.privCommandResponse.token}static fromJSON(e){return new r(e)}};Vu.CommandResponsePayload=Nf});var HR=u(tn=>{"use strict";Object.defineProperty(tn,"__esModule",{value:!0});tn.ParticipantPayloadResponse=tn.ParticipantsListPayloadResponse=void 0;var mk=r=>JSON.parse(r),yk=r=>JSON.parse(r),jf=class r{constructor(e){this.privParticipantsPayloadResponse=mk(e)}get roomid(){return this.privParticipantsPayloadResponse.roomid}get id(){return this.privParticipantsPayloadResponse.id}get command(){return this.privParticipantsPayloadResponse.command}get participants(){return this.privParticipantsPayloadResponse.participants}get token(){return this.privParticipantsPayloadResponse.token}get translateTo(){return this.privParticipantsPayloadResponse.translateTo}get profanityFilter(){return this.privParticipantsPayloadResponse.profanityFilter}get roomProfanityFilter(){return this.privParticipantsPayloadResponse.roomProfanityFilter}get roomLocked(){return this.privParticipantsPayloadResponse.roomLocked}get muteAll(){return this.privParticipantsPayloadResponse.muteAll}get type(){return this.privParticipantsPayloadResponse.type}static fromJSON(e){return new r(e)}};tn.ParticipantsListPayloadResponse=jf;var qf=class r{constructor(e){this.privParticipantPayloadResponse=yk(e)}get nickname(){return this.privParticipantPayloadResponse.nickname}get locale(){return this.privParticipantPayloadResponse.locale}get usetts(){return this.privParticipantPayloadResponse.usetts}get ismuted(){return this.privParticipantPayloadResponse.ismuted}get ishost(){return this.privParticipantPayloadResponse.ishost}get participantId(){return this.privParticipantPayloadResponse.participantId}get avatar(){return this.privParticipantPayloadResponse.avatar}static fromJSON(e){return new r(e)}};tn.ParticipantPayloadResponse=qf});var KR=u(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.TextResponsePayload=rn.SpeechResponsePayload=void 0;var Sk=r=>JSON.parse(r),Ck=r=>JSON.parse(r),zf=class r{constructor(e){this.privSpeechResponse=Sk(e)}get recognition(){return this.privSpeechResponse.recognition}get translations(){return this.privSpeechResponse.translations}get id(){return this.privSpeechResponse.id}get language(){return this.privSpeechResponse.language}get nickname(){return this.privSpeechResponse.nickname}get participantId(){return this.privSpeechResponse.participantId}get roomid(){return this.privSpeechResponse.roomid}get timestamp(){return this.privSpeechResponse.timestamp}get type(){return this.privSpeechResponse.type}get isFinal(){return this.privSpeechResponse.type==="final"}static fromJSON(e){return new r(e)}};rn.SpeechResponsePayload=zf;var Lf=class r{constructor(e){this.privTextResponse=Ck(e)}get originalText(){return this.privTextResponse.originalText}get translations(){return this.privTextResponse.translations}get id(){return this.privTextResponse.id}get language(){return this.privTextResponse.language}get nickname(){return this.privTextResponse.nickname}get participantId(){return this.privTextResponse.participantId}get roomid(){return this.privTextResponse.roomid}get timestamp(){return this.privTextResponse.timestamp}get type(){return this.privTextResponse.type}static fromJSON(e){return new r(e)}};rn.TextResponsePayload=Lf});var GR=u(at=>{"use strict";Object.defineProperty(at,"__esModule",{value:!0});at.TextResponsePayload=at.SpeechResponsePayload=at.ParticipantPayloadResponse=at.ParticipantsListPayloadResponse=at.CommandResponsePayload=void 0;var Pk=WR();Object.defineProperty(at,"CommandResponsePayload",{enumerable:!0,get:function(){return Pk.CommandResponsePayload}});var JR=HR();Object.defineProperty(at,"ParticipantsListPayloadResponse",{enumerable:!0,get:function(){return JR.ParticipantsListPayloadResponse}});Object.defineProperty(at,"ParticipantPayloadResponse",{enumerable:!0,get:function(){return JR.ParticipantPayloadResponse}});var $R=KR();Object.defineProperty(at,"SpeechResponsePayload",{enumerable:!0,get:function(){return $R.SpeechResponsePayload}});Object.defineProperty(at,"TextResponsePayload",{enumerable:!0,get:function(){return $R.TextResponsePayload}})});var ZR=u(Uu=>{"use strict";Object.defineProperty(Uu,"__esModule",{value:!0});Uu.ConversationServiceAdapter=void 0;var _s=P(),Rt=f(),QR=C(),XR=Cf(),Rk=UR(),Ge=Mf(),zr=xf(),bs=GR(),Bf=class extends QR.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privConnectionConfigPromise=void 0,this.privLastPartialUtteranceId="",this.privConversationServiceConnector=s,this.privConversationAuthentication=e,this.receiveMessageOverride=()=>this.receiveConversationMessageOverride(),this.recognizeOverride=()=>this.noOp(),this.postConnectImplOverride=o=>this.conversationConnectImpl(o),this.configConnectionOverride=()=>this.configConnection(),this.disconnectOverride=()=>this.privDisconnect(),this.privConversationRequestSession=new Rk.ConversationRequestSession((0,_s.createNoDashGuid)()),this.privConversationConnectionFactory=t,this.privConversationIsDisposed=!1}isDisposed(){return super.isDisposed()||this.privConversationIsDisposed}async dispose(e){this.privConversationIsDisposed=!0,this.privConnectionConfigPromise!==void 0&&await(await this.privConnectionConfigPromise).dispose(e),await super.dispose(e)}async sendMessage(e){return(await this.fetchConnection()).send(new XR.ConversationConnectionMessage(_s.MessageType.Text,e))}async sendMessageAsync(e){await(await this.fetchConnection()).send(new XR.ConversationConnectionMessage(_s.MessageType.Text,e))}privDisconnect(){if(!this.terminateMessageLoop)return this.cancelRecognition(this.privConversationRequestSession.sessionId,this.privConversationRequestSession.requestId,Rt.CancellationReason.Error,Rt.CancellationErrorCode.NoError,"Disconnecting"),this.terminateMessageLoop=!0,Promise.resolve()}async processTypeSpecificMessages(){return!0}cancelRecognition(e,t,i,n,s){this.terminateMessageLoop=!0;let o=new Rt.ConversationTranslationCanceledEventArgs(i,s,n,void 0,e);try{this.privConversationServiceConnector.canceled&&this.privConversationServiceConnector.canceled(this.privConversationServiceConnector,o)}catch{}}async conversationConnectImpl(e){return this.privConnectionLoop=this.startMessageLoop(),e}async receiveConversationMessageOverride(){if(this.isDisposed()||this.terminateMessageLoop)return Promise.resolve();let e=new _s.Deferred;try{let i=await(await this.fetchConnection()).read();if(this.isDisposed()||this.terminateMessageLoop)return e.resolve(),Promise.resolve();if(!i)return this.receiveConversationMessageOverride();let n=this.privConversationRequestSession.sessionId,s=i.conversationMessageType.toLowerCase(),o=!1;try{switch(s){case"info":case"participant_command":case"command":let a=bs.CommandResponsePayload.fromJSON(i.textBody);switch(a.command.toLowerCase()){case"participantlist":let g=bs.ParticipantsListPayloadResponse.fromJSON(i.textBody),M=g.participants.map(U=>({avatar:U.avatar,displayName:U.nickname,id:U.participantId,isHost:U.ishost,isMuted:U.ismuted,isUsingTts:U.usetts,preferredLanguage:U.locale}));this.privConversationServiceConnector.participantsListReceived&&this.privConversationServiceConnector.participantsListReceived(this.privConversationServiceConnector,new Ge.ParticipantsListEventArgs(g.roomid,g.token,g.translateTo,g.profanityFilter,g.roomProfanityFilter,g.roomLocked,g.muteAll,M,n));break;case"settranslatetolanguages":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantAttributeEventArgs(a.participantId,zr.ConversationTranslatorCommandTypes.setTranslateToLanguages,a.value,n));break;case"setprofanityfiltering":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantAttributeEventArgs(a.participantId,zr.ConversationTranslatorCommandTypes.setProfanityFiltering,a.value,n));break;case"setmute":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantAttributeEventArgs(a.participantId,zr.ConversationTranslatorCommandTypes.setMute,a.value,n));break;case"setmuteall":this.privConversationServiceConnector.muteAllCommandReceived&&this.privConversationServiceConnector.muteAllCommandReceived(this.privConversationServiceConnector,new Ge.MuteAllEventArgs(a.value,n));break;case"roomexpirationwarning":this.privConversationServiceConnector.conversationExpiration&&this.privConversationServiceConnector.conversationExpiration(this.privConversationServiceConnector,new Rt.ConversationExpirationEventArgs(a.value,this.privConversationRequestSession.sessionId));break;case"setusetts":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantAttributeEventArgs(a.participantId,zr.ConversationTranslatorCommandTypes.setUseTTS,a.value,n));break;case"setlockstate":this.privConversationServiceConnector.lockRoomCommandReceived&&this.privConversationServiceConnector.lockRoomCommandReceived(this.privConversationServiceConnector,new Ge.LockRoomEventArgs(a.value,n));break;case"changenickname":this.privConversationServiceConnector.participantUpdateCommandReceived&&this.privConversationServiceConnector.participantUpdateCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantAttributeEventArgs(a.participantId,zr.ConversationTranslatorCommandTypes.changeNickname,a.value,n));break;case"joinsession":let A=bs.ParticipantPayloadResponse.fromJSON(i.textBody),H={avatar:A.avatar,displayName:A.nickname,id:A.participantId,isHost:A.ishost,isMuted:A.ismuted,isUsingTts:A.usetts,preferredLanguage:A.locale};this.privConversationServiceConnector.participantJoinCommandReceived&&this.privConversationServiceConnector.participantJoinCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantEventArgs(H,n));break;case"leavesession":let ee={id:a.participantId};this.privConversationServiceConnector.participantLeaveCommandReceived&&this.privConversationServiceConnector.participantLeaveCommandReceived(this.privConversationServiceConnector,new Ge.ParticipantEventArgs(ee,n));break;case"disconnectsession":let ne={id:a.participantId};break;case"token":let Pe=new QR.CognitiveTokenAuthentication(()=>{let U=a.token;return Promise.resolve(U)},()=>{let U=a.token;return Promise.resolve(U)});this.authentication=Pe,this.privConversationServiceConnector.onToken(Pe);break;default:break}break;case"partial":case"final":let c=bs.SpeechResponsePayload.fromJSON(i.textBody),p=s==="final"?Rt.ResultReason.TranslatedParticipantSpeech:Rt.ResultReason.TranslatingParticipantSpeech,h=new Rt.ConversationTranslationResult(c.participantId,this.getTranslations(c.translations),c.language,c.id,p,c.recognition,void 0,void 0,i.textBody,void 0);c.isFinal?((h.text!==void 0&&h.text.length>0||c.id===this.privLastPartialUtteranceId)&&(o=!0),o&&this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ge.ConversationReceivedTranslationEventArgs(zr.ConversationTranslatorMessageTypes.final,h,n))):h.text!==void 0&&(this.privLastPartialUtteranceId=c.id,this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ge.ConversationReceivedTranslationEventArgs(zr.ConversationTranslatorMessageTypes.partial,h,n)));break;case"translated_message":let d=bs.TextResponsePayload.fromJSON(i.textBody),v=new Rt.ConversationTranslationResult(d.participantId,this.getTranslations(d.translations),d.language,void 0,void 0,d.originalText,void 0,void 0,void 0,i.textBody,void 0);this.privConversationServiceConnector.translationReceived&&this.privConversationServiceConnector.translationReceived(this.privConversationServiceConnector,new Ge.ConversationReceivedTranslationEventArgs(zr.ConversationTranslatorMessageTypes.instantMessage,v,n));break;default:break}}catch{}return this.receiveConversationMessageOverride()}catch{this.terminateMessageLoop=!0}return e.promise}async startMessageLoop(){if(this.isDisposed())return Promise.resolve();this.terminateMessageLoop=!1;let e=this.receiveConversationMessageOverride();try{return await e}catch(t){return this.cancelRecognition(this.privRequestSession?this.privRequestSession.sessionId:"",this.privRequestSession?this.privRequestSession.requestId:"",Rt.CancellationReason.Error,Rt.CancellationErrorCode.RuntimeError,t),null}}configConnection(){return this.isDisposed()?Promise.resolve(void 0):this.privConnectionConfigPromise!==void 0?this.privConnectionConfigPromise.then(e=>e.state()===_s.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection()):this.privConnectionConfigPromise,()=>(this.privConnectionId=null,this.privConnectionConfigPromise=void 0,this.configConnection())):this.terminateMessageLoop?Promise.resolve(void 0):(this.privConnectionConfigPromise=this.connectImpl().then(e=>e),this.privConnectionConfigPromise)}getTranslations(e){let t;if(e!==void 0){t=new Rt.Translations;for(let i of e)t.set(i.lang,i.translation)}return t}};Uu.ConversationServiceAdapter=Bf});var YR=u(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.ConversationTranslatorRecognizer=on.ConversationRecognizerFactory=void 0;var Ek=C(),nn=P(),sn=I(),Ff=f(),wk=VR(),Ik=ZR(),Vf=class{static fromConfig(e,t,i){return new Wu(e,t,i)}};on.ConversationRecognizerFactory=Vf;var Wu=class extends Ff.Recognizer{constructor(e,t,i){let n=t;sn.Contracts.throwIfNull(n,"speechConfig");let s=e;sn.Contracts.throwIfNull(s,"conversationImpl"),super(i,n.properties,new wk.ConversationConnectionFactory),this.privConversation=s,this.privIsDisposed=!1,this.privProperties=n.properties.clone(),this.privConnection=Ff.Connection.fromRecognizer(this),this.privProperties.getProperty(Ff.PropertyId.WebWorkerLoadType,"on").toLowerCase()==="on"&&typeof Blob<"u"&&typeof Worker<"u"?(this.privSetTimeout=nn.Timeout.setTimeout,this.privClearTimeout=nn.Timeout.clearTimeout):typeof window<"u"?(this.privSetTimeout=window.setTimeout.bind(window),this.privClearTimeout=window.clearTimeout.bind(window)):(this.privSetTimeout=setTimeout,this.privClearTimeout=clearTimeout)}set connected(e){this.privConnection.connected=e}set disconnected(e){this.privConnection.disconnected=e}get speechRecognitionLanguage(){return this.privSpeechRecognitionLanguage}get properties(){return this.privProperties}isDisposed(){return this.privIsDisposed}connect(e,t,i){try{sn.Contracts.throwIfDisposed(this.privIsDisposed),sn.Contracts.throwIfNullOrWhitespace(e,"token"),this.privReco.conversationTranslatorToken=e,this.resetConversationTimeout(),this.privReco.connectAsync(t,i)}catch(n){if(i)if(n instanceof Error){let s=n;i(s.name+": "+s.message)}else i(n)}}disconnect(e,t){try{sn.Contracts.throwIfDisposed(this.privIsDisposed),this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privReco.disconnect().then(()=>{e&&e()},i=>{t&&t(i)})}catch(i){if(t)if(i instanceof Error){let n=i;t(n.name+": "+n.message)}else t(i);this.dispose(!0).catch(n=>{nn.Events.instance.onEvent(new nn.BackgroundEvent(n))})}}sendRequest(e,t,i){try{sn.Contracts.throwIfDisposed(this.privIsDisposed),this.sendMessage(e,t,i)}catch(n){if(i)if(n instanceof Error){let s=n;i(s.name+": "+s.message)}else i(n);this.dispose(!0).catch(s=>{nn.Events.instance.onEvent(new nn.BackgroundEvent(s))})}}onToken(e){this.privConversation.onToken(e)}async close(){this.privIsDisposed||(this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close()),this.privConnection=void 0,await this.dispose(!0))}async dispose(e){this.privIsDisposed||e&&(this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privIsDisposed=!0,this.privConnection&&(this.privConnection.closeConnection(),this.privConnection.close(),this.privConnection=void 0),await super.dispose(e))}createRecognizerConfig(e){return new Ek.RecognizerConfig(e,this.privProperties)}createServiceRecognizer(e,t,i,n){let s=i;return new Ik.ConversationServiceAdapter(e,t,s,n,this)}sendMessage(e,t,i){let n=this.privReco;((o,a,c)=>{o!==void 0?o.then(()=>{try{a&&a()}catch(p){c&&c(`'Unhandled error on promise callback: ${p}'`)}},p=>{try{c&&c(p)}catch{}}):c&&c("Null promise")})(n.sendMessageAsync(e),t,i),this.resetConversationTimeout()}resetConversationTimeout(){this.privTimeoutToken!==void 0&&this.privClearTimeout(this.privTimeoutToken),this.privTimeoutToken=this.privSetTimeout(()=>{this.sendRequest(this.privConversation.getKeepAlive())},6e4)}};on.ConversationTranslatorRecognizer=Wu});var tE=u(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});Hu.TranscriberRecognizer=void 0;var eE=P(),Et=I(),an=f(),Uf=C(),_k=He(),Wf=class extends an.Recognizer{constructor(e,t){let i=e;Et.Contracts.throwIfNull(i,"speechTranslationConfig");let n=t;Et.Contracts.throwIfNull(n,"audioConfigImpl"),Et.Contracts.throwIfNullOrWhitespace(i.speechRecognitionLanguage,an.PropertyId[an.PropertyId.SpeechServiceConnection_RecoLanguage]),super(t,i.properties,new Uf.TranscriberConnectionFactory),this.privDisposedRecognizer=!1,this.isMeetingRecognizer=!1}get speechRecognitionLanguage(){return Et.Contracts.throwIfDisposed(this.privDisposedRecognizer),this.properties.getProperty(an.PropertyId.SpeechServiceConnection_RecoLanguage)}get properties(){return this.privProperties}get authorizationToken(){return this.properties.getProperty(an.PropertyId.SpeechServiceAuthorization_Token)}set authorizationToken(e){Et.Contracts.throwIfNullOrWhitespace(e,"token"),this.properties.setProperty(an.PropertyId.SpeechServiceAuthorization_Token,e)}set conversation(e){Et.Contracts.throwIfNullOrUndefined(e,"Conversation"),this.isMeetingRecognizer=!1,this.privConversation=e}getConversationInfo(){return Et.Contracts.throwIfNullOrUndefined(this.privConversation,"Conversation"),this.privConversation.conversationInfo}set meeting(e){Et.Contracts.throwIfNullOrUndefined(e,"Meeting"),this.isMeetingRecognizer=!0,this.privMeeting=e}getMeetingInfo(){return Et.Contracts.throwIfNullOrUndefined(this.privMeeting,"Meeting"),this.privMeeting.meetingInfo}IsMeetingRecognizer(){return this.isMeetingRecognizer}startContinuousRecognitionAsync(e,t){(0,eE.marshalPromiseToCallbacks)(this.startContinuousRecognitionAsyncImpl(_k.RecognitionMode.Conversation),e,t)}stopContinuousRecognitionAsync(e,t){(0,eE.marshalPromiseToCallbacks)(this.stopContinuousRecognitionAsyncImpl(),e,t)}async close(){this.privDisposedRecognizer||await this.dispose(!0)}async pushConversationEvent(e,t){let i=this.privReco;Et.Contracts.throwIfNullOrUndefined(i,"serviceRecognizer"),await i.sendSpeechEventAsync(e,t)}async pushMeetingEvent(e,t){let i=this.privReco;Et.Contracts.throwIfNullOrUndefined(i,"serviceRecognizer"),await i.sendMeetingSpeechEventAsync(e,t)}async enforceAudioGating(){let i=(await this.audioConfig.format).channels;if(i===1){if(this.properties.getProperty("f0f5debc-f8c9-4892-ac4b-90a7ab359fd2","false").toLowerCase()!=="true")throw new Error("Single channel audio configuration for MeetingTranscriber is currently under private preview, please contact diarizationrequest@microsoft.com for more details")}else if(i!==8)throw new Error(`Unsupported audio configuration: Detected ${i}-channel audio`)}connectMeetingCallbacks(e){this.isMeetingRecognizer=!0,this.canceled=(t,i)=>{e.canceled&&e.canceled(e,i)},this.recognizing=(t,i)=>{e.transcribing&&e.transcribing(e,i)},this.recognized=(t,i)=>{e.transcribed&&e.transcribed(e,i)},this.sessionStarted=(t,i)=>{e.sessionStarted&&e.sessionStarted(e,i)},this.sessionStopped=(t,i)=>{e.sessionStopped&&e.sessionStopped(e,i)}}disconnectCallbacks(){this.canceled=void 0,this.recognizing=void 0,this.recognized=void 0,this.sessionStarted=void 0,this.sessionStopped=void 0}async dispose(e){this.privDisposedRecognizer||(e&&(this.privDisposedRecognizer=!0,await this.implRecognizerStop()),await super.dispose(e))}createRecognizerConfig(e){return new Uf.RecognizerConfig(e,this.properties)}createServiceRecognizer(e,t,i,n){let s=i;return new Uf.TranscriptionServiceRecognizer(e,t,s,n,this)}};Hu.TranscriberRecognizer=Wf});var rE=u(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.InternalParticipants=V.ConversationTranslatorMessageTypes=V.ConversationTranslatorCommandTypes=V.ParticipantsListEventArgs=V.ParticipantEventArgs=V.ParticipantAttributeEventArgs=V.MuteAllEventArgs=V.LockRoomEventArgs=V.ConversationReceivedTranslationEventArgs=V.TranscriberRecognizer=V.ConversationRecognizerFactory=V.ConversationConnectionConfig=V.ConversationManager=void 0;var bk=zR();Object.defineProperty(V,"ConversationManager",{enumerable:!0,get:function(){return bk.ConversationManager}});var Ak=Nu();Object.defineProperty(V,"ConversationConnectionConfig",{enumerable:!0,get:function(){return Ak.ConversationConnectionConfig}});var Tk=YR();Object.defineProperty(V,"ConversationRecognizerFactory",{enumerable:!0,get:function(){return Tk.ConversationRecognizerFactory}});var Ok=tE();Object.defineProperty(V,"TranscriberRecognizer",{enumerable:!0,get:function(){return Ok.TranscriberRecognizer}});var cn=Mf();Object.defineProperty(V,"ConversationReceivedTranslationEventArgs",{enumerable:!0,get:function(){return cn.ConversationReceivedTranslationEventArgs}});Object.defineProperty(V,"LockRoomEventArgs",{enumerable:!0,get:function(){return cn.LockRoomEventArgs}});Object.defineProperty(V,"MuteAllEventArgs",{enumerable:!0,get:function(){return cn.MuteAllEventArgs}});Object.defineProperty(V,"ParticipantAttributeEventArgs",{enumerable:!0,get:function(){return cn.ParticipantAttributeEventArgs}});Object.defineProperty(V,"ParticipantEventArgs",{enumerable:!0,get:function(){return cn.ParticipantEventArgs}});Object.defineProperty(V,"ParticipantsListEventArgs",{enumerable:!0,get:function(){return cn.ParticipantsListEventArgs}});var Hf=xf();Object.defineProperty(V,"ConversationTranslatorCommandTypes",{enumerable:!0,get:function(){return Hf.ConversationTranslatorCommandTypes}});Object.defineProperty(V,"ConversationTranslatorMessageTypes",{enumerable:!0,get:function(){return Hf.ConversationTranslatorMessageTypes}});Object.defineProperty(V,"InternalParticipants",{enumerable:!0,get:function(){return Hf.InternalParticipants}})});var Jf=u(gi=>{"use strict";Object.defineProperty(gi,"__esModule",{value:!0});gi.SynthesisAudioMetadata=gi.MetadataType=void 0;var kk;(function(r){r.WordBoundary="WordBoundary",r.Bookmark="Bookmark",r.Viseme="Viseme",r.SentenceBoundary="SentenceBoundary",r.SessionEnd="SessionEnd",r.AvatarSignal="TalkingAvatarSignal"})(kk=gi.MetadataType||(gi.MetadataType={}));var Kf=class r{constructor(e){this.privSynthesisAudioMetadata=JSON.parse(e)}static fromJSON(e){return new r(e)}get Metadata(){return this.privSynthesisAudioMetadata.Metadata}};gi.SynthesisAudioMetadata=Kf});var nE=u(Lt=>{"use strict";Object.defineProperty(Lt,"__esModule",{value:!0});Lt.SynthesisStartedEvent=Lt.ConnectingToSynthesisServiceEvent=Lt.SynthesisTriggeredEvent=Lt.SpeechSynthesisEvent=void 0;var iE=P(),un=class extends iE.PlatformEvent{constructor(e,t,i=iE.EventType.Info){super(e,i),this.privRequestId=t}get requestId(){return this.privRequestId}};Lt.SpeechSynthesisEvent=un;var $f=class extends un{constructor(e,t,i){super("SynthesisTriggeredEvent",e),this.privSessionAudioDestinationId=t,this.privTurnAudioDestinationId=i}get audioSessionDestinationId(){return this.privSessionAudioDestinationId}get audioTurnDestinationId(){return this.privTurnAudioDestinationId}};Lt.SynthesisTriggeredEvent=$f;var Gf=class extends un{constructor(e,t){super("ConnectingToSynthesisServiceEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}};Lt.ConnectingToSynthesisServiceEvent=Gf;var Qf=class extends un{constructor(e,t){super("SynthesisStartedEvent",e),this.privAuthFetchEventId=t}get authFetchEventId(){return this.privAuthFetchEventId}};Lt.SynthesisStartedEvent=Qf});var sE=u($u=>{"use strict";Object.defineProperty($u,"__esModule",{value:!0});$u.SynthesisTurn=void 0;var Ku=P(),Mk=Xr(),Ju=f(),Dk=Jf(),Xf=nE(),Zf=class r{constructor(){this.privIsDisposed=!1,this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!1,this.privBytesReceived=0,this.privInTurn=!1,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privRequestId=(0,Ku.createNoDashGuid)(),this.privTurnDeferral=new Ku.Deferred,this.privTurnDeferral.resolve()}get requestId(){return this.privRequestId}get streamId(){return this.privStreamId}set streamId(e){this.privStreamId=e}get audioOutputFormat(){return this.privAudioOutputFormat}set audioOutputFormat(e){this.privAudioOutputFormat=e}get turnCompletionPromise(){return this.privTurnDeferral.promise}get isSynthesisEnded(){return this.privIsSynthesisEnded}get isSynthesizing(){return this.privIsSynthesizing}get currentTextOffset(){return this.privTextOffset}get currentSentenceOffset(){return this.privSentenceOffset}get bytesReceived(){return this.privBytesReceived}get audioDuration(){return this.privAudioDuration}get extraProperties(){if(this.privWebRTCSDP){let e=new Ju.PropertyCollection;return e.setProperty(Ju.PropertyId.TalkingAvatarService_WebRTC_SDP,this.privWebRTCSDP),e}}async getAllReceivedAudio(){return this.privReceivedAudio?Promise.resolve(this.privReceivedAudio):this.privIsSynthesisEnded?(await this.readAllAudioFromStream(),Promise.resolve(this.privReceivedAudio)):null}async getAllReceivedAudioWithHeader(){if(this.privReceivedAudioWithHeader)return this.privReceivedAudioWithHeader;if(!this.privIsSynthesisEnded)return null;if(this.audioOutputFormat.hasHeader){let e=await this.getAllReceivedAudio();return this.privReceivedAudioWithHeader=this.audioOutputFormat.addHeader(e),this.privReceivedAudioWithHeader}else return this.getAllReceivedAudio()}startNewSynthesis(e,t,i,n){this.privIsSynthesisEnded=!1,this.privIsSynthesizing=!0,this.privRequestId=e,this.privRawText=t,this.privIsSSML=i,this.privAudioOutputStream=new Mk.PullAudioOutputStreamImpl,this.privAudioOutputStream.format=this.privAudioOutputFormat,this.privReceivedAudio=null,this.privReceivedAudioWithHeader=null,this.privBytesReceived=0,this.privTextOffset=0,this.privNextSearchTextIndex=0,this.privSentenceOffset=0,this.privNextSearchSentenceIndex=0,this.privPartialVisemeAnimation="",this.privWebRTCSDP="",n!==void 0&&(this.privTurnAudioDestination=n,this.privTurnAudioDestination.format=this.privAudioOutputFormat),this.onEvent(new Xf.SynthesisTriggeredEvent(this.requestId,void 0,n===void 0?void 0:n.id()))}onPreConnectionStart(e){this.privAuthFetchEventId=e,this.onEvent(new Xf.ConnectingToSynthesisServiceEvent(this.privRequestId,this.privAuthFetchEventId))}onAuthCompleted(e){e&&this.onComplete()}onConnectionEstablishCompleted(e){if(e===200){this.onEvent(new Xf.SynthesisStartedEvent(this.requestId,this.privAuthFetchEventId)),this.privBytesReceived=0;return}else e===403&&this.onComplete()}onServiceResponseMessage(e){let t=JSON.parse(e);this.streamId=t.audio.streamId}onServiceTurnEndResponse(){this.privInTurn=!1,this.privTurnDeferral.resolve(),this.onComplete()}onServiceTurnStartResponse(e){this.privTurnDeferral&&this.privInTurn&&(this.privTurnDeferral.reject("Another turn started before current completed."),this.privTurnDeferral.promise.then().catch(()=>{})),this.privInTurn=!0,this.privTurnDeferral=new Ku.Deferred;let t=JSON.parse(e);t.webrtc&&(this.privWebRTCSDP=t.webrtc.connectionString)}onAudioChunkReceived(e){this.isSynthesizing&&(this.privAudioOutputStream.write(e),this.privBytesReceived+=e.byteLength,this.privTurnAudioDestination!==void 0&&this.privTurnAudioDestination.write(e))}onTextBoundaryEvent(e){this.updateTextOffset(e.Data.text.Text,e.Type)}onVisemeMetadataReceived(e){e.Data.AnimationChunk!==void 0&&(this.privPartialVisemeAnimation+=e.Data.AnimationChunk)}onSessionEnd(e){this.privAudioDuration=e.Data.Offset}async constructSynthesisResult(){let e=await this.getAllReceivedAudioWithHeader();return new Ju.SpeechSynthesisResult(this.requestId,Ju.ResultReason.SynthesizingAudioCompleted,e,void 0,this.extraProperties,this.audioDuration)}dispose(){this.privIsDisposed||(this.privIsDisposed=!0)}onStopSynthesizing(){this.onComplete()}getAndClearVisemeAnimation(){let e=this.privPartialVisemeAnimation;return this.privPartialVisemeAnimation="",e}onEvent(e){Ku.Events.instance.onEvent(e)}static isXmlTag(e){return e.length>=2&&e[0]==="<"&&e[e.length-1]===">"}updateTextOffset(e,t){t===Dk.MetadataType.WordBoundary?(this.privTextOffset=this.privRawText.indexOf(e,this.privNextSearchTextIndex),this.privTextOffset>=0&&(this.privNextSearchTextIndex=this.privTextOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privTextOffset)&&!r.isXmlTag(e)&&this.updateTextOffset(e,t))):(this.privSentenceOffset=this.privRawText.indexOf(e,this.privNextSearchSentenceIndex),this.privSentenceOffset>=0&&(this.privNextSearchSentenceIndex=this.privSentenceOffset+e.length,this.privIsSSML&&this.withinXmlTag(this.privSentenceOffset)&&!r.isXmlTag(e)&&this.updateTextOffset(e,t)))}onComplete(){this.privIsSynthesizing&&(this.privIsSynthesizing=!1,this.privIsSynthesisEnded=!0,this.privAudioOutputStream.close(),this.privInTurn=!1,this.privTurnAudioDestination!==void 0&&(this.privTurnAudioDestination.close(),this.privTurnAudioDestination=void 0))}async readAllAudioFromStream(){if(this.privIsSynthesisEnded){this.privReceivedAudio=new ArrayBuffer(this.bytesReceived);try{await this.privAudioOutputStream.read(this.privReceivedAudio)}catch{this.privReceivedAudio=new ArrayBuffer(0)}}}withinXmlTag(e){return this.privRawText.indexOf("<",e+1)>this.privRawText.indexOf(">",e+1)}};$u.SynthesisTurn=Zf});var oE=u(Qu=>{"use strict";Object.defineProperty(Qu,"__esModule",{value:!0});Qu.SynthesisAdapterBase=void 0;var ke=P(),Qe=f(),ct=C(),pn=pi(),Gu=class{constructor(e,t,i,n){if(this.speakOverride=void 0,this.receiveMessageOverride=void 0,this.connectImplOverride=void 0,this.configConnectionOverride=void 0,this.privConnectionConfigurationPromise=void 0,!e)throw new ke.ArgumentNullError("authentication");if(!t)throw new ke.ArgumentNullError("connectionFactory");if(!i)throw new ke.ArgumentNullError("synthesizerConfig");this.privAuthentication=e,this.privConnectionFactory=t,this.privSynthesizerConfig=i,this.privIsDisposed=!1,this.privSessionAudioDestination=n,this.privSynthesisTurn=new ct.SynthesisTurn,this.privConnectionEvents=new ke.EventSource,this.privServiceEvents=new ke.EventSource,this.privSynthesisContext=new ct.SynthesisContext,this.privAgentConfig=new ct.AgentConfig,this.connectionEvents.attach(s=>{if(s.name==="ConnectionClosedEvent"){let o=s;o.statusCode!==1e3&&this.cancelSynthesisLocal(Qe.CancellationReason.Error,o.statusCode===1007?Qe.CancellationErrorCode.BadRequestParameters:Qe.CancellationErrorCode.ConnectionFailure,`${o.reason} websocket error code: ${o.statusCode}`)}})}get synthesizerConfig(){return this.privSynthesizerConfig}get synthesisContext(){return this.privSynthesisContext}get agentConfig(){return this.privAgentConfig}get connectionEvents(){return this.privConnectionEvents}get serviceEvents(){return this.privServiceEvents}set activityTemplate(e){this.privActivityTemplate=e}get activityTemplate(){return this.privActivityTemplate}set audioOutputFormat(e){this.privAudioOutputFormat=e,this.privSynthesisTurn.audioOutputFormat=e,this.privSessionAudioDestination!==void 0&&(this.privSessionAudioDestination.format=e),this.synthesisContext!==void 0&&(this.synthesisContext.audioOutputFormat=e)}isDisposed(){return this.privIsDisposed}async dispose(e){this.privIsDisposed=!0,this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.close(),this.privConnectionConfigurationPromise!==void 0&&await(await this.privConnectionConfigurationPromise).dispose(e)}async connect(){await this.connectImpl()}async sendNetworkMessage(e,t){let i=typeof t=="string"?ke.MessageType.Text:ke.MessageType.Binary,n=typeof t=="string"?"application/json":"";return(await this.fetchConnection()).send(new pn.SpeechConnectionMessage(i,e,this.privSynthesisTurn.requestId,n,t))}async Speak(e,t,i,n,s,o){let a;if(t?a=e:a=this.privSynthesizer.buildSsml(e),this.speakOverride!==void 0)return this.speakOverride(a,i,n,s);this.privSuccessCallback=n,this.privErrorCallback=s,this.privSynthesisTurn.startNewSynthesis(i,e,t,o);try{await this.connectImpl();let c=await this.fetchConnection();await this.sendSynthesisContext(c),await this.sendSsmlMessage(c,a,i),this.onSynthesisStarted(i),this.receiveMessage()}catch(c){return this.cancelSynthesisLocal(Qe.CancellationReason.Error,Qe.CancellationErrorCode.ConnectionFailure,c),Promise.reject(c)}}async stopSpeaking(){return await this.connectImpl(),(await this.fetchConnection()).send(new pn.SpeechConnectionMessage(ke.MessageType.Text,"synthesis.control",this.privSynthesisTurn.requestId,"application/json",JSON.stringify({action:"stop"})))}cancelSynthesis(e,t,i,n){let s=new Qe.PropertyCollection;s.setProperty(ct.CancellationErrorCodePropertyName,Qe.CancellationErrorCode[i]);let o=new Qe.SpeechSynthesisResult(e,Qe.ResultReason.Canceled,void 0,n,s);if(this.onSynthesisCancelled(o),this.privSuccessCallback)try{this.privSuccessCallback(o)}catch{}}cancelSynthesisLocal(e,t,i){this.privSynthesisTurn.isSynthesizing&&(this.privSynthesisTurn.onStopSynthesizing(),this.cancelSynthesis(this.privSynthesisTurn.requestId,e,t,i))}processTypeSpecificMessages(e){return!0}async receiveMessage(){try{let t=await(await this.fetchConnection()).read();if(this.receiveMessageOverride!==void 0)return this.receiveMessageOverride();if(this.privIsDisposed)return;if(!t)return this.privSynthesisTurn.isSynthesizing?this.receiveMessage():void 0;let i=pn.SpeechConnectionMessage.fromConnectionMessage(t);if(i.requestId.toLowerCase()===this.privSynthesisTurn.requestId.toLowerCase())switch(i.path.toLowerCase()){case"turn.start":this.privSynthesisTurn.onServiceTurnStartResponse(i.textBody);break;case"response":this.privSynthesisTurn.onServiceResponseMessage(i.textBody);break;case"audio":this.privSynthesisTurn.streamId.toLowerCase()===i.streamId.toLowerCase()&&i.binaryBody&&(this.privSynthesisTurn.onAudioChunkReceived(i.binaryBody),this.onSynthesizing(i.binaryBody),this.privSessionAudioDestination!==void 0&&this.privSessionAudioDestination.write(i.binaryBody));break;case"audio.metadata":let n=ct.SynthesisAudioMetadata.fromJSON(i.textBody).Metadata;for(let o of n)switch(o.Type){case ct.MetadataType.WordBoundary:case ct.MetadataType.SentenceBoundary:this.privSynthesisTurn.onTextBoundaryEvent(o);let a=new Qe.SpeechSynthesisWordBoundaryEventArgs(o.Data.Offset,o.Data.Duration,o.Data.text.Text,o.Data.text.Length,o.Type===ct.MetadataType.WordBoundary?this.privSynthesisTurn.currentTextOffset:this.privSynthesisTurn.currentSentenceOffset,o.Data.text.BoundaryType);this.onWordBoundary(a);break;case ct.MetadataType.Bookmark:let c=new Qe.SpeechSynthesisBookmarkEventArgs(o.Data.Offset,o.Data.Bookmark);this.onBookmarkReached(c);break;case ct.MetadataType.Viseme:if(this.privSynthesisTurn.onVisemeMetadataReceived(o),o.Data.IsLastAnimation){let p=new Qe.SpeechSynthesisVisemeEventArgs(o.Data.Offset,o.Data.VisemeId,this.privSynthesisTurn.getAndClearVisemeAnimation());this.onVisemeReceived(p)}break;case ct.MetadataType.AvatarSignal:this.onAvatarEvent(o);break;case ct.MetadataType.SessionEnd:this.privSynthesisTurn.onSessionEnd(o);break}break;case"turn.end":this.privSynthesisTurn.onServiceTurnEndResponse();let s;try{s=await this.privSynthesisTurn.constructSynthesisResult(),this.privSuccessCallback&&this.privSuccessCallback(s)}catch(o){this.privErrorCallback&&this.privErrorCallback(o)}this.onSynthesisCompleted(s);break;default:this.processTypeSpecificMessages(i)||this.privServiceEvents&&this.serviceEvents.onEvent(new ke.ServiceEvent(i.path.toLowerCase(),i.textBody))}return this.receiveMessage()}catch{}}sendSynthesisContext(e){this.setSynthesisContextSynthesisSection();let t=this.synthesisContext.toJSON();if(t)return e.send(new pn.SpeechConnectionMessage(ke.MessageType.Text,"synthesis.context",this.privSynthesisTurn.requestId,"application/json",t))}setSpeechConfigSynthesisSection(){}connectImpl(e=!1){if(this.privConnectionPromise!=null)return this.privConnectionPromise.then(i=>i.state()===ke.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()):this.privConnectionPromise,()=>(this.privConnectionId=null,this.privConnectionPromise=null,this.connectImpl()));this.privAuthFetchEventId=(0,ke.createNoDashGuid)(),this.privConnectionId=(0,ke.createNoDashGuid)(),this.privSynthesisTurn.onPreConnectionStart(this.privAuthFetchEventId);let t=e?this.privAuthentication.fetchOnExpiry(this.privAuthFetchEventId):this.privAuthentication.fetch(this.privAuthFetchEventId);return this.privConnectionPromise=t.then(async i=>{this.privSynthesisTurn.onAuthCompleted(!1);let n=await this.privConnectionFactory.create(this.privSynthesizerConfig,i,this.privConnectionId);n.events.attach(o=>{this.connectionEvents.onEvent(o)});let s=await n.open();return s.statusCode===200?(this.privSynthesisTurn.onConnectionEstablishCompleted(s.statusCode),Promise.resolve(n)):s.statusCode===403&&!e?this.connectImpl(!0):(this.privSynthesisTurn.onConnectionEstablishCompleted(s.statusCode),Promise.reject(`Unable to contact server. StatusCode: ${s.statusCode},
                    ${this.privSynthesizerConfig.parameters.getProperty(Qe.PropertyId.SpeechServiceConnection_Url)} Reason: ${s.reason}`))},i=>{throw this.privSynthesisTurn.onAuthCompleted(!0),new Error(i)}),this.privConnectionPromise.catch(()=>{}),this.privConnectionPromise}sendSpeechServiceConfig(e,t){if(t)return e.send(new pn.SpeechConnectionMessage(ke.MessageType.Text,"speech.config",this.privSynthesisTurn.requestId,"application/json",t))}sendSsmlMessage(e,t,i){return e.send(new pn.SpeechConnectionMessage(ke.MessageType.Text,"ssml",i,"application/ssml+xml",t))}async fetchConnection(){return this.privConnectionConfigurationPromise!==void 0?this.privConnectionConfigurationPromise.then(e=>e.state()===ke.ConnectionState.Disconnected?(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection()):this.privConnectionConfigurationPromise,()=>(this.privConnectionId=null,this.privConnectionConfigurationPromise=void 0,this.fetchConnection())):(this.privConnectionConfigurationPromise=this.configureConnection(),await this.privConnectionConfigurationPromise)}async configureConnection(){let e=await this.connectImpl();return this.configConnectionOverride!==void 0?this.configConnectionOverride(e):(this.setSpeechConfigSynthesisSection(),await this.sendSpeechServiceConfig(e,this.privSynthesizerConfig.SpeechServiceConfig.serialize()),e)}onAvatarEvent(e){}onSynthesisStarted(e){}onSynthesizing(e){}onSynthesisCancelled(e){}onSynthesisCompleted(e){}onWordBoundary(e){}onVisemeReceived(e){}onBookmarkReached(e){}};Qu.SynthesisAdapterBase=Gu;Gu.telemetryDataEnabled=!0});var cE=u(Xu=>{"use strict";Object.defineProperty(Xu,"__esModule",{value:!0});Xu.AvatarSynthesisAdapter=void 0;var aE=f(),xk=C(),Yf=class extends xk.SynthesisAdapterBase{constructor(e,t,i,n,s){super(e,t,i,void 0),this.privAvatarSynthesizer=n,this.privSynthesizer=n,this.privAvatarConfig=s}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(void 0)}setSpeechConfigSynthesisSection(){this.privSynthesizerConfig.synthesisVideoSection={format:{bitrate:this.privAvatarConfig.videoFormat?.bitrate,codec:this.privAvatarConfig.videoFormat?.codec,crop:{bottomRight:{x:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.bottomRight?.y},topLeft:{x:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.x,y:this.privAvatarConfig.videoFormat?.cropRange?.topLeft?.y}},resolution:{height:this.privAvatarConfig.videoFormat?.height,width:this.privAvatarConfig.videoFormat?.width}},protocol:{name:"WebRTC",webrtcConfig:{clientDescription:btoa(this.privSynthesizerConfig.parameters.getProperty(aE.PropertyId.TalkingAvatarService_WebRTC_SDP)),iceServers:this.privAvatarConfig.remoteIceServers??this.privAvatarSynthesizer.iceServers}},talkingAvatar:{background:{color:this.privAvatarConfig.backgroundColor,image:{url:this.privAvatarConfig.backgroundImage?.toString()}},character:this.privAvatarConfig.character,customized:this.privAvatarConfig.customized,style:this.privAvatarConfig.style,useBuiltInVoice:this.privAvatarConfig.useBuiltInVoice}}}onAvatarEvent(e){if(this.privAvatarSynthesizer.avatarEventReceived){let t=new aE.AvatarEventArgs(e.Data.Offset,e.Data.Name);try{this.privAvatarSynthesizer.avatarEventReceived(this.privAvatarSynthesizer,t)}catch{}}}};Xu.AvatarSynthesisAdapter=Yf});var uE=u(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.SpeechSynthesisAdapter=void 0;var Lr=f(),Nk=C(),eg=class extends Nk.SynthesisAdapterBase{constructor(e,t,i,n,s){super(e,t,i,s),this.privSpeechSynthesizer=n,this.privSynthesizer=n}setSynthesisContextSynthesisSection(){this.privSynthesisContext.setSynthesisSection(this.privSpeechSynthesizer)}onSynthesisStarted(e){let t=new Lr.SpeechSynthesisEventArgs(new Lr.SpeechSynthesisResult(e,Lr.ResultReason.SynthesizingAudioStarted));this.privSpeechSynthesizer.synthesisStarted&&this.privSpeechSynthesizer.synthesisStarted(this.privSpeechSynthesizer,t)}onSynthesizing(e){if(this.privSpeechSynthesizer.synthesizing)try{let t=this.privSynthesisTurn.audioOutputFormat.addHeader(e),i=new Lr.SpeechSynthesisEventArgs(new Lr.SpeechSynthesisResult(this.privSynthesisTurn.requestId,Lr.ResultReason.SynthesizingAudio,t));this.privSpeechSynthesizer.synthesizing(this.privSpeechSynthesizer,i)}catch{}}onSynthesisCancelled(e){if(this.privSpeechSynthesizer.SynthesisCanceled){let t=new Lr.SpeechSynthesisEventArgs(e);try{this.privSpeechSynthesizer.SynthesisCanceled(this.privSpeechSynthesizer,t)}catch{}}}onSynthesisCompleted(e){if(this.privSpeechSynthesizer.synthesisCompleted)try{this.privSpeechSynthesizer.synthesisCompleted(this.privSpeechSynthesizer,new Lr.SpeechSynthesisEventArgs(e))}catch{}}onWordBoundary(e){if(this.privSpeechSynthesizer.wordBoundary)try{this.privSpeechSynthesizer.wordBoundary(this.privSpeechSynthesizer,e)}catch{}}onVisemeReceived(e){if(this.privSpeechSynthesizer.visemeReceived)try{this.privSpeechSynthesizer.visemeReceived(this.privSpeechSynthesizer,e)}catch{}}onBookmarkReached(e){if(this.privSpeechSynthesizer.bookmarkReached)try{this.privSpeechSynthesizer.bookmarkReached(this.privSpeechSynthesizer,e)}catch{}}};Zu.SpeechSynthesisAdapter=eg});var pE=u(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.SynthesisRestAdapter=void 0;var tg=ue(),rg=f(),jk=tt(),qk=_e(),ig=class{constructor(e,t){let i=e.parameters.getProperty(rg.PropertyId.SpeechServiceConnection_Endpoint,void 0);if(!i){let s=e.parameters.getProperty(rg.PropertyId.SpeechServiceConnection_Region,"westus"),o=jk.ConnectionFactoryBase.getHostSuffix(s);i=e.parameters.getProperty(rg.PropertyId.SpeechServiceConnection_Host,`https://${s}.tts.speech${o}`)}this.privUri=`${i}/cognitiveservices/voices/list`;let n=tg.RestConfigBase.requestOptions;this.privRestAdapter=new tg.RestMessageAdapter(n),this.privAuthentication=t}getVoicesList(e){return this.privRestAdapter.setHeaders(qk.HeaderNames.ConnectionId,e),this.privAuthentication.fetch(e).then(t=>(this.privRestAdapter.setHeaders(t.headerName,t.token),this.privRestAdapter.request(tg.RestRequestType.Get,this.privUri)))}};Yu.SynthesisRestAdapter=ig});var dE=u(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.SynthesizerConfig=mi.SynthesisServiceType=void 0;var lE=C(),hE;(function(r){r[r.Standard=0]="Standard",r[r.Custom=1]="Custom"})(hE=mi.SynthesisServiceType||(mi.SynthesisServiceType={}));var ng=class{constructor(e,t){this.privSynthesisServiceType=hE.Standard,this.avatarEnabled=!1,this.privSpeechServiceConfig=e||new lE.SpeechServiceConfig(new lE.Context(null)),this.privParameters=t}get parameters(){return this.privParameters}get synthesisServiceType(){return this.privSynthesisServiceType}set synthesisServiceType(e){this.privSynthesisServiceType=e}set synthesisVideoSection(e){this.privSpeechServiceConfig.Context.synthesis={video:e}}get SpeechServiceConfig(){return this.privSpeechServiceConfig}setContextFromJson(e){let t=JSON.parse(e);t.system&&(this.privSpeechServiceConfig.Context.system=t.system),t.os&&(this.privSpeechServiceConfig.Context.os=t.os),t.audio&&(this.privSpeechServiceConfig.Context.audio=t.audio),t.synthesis&&(this.privSpeechServiceConfig.Context.synthesis=t.synthesis)}};mi.SynthesizerConfig=ng});var vE=u(ep=>{"use strict";Object.defineProperty(ep,"__esModule",{value:!0});ep.SynthesisContext=void 0;var sg=f(),og=class{constructor(){this.privContext={}}setSection(e,t){this.privContext[e]=t}set audioOutputFormat(e){this.privAudioOutputFormat=e}toJSON(){return JSON.stringify(this.privContext)}setSynthesisSection(e){let t=this.buildSynthesisContext(e);this.setSection("synthesis",t)}buildSynthesisContext(e){return{audio:{metadataOptions:{bookmarkEnabled:!!e?.bookmarkReached,punctuationBoundaryEnabled:e?.properties.getProperty(sg.PropertyId.SpeechServiceResponse_RequestPunctuationBoundary,!!e?.wordBoundary),sentenceBoundaryEnabled:e?.properties.getProperty(sg.PropertyId.SpeechServiceResponse_RequestSentenceBoundary,!1),sessionEndEnabled:!0,visemeEnabled:!!e?.visemeReceived,wordBoundaryEnabled:e?.properties.getProperty(sg.PropertyId.SpeechServiceResponse_RequestWordBoundary,!!e?.wordBoundary)},outputFormat:this.privAudioOutputFormat.requestAudioFormatString},language:{autoDetection:e?.autoDetectSourceLanguage}}}};ep.SynthesisContext=og});var fE=u(tp=>{"use strict";Object.defineProperty(tp,"__esModule",{value:!0});tp.SpeakerRecognitionConfig=void 0;var zk=C(),ag=class{constructor(e,t){this.privContext=e||new zk.Context(null),this.privParameters=t}get parameters(){return this.privParameters}get Context(){return this.privContext}};tp.SpeakerRecognitionConfig=ag});var mE=u(ip=>{"use strict";Object.defineProperty(ip,"__esModule",{value:!0});ip.SpeakerServiceRecognizer=void 0;var Lk=ue(),rp=P(),Ce=f(),gE=C(),Bk=pi(),cg=class extends gE.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privSpeakerRecognizer=s,this.privSpeakerAudioSource=i,this.recognizeSpeaker=o=>this.recognizeSpeakerOnce(o),this.sendPrePayloadJSONOverride=()=>this.noOp()}processTypeSpecificMessages(e){let t=!1,i=new Ce.PropertyCollection;switch(e.messageType===rp.MessageType.Text&&i.setProperty(Ce.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speaker.response":let s=JSON.parse(e.textBody),o;s.status.statusCode.toLowerCase()!=="success"?o=new Ce.SpeakerRecognitionResult(s,Ce.ResultReason.Canceled,Ce.CancellationErrorCode.ServiceError,s.status.reason):o=new Ce.SpeakerRecognitionResult(s,Ce.ResultReason.RecognizedSpeaker),this.privResultDeferral&&this.privResultDeferral.resolve(o),t=!0;break;default:break}let n=new rp.Deferred;return n.resolve(t),n.promise}cancelRecognition(e,t,i,n,s){if(new Ce.PropertyCollection().setProperty(gE.CancellationErrorCodePropertyName,Ce.CancellationErrorCode[n]),this.privResultDeferral){let a=new Ce.SpeakerRecognitionResult({scenario:this.privSpeakerModel.scenario,status:{statusCode:s,reason:s}},Ce.ResultReason.Canceled,n,s);try{this.privResultDeferral.resolve(a)}catch(c){this.privResultDeferral.reject(c)}}}async recognizeSpeakerOnce(e){this.privSpeakerModel=e,this.voiceProfileType=e.scenario,this.privResultDeferral||(this.privResultDeferral=new rp.Deferred),this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(Ce.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);let t=this.connectImpl(),i=this.sendPreAudioMessages(this.extractSpeakerContext(e)),n=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),s=await this.privSpeakerAudioSource.format,o=await this.privSpeakerAudioSource.deviceInfo,a=new Lk.ReplayableAudioNode(n,s.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(a,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:o};try{await t,await i}catch(h){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,Ce.CancellationReason.Error,Ce.CancellationErrorCode.ConnectionFailure,h)}let c=new Ce.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,c),this.receiveMessage(),this.sendAudio(a).then(()=>{},h=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,Ce.CancellationReason.Error,Ce.CancellationErrorCode.RuntimeError,h)}),this.privResultDeferral.promise}async sendPreAudioMessages(e){let t=await this.fetchConnection();await this.sendSpeakerRecognition(t,e)}async sendSpeakerRecognition(e,t){let i=JSON.stringify(t);return e.send(new Bk.SpeechConnectionMessage(rp.MessageType.Text,"speaker.context",this.privRequestSession.requestId,"application/json; charset=utf-8",i))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}};ip.SpeakerServiceRecognizer=cg});var SE=u(np=>{"use strict";Object.defineProperty(np,"__esModule",{value:!0});np.VoiceServiceRecognizer=void 0;var Fk=ue(),Bt=P(),F=f(),yE=C(),ug=pi(),pg=class extends yE.ServiceRecognizerBase{constructor(e,t,i,n,s){super(e,t,i,n,s),this.privDeferralMap=new Bt.DeferralMap,this.privSpeakerAudioSource=i,this.sendPrePayloadJSONOverride=()=>this.noOp()}set SpeakerAudioSource(e){this.privSpeakerAudioSource=e}processTypeSpecificMessages(e){let t=!1,i=new F.PropertyCollection;switch(e.messageType===Bt.MessageType.Text&&i.setProperty(F.PropertyId.SpeechServiceResponse_JsonResult,e.textBody),e.path.toLowerCase()){case"speaker.profiles":let s=JSON.parse(e.textBody);switch(s.operation.toLowerCase()){case"create":this.handleCreateResponse(s,e.requestId);break;case"delete":case"reset":this.handleResultResponse(s,e.requestId);break;case"fetch":let p=JSON.parse(e.textBody);this.handleFetchResponse(p,e.requestId);break;default:break}t=!0;break;case"speaker.phrases":let o=JSON.parse(e.textBody);this.handlePhrasesResponse(o,e.requestId),t=!0;break;case"speaker.profile.enrollment":let a=JSON.parse(e.textBody),c=new F.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(a.enrollment?a.enrollment.enrollmentStatus:a.status.statusCode),a.enrollment?JSON.stringify(a.enrollment):void 0,a.status.reason);this.privDeferralMap.getId(e.requestId)&&this.privDeferralMap.complete(e.requestId,c),this.privRequestSession.onSpeechEnded(),t=!0;break;default:break}let n=new Bt.Deferred;return n.resolve(t),n.promise}cancelRecognition(e,t,i,n,s){new F.PropertyCollection().setProperty(yE.CancellationErrorCodePropertyName,F.CancellationErrorCode[n]);let a=new F.VoiceProfileEnrollmentResult(F.ResultReason.Canceled,s,s);this.privDeferralMap.getId(t)&&this.privDeferralMap.complete(t,a)}async createProfile(e,t){this.voiceProfileType=e.toString();let i=this.connectImpl();try{let n=new Bt.Deferred;return await i,await this.sendCreateProfile(n,e,t),this.receiveMessage(),n.promise}catch(n){throw n}}async resetProfile(e){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("reset",e.profileType,e)}async deleteProfile(e){return this.voiceProfileType=e.profileType.toString(),this.sendCommonRequest("delete",e.profileType,e)}async retrieveEnrollmentResult(e){return this.voiceProfileType=e.profileType.toString(),this.privExpectedProfileId=e.profileId,this.sendCommonRequest("fetch",e.profileType,e)}async getAllProfiles(e){return this.voiceProfileType=e.toString(),this.sendCommonRequest("fetch",e)}async getActivationPhrases(e,t){this.voiceProfileType=e.toString();let i=this.connectImpl();try{let n=new Bt.Deferred;return await i,await this.sendPhrasesRequest(n,e,t),this.receiveMessage(),n.promise}catch(n){throw n}}async enrollProfile(e){this.voiceProfileType=e.profileType.toString();let t=new Bt.Deferred;this.privRequestSession.startNewRecognition(),this.privRequestSession.listenForServiceTelemetry(this.privSpeakerAudioSource.events),this.privRecognizerConfig.parameters.setProperty(F.PropertyId.Speech_SessionId,this.privRequestSession.sessionId);let i=this.connectImpl(),n=this.sendPreAudioMessages(e,t),s=await this.privSpeakerAudioSource.attach(this.privRequestSession.audioNodeId),o=await this.privSpeakerAudioSource.format,a=await this.privSpeakerAudioSource.deviceInfo,c=new Fk.ReplayableAudioNode(s,o.avgBytesPerSec);await this.privRequestSession.onAudioSourceAttachCompleted(c,!1),this.privRecognizerConfig.SpeechServiceConfig.Context.audio={source:a};try{await i,await n}catch(d){this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,F.CancellationReason.Error,F.CancellationErrorCode.ConnectionFailure,d)}let p=new F.SessionEventArgs(this.privRequestSession.sessionId);return this.privRecognizer.sessionStarted&&this.privRecognizer.sessionStarted(this.privRecognizer,p),this.receiveMessage(),this.sendAudio(c).then(()=>{},d=>{this.cancelRecognition(this.privRequestSession.sessionId,this.privRequestSession.requestId,F.CancellationReason.Error,F.CancellationErrorCode.RuntimeError,d)}),t.promise}async sendPreAudioMessages(e,t){let i=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,t),await this.sendBaseRequest(i,"enroll",this.scenarioFrom(e.profileType),e)}async sendPhrasesRequest(e,t,i){let n=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);let s=this.scenarioFrom(t),o={locale:i,scenario:s};return n.send(new ug.SpeechConnectionMessage(Bt.MessageType.Text,"speaker.profile.phrases",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(o)))}async sendCreateProfile(e,t,i){let n=await this.fetchConnection();this.privRequestSession.onSpeechContext(),this.privDeferralMap.add(this.privRequestSession.requestId,e);let s=t===F.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":t===F.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification",o={locale:i,number:"1",scenario:s};return n.send(new ug.SpeechConnectionMessage(Bt.MessageType.Text,"speaker.profile.create",this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(o)))}async sendCommonRequest(e,t,i=void 0){let n=this.connectImpl();try{let s=new Bt.Deferred;this.privRequestSession.onSpeechContext(),await n;let o=await this.fetchConnection();return this.privDeferralMap.add(this.privRequestSession.requestId,s),await this.sendBaseRequest(o,e,this.scenarioFrom(t),i),this.receiveMessage(),s.promise}catch(s){throw s}}async sendBaseRequest(e,t,i,n){let s={scenario:i};return n?s.profileIds=[n.profileId]:s.maxPageSize=-1,e.send(new ug.SpeechConnectionMessage(Bt.MessageType.Text,`speaker.profile.${t}`,this.privRequestSession.requestId,"application/json; charset=utf-8",JSON.stringify(s)))}extractSpeakerContext(e){return{features:{interimResult:"enabled",progressiveDetection:"disabled"},profileIds:e.profileIds,scenario:e.scenario}}handlePhrasesResponse(e,t){if(this.privDeferralMap.getId(t))if(e.status.statusCode.toLowerCase()!=="success"){let i=F.ResultReason.Canceled,n=new F.VoiceProfilePhraseResult(i,e.status.statusCode,e.passPhraseType,[]);this.privDeferralMap.complete(t,n)}else if(e.phrases&&e.phrases.length>0){let i=F.ResultReason.EnrollingVoiceProfile,n=new F.VoiceProfilePhraseResult(i,e.status.statusCode,e.passPhraseType,e.phrases);this.privDeferralMap.complete(t,n)}else throw new Error("Voice Profile get activation phrases failed, no phrases received");else throw new Error(`Voice Profile get activation phrases request for requestID ${t} not found`)}handleCreateResponse(e,t){if(e.profiles&&e.profiles.length>0)if(this.privDeferralMap.getId(t)){let i=e.profiles.map(n=>n.profileId);this.privDeferralMap.complete(t,i)}else throw new Error(`Voice Profile create request for requestID ${t} not found`);else throw new Error("Voice Profile create failed, no profile id received")}handleResultResponse(e,t){if(this.privDeferralMap.getId(t)){let i=e.operation.toLowerCase()==="delete"?F.ResultReason.DeletedVoiceProfile:F.ResultReason.ResetVoiceProfile,n=e.status.statusCode.toLowerCase()==="success"?i:F.ResultReason.Canceled,s=new F.VoiceProfileResult(n,`statusCode: ${e.status.statusCode}, errorDetails: ${e.status.reason}`);this.privDeferralMap.complete(t,s)}else throw new Error(`Voice Profile create request for requestID ${t} not found`)}handleFetchResponse(e,t){if(this.privDeferralMap.getId(t)&&e.profiles[0]){if(this.privExpectedProfileId&&e.profiles.length===1&&e.profiles[0].profileId===this.privExpectedProfileId){this.privExpectedProfileId=void 0;let i=e.profiles[0],n=new F.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(i.enrollmentStatus),JSON.stringify(i),e.status.reason);this.privDeferralMap.complete(t,n)}else if(e.profiles.length>0){let i=e.profiles,n=[];for(let s of i)n.push(new F.VoiceProfileEnrollmentResult(this.enrollmentReasonFrom(s.enrollmentStatus),JSON.stringify(s),e.status.reason));this.privDeferralMap.complete(t,n)}}else throw new Error(`Voice Profile fetch request for requestID ${t} not found`)}enrollmentReasonFrom(e){switch(e.toLowerCase()){case"enrolled":return F.ResultReason.EnrolledVoiceProfile;case"invalidlocale":case"invalidphrase":case"invalidaudioformat":case"invalidscenario":case"invalidprofilecount":case"invalidoperation":case"audiotooshort":case"audiotoolong":case"toomanyenrollments":case"storageconflict":case"profilenotfound":case"incompatibleprofiles":case"incompleteenrollment":return F.ResultReason.Canceled;default:return F.ResultReason.EnrollingVoiceProfile}}scenarioFrom(e){return e===F.VoiceProfileType.TextIndependentIdentification?"TextIndependentIdentification":e===F.VoiceProfileType.TextIndependentVerification?"TextIndependentVerification":"TextDependentVerification"}};np.VoiceServiceRecognizer=pg});var CE=u(he=>{"use strict";Object.defineProperty(he,"__esModule",{value:!0});he.type=he.connectivity=he.Device=he.OS=he.System=he.Context=he.SpeechServiceConfig=void 0;var lg=class{constructor(e){this.context=e}serialize(){return JSON.stringify(this,(e,t)=>{if(t&&typeof t=="object"&&!Array.isArray(t)){let i={};for(let n in t)Object.hasOwnProperty.call(t,n)&&(i[n&&n.charAt(0).toLowerCase()+n.substring(1)]=t[n]);return i}return t})}get Context(){return this.context}get Recognition(){return this.recognition}set Recognition(e){this.recognition=e.toLowerCase()}};he.SpeechServiceConfig=lg;var hg=class{constructor(e){this.system=new sp,this.os=e}};he.Context=hg;var sp=class{constructor(){let e="1.45.0";this.name="SpeechSDK",this.version=e,this.build="JavaScript",this.lang="JavaScript"}};he.System=sp;var dg=class{constructor(e,t,i){this.platform=e,this.name=t,this.version=i}};he.OS=dg;var vg=class{constructor(e,t,i){this.manufacturer=e,this.model=t,this.version=i}};he.Device=vg;var Vk;(function(r){r.Bluetooth="Bluetooth",r.Wired="Wired",r.WiFi="WiFi",r.Cellular="Cellular",r.InBuilt="InBuilt",r.Unknown="Unknown"})(Vk=he.connectivity||(he.connectivity={}));var Uk;(function(r){r.Phone="Phone",r.Speaker="Speaker",r.Car="Car",r.Headset="Headset",r.Thermostat="Thermostat",r.Microphones="Microphones",r.Deskphone="Deskphone",r.RemoteControl="RemoteControl",r.Unknown="Unknown",r.File="File",r.Stream="Stream"})(Uk=he.type||(he.type={}))});var C=u(m=>{"use strict";var Wk=m&&m.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),R=m&&m.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Wk(e,r,t)};Object.defineProperty(m,"__esModule",{value:!0});m.AutoDetectSourceLanguagesOpenRangeOptionName=m.ForceDictationPropertyName=m.ServicePropertiesPropertyName=m.CancellationErrorCodePropertyName=m.OutputFormatPropertyName=m.SpeechSynthesisAdapter=m.AvatarSynthesisAdapter=void 0;R(ry(),m);R(oy(),m);R(go(),m);R(cy(),m);R(py(),m);R(uP(),m);R(dP(),m);R(Qc(),m);R(_P(),m);R(bP(),m);R(TP(),m);R(kP(),m);R(DP(),m);R(qP(),m);R(LP(),m);R(UP(),m);R(JP(),m);R(cv(),m);R($P(),m);R(GP(),m);R(XP(),m);R(YP(),m);R(rR(),m);R(nR(),m);R(sR(),m);R(oR(),m);R(aR(),m);R(cR(),m);R(pR(),m);R(hR(),m);R(vR(),m);R(gR(),m);R(mR(),m);R(SR(),m);R(CR(),m);R(RR(),m);R(IR(),m);R(bR(),m);R(TR(),m);R(jR(),m);R(qR(),m);R(rE(),m);R(Jf(),m);R(sE(),m);R(oE(),m);var Hk=cE();Object.defineProperty(m,"AvatarSynthesisAdapter",{enumerable:!0,get:function(){return Hk.AvatarSynthesisAdapter}});var Kk=uE();Object.defineProperty(m,"SpeechSynthesisAdapter",{enumerable:!0,get:function(){return Kk.SpeechSynthesisAdapter}});R(pE(),m);R(dE(),m);R(vE(),m);R(fE(),m);R(mE(),m);R(SE(),m);R(CE(),m);m.OutputFormatPropertyName="OutputFormat";m.CancellationErrorCodePropertyName="CancellationErrorCode";m.ServicePropertiesPropertyName="ServiceProperties";m.ForceDictationPropertyName="ForceDictation";m.AutoDetectSourceLanguagesOpenRangeOptionName="UND"});var fg=u(yi=>{"use strict";var Jk=yi&&yi.__createBinding||(Object.create?function(r,e,t,i){i===void 0&&(i=t),Object.defineProperty(r,i,{enumerable:!0,get:function(){return e[t]}})}:function(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}),$k=yi&&yi.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Jk(e,r,t)};Object.defineProperty(yi,"__esModule",{value:!0});var Gk=C();new Gk.AgentConfig;$k(f(),yi)});var ME=yp(fg());var gg;function RE(r){return{lang:r?.lang??gg?.lang,message:r?.message,abortEarly:r?.abortEarly??gg?.abortEarly,abortPipeEarly:r?.abortPipeEarly??gg?.abortPipeEarly}}var Qk;function Xk(r){return Qk?.get(r)}var Zk;function Yk(r){return Zk?.get(r)}var e0;function t0(r,e){return e0?.get(r)?.get(e)}function ln(r){let e=typeof r;return e==="string"?`"${r}"`:e==="number"||e==="bigint"||e==="boolean"?`${r}`:e==="object"||e==="function"?(r&&Object.getPrototypeOf(r)?.constructor?.name)??"null":e}function xe(r,e,t,i,n){let s=n&&"input"in n?n.input:t.value,o=n?.expected??r.expects??null,a=n?.received??ln(s),c={kind:r.kind,type:r.type,input:s,expected:o,received:a,message:`Invalid ${e}: ${o?`Expected ${o} but r`:"R"}eceived ${a}`,requirement:r.requirement,path:n?.path,issues:n?.issues,lang:i.lang,abortEarly:i.abortEarly,abortPipeEarly:i.abortPipeEarly},p=r.kind==="schema",h=n?.message??r.message??t0(r.reference,c.lang)??(p?Yk(c.lang):null)??i.message??Xk(c.lang);h!==void 0&&(c.message=typeof h=="function"?h(c):h),p&&(t.typed=!1),t.issues?t.issues.push(c):t.issues=[c]}function ut(r){return{version:1,vendor:"valibot",validate(e){return r["~run"]({value:e},RE())}}}function yg(r,e){let t=[...new Set(r)];return t.length>1?`(${t.join(` ${e} `)})`:t[0]??"never"}var r0=class extends Error{constructor(r){super(r[0].message),this.name="ValiError",this.issues=r}};var Pj=new RegExp("^(?:[\\u{1F1E6}-\\u{1F1FF}]{2}|\\u{1F3F4}[\\u{E0061}-\\u{E007A}]{2}[\\u{E0030}-\\u{E0039}\\u{E0061}-\\u{E007A}]{1,3}\\u{E007F}|(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation})(?:\\u200D(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation}))*)+$","u");function Sg(r,e){return{kind:"validation",type:"max_value",reference:Sg,async:!1,expects:`<=${r instanceof Date?r.toJSON():ln(r)}`,requirement:r,message:e,"~run"(t,i){return t.typed&&!(t.value<=this.requirement)&&xe(this,"value",t,i,{received:t.value instanceof Date?t.value.toJSON():ln(t.value)}),t}}}function Cg(r,e){return{kind:"validation",type:"min_value",reference:Cg,async:!1,expects:`>=${r instanceof Date?r.toJSON():ln(r)}`,requirement:r,message:e,"~run"(t,i){return t.typed&&!(t.value>=this.requirement)&&xe(this,"value",t,i,{received:t.value instanceof Date?t.value.toJSON():ln(t.value)}),t}}}function Pg(){return{kind:"transformation",type:"readonly",reference:Pg,async:!1,"~run"(r){return r}}}function Rg(r){return{kind:"transformation",type:"transform",reference:Rg,async:!1,operation:r,"~run"(e){return e.value=this.operation(e.value),e}}}function i0(r,e,t){return typeof r.fallback=="function"?r.fallback(e,t):r.fallback}function EE(r,e,t){return typeof r.default=="function"?r.default(e,t):r.default}function Eg(r,e){return{kind:"schema",type:"array",reference:Eg,expects:"Array",async:!1,item:r,message:e,get"~standard"(){return ut(this)},"~run"(t,i){let n=t.value;if(Array.isArray(n)){t.typed=!0,t.value=[];for(let s=0;s<n.length;s++){let o=n[s],a=this.item["~run"]({value:o},i);if(a.issues){let c={type:"array",origin:"value",input:n,key:s,value:o};for(let p of a.issues)p.path?p.path.unshift(c):p.path=[c],t.issues?.push(p);if(t.issues||(t.issues=a.issues),i.abortEarly){t.typed=!1;break}}a.typed||(t.typed=!1),t.value.push(a.value)}}else xe(this,"type",t,i);return t}}}function Br(r){return{kind:"schema",type:"boolean",reference:Br,expects:"boolean",async:!1,message:r,get"~standard"(){return ut(this)},"~run"(e,t){return typeof e.value=="boolean"?e.typed=!0:xe(this,"type",e,t),e}}}function wg(r,e){let t=[];for(let i in r)(`${+i}`!==i||typeof r[i]!="string"||!Object.is(r[r[i]],+i))&&t.push(r[i]);return{kind:"schema",type:"enum",reference:wg,expects:yg(t.map(ln),"|"),async:!1,enum:r,options:t,message:e,get"~standard"(){return ut(this)},"~run"(i,n){return this.options.includes(i.value)?i.typed=!0:xe(this,"type",i,n),i}}}function Ig(r){return{kind:"schema",type:"function",reference:Ig,expects:"Function",async:!1,message:r,get"~standard"(){return ut(this)},"~run"(e,t){return typeof e.value=="function"?e.typed=!0:xe(this,"type",e,t),e}}}function mg(r,e){if(typeof r==typeof e){if(r===e||r instanceof Date&&e instanceof Date&&+r==+e)return{value:r};if(r&&e&&r.constructor===Object&&e.constructor===Object){for(let t in e)if(t in r){let i=mg(r[t],e[t]);if(i.issue)return i;r[t]=i.value}else r[t]=e[t];return{value:r}}if(Array.isArray(r)&&Array.isArray(e)&&r.length===e.length){for(let t=0;t<r.length;t++){let i=mg(r[t],e[t]);if(i.issue)return i;r[t]=i.value}return{value:r}}}return{issue:!0}}function _g(r,e){return{kind:"schema",type:"intersect",reference:_g,expects:yg(r.map(t=>t.expects),"&"),async:!1,options:r,message:e,get"~standard"(){return ut(this)},"~run"(t,i){if(this.options.length){let n=t.value,s;t.typed=!0;for(let o of this.options){let a=o["~run"]({value:n},i);if(a.issues&&(t.issues?t.issues.push(...a.issues):t.issues=a.issues,i.abortEarly)){t.typed=!1;break}a.typed||(t.typed=!1),t.typed&&(s?s.push(a.value):s=[a.value])}if(t.typed){t.value=s[0];for(let o=1;o<s.length;o++){let a=mg(t.value,s[o]);if(a.issue){xe(this,"type",t,i,{received:"unknown"});break}t.value=a.value}}}else xe(this,"type",t,i);return t}}}function bg(r){return{kind:"schema",type:"number",reference:bg,expects:"number",async:!1,message:r,get"~standard"(){return ut(this)},"~run"(e,t){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:xe(this,"type",e,t),e}}}function hn(r,e){return{kind:"schema",type:"object",reference:hn,expects:"Object",async:!1,entries:r,message:e,get"~standard"(){return ut(this)},"~run"(t,i){let n=t.value;if(n&&typeof n=="object"){t.typed=!0,t.value={};for(let s in this.entries){let o=this.entries[s];if(s in n||(o.type==="exact_optional"||o.type==="optional"||o.type==="nullish")&&o.default!==void 0){let a=s in n?n[s]:EE(o),c=o["~run"]({value:a},i);if(c.issues){let p={type:"object",origin:"value",input:n,key:s,value:a};for(let h of c.issues)h.path?h.path.unshift(p):h.path=[p],t.issues?.push(h);if(t.issues||(t.issues=c.issues),i.abortEarly){t.typed=!1;break}}c.typed||(t.typed=!1),t.value[s]=c.value}else if(o.fallback!==void 0)t.value[s]=i0(o);else if(o.type!=="exact_optional"&&o.type!=="optional"&&o.type!=="nullish"&&(xe(this,"key",t,i,{input:void 0,expected:`"${s}"`,path:[{type:"object",origin:"key",input:n,key:s,value:n[s]}]}),i.abortEarly))break}}else xe(this,"type",t,i);return t}}}function ie(r,e){return{kind:"schema",type:"optional",reference:ie,expects:`(${r.expects} | undefined)`,async:!1,wrapped:r,default:e,get"~standard"(){return ut(this)},"~run"(t,i){return t.value===void 0&&(this.default!==void 0&&(t.value=EE(this,t,i)),t.value===void 0)?(t.typed=!0,t):this.wrapped["~run"](t,i)}}}function pt(r){return{kind:"schema",type:"string",reference:pt,expects:"string",async:!1,message:r,get"~standard"(){return ut(this)},"~run"(e,t){return typeof e.value=="string"?e.typed=!0:xe(this,"type",e,t),e}}}function wt(r){return{kind:"schema",type:"undefined",reference:wt,expects:"undefined",async:!1,message:r,get"~standard"(){return ut(this)},"~run"(e,t){return e.value===void 0?e.typed=!0:xe(this,"type",e,t),e}}}function PE(r){let e;if(r)for(let t of r)e?e.push(...t.issues):e=t.issues;return e}function Si(r,e){return{kind:"schema",type:"union",reference:Si,expects:yg(r.map(t=>t.expects),"|"),async:!1,options:r,message:e,get"~standard"(){return ut(this)},"~run"(t,i){let n,s,o;for(let a of this.options){let c=a["~run"]({value:t.value},i);if(c.typed)if(c.issues)s?s.push(c):s=[c];else{n=c;break}else o?o.push(c):o=[c]}if(n)return n;if(s){if(s.length===1)return s[0];xe(this,"type",t,i,{issues:PE(s)}),t.typed=!0}else{if(o?.length===1)return o[0];xe(this,"type",t,i,{issues:PE(o)})}return t}}}function Ue(r,e,t){let i=r["~run"]({value:e},RE(t));if(i.issues)throw new r0(i.issues);return i.value}function dn(...r){return{...r[0],pipe:r,get"~standard"(){return ut(this)},"~run"(e,t){for(let i of r)if(i.kind!=="metadata"){if(e.issues&&(i.kind==="schema"||i.kind==="transformation")){e.typed=!1;break}(!e.issues||!t.abortEarly&&!t.abortPipeEarly)&&(e=i["~run"](e,t))}return e}}}function n0(r){return typeof r=="function"}function Ag(r){return n0(r)?r():r}var Ft=yp(fg()),Fr={AudioConfig:Ft.AudioConfig,OutputFormat:Ft.OutputFormat,ResultReason:Ft.ResultReason,SpeechConfig:Ft.SpeechConfig,SpeechRecognizer:Ft.SpeechRecognizer};var s0=dn(_g([Si([hn({authorizationToken:pt(),subscriptionKey:ie(wt('"subscriptionKey" must be unset when "authorizationToken" is set.'))}),hn({authorizationToken:ie(wt('"authorizationToken" must be unset when "subscriptionKey" is set.')),subscriptionKey:pt()})],'The object must either have either "authorizationToken" or "subscriptionKey" set, but not both.'),Si([hn({customVoiceHostname:ie(wt('"customVoiceHostname" must be unest when "region" is set.')),region:pt(),speechRecognitionHostname:ie(wt('"speechRecognitionHostname" must be unest when "region" is set.')),speechSynthesisHostname:ie(wt('"speechSynthesisHostname" must be unest when "region" is set.'))}),hn({customVoiceHostname:ie(Si([pt(),wt()])),region:ie(wt('"region" must be unset when "*Hostname" is set.')),speechRecognitionHostname:pt(),speechSynthesisHostname:pt()})],'The object must either have either "region" or "*Hostname" set, but not both.')]),Pg()),wE=s0;var o0=ie(Br()),IE=o0;var a0=ie(dn(bg(),Cg(1),Sg(6e4))),_E=a0;var c0=ie(Br(),!1),bE=c0;var u0=dn(ie(Eg(pt()),[]),Rg(r=>Object.isFrozen(r)?r:Object.freeze([...r]))),op=u0;var p0=ie(pt()),AE=p0;var l0=ie(wg({display:"display",itn:"itn",lexical:"lexical",maskeditn:"maskeditn"}),"display"),ap=l0;var{AudioConfig:h0}=Fr,TE=!0;function As(r){let{audioConfig:e,credentials:t,enableTelemetry:i,initialSilenceTimeout:n,looseEvent:s,referenceGrammars:o,speechRecognitionEndpointId:a,textNormalization:c}=r,{looseEvents:p}=r;return typeof s<"u"&&(console.warn('web-speech-cognitive-services: The option "looseEvent" should be named as "looseEvents".'),p=s),Object.freeze({audioConfig:e||h0.fromDefaultMicrophoneInput(),enableTelemetry:Ue(IE,i),fetchCredentials:async()=>{let h=Ue(wE,await Ag(t));return TE&&h.subscriptionKey&&(console.warn("web-speech-cognitive-services: In production environment, subscription key should not be used, authorization token should be used instead."),TE=!1),h},initialSilenceTimeout:Ue(_E,n),looseEvents:Ue(bE,p),referenceGrammars:Ue(op,o),speechRecognitionEndpointId:Ue(AE,a),textNormalization:Ue(ap,c)})}function Ts(){let r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}function OE(){let r,e=[];return{push:n=>{if(r){let{resolve:s}=r;r=null,s(n)}else e.push(n)},shift:()=>e.length?Promise.resolve(e.shift()):(r||(r=Ts())).promise}}var vn=class{constructor({confidence:e,transcript:t}){this.#t=e,this.#e=t}#t;#e;get confidence(){return this.#t}get transcript(){return this.#e}};var Ci=class{constructor(e){if(!e)throw new Error("array must be set.");this.#t=e;for(let t in e)Object.defineProperty(this,t,{enumerable:!0,get(){return e[t]}})}#t;[Symbol.iterator](){return this.#t[Symbol.iterator]()}get length(){return this.#t.length}};var Pi=class extends Ci{constructor(e){super(e.results),this.#t=e.isFinal}#t;get isFinal(){return this.#t}};var{ResultReason:{RecognizingSpeech:d0,RecognizedSpeech:Tg}}=Fr;function Og(r,e){let{maxAlternatives:t=1/0,textNormalization:i="display"}=e||{},n=typeof r.json=="string"?JSON.parse(r.json):r.json;return r.reason===d0||r.reason===Tg&&!n.NBest?new Pi({isFinal:r.reason===Tg,results:[new vn({confidence:.5,transcript:r.text})]}):r.reason===Tg?new Pi({isFinal:!0,results:(n.NBest||[]).slice(0,t).map(({Confidence:s,Display:o,ITN:a,Lexical:c,MaskedITN:p})=>new vn({confidence:s,transcript:i==="itn"?a:i==="lexical"?c:i==="maskeditn"?p:o}))}):new Pi({isFinal:!1,results:[]})}function fn(r,e=void 0){return(...t)=>new Promise((i,n)=>r.apply(e,[...t,i,n]))}var Os=class{constructor(e){this.#t=e,this.#e={}}#t;#e;getProperty(e){return this.#e[e]}setProperty(e,t){let i=this.#e[e];i&&this.#t.removeEventListener(e,i),t&&this.#t.addEventListener(e,t),this.#e[e]=t}};var kE=yp(qp());function kg(r){let e=Array.from(new Int16Array(r));return e.reduce((t,i)=>t+Math.abs(i),0)/e.length}function Mg(r){let e=r,t=e.attach,i=e.attach.bind(e),n=!1,s=!1;return e.attach=async()=>{let o=await i("");return{...o,read:async()=>{let a=await o.read();return!n&&kg(a.buffer)>150&&(e.events.onEvent(new kE.AudioSourceEvent("FirstAudibleChunk","")),n=!0),s?{buffer:new ArrayBuffer(0),isEnd:!0,timeReceived:Date.now()}:a}}},{audioConfig:r,pause:()=>{s=!0},unprepare:()=>{e.attach=t}}}function cp({duration:r,errorDetails:e,json:t,offset:i,properties:n,reason:s,resultId:o,text:a}){return Object.freeze({duration:r,errorDetails:e,json:t&&JSON.parse(t),offset:i,properties:n,reason:s,resultId:o,text:a})}var Ri=class{constructor(){this.#t=[]}addFromString(){throw new Error("JSGF is not supported")}addFromURI(){throw new Error("JSGF is not supported")}item(){throw new Error("JSGF is not supported")}get length(){throw new Error("JSGF is not supported")}#t;get phrases(){return this.#t}set phrases(e){if(Array.isArray(e))this.#t=Object.freeze([...e]);else if(typeof e=="string")this.#t=Object.freeze([e]);else throw new Error("The provided value is not an array or of type 'string'")}};var Vt=class extends Event{constructor(e,{error:t,message:i}){super(e),this.#t=t,this.#e=i}#t;#e;get error(){return this.#t}get message(){return this.#e}get type(){return"error"}};var Ut=class extends Ci{constructor(e){super(e)}};var $=class extends Event{constructor(e,{data:t,resultIndex:i,results:n}={}){super(e),this.#t=t,this.#e=i,this.#r=n||new Ut([])}#t;#e;#r;get data(){return this.#t}get resultIndex(){return this.#e}get results(){return this.#r}get type(){return super.type}};var{ResultReason:v0,SpeechRecognizer:f0}=Fr,g0=Si([Br(),wt()]);function Vr({createRecognizer:r,enableTelemetry:e,looseEvents:t,referenceGrammars:i,textNormalization:n}){r=Ue(Ig(),r),e=Ue(g0,e),t=Ue(Br(),t),i=Ue(op,i),n=Ue(ap,n),typeof e<"u"&&f0.enableTelemetry(e);class s extends EventTarget{#t=!1;#e=new Os(this);#r=new Ri;#i=!1;#n=typeof window<"u"?window.document.documentElement.getAttribute("lang")||window.navigator.language:"en-US";#s=1;emitCognitiveServices(a,c){this.dispatchEvent(new $("cognitiveservices",{data:{...c,type:a}}))}get continuous(){return this.#t}set continuous(a){this.#t=a}get grammars(){return this.#r}set grammars(a){if(a instanceof Ri)this.#r=a;else throw new Error("The provided value is not of type 'SpeechGrammarList'")}get interimResults(){return this.#i}set interimResults(a){this.#i=a}get maxAlternatives(){return this.#s}set maxAlternatives(a){this.#s=a}get lang(){return this.#n}set lang(a){this.#n=a}get onaudioend(){return this.#e.getProperty("audioend")}set onaudioend(a){this.#e.setProperty("audioend",a)}get onaudiostart(){return this.#e.getProperty("audiostart")}set onaudiostart(a){this.#e.setProperty("audiostart",a)}get oncognitiveservices(){return this.#e.getProperty("cognitiveservices")}set oncognitiveservices(a){this.#e.setProperty("cognitiveservices",a)}get onend(){return this.#e.getProperty("end")}set onend(a){this.#e.setProperty("end",a)}get onerror(){return this.#e.getProperty("error")}set onerror(a){this.#e.setProperty("error",a)}get onresult(){return this.#e.getProperty("result")}set onresult(a){this.#e.setProperty("result",a)}get onsoundend(){return this.#e.getProperty("soundend")}set onsoundend(a){this.#e.setProperty("soundend",a)}get onsoundstart(){return this.#e.getProperty("soundstart")}set onsoundstart(a){this.#e.setProperty("soundstart",a)}get onspeechend(){return this.#e.getProperty("speechend")}set onspeechend(a){this.#e.setProperty("speechend",a)}get onspeechstart(){return this.#e.getProperty("speechstart")}set onspeechstart(a){this.#e.setProperty("speechstart",a)}get onstart(){return this.#e.getProperty("start")}set onstart(a){this.#e.setProperty("start",a)}abort;stop;start(){this._startOnce().catch(a=>{this.dispatchEvent(new Vt("error",{error:a,message:a&&(a.stack||a.message)}))})}async _startOnce(){let a=await r(this.lang),{pause:c,unprepare:p}=Mg(a.audioConfig);try{let h=OE(),d,v,g,{detach:M}=a.audioConfig.events.attach(U=>{let{name:Q}=U;Q==="AudioSourceReadyEvent"?h.push({audioSourceReady:{}}):Q==="AudioSourceOffEvent"?h.push({audioSourceOff:{}}):Q==="FirstAudibleChunk"&&h.push({firstAudibleChunk:{}})});a.canceled=(U,{errorDetails:Q,offset:lt,reason:Wr,sessionId:vp})=>{h.push({canceled:{errorDetails:Q,offset:lt,reason:Wr,sessionId:vp}})},a.recognized=(U,{offset:Q,result:lt,sessionId:Wr})=>{h.push({recognized:{offset:Q,result:cp(lt),sessionId:Wr}})},a.recognizing=(U,{offset:Q,result:lt,sessionId:Wr})=>{h.push({recognizing:{offset:Q,result:cp(lt),sessionId:Wr}})},a.sessionStarted=(U,{sessionId:Q})=>{h.push({sessionStarted:{sessionId:Q}})},a.sessionStopped=(U,{sessionId:Q})=>{h.push({sessionStopped:{sessionId:Q}})},a.speechStartDetected=(U,{offset:Q,sessionId:lt})=>{h.push({speechStartDetected:{offset:Q,sessionId:lt}})},a.speechEndDetected=(U,{sessionId:Q})=>{h.push({speechEndDetected:{sessionId:Q}})};let{phrases:A}=this.grammars,{dynamicGrammar:H}=a.privReco;i&&i.length&&H.addReferenceGrammar([...i]),A&&A.length&&H.addPhrase([...A]),await fn(a.startContinuousRecognitionAsync,a)(),typeof a.stopContinuousRecognitionAsync=="function"?(this.abort=()=>h.push({abort:{}}),this.stop=()=>h.push({stop:{}})):this.abort=this.stop=void 0;let ee,ne,Pe=[];for(let U=0;!g||ee;U++){let Q=await h.shift(),{abort:lt,audioSourceOff:Wr,audioSourceReady:vp,canceled:Qg,firstAudibleChunk:dw,recognized:Ei,recognizing:fp,stop:vw}=Q;Object.keys(Q).forEach(Cn=>this.emitCognitiveServices(Cn,Q[Cn]));let gp=Qg&&Qg.errorDetails;if(/Permission\sdenied/u.test(gp||"")){ne=new Vt("error",{error:"not-allowed"});break}if(U||this.dispatchEvent(new $("start")),gp){/1006/u.test(gp)?(ee||(this.dispatchEvent(new $("audiostart")),this.dispatchEvent(new $("audioend"))),ne=new Vt("error",{error:"network"})):ne=new Vt("error",{error:"unknown"});break}else if(lt||vw)lt?(ne=new Vt("error",{error:"aborted"}),g="abort"):(c(),g="stop"),lt&&a.stopContinuousRecognitionAsync&&await fn(a.stopContinuousRecognitionAsync,a)();else if(vp)this.dispatchEvent(new $("audiostart")),ee=!0;else if(dw)this.dispatchEvent(new $("soundstart")),d=!0;else if(Wr){v&&this.dispatchEvent(new $("speechend")),d&&this.dispatchEvent(new $("soundend")),ee&&this.dispatchEvent(new $("audioend")),ee=d=v=!1;break}else if(g!=="abort"){if(Ei&&Ei.result&&Ei.result.reason===v0.NoMatch){if(!this.continuous||g==="stop"){ne=new $("result",{results:new Ut(Pe)}),a.stopContinuousRecognitionAsync&&await fn(a.stopContinuousRecognitionAsync,a)();break}}else if(Ei||fp)if(ee||(this.dispatchEvent(new $("audiostart")),ee=!0),d||(this.dispatchEvent(new $("soundstart")),d=!0),v||(this.dispatchEvent(new $("speechstart")),v=!0),Ei){let Cn=Og(Ei.result,{maxAlternatives:this.maxAlternatives,textNormalization:n}),mp=!!Cn[0]?.transcript;mp&&(Pe=[...Pe,Cn],this.continuous&&this.dispatchEvent(new $("result",{results:new Ut(Pe)}))),this.continuous&&mp?ne=void 0:ne=new $("result",{results:new Ut(Pe)}),(!this.continuous||g==="stop")&&a.stopContinuousRecognitionAsync&&await fn(a.stopContinuousRecognitionAsync,a)(),t&&ne&&mp&&(this.dispatchEvent(ne),ne=void 0)}else fp&&this.interimResults&&this.dispatchEvent(new $("result",{results:new Ut([...Pe,Og(fp.result,{maxAlternatives:this.maxAlternatives,textNormalization:n})])}))}}v&&this.dispatchEvent(new $("speechend")),d&&this.dispatchEvent(new $("soundend")),ee&&this.dispatchEvent(new $("audioend")),ne&&(ne.type==="result"&&!ne.results.length&&(ne=new Vt("error",{error:"no-speech"})),this.dispatchEvent(ne)),this.dispatchEvent(new $("end")),M()}catch(h){throw console.error(h),h}finally{p(),a.dispose(!1)}}}return{SpeechGrammarList:Ri,SpeechRecognition:s,SpeechRecognitionEvent:$}}var{OutputFormat:m0,SpeechConfig:up,SpeechRecognizer:y0}=Fr;function ks(r){let{audioConfig:e,enableTelemetry:t,fetchCredentials:i,initialSilenceTimeout:n,looseEvents:s,referenceGrammars:o,speechRecognitionEndpointId:a,textNormalization:c}=As(r);if(!e&&(!window.navigator.mediaDevices||!window.navigator.mediaDevices.getUserMedia))throw new Error("web-speech-cognitive-services: This browser does not support Media Capture and Streams API and it will not work with Cognitive Services Speech Services.");return Vr({createRecognizer:async h=>{let d=await i(),v;if(typeof d.speechRecognitionHostname<"u"){let g=new URL("wss://localhost:443");g.hostname=d.speechRecognitionHostname,d.authorizationToken?(v=up.fromHost(g),v.authorizationToken=d.authorizationToken):v=up.fromHost(g,d.subscriptionKey)}else v=typeof d.authorizationToken<"u"?up.fromAuthorizationToken(d.authorizationToken,d.region):up.fromSubscription(d.subscriptionKey,d.region);return a&&(v.endpointId=a),v.outputFormat=m0.Detailed,v.speechRecognitionLanguage=h||"en-US",typeof n=="number"&&v.setProperty(ME.PropertyId.SpeechServiceConnection_InitialSilenceTimeoutMs,""+n),new y0(v,e)},enableTelemetry:t,looseEvents:s,referenceGrammars:o,textNormalization:c})}function qg(r,e,...t){if(!r)throw new TypeError(UE(e,t))}function UE(r,e){let t=0;return r.replace(/%[os]/gu,()=>WE(e[t++]))}function WE(r){return typeof r!="object"||r===null?String(r):Object.prototype.toString.call(r)}var DE;function S0(r){try{let e=r instanceof Error?r:new Error(WE(r));if(DE){DE(e);return}if(typeof dispatchEvent=="function"&&typeof ErrorEvent=="function")dispatchEvent(new ErrorEvent("error",{error:e,message:e.message}));else if(typeof process<"u"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)}catch{}}var It=typeof window<"u"?window:typeof self<"u"?self:typeof global<"u"?global:typeof globalThis<"u"?globalThis:void 0,xE;var _t=class{constructor(e,t){this.code=e,this.message=t}warn(...e){var t;try{if(xE){xE({...this,args:e});return}let i=((t=new Error().stack)!==null&&t!==void 0?t:"").replace(/^(?:.+?\n){2}/gu,`
`);console.warn(this.message,...e,i)}catch{}}},C0=new _t("W01","Unable to initialize event under dispatching."),P0=new _t("W02","Assigning any falsy value to 'cancelBubble' property has no effect."),R0=new _t("W03","Assigning any truthy value to 'returnValue' property has no effect."),E0=new _t("W04","Unable to preventDefault on non-cancelable events."),w0=new _t("W05","Unable to preventDefault inside passive event listener invocation."),I0=new _t("W06","An event listener wasn't added because it has been added already: %o, %o"),Dg=new _t("W07","The %o option value was abandoned because the event listener wasn't added as duplicated."),NE=new _t("W08","The 'callback' argument must be a function or an object that has 'handleEvent' method: %o"),_0=new _t("W09","Event attribute handler must be a function: %o"),Xe=class{static get NONE(){return jE}static get CAPTURING_PHASE(){return qE}static get AT_TARGET(){return zE}static get BUBBLING_PHASE(){return LE}constructor(e,t){Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});let i=t??{};jg.set(this,{type:String(e),bubbles:!!i.bubbles,cancelable:!!i.cancelable,composed:!!i.composed,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1,inPassiveListenerFlag:!1,dispatchFlag:!1,timeStamp:Date.now()})}get type(){return ae(this).type}get target(){return ae(this).target}get srcElement(){return ae(this).target}get currentTarget(){return ae(this).currentTarget}composedPath(){let e=ae(this).currentTarget;return e?[e]:[]}get NONE(){return jE}get CAPTURING_PHASE(){return qE}get AT_TARGET(){return zE}get BUBBLING_PHASE(){return LE}get eventPhase(){return ae(this).dispatchFlag?2:0}stopPropagation(){ae(this).stopPropagationFlag=!0}get cancelBubble(){return ae(this).stopPropagationFlag}set cancelBubble(e){e?ae(this).stopPropagationFlag=!0:P0.warn()}stopImmediatePropagation(){let e=ae(this);e.stopPropagationFlag=e.stopImmediatePropagationFlag=!0}get bubbles(){return ae(this).bubbles}get cancelable(){return ae(this).cancelable}get returnValue(){return!ae(this).canceledFlag}set returnValue(e){e?R0.warn():BE(ae(this))}preventDefault(){BE(ae(this))}get defaultPrevented(){return ae(this).canceledFlag}get composed(){return ae(this).composed}get isTrusted(){return!1}get timeStamp(){return ae(this).timeStamp}initEvent(e,t=!1,i=!1){let n=ae(this);if(n.dispatchFlag){C0.warn();return}jg.set(this,{...n,type:String(e),bubbles:!!t,cancelable:!!i,target:null,currentTarget:null,stopPropagationFlag:!1,stopImmediatePropagationFlag:!1,canceledFlag:!1})}},jE=0,qE=1,zE=2,LE=3,jg=new WeakMap;function ae(r,e="this"){let t=jg.get(r);return qg(t!=null,"'%s' must be an object that Event constructor created, but got another one: %o",e,r),t}function BE(r){if(r.inPassiveListenerFlag){w0.warn();return}if(!r.cancelable){E0.warn();return}r.canceledFlag=!0}Object.defineProperty(Xe,"NONE",{enumerable:!0});Object.defineProperty(Xe,"CAPTURING_PHASE",{enumerable:!0});Object.defineProperty(Xe,"AT_TARGET",{enumerable:!0});Object.defineProperty(Xe,"BUBBLING_PHASE",{enumerable:!0});var xg=Object.getOwnPropertyNames(Xe.prototype);for(let r=0;r<xg.length;++r)xg[r]!=="constructor"&&Object.defineProperty(Xe.prototype,xg[r],{enumerable:!0});typeof It<"u"&&typeof It.Event<"u"&&Object.setPrototypeOf(Xe.prototype,It.Event.prototype);function b0(r){return It.DOMException?new It.DOMException(r,"InvalidStateError"):(gn==null&&(gn=class HE extends Error{constructor(t){super(t),Error.captureStackTrace&&Error.captureStackTrace(this,HE)}get code(){return 11}get name(){return"InvalidStateError"}},Object.defineProperties(gn.prototype,{code:{enumerable:!0},name:{enumerable:!0}}),VE(gn),VE(gn.prototype)),new gn(r))}var gn,FE={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function VE(r){let e=Object.keys(FE);for(let t=0;t<e.length;++t){let i=e[t],n=FE[i];Object.defineProperty(r,i,{get(){return n},configurable:!0,enumerable:!0})}}var yn=class extends Xe{static wrap(e){return new(JE(e))(e)}constructor(e){super(e.type,{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}),e.cancelBubble&&super.stopPropagation(),e.defaultPrevented&&super.preventDefault(),KE.set(this,{original:e});let t=Object.keys(e);for(let i=0;i<t.length;++i){let n=t[i];n in this||Object.defineProperty(this,n,$E(e,n))}}stopPropagation(){super.stopPropagation();let{original:e}=Ur(this);"stopPropagation"in e&&e.stopPropagation()}get cancelBubble(){return super.cancelBubble}set cancelBubble(e){super.cancelBubble=e;let{original:t}=Ur(this);"cancelBubble"in t&&(t.cancelBubble=e)}stopImmediatePropagation(){super.stopImmediatePropagation();let{original:e}=Ur(this);"stopImmediatePropagation"in e&&e.stopImmediatePropagation()}get returnValue(){return super.returnValue}set returnValue(e){super.returnValue=e;let{original:t}=Ur(this);"returnValue"in t&&(t.returnValue=e)}preventDefault(){super.preventDefault();let{original:e}=Ur(this);"preventDefault"in e&&e.preventDefault()}get timeStamp(){let{original:e}=Ur(this);return"timeStamp"in e?e.timeStamp:super.timeStamp}},KE=new WeakMap;function Ur(r){let e=KE.get(r);return qg(e!=null,"'this' is expected an Event object, but got",r),e}var pp=new WeakMap;pp.set(Object.prototype,yn);typeof It<"u"&&typeof It.Event<"u"&&pp.set(It.Event.prototype,yn);function JE(r){let e=Object.getPrototypeOf(r);if(e==null)return yn;let t=pp.get(e);return t==null&&(t=A0(JE(e),e),pp.set(e,t)),t}function A0(r,e){class t extends r{}let i=Object.keys(e);for(let n=0;n<i.length;++n)Object.defineProperty(t.prototype,i[n],$E(e,i[n]));return t}function $E(r,e){let t=Object.getOwnPropertyDescriptor(r,e);return{get(){let i=Ur(this).original,n=i[e];return typeof n=="function"?n.bind(i):n},set(i){let n=Ur(this).original;n[e]=i},configurable:t.configurable,enumerable:t.enumerable}}function T0(r,e,t,i,n,s){return{callback:r,flags:(e?1:0)|(t?2:0)|(i?4:0),signal:n,signalListener:s}}function O0(r){r.flags|=8}function GE(r){return(r.flags&1)===1}function QE(r){return(r.flags&2)===2}function XE(r){return(r.flags&4)===4}function k0(r){return(r.flags&8)===8}function M0({callback:r},e,t){try{typeof r=="function"?r.call(e,t):typeof r.handleEvent=="function"&&r.handleEvent(t)}catch(i){S0(i)}}function ZE({listeners:r},e,t){for(let i=0;i<r.length;++i)if(r[i].callback===e&&GE(r[i])===t)return i;return-1}function YE(r,e,t,i,n,s){let o;s&&(o=zg.bind(null,r,e,t),s.addEventListener("abort",o));let a=T0(e,t,i,n,s,o);return r.cow?(r.cow=!1,r.listeners=[...r.listeners,a]):r.listeners.push(a),a}function zg(r,e,t){let i=ZE(r,e,t);return i!==-1?ew(r,i):!1}function ew(r,e,t=!1){let i=r.listeners[e];return O0(i),i.signal&&i.signal.removeEventListener("abort",i.signalListener),r.cow&&!t?(r.cow=!1,r.listeners=r.listeners.filter((n,s)=>s!==e),!1):(r.listeners.splice(e,1),!0)}function D0(){return Object.create(null)}function tw(r,e){var t;return(t=r[e])!==null&&t!==void 0?t:r[e]={attrCallback:void 0,attrListener:void 0,cow:!1,listeners:[]}}var ur=class{constructor(){rw.set(this,D0())}addEventListener(e,t,i){let n=mn(this),{callback:s,capture:o,once:a,passive:c,signal:p,type:h}=x0(e,t,i);if(s==null||p?.aborted)return;let d=tw(n,h),v=ZE(d,s,o);if(v!==-1){j0(d.listeners[v],c,a,p);return}YE(d,s,o,c,a,p)}removeEventListener(e,t,i){let n=mn(this),{callback:s,capture:o,type:a}=N0(e,t,i),c=n[a];s!=null&&c&&zg(c,s,o)}dispatchEvent(e){let t=mn(this)[String(e.type)];if(t==null)return!0;let i=e instanceof Xe?e:yn.wrap(e),n=ae(i,"event");if(n.dispatchFlag)throw b0("This event has been in dispatching.");if(n.dispatchFlag=!0,n.target=n.currentTarget=this,!n.stopPropagationFlag){let{cow:s,listeners:o}=t;t.cow=!0;for(let a=0;a<o.length;++a){let c=o[a];if(!k0(c)&&(XE(c)&&ew(t,a,!s)&&(a-=1),n.inPassiveListenerFlag=QE(c),M0(c,this,i),n.inPassiveListenerFlag=!1,n.stopImmediatePropagationFlag))break}s||(t.cow=!1)}return n.target=null,n.currentTarget=null,n.stopImmediatePropagationFlag=!1,n.stopPropagationFlag=!1,n.dispatchFlag=!1,!n.canceledFlag}},rw=new WeakMap;function mn(r,e="this"){let t=rw.get(r);return qg(t!=null,"'%s' must be an object that EventTarget constructor created, but got another one: %o",e,r),t}function x0(r,e,t){var i;return iw(e),typeof t=="object"&&t!==null?{type:String(r),callback:e??void 0,capture:!!t.capture,passive:!!t.passive,once:!!t.once,signal:(i=t.signal)!==null&&i!==void 0?i:void 0}:{type:String(r),callback:e??void 0,capture:!!t,passive:!1,once:!1,signal:void 0}}function N0(r,e,t){return iw(e),typeof t=="object"&&t!==null?{type:String(r),callback:e??void 0,capture:!!t.capture}:{type:String(r),callback:e??void 0,capture:!!t}}function iw(r){if(!(typeof r=="function"||typeof r=="object"&&r!==null&&typeof r.handleEvent=="function")){if(r==null||typeof r=="object"){NE.warn(r);return}throw new TypeError(UE(NE.message,[r]))}}function j0(r,e,t,i){I0.warn(GE(r)?"capture":"bubble",r.callback),QE(r)!==e&&Dg.warn("passive"),XE(r)!==t&&Dg.warn("once"),r.signal!==i&&Dg.warn("signal")}var Ng=Object.getOwnPropertyNames(ur.prototype);for(let r=0;r<Ng.length;++r)Ng[r]!=="constructor"&&Object.defineProperty(ur.prototype,Ng[r],{enumerable:!0});typeof It<"u"&&typeof It.EventTarget<"u"&&Object.setPrototypeOf(ur.prototype,It.EventTarget.prototype);function Wt(r,e){var t,i;return(i=(t=mn(r,"target")[e])===null||t===void 0?void 0:t.attrCallback)!==null&&i!==void 0?i:null}function Ht(r,e,t){t!=null&&typeof t!="function"&&_0.warn(t),typeof t=="function"||typeof t=="object"&&t!==null?q0(r,e,t):z0(r,e)}function q0(r,e,t){let i=tw(mn(r,"target"),String(e));i.attrCallback=t,i.attrListener==null&&(i.attrListener=YE(i,L0(i),!1,!1,!1,void 0))}function z0(r,e){let i=mn(r,"target")[String(e)];i&&i.attrListener&&(zg(i,i.attrListener.callback,!1),i.attrCallback=i.attrListener=void 0)}function L0(r){return function(e){let t=r.attrCallback;typeof t=="function"&&t.call(this,e)}}function nw(r){return!!((typeof r=="function"||typeof r=="object")&&r&&"then"in r&&typeof r.then=="function")}function Lg(r,e){return new Promise(t=>{try{let i=r.call(e);nw(i)?i.then(t,()=>t(void 0)):t(i)}catch{t(void 0)}})}var sw=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function B0(r,e){return!!(r===e||sw(r)&&sw(e))}function F0(r,e){if(r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(!B0(r[t],e[t]))return!1;return!0}function ow(r,e){e===void 0&&(e=F0);var t=null;function i(){for(var n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];if(t&&t.lastThis===this&&e(n,t.lastArgs))return t.lastResult;var o=r.apply(this,n);return t={lastResult:o,lastArgs:n,lastThis:this},o}return i.clear=function(){t=null},i}var lp=class{constructor(r){this.audioContext=r}pause(){this.audioContext&&this.audioContext.suspend(),this.playingUtterance&&this.playingUtterance.dispatchEvent(new CustomEvent("pause"))}resume(){this.audioContext&&this.audioContext.resume(),this.playingUtterance&&this.playingUtterance.dispatchEvent(new CustomEvent("resume"))}async start(r){let e;for(;e=r.shift();)this.playingUtterance=e,await e.play(this.audioContext),this.playingUtterance=null}stop(){this.playingUtterance&&this.playingUtterance.stop(),this.audioContext.state==="suspended"&&this.audioContext.resume()}};var hp=class{constructor({audioContext:r,ponyfill:e}){this.consumer=null,this.paused=!1,this.queue=[],this.getAudioContext=ow(()=>r||new e.AudioContext)}pause(){this.paused=!0,this.consumer&&this.consumer.pause()}push(r){this.queue.push(r),this.startConsumer()}resume(){this.paused=!1,this.consumer?this.consumer.resume():this.startConsumer()}get speaking(){return!!this.consumer}async startConsumer(){for(;!this.paused&&this.queue.length&&!this.consumer;)this.consumer=new lp(this.getAudioContext()),await this.consumer.start(this.queue),this.consumer=null}stop(){this.queue.splice(0),this.consumer&&this.consumer.stop()}};var pr=class extends Xe{constructor(e){super(e)}};function aw(){let r={};return r.promise=new Promise((e,t)=>{r.reject=t,r.resolve=e}),r}var Bg=class{constructor(){this.#t=r=>{let e=this.#e.shift();e&&e.resolve(r),this.#r&&(this.#r.resolve(r),this.#r=void 0)}}#t;#e=[];#r=void 0;get eventListener(){return this.#t}[Symbol.iterator](){return{next:()=>({done:!1,value:this.upcoming()})}}one(){let r=aw();return this.#e.push(r),r.promise}upcoming(){return this.#r||(this.#r=aw()),this.#r.promise}};var cw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ds=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(Ms=0;Ms<cw.length;Ms++)Ds[cw.charCodeAt(Ms)]=Ms;var Ms;var uw=function(r){var e=r.length*.75,t=r.length,i,n=0,s,o,a,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);var p=new ArrayBuffer(e),h=new Uint8Array(p);for(i=0;i<t;i+=4)s=Ds[r.charCodeAt(i)],o=Ds[r.charCodeAt(i+1)],a=Ds[r.charCodeAt(i+2)],c=Ds[r.charCodeAt(i+3)],h[n++]=s<<2|o>>4,h[n++]=(o&15)<<4|a>>2,h[n++]=(a&3)<<6|c&63;return p};function Fg(r){let e=Math.round((r-1)*100);return e>=0&&(e="+"+e),e+"%"}function Vg({lang:r,pitch:e=1,rate:t=1,text:i,voice:n,volume:s}){return`<speak version="1.0" xml:lang="${r}">
  <voice xml:lang="${r}" name="${n}">
    <prosody pitch="${Fg(e)}" rate="${Fg(t)}" volume="${Fg(s)}">
      ${i}
    </prosody>
  </voice>
</speak>`}var V0=/^\s*<speak(\s|\/?>)/u,U0=/^\s*<\?xml\s/u;function Ug(r){return V0.test(r)||U0.test(r)}var W0="en-US",H0="riff-16khz-16bit-mono-pcm",K0="Microsoft Server Speech Text to Speech Voice (en-US, AriaNeural)",J0="SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU3LjU2LjEwMQAAAAAAAAAAAAAA//tAwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAACAAABhgC7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7u7//////////////////////////////////////////////////////////////////8AAAAATGF2YzU3LjY0AAAAAAAAAAAAAAAAJAUHAAAAAAAAAYYoRBqpAAAAAAD/+xDEAAPAAAGkAAAAIAAANIAAAARMQU1FMy45OS41VVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVf/7EMQpg8AAAaQAAAAgAAA0gAAABFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV";async function pw({deploymentId:r,fetchCredentials:e,lang:t=W0,outputFormat:i=H0,pitch:n,rate:s,text:o,voice:a=K0,volume:c}){if(!o)return uw(J0);let{authorizationToken:p,region:h,speechSynthesisHostname:d,subscriptionKey:v}=await e();if(p&&v||!p&&!v)throw new Error('Only "authorizationToken" or "subscriptionKey" should be set.');if(h&&d||!h&&!d)throw new Error('Only "region" or "speechSynthesisHostnamename" should be set.');let g=Ug(o)?o:Vg({lang:t,pitch:n,rate:s,text:o,voice:a,volume:c}),M=d||(r?`${encodeURI(h)}.voice.speech.microsoft.com`:`${encodeURI(h)}.tts.speech.microsoft.com`),A=r?`?deploymentId=${encodeURI(r)}`:"",H=`https://${M}/cognitiveservices/v1${A}`,ee=await fetch(H,{headers:{"Content-Type":"application/ssml+xml","X-Microsoft-OutputFormat":i,...p?{Authorization:`Bearer ${p}`}:{"Ocp-Apim-Subscription-Key":v}},method:"POST",body:g});if(!ee.ok)throw new Error(`web-speech-cognitive-services: Failed to syntheis speech, server returned ${ee.status}`);return ee.arrayBuffer()}function Wg(r,e,t){return r.addEventListener(e,t),()=>r.removeEventListener(e,t)}function $0(r,e){return new Promise((t,i)=>{let n=r.decodeAudioData(e,t,i);n&&typeof n.then=="function"&&t(n)})}function G0(r,e,t){return new Promise((i,n)=>{let s=new Bg,o=new Bg,a=Wg(r,"statechange",({target:{state:c}})=>c==="closed"&&s.eventListener());try{t.buffer=e,t.onended=o.eventListener,t.connect(r.destination),t.start(0),Promise.race([s.upcoming(),o.upcoming()]).then(i)}catch(c){n(c)}finally{a()}})}var Hg=class extends ur{constructor(e){super(),this._lang=null,this._pitch=1,this._rate=1,this._voice=null,this._volume=1,this.text=e,this.onboundary=null,this.onend=null,this.onerror=null,this.onmark=null,this.onpause=null,this.onresume=null,this.onstart=null}get lang(){return this._lang}set lang(e){this._lang=e}get onboundary(){return Wt(this,"boundary")}set onboundary(e){Ht(this,"boundary",e)}get onend(){return Wt(this,"end")}set onend(e){Ht(this,"end",e)}get onerror(){return Wt(this,"error")}set onerror(e){Ht(this,"error",e)}get onmark(){return Wt(this,"mark")}set onmark(e){Ht(this,"mark",e)}get onpause(){return Wt(this,"pause")}set onpause(e){Ht(this,"pause",e)}get onresume(){return Wt(this,"resume")}set onresume(e){Ht(this,"resume",e)}get onstart(){return Wt(this,"start")}set onstart(e){Ht(this,"start",e)}get pitch(){return this._pitch}set pitch(e){this._pitch=e}get rate(){return this._rate}set rate(e){this._rate=e}get voice(){return this._voice}set voice(e){this._voice=e}get volume(){return this._volume}set volume(e){this._volume=e}preload({deploymentId:e,fetchCredentials:t,outputFormat:i}){this.arrayBufferPromise=pw({fetchCredentials:t,deploymentId:e,lang:this.lang||window.navigator.language,outputFormat:i,pitch:this.pitch,rate:this.rate,text:this.text,voice:this.voice&&this.voice.voiceURI,volume:this.volume}),this.arrayBufferPromise.catch()}async play(e){try{this.dispatchEvent(new pr("start"));let t=e.createBufferSource(),i=await $0(e,await this.arrayBufferPromise);this._playingSource=t,await G0(e,i,t),this._playingSource=null,this.dispatchEvent(new pr("end"))}catch(t){this.dispatchEvent(new ErrorEvent("error",{error:"synthesis-failed",message:t.stack}))}}stop(){this._playingSource&&this._playingSource.stop()}},Kg=Hg;var Sn=class{constructor({gender:r,lang:e,voiceURI:t}){this._default=!1,this._gender=r,this._lang=e,this._localService=!1,this._name=t,this._voiceURI=t}get default(){return this._default}get gender(){return this._gender}get lang(){return this._lang}get localService(){return this._localService}get name(){return this._name}get voiceURI(){return this._voiceURI}};async function Q0({customVoiceHostname:r,deploymentId:e,region:t,subscriptionKey:i}){let n=r||`${t}.customvoice.api.speech.microsoft.com`,s=await fetch(`https://${encodeURI(n)}/api/texttospeech/v2.0/endpoints/${encodeURIComponent(e)}`,{headers:{accept:"application/json","ocp-apim-subscription-key":i}});if(!s.ok)throw new Error("Failed to fetch custom voices");return s.json()}async function lw({customVoiceHostname:r,deploymentId:e,region:t,subscriptionKey:i}){let{models:n}=await Q0({customVoiceHostname:r,deploymentId:e,region:t,subscriptionKey:i});return n.map(({properties:{Gender:s},locale:o,name:a})=>new Sn({gender:s,lang:o,voiceURI:a})).sort(({name:s},{name:o})=>s>o?1:s<o?-1:0)}async function Jg({authorizationToken:r,region:e,speechSynthesisHostname:t,subscriptionKey:i}){let n=t||`${encodeURI(e)}.tts.speech.microsoft.com`,s=await fetch(`https://${n}/cognitiveservices/voices/list`,{headers:{"content-type":"application/json",...r?{authorization:`Bearer ${r}`}:{"Ocp-Apim-Subscription-Key":i}}});if(!s.ok)throw new Error("Failed to fetch voices");return(await s.json()).map(({Gender:a,Locale:c,Name:p})=>new Sn({gender:a,lang:c,voiceURI:p})).sort(({name:a},{name:c})=>a>c?1:a<c?-1:0)}var X0="audio-24khz-160kbitrate-mono-mp3",Z0=[],hw=r=>{let{audioContext:e,fetchCredentials:t,ponyfill:i={AudioContext:window.AudioContext||window.webkitAudioContext},speechSynthesisDeploymentId:n,speechSynthesisOutputFormat:s=X0}=As(r);if(!e&&!i.AudioContext)return console.warn("web-speech-cognitive-services: This browser does not support Web Audio and it will not work with Cognitive Services Speech Services."),{};class o extends ur{constructor(){super(),this.queue=new hp({audioContext:e,ponyfill:i}),this.updateVoices()}cancel(){this.queue.stop()}getVoices(){return Z0}get onvoiceschanged(){return Wt(this,"voiceschanged")}set onvoiceschanged(c){Ht(this,"voiceschanged",c)}pause(){this.queue.pause()}resume(){this.queue.resume()}speak(c){if(!(c instanceof Kg))throw new Error("invalid utterance");let{reject:p,resolve:h,promise:d}=Ts(),v=({error:g,message:M})=>{let A=new Error(g);A.stack=M,p(A)};return c.addEventListener("end",h),c.addEventListener("error",v),c.preload({deploymentId:n,fetchCredentials:t,outputFormat:s}),this.queue.push(c),d.finally(()=>{c.removeEventListener("end",h),c.removeEventListener("error",v)})}get speaking(){return this.queue.speaking}async updateVoices(){let{customVoiceHostname:c,region:p,speechSynthesisHostname:h,subscriptionKey:d}=await t();n?d&&(console.warn("web-speech-cognitive-services: Listing of custom voice models are only available when using subscription key."),await Lg(async()=>{let v=await lw({customVoiceHostname:c,deploymentId:n,region:p,speechSynthesisHostname:h,subscriptionKey:d});this.getVoices=()=>v})):await Lg(async()=>{let v=await Jg(await t());this.getVoices=()=>v}),this.dispatchEvent(new pr("voiceschanged"))}}return{speechSynthesis:new o,SpeechSynthesisEvent:pr,SpeechSynthesisUtterance:Kg}};var $g=hw;function dp(r={}){return{...ks(r),...$g(r)}}var Gg=document.createElement("meta");Gg.setAttribute("name","web-speech-cognitive-services");Gg.setAttribute("content","version=8.1.3");document.head.appendChild(Gg);globalThis.WebSpeechCognitiveServices={create:dp,createSpeechRecognitionPonyfillFromRecognizer:Vr};})();
//# sourceMappingURL=web-speech-cognitive-services.production.min.js.map